<!DOCTYPE html>
<!-- saved from url=(0040)https://nixos.org/manual/nixpkgs/stable/ -->
<html lang="en" class="with-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>NixOS - Nixpkgs 20.09 manual</title>
  
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0">
  <style class="anchorjs"></style><link rel="stylesheet" href="./Nixpkgs-Manual-Version-20.09_files/index.css" type="text/css">

  <link rel="shortcut icon" type="image/png" href="https://nixos.org/favicon.png">
  <meta name="google-site-verification" content="ir-07nYvo3u3x_VmkTO1wCfYJ8uC-SrVBGR7hZgqPSE">

    <script>
    var html = document.documentElement;
    html.className = html.className.replace("without-js", "with-js");
  </script><style>@media print {#ghostery-tracker-tally {display:none !important}}</style>

  <script type="text/javascript" src="./Nixpkgs-Manual-Version-20.09_files/jquery.min.js"></script>

  <link rel="canonical" url="https://nixos.org/manual/nixpkgs/stable">
</head>

<body data-nixpkgs-channels="[{&quot;channel&quot;:&quot;unstable&quot;,&quot;version&quot;:&quot;21.05&quot;},{&quot;channel&quot;:&quot;stable&quot;,&quot;version&quot;:&quot;20.09&quot;}]">
  <header>
    <div>
      <h1><a href="https://nixos.org/">NixOS</a></h1>
            <nav style="display: none;">
        <ul>
<li class="">  <a href="https://nixos.org/explore.html">Explore</a></li>
<li class="">  <a href="https://nixos.org/download.html">Download</a></li>
<li class="">  <a href="https://nixos.org/learn.html">Learn</a></li>
<li class="">  <a href="https://nixos.org/community.html">Community</a></li>
<li class="">  <a href="https://nixos.org/governance.html">Governance</a></li>
<li class="">  <a href="https://nixos.org/donate.html">Donate</a></li>
<li class=" activesearch">          <a href="https://search.nixos.org/packages">Search</a></li>        </ul>
      </nav>
    </div>
  <button class="menu-toggle">Toggle the menu</button></header>

  <main>
<section class="generic-layout docbook-page"><script xmlns="http://www.w3.org/1999/xhtml" src="./Nixpkgs-Manual-Version-20.09_files/highlight.pack.js" type="text/javascript" xml:space="preserve"></script><script xmlns="http://www.w3.org/1999/xhtml" src="./Nixpkgs-Manual-Version-20.09_files/loader.js" type="text/javascript" xml:space="preserve"></script><link xmlns="http://www.w3.org/1999/xhtml" rel="stylesheet" type="text/css" href="./Nixpkgs-Manual-Version-20.09_files/overrides.css"><link xmlns="http://www.w3.org/1999/xhtml" rel="stylesheet" type="text/css" href="./Nixpkgs-Manual-Version-20.09_files/mono-blue.css"><div xmlns="http://www.w3.org/1999/xhtml" class="page-header"><h1 id="nixpkgs-manual"><a id="idm140737322703360" shape="rect"></a>Nixpkgs Manual<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#nixpkgs-manual" aria-label="Anchor link for: nixpkgs manual" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h1><h2 id="version-20-09">Version 20.09<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#version-20-09" aria-label="Anchor link for: version 20 09" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div><ul xmlns="http://www.w3.org/1999/xhtml" class="hidden"></ul><div xmlns="http://www.w3.org/1999/xhtml" class="docbook"><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#preface" shape="rect">1. Preface</a></span></dt><dt><span class="part"><a href="https://nixos.org/manual/nixpkgs/stable/#idm140737322634096" shape="rect">I. Using Nixpkgs</a></span></dt><dd><dl><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-packageconfig" shape="rect">2. Global configuration</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays" shape="rect">3. Overlays</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-overrides" shape="rect">4. Overriding</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-functions" shape="rect">5. Functions reference</a></span></dt></dl></dd><dt><span class="part"><a href="https://nixos.org/manual/nixpkgs/stable/#idm140737320561136" shape="rect">II. Standard environment</a></span></dt><dd><dl><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" shape="rect">6. The Standard Environment</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-meta" shape="rect">7. Meta-attributes</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output" shape="rect">8. Multiple-output packages</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-cross" shape="rect">9. Cross-compilation</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-notes" shape="rect">10. Platform Notes</a></span></dt></dl></dd><dt><span class="part"><a href="https://nixos.org/manual/nixpkgs/stable/#idm140737319477504" shape="rect">III. Builders</a></span></dt><dd><dl><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers" shape="rect">11. Fetchers</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-trivial-builders" shape="rect">12. Trivial builders</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-special" shape="rect">13. Special builders</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-images" shape="rect">14. Images</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support" shape="rect">15. Languages and frameworks</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-packages" shape="rect">16. Packages</a></span></dt></dl></dd><dt><span class="part"><a href="https://nixos.org/manual/nixpkgs/stable/#idm140737317098448" shape="rect">IV. Contributing to Nixpkgs</a></span></dt><dd><dl><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-quick-start" shape="rect">17. Quick Start to Adding a Package</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-conventions" shape="rect">18. Coding conventions</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-submitting-changes" shape="rect">19. Submitting changes</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-reviewing-contributions" shape="rect">20. Reviewing contributions</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-contributing" shape="rect">21. Contributing to this documentation</a></span></dt></dl></dd></dl></div><div class="list-of-tables"><p><strong>List of Tables</strong></p><dl><dt>9.1. <a href="https://nixos.org/manual/nixpkgs/stable/#idm140737319592656" shape="rect">Possible dependency types</a></dt></dl></div><section class="chapter"><div class="titlepage"><div><div><div class="page-header"><h1 id="preface" class="title">Chapter&nbsp;1.&nbsp;Preface<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#preface" aria-label="Anchor link for: preface" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h1></div></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#overview-of-nixpkgs" shape="rect">1.1. Overview of Nixpkgs</a></span></dt></dl></div><p>
   The Nix Packages collection (Nixpkgs) is a set of thousands of packages for the <a class="link" href="https://nixos.org/nix/" target="_top" shape="rect">Nix package manager</a>, released under a <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/COPYING" target="_top" shape="rect">permissive MIT/X11 license</a>. Packages are available for several platforms, and can be used with the Nix package manager on most GNU/Linux distributions as well as <a class="link" href="https://nixos.org/nixos" target="_top" shape="rect">NixOS</a>.
  </p><p>
   This manual primarily describes how to write packages for the Nix Packages collection (Nixpkgs). Thus it’s mainly for packagers and developers who want to add packages to Nixpkgs. If you like to learn more about the Nix package manager and the Nix expression language, then you are kindly referred to the <a class="link" href="https://nixos.org/nix/manual/" target="_top" shape="rect">Nix manual</a>. The NixOS distribution is documented in the <a class="link" href="https://nixos.org/nixos/manual/" target="_top" shape="rect">NixOS manual</a>.
  </p><section class="section"><div class="titlepage"><div><div><h2 id="overview-of-nixpkgs" class="title" style="clear: both">1.1.&nbsp;Overview of Nixpkgs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#overview-of-nixpkgs" aria-label="Anchor link for: overview of nixpkgs" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
    Nix expressions describe how to build packages from source and are collected in the <a class="link" href="https://github.com/NixOS/nixpkgs" target="_top" shape="rect">nixpkgs repository</a>. Also included in the collection are Nix expressions for <a class="link" href="https://nixos.org/nixos/manual/index.html#sec-writing-modules" target="_top" shape="rect">NixOS modules</a>. With these expressions the Nix package manager can build binary packages.
   </p><p>
    Packages, including the Nix packages collection, are distributed through <a class="link" href="https://nixos.org/nix/manual/#sec-channels" target="_top" shape="rect">channels</a>. The collection is distributed for users of Nix on non-NixOS distributions through the channel <code class="literal">nixpkgs</code>. Users of NixOS generally use one of the <code class="literal">nixos-*</code> channels, e.g. <code class="literal">nixos-19.09</code>, which includes all packages and modules for the stable NixOS 19.09. Stable NixOS releases are generally only given security updates. More up to date packages and modules are available via the <code class="literal">nixos-unstable</code> channel.
   </p><p>
    Both <code class="literal">nixos-unstable</code> and <code class="literal">nixpkgs</code> follow the <code class="literal">master</code> branch of the Nixpkgs repository, although both do lag the <code class="literal">master</code> branch by generally <a class="link" href="https://status.nixos.org/" target="_top" shape="rect">a couple of days</a>. Updates to a channel are distributed as soon as all tests for that channel pass, e.g. <a class="link" href="https://hydra.nixos.org/job/nixpkgs/trunk/unstable#tabs-constituents" target="_top" shape="rect">this table</a> shows the status of tests for the <code class="literal">nixpkgs</code> channel.
   </p><p>
    The tests are conducted by a cluster called <a class="link" href="https://nixos.org/hydra/" target="_top" shape="rect">Hydra</a>, which also builds binary packages from the Nix expressions in Nixpkgs for <code class="literal">x86_64-linux</code>, <code class="literal">i686-linux</code> and <code class="literal">x86_64-darwin</code>. The binaries are made available via a <a class="link" href="https://cache.nixos.org/" target="_top" shape="rect">binary cache</a>.
   </p><p>
    The current Nix expressions of the channels are available in the <a class="link" href="https://github.com/NixOS/nixpkgs" target="_top" shape="rect"><code class="literal">nixpkgs</code></a> repository in branches that correspond to the channel names (e.g.&nbsp;<code class="literal">nixos-19.09-small</code>).
   </p></section></section><div class="part"><div class="titlepage"><div><div><div class="page-header"><h1 id="idm140737322634096" class="title">Part&nbsp;I.&nbsp;Using Nixpkgs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#idm140737322634096" aria-label="Anchor link for: idm140737322634096" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h1></div></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-packageconfig" shape="rect">2. Global configuration</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays" shape="rect">3. Overlays</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-overrides" shape="rect">4. Overriding</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-functions" shape="rect">5. Functions reference</a></span></dt></dl></div><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-packageconfig" class="title">Chapter&nbsp;2.&nbsp;Global configuration<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-packageconfig" aria-label="Anchor link for: chap packageconfig" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-broken" shape="rect">2.1. Installing broken packages</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unsupported-system" shape="rect">2.2. Installing packages on unsupported systems</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unfree" shape="rect">2.3. Installing unfree packages</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-insecure" shape="rect">2.4. Installing insecure packages</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-modify-via-packageOverrides" shape="rect">2.5. Modify packages via <code class="literal">packageOverrides</code></a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-declarative-package-management" shape="rect">2.6. Declarative Package Management</a></span></dt></dl></div><p>
    Nix comes with certain defaults about what packages can and cannot be installed, based on a package's metadata. By default, Nix will prevent installation if any of the following criteria are true:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      The package is thought to be broken, and has had its <code class="literal">meta.broken</code> set to <code class="literal">true</code>.
     </p></li><li class="listitem"><p>
      The package isn't intended to run on the given system, as none of its <code class="literal">meta.platforms</code> match the given system.
     </p></li><li class="listitem"><p>
      The package's <code class="literal">meta.license</code> is set to a license which is considered to be unfree.
     </p></li><li class="listitem"><p>
      The package has known security vulnerabilities but has not or can not be updated for some reason, and a list of issues has been entered in to the package's <code class="literal">meta.knownVulnerabilities</code>.
     </p></li></ul></div><p>
    Note that all this is checked during evaluation already, and the check includes any package that is evaluated. In particular, all build-time dependencies are checked. <code class="literal">nix-env -qa</code> will (attempt to) hide any packages that would be refused.
   </p><p>
    Each of these criteria can be altered in the nixpkgs configuration.
   </p><p>
    The nixpkgs configuration for a NixOS system is set in the <code class="literal">configuration.nix</code>, as in the following example:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  nixpkgs.<span class="hljs-attr"><span class="hljs-attr">config</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">allowUnfree</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  };
}
</pre><p>
    However, this does not allow unfree software for individual users. Their configurations are managed separately.
   </p><p>
    A user's nixpkgs configuration is stored in a user-specific configuration file located at <code class="filename">~/.config/nixpkgs/config.nix</code>. For example:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">allowUnfree</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}
</pre><p>
   </p><p>
    Note that we are not able to test or build unfree software on Hydra due to policy. Most unfree licenses prohibit us from either executing or distributing the software.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-allow-broken" class="title" style="clear: both">2.1.&nbsp;Installing broken packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-broken" aria-label="Anchor link for: sec allow broken" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     There are two ways to try compiling a package which has been marked as broken.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       For allowing the build of a broken package once, you can use an environment variable for a single invocation of the nix tools:
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>export <span class="hljs-attr"><span class="hljs-attr">NIXPKGS_ALLOW_BROKEN=1</span></span></pre><p>
      </p></li><li class="listitem"><p>
       For permanently allowing broken packages to be built, you may add <code class="literal">allowBroken = true;</code> to your user's configuration file, like this:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">allowBroken</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}
</pre><p>
      </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-allow-unsupported-system" class="title" style="clear: both">2.2.&nbsp;Installing packages on unsupported systems<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unsupported-system" aria-label="Anchor link for: sec allow unsupported system" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     There are also two ways to try compiling a package which has been marked as unsupported for the given system.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       For allowing the build of an unsupported package once, you can use an environment variable for a single invocation of the nix tools:
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>export <span class="hljs-attr"><span class="hljs-attr">NIXPKGS_ALLOW_UNSUPPORTED_SYSTEM=1</span></span></pre><p>
      </p></li><li class="listitem"><p>
       For permanently allowing unsupported packages to be built, you may add <code class="literal">allowUnsupportedSystem = true;</code> to your user's configuration file, like this:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">allowUnsupportedSystem</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}
</pre><p>
      </p></li></ul></div><p>
     The difference between a package being unsupported on some system and being broken is admittedly a bit fuzzy. If a program <span class="emphasis"><em>ought</em></span> to work on a certain platform, but doesn't, the platform should be included in <code class="literal">meta.platforms</code>, but marked as broken with e.g. <code class="literal">meta.broken = !hostPlatform.isWindows</code>. Of course, this begs the question of what "ought" means exactly. That is left to the package maintainer.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-allow-unfree" class="title" style="clear: both">2.3.&nbsp;Installing unfree packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-unfree" aria-label="Anchor link for: sec allow unfree" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     There are several ways to tweak how Nix handles a package which has been marked as unfree.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       To temporarily allow all unfree packages, you can use an environment variable for a single invocation of the nix tools:
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>export <span class="hljs-attr"><span class="hljs-attr">NIXPKGS_ALLOW_UNFREE=1</span></span></pre><p>
      </p></li><li class="listitem"><p>
       It is possible to permanently allow individual unfree packages, while still blocking unfree packages by default using the <code class="literal">allowUnfreePredicate</code> configuration option in the user configuration file.
      </p><p>
       This option is a function which accepts a package as a parameter, and returns a boolean. The following example configuration accepts a package and always returns false:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">allowUnfreePredicate</span></span> = (pkg: <span class="hljs-literal"><span class="hljs-literal">false</span></span>);
}
</pre><p>
      </p><p>
       For a more useful example, try the following. This configuration only allows unfree packages named flash player and visual studio code:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">allowUnfreePredicate</span></span> = pkg: <span class="hljs-built_in"><span class="hljs-built_in">builtins</span></span>.elem (lib.getName pkg) [
    <span class="hljs-string"><span class="hljs-string">"flashplayer"</span></span>
    <span class="hljs-string"><span class="hljs-string">"vscode"</span></span>
  ];
}
</pre><p>
      </p></li><li class="listitem"><p>
       It is also possible to whitelist and blacklist licenses that are specifically acceptable or not acceptable, using <code class="literal">whitelistedLicenses</code> and <code class="literal">blacklistedLicenses</code>, respectively.
      </p><p>
       The following example configuration whitelists the licenses <code class="literal">amd</code> and <code class="literal">wtfpl</code>:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">whitelistedLicenses</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> stdenv.lib.licenses; [ amd wtfpl ];
}
</pre><p>
      </p><p>
       The following example configuration blacklists the <code class="literal">gpl3Only</code> and <code class="literal">agpl3Only</code> licenses:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">blacklistedLicenses</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> stdenv.lib.licenses; [ agpl3Only gpl3Only ];
}
</pre><p>
      </p></li></ul></div><p>
     A complete list of licenses can be found in the file <code class="filename">lib/licenses.nix</code> of the nixpkgs tree.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-allow-insecure" class="title" style="clear: both">2.4.&nbsp;Installing insecure packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-allow-insecure" aria-label="Anchor link for: sec allow insecure" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     There are several ways to tweak how Nix handles a package which has been marked as insecure.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       To temporarily allow all insecure packages, you can use an environment variable for a single invocation of the nix tools:
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>export <span class="hljs-attr"><span class="hljs-attr">NIXPKGS_ALLOW_INSECURE=1</span></span></pre><p>
      </p></li><li class="listitem"><p>
       It is possible to permanently allow individual insecure packages, while still blocking other insecure packages by default using the <code class="literal">permittedInsecurePackages</code> configuration option in the user configuration file.
      </p><p>
       The following example configuration permits the installation of the hypothetically insecure package <code class="literal">hello</code>, version <code class="literal">1.2.3</code>:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">permittedInsecurePackages</span></span> = [
    <span class="hljs-string"><span class="hljs-string">"hello-1.2.3"</span></span>
  ];
}
</pre><p>
      </p></li><li class="listitem"><p>
       It is also possible to create a custom policy around which insecure packages to allow and deny, by overriding the <code class="literal">allowInsecurePredicate</code> configuration option.
      </p><p>
       The <code class="literal">allowInsecurePredicate</code> option is a function which accepts a package and returns a boolean, much like <code class="literal">allowUnfreePredicate</code>.
      </p><p>
       The following configuration example only allows insecure packages with very short names:
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">allowInsecurePredicate</span></span> = pkg: <span class="hljs-built_in"><span class="hljs-built_in">builtins</span></span>.stringLength (lib.getName pkg) &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span>;
}
</pre><p>
      </p><p>
       Note that <code class="literal">permittedInsecurePackages</code> is only checked if <code class="literal">allowInsecurePredicate</code> is not specified.
      </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-modify-via-packageOverrides" class="title" style="clear: both">2.5.&nbsp;Modify packages via <code class="literal">packageOverrides</code><a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-modify-via-packageOverrides" aria-label="Anchor link for: sec modify via packageOverrides" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     You can define a function called <code class="varname">packageOverrides</code> in your local <code class="filename">~/.config/nixpkgs/config.nix</code> to override Nix packages. It must be a function that takes pkgs as an argument and returns a modified set of packages.
</p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
    <span class="hljs-attr"><span class="hljs-attr">foo</span></span> = pkgs.foo.override { ... };
  };
}
</pre><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-declarative-package-management" class="title" style="clear: both">2.6.&nbsp;Declarative Package Management<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-declarative-package-management" aria-label="Anchor link for: sec declarative package management" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="sec-building-environment" class="title">2.6.1.&nbsp;Build an environment<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-building-environment" aria-label="Anchor link for: sec building environment" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Using <code class="literal">packageOverrides</code>, it is possible to manage packages declaratively. This means that we can list all of our desired packages within a declarative Nix expression. For example, to have <code class="literal">aspell</code>, <code class="literal">bc</code>, <code class="literal">ffmpeg</code>, <code class="literal">coreutils</code>, <code class="literal">gdb</code>, <code class="literal">nixUnstable</code>, <code class="literal">emscripten</code>, <code class="literal">jq</code>, <code class="literal">nox</code>, and <code class="literal">silver-searcher</code>, we could use the following in <code class="filename">~/.config/nixpkgs/config.nix</code>:
     </p><pre class="screen hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; {
    <span class="hljs-attr"><span class="hljs-attr">myPackages</span></span> = pkgs.buildEnv {
      <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-packages"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">paths</span></span> = [
        aspell
        bc
        coreutils
        gdb
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
    };
  };
}
</pre><p>
      To install it into our environment, you can just run <code class="literal">nix-env -iA nixpkgs.myPackages</code>. If you want to load the packages to be built from a working copy of <code class="literal">nixpkgs</code> you just run <code class="literal">nix-env -f. -iA myPackages</code>. To explore what's been installed, just look through <code class="filename">~/.nix-profile/</code>. You can see that a lot of stuff has been installed. Some of this stuff is useful some of it isn't. Let's tell Nixpkgs to only link the stuff that we want:
     </p><pre class="screen hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; {
    <span class="hljs-attr"><span class="hljs-attr">myPackages</span></span> = pkgs.buildEnv {
      <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-packages"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">paths</span></span> = [
        aspell
        bc
        coreutils
        gdb
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      <span class="hljs-attr"><span class="hljs-attr">pathsToLink</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/share"</span></span> <span class="hljs-string"><span class="hljs-string">"/bin"</span></span> ];
    };
  };
}
</pre><p>
      <code class="literal">pathsToLink</code> tells Nixpkgs to only link the paths listed which gets rid of the extra stuff in the profile. <code class="filename">/bin</code> and <code class="filename">/share</code> are good defaults for a user environment, getting rid of the clutter. If you are running on Nix on MacOS, you may want to add another path as well, <code class="filename">/Applications</code>, that makes GUI apps available.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-getting-documentation" class="title">2.6.2.&nbsp;Getting documentation<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-getting-documentation" aria-label="Anchor link for: sec getting documentation" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      After building that new environment, look through <code class="filename">~/.nix-profile</code> to make sure everything is there that we wanted. Discerning readers will note that some files are missing. Look inside <code class="filename">~/.nix-profile/share/man/man1/</code> to verify this. There are no man pages for any of the Nix tools! This is because some packages like Nix have multiple outputs for things like documentation (see section 4). Let's make Nix install those as well.
     </p><pre class="screen hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; {
    <span class="hljs-attr"><span class="hljs-attr">myPackages</span></span> = pkgs.buildEnv {
      <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-packages"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">paths</span></span> = [
        aspell
        bc
        coreutils
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      <span class="hljs-attr"><span class="hljs-attr">pathsToLink</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/share/man"</span></span> <span class="hljs-string"><span class="hljs-string">"/share/doc"</span></span> <span class="hljs-string"><span class="hljs-string">"/bin"</span></span> ];
      <span class="hljs-attr"><span class="hljs-attr">extraOutputsToInstall</span></span> = [ <span class="hljs-string"><span class="hljs-string">"man"</span></span> <span class="hljs-string"><span class="hljs-string">"doc"</span></span> ];
    };
  };
}
</pre><p>
      This provides us with some useful documentation for using our packages. However, if we actually want those manpages to be detected by man, we need to set up our environment. This can also be managed within Nix expressions.
     </p><pre class="screen hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
    <span class="hljs-attr"><span class="hljs-attr">myProfile</span></span> = writeText <span class="hljs-string"><span class="hljs-string">"my-profile"</span></span> <span class="hljs-string"><span class="hljs-string">''
      export PATH=$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/sbin:/bin:/usr/sbin:/usr/bin
      export MANPATH=$HOME/.nix-profile/share/man:/nix/var/nix/profiles/default/share/man:/usr/share/man
    ''</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">myPackages</span></span> = pkgs.buildEnv {
      <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-packages"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">paths</span></span> = [
        (runCommand <span class="hljs-string"><span class="hljs-string">"profile"</span></span> {} <span class="hljs-string"><span class="hljs-string">''
          mkdir -p $out/etc/profile.d
          cp </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${myProfile}</span></span></span><span class="hljs-string"> $out/etc/profile.d/my-profile.sh
        ''</span></span>)
        aspell
        bc
        coreutils
        ffmpeg
        man
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      <span class="hljs-attr"><span class="hljs-attr">pathsToLink</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/share/man"</span></span> <span class="hljs-string"><span class="hljs-string">"/share/doc"</span></span> <span class="hljs-string"><span class="hljs-string">"/bin"</span></span> <span class="hljs-string"><span class="hljs-string">"/etc"</span></span> ];
      <span class="hljs-attr"><span class="hljs-attr">extraOutputsToInstall</span></span> = [ <span class="hljs-string"><span class="hljs-string">"man"</span></span> <span class="hljs-string"><span class="hljs-string">"doc"</span></span> ];
    };
  };
}
</pre><p>
      For this to work fully, you must also have this script sourced when you are logged in. Try adding something like this to your <code class="filename">~/.profile</code> file:
     </p><pre class="screen hljs bash" xml:space="preserve"><span class="hljs-meta"><span class="hljs-meta">#!/bin/sh</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -d <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.nix-profile/etc/profile.d ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.nix-profile/etc/profile.d/*.sh; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -r <span class="hljs-variable"><span class="hljs-variable">$i</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
      . <span class="hljs-variable"><span class="hljs-variable">$i</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">fi</span></span>
</pre><p>
      Now just run <code class="literal">source $HOME/.profile</code> and you can starting loading man pages from your environment.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-gnu-info-setup" class="title">2.6.3.&nbsp;GNU info setup<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-gnu-info-setup" aria-label="Anchor link for: sec gnu info setup" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Configuring GNU info is a little bit trickier than man pages. To work correctly, info needs a database to be generated. This can be done with some small modifications to our environment scripts.
     </p><pre class="screen hljs bash" xml:space="preserve">{
  packageOverrides = pkgs: with pkgs; rec {
    myProfile = writeText <span class="hljs-string"><span class="hljs-string">"my-profile"</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>
      <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/sbin:/bin:/usr/sbin:/usr/bin
      <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MANPATH=<span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.nix-profile/share/man:/nix/var/nix/profiles/default/share/man:/usr/share/man
      <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> INFOPATH=<span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.nix-profile/share/info:/nix/var/nix/profiles/default/share/info:/usr/share/info
    <span class="hljs-string"><span class="hljs-string">''</span></span>;
    myPackages = pkgs.buildEnv {
      name = <span class="hljs-string"><span class="hljs-string">"my-packages"</span></span>;
      paths = [
        (runCommand <span class="hljs-string"><span class="hljs-string">"profile"</span></span> {} <span class="hljs-string"><span class="hljs-string">''</span></span>
          mkdir -p <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/etc/profile.d
          cp <span class="hljs-variable"><span class="hljs-variable">${myProfile}</span></span> <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/etc/profile.d/my-profile.sh
        <span class="hljs-string"><span class="hljs-string">''</span></span>)
        aspell
        bc
        coreutils
        ffmpeg
        man
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
        texinfoInteractive
      ];
      pathsToLink = [ <span class="hljs-string"><span class="hljs-string">"/share/man"</span></span> <span class="hljs-string"><span class="hljs-string">"/share/doc"</span></span> <span class="hljs-string"><span class="hljs-string">"/share/info"</span></span> <span class="hljs-string"><span class="hljs-string">"/bin"</span></span> <span class="hljs-string"><span class="hljs-string">"/etc"</span></span> ];
      extraOutputsToInstall = [ <span class="hljs-string"><span class="hljs-string">"man"</span></span> <span class="hljs-string"><span class="hljs-string">"doc"</span></span> <span class="hljs-string"><span class="hljs-string">"info"</span></span> ];
      postBuild = <span class="hljs-string"><span class="hljs-string">''</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -x <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin/install-info -a -w <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share/info ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
          <span class="hljs-built_in"><span class="hljs-built_in">shopt</span></span> -s nullglob
          <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share/info/*.info <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share/info/*.info.gz; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>
              <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin/install-info <span class="hljs-variable"><span class="hljs-variable">$i</span></span> <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share/info/dir
          <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span>
      <span class="hljs-string"><span class="hljs-string">''</span></span>;
    };
  };
}
</pre><p>
      <code class="literal">postBuild</code> tells Nixpkgs to run a command after building the environment. In this case, <code class="literal">install-info</code> adds the installed info pages to <code class="literal">dir</code> which is GNU info's default root node. Note that <code class="literal">texinfoInteractive</code> is added to the environment to give the <code class="literal">install-info</code> command.
     </p></section></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-overlays" class="title">Chapter&nbsp;3.&nbsp;Overlays<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays" aria-label="Anchor link for: chap overlays" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-install" shape="rect">3.1. Installing overlays</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-definition" shape="rect">3.2. Defining overlays</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives" shape="rect">3.3. Using overlays to configure alternatives</a></span></dt></dl></div><p>
    This chapter describes how to extend and change Nixpkgs using overlays. Overlays are used to add layers in the fixed-point used by Nixpkgs to compose the set of all packages.
   </p><p>
    Nixpkgs can be configured with a list of overlays, which are applied in order. This means that the order of the overlays can be significant if multiple layers override the same package.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-overlays-install" class="title" style="clear: both">3.1.&nbsp;Installing overlays<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-install" aria-label="Anchor link for: sec overlays install" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The list of overlays can be set either explicitly in a Nix expression, or through <code class="literal">&lt;nixpkgs-overlays&gt;</code> or user configuration files.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-overlays-argument" class="title">3.1.1.&nbsp;Set overlays in NixOS or Nix expressions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-argument" aria-label="Anchor link for: sec overlays argument" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      On a NixOS system the value of the <code class="literal">nixpkgs.overlays</code> option, if present, is passed to the system Nixpkgs directly as an argument. Note that this does not affect the overlays for non-NixOS operations (e.g. <code class="literal">nix-env</code>), which are <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-lookup" title="3.1.2. Install overlays via configuration lookup" shape="rect">looked</a> up independently.
     </p><p>
      The list of overlays can be passed explicitly when importing nixpkgs, for example <code class="literal">import &lt;nixpkgs&gt; { overlays = [ overlay1 overlay2 ]; }</code>.
     </p><p>
      Further overlays can be added by calling the <code class="literal">pkgs.extend</code> or <code class="literal">pkgs.appendOverlays</code>, although it is often preferable to avoid these functions, because they recompute the Nixpkgs fixpoint, which is somewhat expensive to do.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-overlays-lookup" class="title">3.1.2.&nbsp;Install overlays via configuration lookup<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-lookup" aria-label="Anchor link for: sec overlays lookup" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The list of overlays is determined as follows.
     </p><p>
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
         First, if an <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-argument" title="3.1.1. Set overlays in NixOS or Nix expressions" shape="rect"><code class="varname">overlays</code> argument</a> to the Nixpkgs function itself is given, then that is used and no path lookup will be performed.
        </p></li><li class="listitem"><p>
         Otherwise, if the Nix path entry <code class="literal">&lt;nixpkgs-overlays&gt;</code> exists, we look for overlays at that path, as described below.
        </p><p>
         See the section on <code class="literal">NIX_PATH</code> in the Nix manual for more details on how to set a value for <code class="literal">&lt;nixpkgs-overlays&gt;.</code>
        </p></li><li class="listitem"><p>
         If one of <code class="filename">~/.config/nixpkgs/overlays.nix</code> and <code class="filename">~/.config/nixpkgs/overlays/</code> exists, then we look for overlays at that path, as described below. It is an error if both exist.
        </p></li></ol></div><p>
     </p><p>
      If we are looking for overlays at a path, then there are two cases:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         If the path is a file, then the file is imported as a Nix expression and used as the list of overlays.
        </p></li><li class="listitem"><p>
         If the path is a directory, then we take the content of the directory, order it lexicographically, and attempt to interpret each as an overlay by:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            Importing the file, if it is a <code class="literal">.nix</code> file.
           </p></li><li class="listitem"><p>
            Importing a top-level <code class="filename">default.nix</code> file, if it is a directory.
           </p></li></ul></div><p>
        </p></li></ul></div><p>
     </p><p>
      Because overlays that are set in NixOS configuration do not affect non-NixOS operations such as <code class="literal">nix-env</code>, the <code class="filename">overlays.nix</code> option provides a convenient way to use the same overlays for a NixOS system configuration and user configuration: the same file can be used as <code class="filename">overlays.nix</code> and imported as the value of <code class="literal">nixpkgs.overlays</code>.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-overlays-definition" class="title" style="clear: both">3.2.&nbsp;Defining overlays<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-definition" aria-label="Anchor link for: sec overlays definition" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Overlays are Nix functions which accept two arguments, conventionally called <code class="varname">self</code> and <code class="varname">super</code>, and return a set of packages. For example, the following is a valid overlay.
    </p><pre class="programlisting hljs nix" xml:space="preserve">self: super:

{
  <span class="hljs-attr"><span class="hljs-attr">boost</span></span> = super.boost.override {
    <span class="hljs-attr"><span class="hljs-attr">python</span></span> = self.python3;
  };
  <span class="hljs-attr"><span class="hljs-attr">rr</span></span> = super.callPackage ./pkgs/rr {
    <span class="hljs-attr"><span class="hljs-attr">stdenv</span></span> = self.stdenv_32bit;
  };
}
</pre><p>
     The first argument (<code class="varname">self</code>) corresponds to the final package set. You should use this set for the dependencies of all packages specified in your overlay. For example, all the dependencies of <code class="varname">rr</code> in the example above come from <code class="varname">self</code>, as well as the overridden dependencies used in the <code class="varname">boost</code> override.
    </p><p>
     The second argument (<code class="varname">super</code>) corresponds to the result of the evaluation of the previous stages of Nixpkgs. It does not contain any of the packages added by the current overlay, nor any of the following overlays. This set should be used either to refer to packages you wish to override, or to access functions defined in Nixpkgs. For example, the original recipe of <code class="varname">boost</code> in the above example, comes from <code class="varname">super</code>, as well as the <code class="varname">callPackage</code> function.
    </p><p>
     The value returned by this function should be a set similar to <code class="filename">pkgs/top-level/all-packages.nix</code>, containing overridden and/or new packages.
    </p><p>
     Overlays are similar to other methods for customizing Nixpkgs, in particular the <code class="literal">packageOverrides</code> attribute described in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-modify-via-packageOverrides" title="2.5. Modify packages via packageOverrides" shape="rect">Section&nbsp;2.5, “Modify packages via <code class="literal">packageOverrides</code>”</a>. Indeed, <code class="literal">packageOverrides</code> acts as an overlay with only the <code class="varname">super</code> argument. It is therefore appropriate for basic use, but overlays are more powerful and easier to distribute.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-overlays-alternatives" class="title" style="clear: both">3.3.&nbsp;Using overlays to configure alternatives<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives" aria-label="Anchor link for: sec overlays alternatives" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Certain software packages have different implementations of the same interface. Other distributions have functionality to switch between these. For example, Debian provides <a class="link" href="https://wiki.debian.org/DebianAlternatives" target="_top" shape="rect">DebianAlternatives</a>. Nixpkgs has what we call <code class="literal">alternatives</code>, which are configured through overlays.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-overlays-alternatives-blas-lapack" class="title">3.3.1.&nbsp;BLAS/LAPACK<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives-blas-lapack" aria-label="Anchor link for: sec overlays alternatives blas lapack" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      In Nixpkgs, we have multiple implementations of the BLAS/LAPACK numerical linear algebra interfaces. They are:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="https://www.openblas.net/" target="_top" shape="rect">OpenBLAS</a>
       </p><p>
        The Nixpkgs attribute is <code class="literal">openblas</code> for ILP64 (integer width = 64 bits) and <code class="literal">openblasCompat</code> for LP64 (integer width = 32 bits). <code class="literal">openblasCompat</code> is the default.
       </p></li><li class="listitem"><p>
        <a class="link" href="http://www.netlib.org/lapack/" target="_top" shape="rect">LAPACK reference</a> (also provides BLAS)
       </p><p>
        The Nixpkgs attribute is <code class="literal">lapack-reference</code>.
       </p></li><li class="listitem"><p>
        <a class="link" href="https://software.intel.com/en-us/mkl" target="_top" shape="rect">Intel MKL</a> (only works on the x86_64 architecture, unfree)
       </p><p>
        The Nixpkgs attribute is <code class="literal">mkl</code>.
       </p></li><li class="listitem"><p>
        <a class="link" href="https://developer.amd.com/amd-aocl/blas-library/" target="_top" shape="rect">AMD BLIS/LIBFLAME</a> (optimized for modern AMD x86_64 CPUs)
       </p><p>
        The AMD BLIS library, with attribute <code class="literal">amd-blis</code>, provides a BLAS implementation. The complementary AMD LIBFLAME library, with attribute <code class="literal">amd-libflame</code>, provides a LAPACK implementation.
       </p></li></ul></div><p>
      Introduced in <a class="link" href="https://github.com/NixOS/nixpkgs/pull/83888" target="_top" shape="rect">PR #83888</a>, we are able to override the <code class="literal">blas</code> and <code class="literal">lapack</code> packages to use different implementations, through the <code class="literal">blasProvider</code> and <code class="literal">lapackProvider</code> argument. This can be used to select a different provider. BLAS providers will have symlinks in <code class="literal">$out/lib/libblas.so.3</code> and <code class="literal">$out/lib/libcblas.so.3</code> to their respective BLAS libraries. Likewise, LAPACK providers will have symlinks in <code class="literal">$out/lib/liblapack.so.3</code> and <code class="literal">$out/lib/liblapacke.so.3</code> to their respective LAPACK libraries. For example, Intel MKL is both a BLAS and LAPACK provider. An overlay can be created to use Intel MKL that looks like:
     </p><pre class="programlisting hljs nix" xml:space="preserve">self: super:

{
  <span class="hljs-attr"><span class="hljs-attr">blas</span></span> = super.blas.override {
    <span class="hljs-attr"><span class="hljs-attr">blasProvider</span></span> = self.mkl;
  }
  <span class="hljs-attr"><span class="hljs-attr">lapack</span></span> = super.lapack.override {
    <span class="hljs-attr"><span class="hljs-attr">lapackProvider</span></span> = self.mkl;
  }
}
</pre><p>
      This overlay uses Intel’s MKL library for both BLAS and LAPACK interfaces. Note that the same can be accomplished at runtime using <code class="literal">LD_LIBRARY_PATH</code> of <code class="literal">libblas.so.3</code> and <code class="literal">liblapack.so.3</code>. For instance:
     </p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code><span class="hljs-attr"><span class="hljs-attr">LD_LIBRARY_PATH=$(nix-build</span></span> -A mkl)/lib:$LD_LIBRARY_PATH nix-shell -p octave --run octave
</pre><p>
      Intel MKL requires an <code class="literal">openmp</code> implementation when running with multiple processors. By default, <code class="literal">mkl</code> will use Intel’s <code class="literal">iomp</code> implementation if no other is specified, but this is a runtime-only dependency and binary compatible with the LLVM implementation. To use that one instead, Intel recommends users set it with <code class="literal">LD_PRELOAD</code>. Note that <code class="literal">mkl</code> is only available on <code class="literal">x86_64-linux</code> and <code class="literal">x86_64-darwin</code>. Moreover, Hydra is not building and distributing pre-compiled binaries using it.
     </p><p>
      For BLAS/LAPACK switching to work correctly, all packages must depend on <code class="literal">blas</code> or <code class="literal">lapack</code>. This ensures that only one BLAS/LAPACK library is used at one time. There are two versions versions of BLAS/LAPACK currently in the wild, <code class="literal">LP64</code> (integer size = 32 bits) and <code class="literal">ILP64</code> (integer size = 64 bits). Some software needs special flags or patches to work with <code class="literal">ILP64</code>. You can check if <code class="literal">ILP64</code> is used in Nixpkgs with <code class="varname">blas.isILP64</code> and <code class="varname">lapack.isILP64</code>. Some software does NOT work with <code class="literal">ILP64</code>, and derivations need to specify an assertion to prevent this. You can prevent <code class="literal">ILP64</code> from being used with the following:
     </p><pre class="programlisting hljs nix" xml:space="preserve">{ stdenv, blas, lapack, ... }:

<span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> (!blas.isILP64) &amp;&amp; (!lapack.isILP64);

stdenv.mkDerivation {
  ...
}
</pre></section></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-overrides" class="title">Chapter&nbsp;4.&nbsp;Overriding<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-overrides" aria-label="Anchor link for: chap overrides" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-override" shape="rect">4.1. &lt;pkg&gt;.override</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideAttrs" shape="rect">4.2. &lt;pkg&gt;.overrideAttrs</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideDerivation" shape="rect">4.3. &lt;pkg&gt;.overrideDerivation</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-lib-makeOverridable" shape="rect">4.4. lib.makeOverridable</a></span></dt></dl></div><p>
    Sometimes one wants to override parts of <code class="literal">nixpkgs</code>, e.g. derivation attributes, the results of derivations.
   </p><p>
    These functions are used to make changes to packages, returning only single packages. <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-overlays" title="Chapter 3. Overlays" shape="rect">Overlays</a>, on the other hand, can be used to combine the overridden packages across the entire package set of Nixpkgs.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkg-override" class="title" style="clear: both">4.1.&nbsp;&lt;pkg&gt;.override<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-override" aria-label="Anchor link for: sec pkg override" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The function <code class="varname">override</code> is usually available for all the derivations in the nixpkgs expression (<code class="varname">pkgs</code>).
    </p><p>
     It is used to override the arguments passed to a function.
    </p><p>
     Example usages:
</p><pre class="programlisting hljs nix" xml:space="preserve">pkgs.foo.override { <span class="hljs-attr"><span class="hljs-attr">arg1</span></span> = val1; <span class="hljs-attr"><span class="hljs-attr">arg2</span></span> = val2; ... }</pre><p>

</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-built_in"><span class="hljs-built_in">import</span></span> pkgs.path { <span class="hljs-attr"><span class="hljs-attr">overlays</span></span> = [ (self: super: {
  <span class="hljs-attr"><span class="hljs-attr">foo</span></span> = super.foo.override { <span class="hljs-attr"><span class="hljs-attr">barSupport</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> ; };
  })]};
</pre><p>
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">mypkg</span></span> = pkgs.callPackage ./mypkg.nix {
  <span class="hljs-attr"><span class="hljs-attr">mydep</span></span> = pkgs.mydep.override { ... };
  }
</pre><p>
    </p><p>
     In the first example, <code class="varname">pkgs.foo</code> is the result of a function call with some default arguments, usually a derivation. Using <code class="varname">pkgs.foo.override</code> will call the same function with the given new arguments.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkg-overrideAttrs" class="title" style="clear: both">4.2.&nbsp;&lt;pkg&gt;.overrideAttrs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideAttrs" aria-label="Anchor link for: sec pkg overrideAttrs" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The function <code class="varname">overrideAttrs</code> allows overriding the attribute set passed to a <code class="varname">stdenv.mkDerivation</code> call, producing a new derivation based on the original one. This function is available on all derivations produced by the <code class="varname">stdenv.mkDerivation</code> function, which is most packages in the nixpkgs expression <code class="varname">pkgs</code>.
    </p><p>
     Example usage:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">helloWithDebug</span></span> = pkgs.hello.overrideAttrs (oldAttrs: <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">separateDebugInfo</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
});
</pre><p>
    </p><p>
     In the above example, the <code class="varname">separateDebugInfo</code> attribute is overridden to be true, thus building debug info for <code class="varname">helloWithDebug</code>, while all other attributes will be retained from the original <code class="varname">hello</code> package.
    </p><p>
     The argument <code class="varname">oldAttrs</code> is conventionally used to refer to the attr set originally passed to <code class="varname">stdenv.mkDerivation</code>.
    </p><div class="alert alert-info"><strong>Note:</strong> 
      Note that <code class="varname">separateDebugInfo</code> is processed only by the <code class="varname">stdenv.mkDerivation</code> function, not the generated, raw Nix derivation. Thus, using <code class="varname">overrideDerivation</code> will not work in this case, as it overrides only the attributes of the final derivation. It is for this reason that <code class="varname">overrideAttrs</code> should be preferred in (almost) all cases to <code class="varname">overrideDerivation</code>, i.e. to allow using <code class="varname">stdenv.mkDerivation</code> to process input arguments, as well as the fact that it is easier to use (you can use the same attribute names you see in your Nix code, instead of the ones generated (e.g. <code class="varname">buildInputs</code> vs <code class="varname">nativeBuildInputs</code>), and it involves less typing).
     </div></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkg-overrideDerivation" class="title" style="clear: both">4.3.&nbsp;&lt;pkg&gt;.overrideDerivation<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideDerivation" aria-label="Anchor link for: sec pkg overrideDerivation" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="alert alert-warning"><strong>Warning:</strong> 
      You should prefer <code class="varname">overrideAttrs</code> in almost all cases, see its documentation for the reasons why. <code class="varname">overrideDerivation</code> is not deprecated and will continue to work, but is less nice to use and does not have as many abilities as <code class="varname">overrideAttrs</code>.
     </div><div class="alert alert-warning"><strong>Warning:</strong> 
      Do not use this function in Nixpkgs as it evaluates a Derivation before modifying it, which breaks package abstraction and removes error-checking of function arguments. In addition, this evaluation-per-function application incurs a performance penalty, which can become a problem if many overrides are used. It is only intended for ad-hoc customisation, such as in <code class="filename">~/.config/nixpkgs/config.nix</code>.
     </div><p>
     The function <code class="varname">overrideDerivation</code> creates a new derivation based on an existing one by overriding the original's attributes with the attribute set produced by the specified function. This function is available on all derivations defined using the <code class="varname">makeOverridable</code> function. Most standard derivation-producing functions, such as <code class="varname">stdenv.mkDerivation</code>, are defined using this function, which means most packages in the nixpkgs expression, <code class="varname">pkgs</code>, have this function.
    </p><p>
     Example usage:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">mySed</span></span> = pkgs.gnused.overrideDerivation (oldAttrs: {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"sed-4.2.2-pre"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = ftp://alpha.gnu.org/gnu/sed/sed-<span class="hljs-number"><span class="hljs-number">4.2</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>-pre.tar.bz2;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"11nq06d131y4wmf3drm0yk502d2xc6n5qy82cg88rb9nqd2lj41k"</span></span>;
  };
  <span class="hljs-attr"><span class="hljs-attr">patches</span></span> = [];
});
</pre><p>
    </p><p>
     In the above example, the <code class="varname">name</code>, <code class="varname">src</code>, and <code class="varname">patches</code> of the derivation will be overridden, while all other attributes will be retained from the original derivation.
    </p><p>
     The argument <code class="varname">oldAttrs</code> is used to refer to the attribute set of the original derivation.
    </p><div class="alert alert-info"><strong>Note:</strong> 
      A package's attributes are evaluated *before* being modified by the <code class="varname">overrideDerivation</code> function. For example, the <code class="varname">name</code> attribute reference in <code class="varname">url = "mirror://gnu/hello/${name}.tar.gz";</code> is filled-in *before* the <code class="varname">overrideDerivation</code> function modifies the attribute set. This means that overriding the <code class="varname">name</code> attribute, in this example, *will not* change the value of the <code class="varname">url</code> attribute. Instead, we need to override both the <code class="varname">name</code> *and* <code class="varname">url</code> attributes.
     </div></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-lib-makeOverridable" class="title" style="clear: both">4.4.&nbsp;lib.makeOverridable<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-lib-makeOverridable" aria-label="Anchor link for: sec lib makeOverridable" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The function <code class="varname">lib.makeOverridable</code> is used to make the result of a function easily customizable. This utility only makes sense for functions that accept an argument set and return an attribute set.
    </p><p>
     Example usage:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">f</span></span> = { a, b }: { <span class="hljs-attr"><span class="hljs-attr">result</span></span> = a+b; };
<span class="hljs-attr"><span class="hljs-attr">c</span></span> = lib.makeOverridable f { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; };
</pre><p>
    </p><p>
     The variable <code class="varname">c</code> is the value of the <code class="varname">f</code> function applied with some default arguments. Hence the value of <code class="varname">c.result</code> is <code class="literal">3</code>, in this example.
    </p><p>
     The variable <code class="varname">c</code> however also has some additional functions, like <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-override" title="4.1. &lt;pkg&gt;.override" shape="rect">c.override</a> which can be used to override the default arguments. In this example the value of <code class="varname">(c.override { a = 4; }).result</code> is 6.
    </p></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-functions" class="title">Chapter&nbsp;5.&nbsp;Functions reference<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-functions" aria-label="Anchor link for: chap functions" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library" shape="rect">5.1. Nixpkgs Library Functions</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-generators" shape="rect">5.2. Generators</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-debug" shape="rect">5.3. Debugging Nix Expressions</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-prefer-remote-fetch" shape="rect">5.4. prefer-remote-fetch overlay</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore" shape="rect">5.5. pkgs.nix-gitignore</a></span></dt></dl></div><p>
    The nixpkgs repository has several utility functions to manipulate Nix expressions.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-functions-library" class="title" style="clear: both">5.1.&nbsp;Nixpkgs Library Functions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library" aria-label="Anchor link for: sec functions library" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Nixpkgs provides a standard library at <code class="varname">pkgs.lib</code>, or through <code class="code">import &lt;nixpkgs/lib&gt;</code>.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-functions-library-asserts" class="title">5.1.1.&nbsp;Assert functions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-asserts" aria-label="Anchor link for: sec functions library asserts" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.asserts.assertMsg" shape="rect"></a>5.1.1.1.&nbsp;<code class="function">lib.asserts.assertMsg</code></h4></div><div><h5 class="subtitle"><code class="literal">assertMsg :: Bool -&gt; String -&gt; Bool</code>
      </h5></div></div></div><p><a id="lib.asserts.assertMsg" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/asserts.nix#L21" target="_top" shape="rect">lib/asserts.nix:21</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Print a trace message if <code class="literal">pred</code> is false.
      </p><p>
       Intended to be used to augment asserts with helpful error messages.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          Condition under which the <code class="varname">msg</code> should <span class="emphasis"><em>not</em></span> be printed.
         </p></dd><dt><span class="term">
         <code class="varname">msg</code>
        </span></dt><dd><p>
          Message to print.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.asserts.assertMsg-example-false" shape="rect"></a><p class="title"><strong>Example&nbsp;5.1.&nbsp;Printing when the predicate is false</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> lib.asserts.assertMsg (<span class="hljs-string"><span class="hljs-string">"foo"</span></span> == <span class="hljs-string"><span class="hljs-string">"bar"</span></span>) <span class="hljs-string"><span class="hljs-string">"foo is not bar, silly"</span></span>
stderr&gt; trace: foo is not bar, silly
stderr&gt; <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> failed
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.asserts.assertOneOf" shape="rect"></a>5.1.1.2.&nbsp;<code class="function">lib.asserts.assertOneOf</code></h4></div><div><h5 class="subtitle"><code class="literal">assertOneOf :: String -&gt; String -&gt;
      StringList -&gt; Bool</code>
      </h5></div></div></div><p><a id="lib.asserts.assertOneOf" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/asserts.nix#L38" target="_top" shape="rect">lib/asserts.nix:38</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Specialized <code class="function">asserts.assertMsg</code> for checking if <code class="varname">val</code> is one of the elements of <code class="varname">xs</code>. Useful for checking enums.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">name</code>
        </span></dt><dd><p>
          The name of the variable the user entered <code class="varname">val</code> into, for inclusion in the error message.
         </p></dd><dt><span class="term">
         <code class="varname">val</code>
        </span></dt><dd><p>
          The value of what the user provided, to be compared against the values in <code class="varname">xs</code>.
         </p></dd><dt><span class="term">
         <code class="varname">xs</code>
        </span></dt><dd><p>
          The list of valid values.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.asserts.assertOneOf-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.2.&nbsp;Ensuring a user provided a possible value</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">sslLibrary</span></span> = <span class="hljs-string"><span class="hljs-string">"bearssl"</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lib.asserts.assertOneOf <span class="hljs-string"><span class="hljs-string">"sslLibrary"</span></span> sslLibrary [ <span class="hljs-string"><span class="hljs-string">"openssl"</span></span> <span class="hljs-string"><span class="hljs-string">"bearssl"</span></span> ];
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
stderr&gt; trace: sslLibrary must be one of <span class="hljs-string"><span class="hljs-string">"openssl"</span></span>, <span class="hljs-string"><span class="hljs-string">"libressl"</span></span>, but is: <span class="hljs-string"><span class="hljs-string">"bearssl"</span></span>
        </pre></div></div><br class="example-break" clear="none"><br></section></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-functions-library-attrset" class="title">5.1.2.&nbsp;Attribute-Set Functions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-attrset" aria-label="Anchor link for: sec functions library attrset" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.attrByPath" shape="rect"></a>5.1.2.1.&nbsp;<code class="function">lib.attrset.attrByPath</code></h4></div><div><h5 class="subtitle"><code class="literal">attrByPath :: [String] -&gt; Any -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.attrByPath" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L24" target="_top" shape="rect">lib/attrsets.nix:24</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Return an attribute from within nested attribute sets.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">attrPath</code>
        </span></dt><dd><p>
          A list of strings representing the path through the nested attribute set <code class="varname">set</code>.
         </p></dd><dt><span class="term">
         <code class="varname">default</code>
        </span></dt><dd><p>
          Default value if <code class="varname">attrPath</code> does not resolve to an existing value.
         </p></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The nested attributeset to select values from.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrset.attrByPath-example-value-exists" shape="rect"></a><p class="title"><strong>Example&nbsp;5.3.&nbsp;Extracting a value from a nested attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">set</span></span> = { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; }; };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lib.attrsets.attrByPath [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ] <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-attr"><span class="hljs-attr">set</span></span>
=&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>
</pre></div></div><br class="example-break" clear="none"><br><div class="example"><a id="function-library-lib.attrset.attrByPath-example-default-value" shape="rect"></a><p class="title"><strong>Example&nbsp;5.4.&nbsp;No value at the path, instead using the default</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.attrByPath [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ] <span class="hljs-number"><span class="hljs-number">0</span></span> {}
=&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.hasAttrByPath" shape="rect"></a>5.1.2.2.&nbsp;<code class="function">lib.attrsets.hasAttrByPath</code></h4></div><div><h5 class="subtitle"><code class="literal">hasAttrByPath :: [String] -&gt; AttrSet -&gt; Bool</code>
      </h5></div></div></div><p><a id="lib.attrsets.hasAttrByPath" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L42" target="_top" shape="rect">lib/attrsets.nix:42</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Determine if an attribute exists within a nested attribute set.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">attrPath</code>
        </span></dt><dd><p>
          A list of strings representing the path through the nested attribute set <code class="varname">set</code>.
         </p></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The nested attributeset to check.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.hasAttrByPath-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.5.&nbsp;A nested value does exist inside a set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.hasAttrByPath
  [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> <span class="hljs-string"><span class="hljs-string">"d"</span></span> ]
  { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = { <span class="hljs-attr"><span class="hljs-attr">c</span></span> = { <span class="hljs-attr"><span class="hljs-attr">d</span></span> = <span class="hljs-number"><span class="hljs-number">123</span></span>; }; }; }; }
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.setAttrByPath" shape="rect"></a>5.1.2.3.&nbsp;<code class="function">lib.attrsets.setAttrByPath</code></h4></div><div><h5 class="subtitle"><code class="literal">setAttrByPath :: [String] -&gt; Any -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.setAttrByPath" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L57" target="_top" shape="rect">lib/attrsets.nix:57</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Create a new attribute set with <code class="varname">value</code> set at the nested attribute location specified in <code class="varname">attrPath</code>.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">attrPath</code>
        </span></dt><dd><p>
          A list of strings representing the path through the nested attribute set.
         </p></dd><dt><span class="term">
         <code class="varname">value</code>
        </span></dt><dd><p>
          The value to set at the location described by <code class="varname">attrPath</code>.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.setAttrByPath-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.6.&nbsp;Creating a new nested attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.setAttrByPath [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ] <span class="hljs-number"><span class="hljs-number">3</span></span>
=&gt; { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; }; }
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.getAttrFromPath" shape="rect"></a>5.1.2.4.&nbsp;<code class="function">lib.attrsets.getAttrFromPath</code></h4></div><div><h5 class="subtitle"><code class="literal">getAttrFromPath :: [String] -&gt; AttrSet -&gt; Value</code>
      </h5></div></div></div><p><a id="lib.attrsets.getAttrFromPath" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L73" target="_top" shape="rect">lib/attrsets.nix:73</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Like <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.attrByPath" title="5.1.2.1. lib.attrset.attrByPath" shape="rect">Section&nbsp;5.1.2.1, “<code class="function">lib.attrset.attrByPath</code>”</a> except without a default, and it will throw if the value doesn't exist.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">attrPath</code>
        </span></dt><dd><p>
          A list of strings representing the path through the nested attribute set <code class="varname">set</code>.
         </p></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The nested attribute set to find the value in.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.getAttrPath-example-success" shape="rect"></a><p class="title"><strong>Example&nbsp;5.7.&nbsp;Succesfully getting a value from an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.getAttrFromPath [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ] { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; }; }
=&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>
</pre></div></div><br class="example-break" clear="none"><br><div class="example"><a id="function-library-lib.attrsets.getAttrPath-example-throw" shape="rect"></a><p class="title"><strong>Example&nbsp;5.8.&nbsp;Throwing after failing to get a value from an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.getAttrFromPath [ <span class="hljs-string"><span class="hljs-string">"x"</span></span> <span class="hljs-string"><span class="hljs-string">"y"</span></span> ] { }
=&gt; error: cannot find attribute `x.y'
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.attrVals" shape="rect"></a>5.1.2.5.&nbsp;<code class="function">lib.attrsets.attrVals</code></h4></div><div><h5 class="subtitle"><code class="literal">attrVals :: [String] -&gt; AttrSet -&gt; [Any]</code>
      </h5></div></div></div><p><a id="lib.attrsets.attrVals" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L84" target="_top" shape="rect">lib/attrsets.nix:84</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Return the specified attributes from a set. All values must exist.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">nameList</code>
        </span></dt><dd><p>
          The list of attributes to fetch from <code class="varname">set</code>. Each attribute name must exist on the attrbitue set.
         </p></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The set to get attribute values from.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.attrVals-example-success" shape="rect"></a><p class="title"><strong>Example&nbsp;5.9.&nbsp;Getting several values from an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.attrVals [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> ] { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; }
=&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><div class="example"><a id="function-library-lib.attrsets.attrVals-failure" shape="rect"></a><p class="title"><strong>Example&nbsp;5.10.&nbsp;Getting missing values from an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs bash" xml:space="preserve">lib.attrsets.attrVals [ <span class="hljs-string"><span class="hljs-string">"d"</span></span> ] { }
error: attribute <span class="hljs-string"><span class="hljs-string">'d'</span></span> missing
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.attrValues" shape="rect"></a>5.1.2.6.&nbsp;<code class="function">lib.attrsets.attrValues</code></h4></div><div><h5 class="subtitle"><code class="literal">attrValues :: AttrSet -&gt; [Any]</code>
      </h5></div></div></div><p><a id="lib.attrsets.attrValues" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L94" target="_top" shape="rect">lib/attrsets.nix:94</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Get all the attribute values from an attribute set.
      </p><p>
       Provides a backwards-compatible interface of <code class="function">builtins.attrValues</code> for Nix version older than 1.8.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">attrs</code>
        </span></dt><dd><p>
          The attribute set.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.attrValues-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.11.&nbsp;</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.attrValues { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; }
=&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.catAttrs" shape="rect"></a>5.1.2.7.&nbsp;<code class="function">lib.attrsets.catAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">catAttrs :: String -&gt; [AttrSet] -&gt; [Any]</code>
      </h5></div></div></div><p><a id="lib.attrsets.catAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L113" target="_top" shape="rect">lib/attrsets.nix:113</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Collect each attribute named `attr' from the list of attribute sets, <code class="varname">sets</code>. Sets that don't contain the named attribute are ignored.
      </p><p>
       Provides a backwards-compatible interface of <code class="function">builtins.catAttrs</code> for Nix version older than 1.9.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">attr</code>
        </span></dt><dd><p>
          Attribute name to select from each attribute set in <code class="varname">sets</code>.
         </p></dd><dt><span class="term">
         <code class="varname">sets</code>
        </span></dt><dd><p>
          The list of attribute sets to select <code class="varname">attr</code> from.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.catAttrs-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.12.&nbsp;Collect an attribute from a list of attribute sets.</strong></p><div class="example-contents"><p>
        Attribute sets which don't have the attribute are ignored.
       </p><pre class="programlisting hljs nix" xml:space="preserve">catAttrs <span class="hljs-string"><span class="hljs-string">"a"</span></span> [{<span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>;} {<span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>;} {<span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>;}]
=&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ]
      </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.filterAttrs" shape="rect"></a>5.1.2.8.&nbsp;<code class="function">lib.attrsets.filterAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">filterAttrs :: (String -&gt; Any -&gt; Bool) -&gt; AttrSet -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.filterAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L124" target="_top" shape="rect">lib/attrsets.nix:124</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Filter an attribute set by removing all attributes for which the given predicate return false.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          <code class="literal">String -&gt; Any -&gt; Bool</code>
         </p><p>
          Predicate which returns true to include an attribute, or returns false to exclude it.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name</code>
           </span></dt><dd><p>
             The attribute's name
            </p></dd><dt><span class="term">
            <code class="varname">value</code>
           </span></dt><dd><p>
             The attribute's value
            </p></dd></dl></div><p>
          Returns <code class="literal">true</code> to include the attribute, <code class="literal">false</code> to exclude the attribute.
         </p></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The attribute set to filter
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.filterAttrs-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.13.&nbsp;Filtering an attributeset</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">filterAttrs (n: v: <span class="hljs-attr"><span class="hljs-attr">n</span></span> == <span class="hljs-string"><span class="hljs-string">"foo"</span></span>) { <span class="hljs-attr"><span class="hljs-attr">foo</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">bar</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; }
=&gt; { <span class="hljs-attr"><span class="hljs-attr">foo</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; }
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.filterAttrsRecursive" shape="rect"></a>5.1.2.9.&nbsp;<code class="function">lib.attrsets.filterAttrsRecursive</code></h4></div><div><h5 class="subtitle"><code class="literal">filterAttrsRecursive :: (String -&gt; Any -&gt; Bool) -&gt; AttrSet -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.filterAttrsRecursive" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L135" target="_top" shape="rect">lib/attrsets.nix:135</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Filter an attribute set recursively by removing all attributes for which the given predicate return false.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          <code class="literal">String -&gt; Any -&gt; Bool</code>
         </p><p>
          Predicate which returns true to include an attribute, or returns false to exclude it.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name</code>
           </span></dt><dd><p>
             The attribute's name
            </p></dd><dt><span class="term">
            <code class="varname">value</code>
           </span></dt><dd><p>
             The attribute's value
            </p></dd></dl></div><p>
          Returns <code class="literal">true</code> to include the attribute, <code class="literal">false</code> to exclude the attribute.
         </p></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The attribute set to filter
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.filterAttrsRecursive-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.14.&nbsp;Recursively filtering an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.filterAttrsRecursive
  (n: v: v != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)
  {
    <span class="hljs-attr"><span class="hljs-attr">levelA</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">example</span></span> = <span class="hljs-string"><span class="hljs-string">"hi"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">levelB</span></span> = {
        <span class="hljs-attr"><span class="hljs-attr">hello</span></span> = <span class="hljs-string"><span class="hljs-string">"there"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">this-one-is-present</span></span> = {
          <span class="hljs-attr"><span class="hljs-attr">this-is-excluded</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;
        };
      };
      <span class="hljs-attr"><span class="hljs-attr">this-one-is-also-excluded</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;
    };
    <span class="hljs-attr"><span class="hljs-attr">also-excluded</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;
  }
=&gt; {
     <span class="hljs-attr"><span class="hljs-attr">levelA</span></span> = {
       <span class="hljs-attr"><span class="hljs-attr">example</span></span> = <span class="hljs-string"><span class="hljs-string">"hi"</span></span>;
       <span class="hljs-attr"><span class="hljs-attr">levelB</span></span> = {
         <span class="hljs-attr"><span class="hljs-attr">hello</span></span> = <span class="hljs-string"><span class="hljs-string">"there"</span></span>;
         <span class="hljs-attr"><span class="hljs-attr">this-one-is-present</span></span> = { };
       };
     };
   }
     </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.foldAttrs" shape="rect"></a>5.1.2.10.&nbsp;<code class="function">lib.attrsets.foldAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">foldAttrs :: (Any -&gt; Any -&gt; Any) -&gt; Any -&gt; [AttrSets] -&gt; Any</code>
      </h5></div></div></div><p><a id="lib.attrsets.foldAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L154" target="_top" shape="rect">lib/attrsets.nix:154</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Apply fold function to values grouped by key.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">op</code>
        </span></dt><dd><p>
          <code class="literal">Any -&gt; Any -&gt; Any</code>
         </p><p>
          Given a value <code class="varname">val</code> and a collector <code class="varname">col</code>, combine the two.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">val</code>
           </span></dt><dd><p>
             An attribute's value
            </p></dd><dt><span class="term">
            <code class="varname">col</code>
           </span></dt><dd><p>
             The result of previous <code class="function">op</code> calls with other values and <code class="function">nul</code>.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">nul</code>
        </span></dt><dd><p>
          The null-value, the starting value.
         </p></dd><dt><span class="term">
         <code class="varname">list_of_attrs</code>
        </span></dt><dd><p>
          A list of attribute sets to fold together by key.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.foldAttrs-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.15.&nbsp;Combining an attribute of lists in to one attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.foldAttrs
  (n: a: [n] ++ a) []
  [
    { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">7</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">6</span></span>; }
  ]
=&gt; { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = [ <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = [ <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ]; }
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.collect" shape="rect"></a>5.1.2.11.&nbsp;<code class="function">lib.attrsets.collect</code></h4></div><div><h5 class="subtitle"><code class="literal">collect :: (Any -&gt; Bool) -&gt; AttrSet -&gt; [Any]</code>
      </h5></div></div></div><p><a id="lib.attrsets.collect" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L178" target="_top" shape="rect">lib/attrsets.nix:178</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Recursively collect sets that verify a given predicate named <code class="varname">pred</code> from the set <code class="varname">attrs</code>. The recursion stops when <code class="varname">pred</code> returns <code class="literal">true</code>.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          <code class="literal">Any -&gt; Bool</code>
         </p><p>
          Given an attribute's value, determine if recursion should stop.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">value</code>
           </span></dt><dd><p>
             The attribute set value.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">attrs</code>
        </span></dt><dd><p>
          The attribute set to recursively collect.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.collect-example-lists" shape="rect"></a><p class="title"><strong>Example&nbsp;5.16.&nbsp;Collecting all lists from an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.collect isList { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = [<span class="hljs-string"><span class="hljs-string">"b"</span></span>]; }; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = [<span class="hljs-number"><span class="hljs-number">1</span></span>]; }
=&gt; [[<span class="hljs-string"><span class="hljs-string">"b"</span></span>] [<span class="hljs-number"><span class="hljs-number">1</span></span>]]
</pre></div></div><br class="example-break" clear="none"><br><div class="example"><a id="function-library-lib.attrsets.collect-example-outpath" shape="rect"></a><p class="title"><strong>Example&nbsp;5.17.&nbsp;Collecting all attribute-sets which contain the <code class="literal">outPath</code> attribute name.</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">collect (x: x ? outPath)
  { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = { <span class="hljs-attr"><span class="hljs-attr">outPath</span></span> = <span class="hljs-string"><span class="hljs-string">"a/"</span></span>; }; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = { <span class="hljs-attr"><span class="hljs-attr">outPath</span></span> = <span class="hljs-string"><span class="hljs-string">"b/"</span></span>; }; }
=&gt; [{ <span class="hljs-attr"><span class="hljs-attr">outPath</span></span> = <span class="hljs-string"><span class="hljs-string">"a/"</span></span>; } { <span class="hljs-attr"><span class="hljs-attr">outPath</span></span> = <span class="hljs-string"><span class="hljs-string">"b/"</span></span>; }]
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.nameValuePair" shape="rect"></a>5.1.2.12.&nbsp;<code class="function">lib.attrsets.nameValuePair</code></h4></div><div><h5 class="subtitle"><code class="literal">nameValuePair :: String -&gt; Any -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.nameValuePair" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L194" target="_top" shape="rect">lib/attrsets.nix:194</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Utility function that creates a <code class="literal">{name, value}</code> pair as expected by <code class="function">builtins.listToAttrs</code>.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">name</code>
        </span></dt><dd><p>
          The attribute name.
         </p></dd><dt><span class="term">
         <code class="varname">value</code>
        </span></dt><dd><p>
          The attribute value.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.nameValuePair-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.18.&nbsp;Creating a name value pair</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">nameValuePair <span class="hljs-string"><span class="hljs-string">"some"</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>
=&gt; { <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"some"</span></span>; <span class="hljs-attr"><span class="hljs-attr">value</span></span> = <span class="hljs-number"><span class="hljs-number">6</span></span>; }
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrs" shape="rect"></a>5.1.2.13.&nbsp;<code class="function">lib.attrsets.mapAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal"></code>
      </h5></div></div></div><p><a id="lib.attrsets.mapAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L207" target="_top" shape="rect">lib/attrsets.nix:207</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Apply a function to each element in an attribute set, creating a new attribute set.
      </p><p>
       Provides a backwards-compatible interface of <code class="function">builtins.mapAttrs</code> for Nix version older than 2.1.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">fn</code>
        </span></dt><dd><p>
          <code class="literal">String -&gt; Any -&gt; Any</code>
         </p><p>
          Given an attribute's name and value, return a new value.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name</code>
           </span></dt><dd><p>
             The name of the attribute.
            </p></dd><dt><span class="term">
            <code class="varname">value</code>
           </span></dt><dd><p>
             The attribute's value.
            </p></dd></dl></div></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrs-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.19.&nbsp;Modifying each value of an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.mapAttrs
  (name: value: name + <span class="hljs-string"><span class="hljs-string">"-"</span></span> value)
  { <span class="hljs-attr"><span class="hljs-attr">x</span></span> = <span class="hljs-string"><span class="hljs-string">"foo"</span></span>; <span class="hljs-attr"><span class="hljs-attr">y</span></span> = <span class="hljs-string"><span class="hljs-string">"bar"</span></span>; }
=&gt; { <span class="hljs-attr"><span class="hljs-attr">x</span></span> = <span class="hljs-string"><span class="hljs-string">"x-foo"</span></span>; <span class="hljs-attr"><span class="hljs-attr">y</span></span> = <span class="hljs-string"><span class="hljs-string">"y-bar"</span></span>; }
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrs-prime" shape="rect"></a>5.1.2.14.&nbsp;<code class="function">lib.attrsets.mapAttrs'</code></h4></div><div><h5 class="subtitle"><code class="literal">mapAttrs' :: (String -&gt; Any -&gt; { name = String; value = Any }) -&gt; AttrSet -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.mapAttrs-prime" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L221" target="_top" shape="rect">lib/attrsets.nix:221</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Like <code class="function">mapAttrs</code>, but allows the name of each attribute to be changed in addition to the value. The applied function should return both the new name and value as a <code class="function">nameValuePair</code>.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">fn</code>
        </span></dt><dd><p>
          <code class="literal">String -&gt; Any -&gt; { name = String; value = Any }</code>
         </p><p>
          Given an attribute's name and value, return a new <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.nameValuePair" title="5.1.2.12. lib.attrsets.nameValuePair" shape="rect">name value pair</a>.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name</code>
           </span></dt><dd><p>
             The name of the attribute.
            </p></dd><dt><span class="term">
            <code class="varname">value</code>
           </span></dt><dd><p>
             The attribute's value.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The attribute set to map over.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrs-prime-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.20.&nbsp;Change the name and value of each attribute of an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.mapAttrs' (name: value: lib.attrsets.nameValuePair (<span class="hljs-string"><span class="hljs-string">"foo_"</span></span> + name) (<span class="hljs-string"><span class="hljs-string">"bar-"</span></span> + value))
   { <span class="hljs-attr"><span class="hljs-attr">x</span></span> = <span class="hljs-string"><span class="hljs-string">"a"</span></span>; <span class="hljs-attr"><span class="hljs-attr">y</span></span> = <span class="hljs-string"><span class="hljs-string">"b"</span></span>; }
=&gt; { <span class="hljs-attr"><span class="hljs-attr">foo_x</span></span> = <span class="hljs-string"><span class="hljs-string">"bar-a"</span></span>; <span class="hljs-attr"><span class="hljs-attr">foo_y</span></span> = <span class="hljs-string"><span class="hljs-string">"bar-b"</span></span>; }

    </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrsToList" shape="rect"></a>5.1.2.15.&nbsp;<code class="function">lib.attrsets.mapAttrsToList</code></h4></div><div><h5 class="subtitle"><code class="literal">mapAttrsToList :: (String -&gt; Any -&gt; Any) -&gt;
   AttrSet -&gt; Any</code>
      </h5></div></div></div><p><a id="lib.attrsets.mapAttrsToList" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L233" target="_top" shape="rect">lib/attrsets.nix:233</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Call <code class="varname">fn</code> for each attribute in the given <code class="varname">set</code> and return the result in a list.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">fn</code>
        </span></dt><dd><p>
          <code class="literal">String -&gt; Any -&gt; Any</code>
         </p><p>
          Given an attribute's name and value, return a new value.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name</code>
           </span></dt><dd><p>
             The name of the attribute.
            </p></dd><dt><span class="term">
            <code class="varname">value</code>
           </span></dt><dd><p>
             The attribute's value.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The attribute set to map over.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrsToList-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.21.&nbsp;Combine attribute values and names in to a list</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.mapAttrsToList (name: value: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${value}</span></span></span><span class="hljs-string">"</span></span>)
   { <span class="hljs-attr"><span class="hljs-attr">x</span></span> = <span class="hljs-string"><span class="hljs-string">"a"</span></span>; <span class="hljs-attr"><span class="hljs-attr">y</span></span> = <span class="hljs-string"><span class="hljs-string">"b"</span></span>; }
=&gt; [ <span class="hljs-string"><span class="hljs-string">"x=a"</span></span> <span class="hljs-string"><span class="hljs-string">"y=b"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrsRecursive" shape="rect"></a>5.1.2.16.&nbsp;<code class="function">lib.attrsets.mapAttrsRecursive</code></h4></div><div><h5 class="subtitle"><code class="literal">mapAttrsRecursive :: ([String] &gt; Any -&gt; Any) -&gt; AttrSet -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.mapAttrsRecursive" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L250" target="_top" shape="rect">lib/attrsets.nix:250</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Like <code class="function">mapAttrs</code>, except that it recursively applies itself to attribute sets. Also, the first argument of the argument function is a <span class="emphasis"><em>list</em></span> of the names of the containing attributes.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          <code class="literal">[ String ] -&gt; Any -&gt; Any</code>
         </p><p>
          Given a list of attribute names and value, return a new value.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name_path</code>
           </span></dt><dd><p>
             The list of attribute names to this value.
            </p><p>
             For example, the <code class="varname">name_path</code> for the <code class="literal">example</code> string in the attribute set <code class="literal">{ foo = { bar = "example"; }; }</code> is <code class="literal">[ "foo" "bar" ]</code>.
            </p></dd><dt><span class="term">
            <code class="varname">value</code>
           </span></dt><dd><p>
             The attribute's value.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The attribute set to recursively map over.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrsRecursive-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.22.&nbsp;A contrived example of using <code class="function">lib.attrsets.mapAttrsRecursive</code></strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">mapAttrsRecursive
  (path: value: concatStringsSep <span class="hljs-string"><span class="hljs-string">"-"</span></span> (path ++ [value]))
  {
    <span class="hljs-attr"><span class="hljs-attr">n</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-string"><span class="hljs-string">"A"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">m</span></span> = {
        <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-string"><span class="hljs-string">"B"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-string"><span class="hljs-string">"C"</span></span>;
      };
    };
    <span class="hljs-attr"><span class="hljs-attr">d</span></span> = <span class="hljs-string"><span class="hljs-string">"D"</span></span>;
  }
=&gt; {
     <span class="hljs-attr"><span class="hljs-attr">n</span></span> = {
       <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-string"><span class="hljs-string">"n-a-A"</span></span>;
       <span class="hljs-attr"><span class="hljs-attr">m</span></span> = {
         <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-string"><span class="hljs-string">"n-m-b-B"</span></span>;
         <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-string"><span class="hljs-string">"n-m-c-C"</span></span>;
       };
     };
     <span class="hljs-attr"><span class="hljs-attr">d</span></span> = <span class="hljs-string"><span class="hljs-string">"d-D"</span></span>;
   }
    </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrsRecursiveCond" shape="rect"></a>5.1.2.17.&nbsp;<code class="function">lib.attrsets.mapAttrsRecursiveCond</code></h4></div><div><h5 class="subtitle"><code class="literal">mapAttrsRecursiveCond :: (AttrSet -&gt; Bool) -&gt; ([ String ] -&gt; Any -&gt; Any) -&gt; AttrSet -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.mapAttrsRecursiveCond" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L271" target="_top" shape="rect">lib/attrsets.nix:271</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Like <code class="function">mapAttrsRecursive</code>, but it takes an additional predicate function that tells it whether to recursive into an attribute set. If it returns false, <code class="function">mapAttrsRecursiveCond</code> does not recurse, but does apply the map function. It is returns true, it does recurse, and does not apply the map function.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">cond</code>
        </span></dt><dd><p>
          <code class="literal">(AttrSet -&gt; Bool)</code>
         </p><p>
          Determine if <code class="function">mapAttrsRecursive</code> should recurse deeper in to the attribute set.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">attributeset</code>
           </span></dt><dd><p>
             An attribute set.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          <code class="literal">[ String ] -&gt; Any -&gt; Any</code>
         </p><p>
          Given a list of attribute names and value, return a new value.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name_path</code>
           </span></dt><dd><p>
             The list of attribute names to this value.
            </p><p>
             For example, the <code class="varname">name_path</code> for the <code class="literal">example</code> string in the attribute set <code class="literal">{ foo = { bar = "example"; }; }</code> is <code class="literal">[ "foo" "bar" ]</code>.
            </p></dd><dt><span class="term">
            <code class="varname">value</code>
           </span></dt><dd><p>
             The attribute's value.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">set</code>
        </span></dt><dd><p>
          The attribute set to recursively map over.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrsRecursiveCond-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.23.&nbsp;Only convert attribute values to JSON if the containing attribute set is marked for recursion</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.mapAttrsRecursiveCond
  ({ recurse ? <span class="hljs-literal"><span class="hljs-literal">false</span></span>, ... }: recurse)
  (name: value: <span class="hljs-built_in"><span class="hljs-built_in">builtins</span></span>.toJSON value)
  {
    <span class="hljs-attr"><span class="hljs-attr">dorecur</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">recurse</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">hello</span></span> = <span class="hljs-string"><span class="hljs-string">"there"</span></span>;
    };
    <span class="hljs-attr"><span class="hljs-attr">dontrecur</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">converted-to-</span></span> = <span class="hljs-string"><span class="hljs-string">"json"</span></span>;
    };
  }
=&gt; {
     <span class="hljs-attr"><span class="hljs-attr">dorecur</span></span> = {
       <span class="hljs-attr"><span class="hljs-attr">hello</span></span> = <span class="hljs-string"><span class="hljs-string">"\"</span></span>there\<span class="hljs-string"><span class="hljs-string">""</span></span>;
       <span class="hljs-attr"><span class="hljs-attr">recurse</span></span> = <span class="hljs-string"><span class="hljs-string">"true"</span></span>;
     };
     <span class="hljs-attr"><span class="hljs-attr">dontrecur</span></span> = <span class="hljs-string"><span class="hljs-string">"{\"</span></span>converted-to\<span class="hljs-string"><span class="hljs-string">":\"</span></span>json\<span class="hljs-string"><span class="hljs-string">"}"</span></span>;
   }
    </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.genAttrs" shape="rect"></a>5.1.2.18.&nbsp;<code class="function">lib.attrsets.genAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">genAttrs :: [ String ] -&gt; (String -&gt; Any) -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.genAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L291" target="_top" shape="rect">lib/attrsets.nix:291</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Generate an attribute set by mapping a function over a list of attribute names.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">names</code>
        </span></dt><dd><p>
          Names of values in the resulting attribute set.
         </p></dd><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          <code class="literal">String -&gt; Any</code>
         </p><p>
          Takes the name of the attribute and return the attribute's value.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name</code>
           </span></dt><dd><p>
             The name of the attribute to generate a value for.
            </p></dd></dl></div></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.genAttrs-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.24.&nbsp;Generate an attrset based on names only</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.genAttrs [ <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span> ] (name: <span class="hljs-string"><span class="hljs-string">"x_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">"</span></span>)
=&gt; { <span class="hljs-attr"><span class="hljs-attr">foo</span></span> = <span class="hljs-string"><span class="hljs-string">"x_foo"</span></span>; <span class="hljs-attr"><span class="hljs-attr">bar</span></span> = <span class="hljs-string"><span class="hljs-string">"x_bar"</span></span>; }
     </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.isDerivation" shape="rect"></a>5.1.2.19.&nbsp;<code class="function">lib.attrsets.isDerivation</code></h4></div><div><h5 class="subtitle"><code class="literal">isDerivation :: Any -&gt; Bool</code>
      </h5></div></div></div><p><a id="lib.attrsets.isDerivation" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L305" target="_top" shape="rect">lib/attrsets.nix:305</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Check whether the argument is a derivation. Any set with <code class="code">{ type = "derivation"; }</code> counts as a derivation.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">value</code>
        </span></dt><dd><p>
          The value which is possibly a derivation.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.isDerivation-example-true" shape="rect"></a><p class="title"><strong>Example&nbsp;5.25.&nbsp;A package is a derivation</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.isDerivation (<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {}).<span class="hljs-attr"><span class="hljs-attr">ruby</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
     </pre></div></div><br class="example-break" clear="none"><br><div class="example"><a id="function-library-lib.attrsets.isDerivation-example-false" shape="rect"></a><p class="title"><strong>Example&nbsp;5.26.&nbsp;Anything else is not a derivation</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.isDerivation <span class="hljs-string"><span class="hljs-string">"foobar"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
     </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.toDerivation" shape="rect"></a>5.1.2.20.&nbsp;<code class="function">lib.attrsets.toDerivation</code></h4></div><div><h5 class="subtitle"><code class="literal">toDerivation :: Path -&gt; Derivation</code>
      </h5></div></div></div><p><a id="lib.attrsets.toDerivation" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L308" target="_top" shape="rect">lib/attrsets.nix:308</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Converts a store path to a fake derivation.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">path</code>
        </span></dt><dd><p>
          A store path to convert to a derivation.
         </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.optionalAttrs" shape="rect"></a>5.1.2.21.&nbsp;<code class="function">lib.attrsets.optionalAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">optionalAttrs :: Bool -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.optionalAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L331" target="_top" shape="rect">lib/attrsets.nix:331</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Conditionally return an attribute set or an empty attribute set.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">cond</code>
        </span></dt><dd><p>
          Condition under which the <code class="varname">as</code> attribute set is returned.
         </p></dd><dt><span class="term">
         <code class="varname">as</code>
        </span></dt><dd><p>
          The attribute set to return if <code class="varname">cond</code> is true.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.optionalAttrs-example-true" shape="rect"></a><p class="title"><strong>Example&nbsp;5.27.&nbsp;Return the provided attribute set when <code class="varname">cond</code> is true</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.optionalAttrs <span class="hljs-literal"><span class="hljs-literal">true</span></span> { <span class="hljs-attr"><span class="hljs-attr">my</span></span> = <span class="hljs-string"><span class="hljs-string">"set"</span></span>; }
=&gt; { <span class="hljs-attr"><span class="hljs-attr">my</span></span> = <span class="hljs-string"><span class="hljs-string">"set"</span></span>; }
     </pre></div></div><br class="example-break" clear="none"><br><div class="example"><a id="function-library-lib.attrsets.optionalAttrs-example-false" shape="rect"></a><p class="title"><strong>Example&nbsp;5.28.&nbsp;Return an empty attribute set when <code class="varname">cond</code> is false</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.optionalAttrs <span class="hljs-literal"><span class="hljs-literal">false</span></span> { <span class="hljs-attr"><span class="hljs-attr">my</span></span> = <span class="hljs-string"><span class="hljs-string">"set"</span></span>; }
=&gt; { }
     </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.zipAttrsWithNames" shape="rect"></a>5.1.2.22.&nbsp;<code class="function">lib.attrsets.zipAttrsWithNames</code></h4></div><div><h5 class="subtitle"><code class="literal">zipAttrsWithNames :: [ String ] -&gt; (String -&gt; [ Any ] -&gt; Any) -&gt; [ AttrSet ] -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.zipAttrsWithNames" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L341" target="_top" shape="rect">lib/attrsets.nix:341</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Merge sets of attributes and use the function <code class="varname">f</code> to merge attribute values where the attribute name is in <code class="varname">names</code>.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">names</code>
        </span></dt><dd><p>
          A list of attribute names to zip.
         </p></dd><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          <code class="literal">(String -&gt; [ Any ] -&gt; Any</code>
         </p><p>
          Accepts an attribute name, all the values, and returns a combined value.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name</code>
           </span></dt><dd><p>
             The name of the attribute each value came from.
            </p></dd><dt><span class="term">
            <code class="varname">vs</code>
           </span></dt><dd><p>
             A list of values collected from the list of attribute sets.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">sets</code>
        </span></dt><dd><p>
          A list of attribute sets to zip together.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.zipAttrsWithNames-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.29.&nbsp;Summing a list of attribute sets of numbers</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.zipAttrsWithNames
  [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ]
  (name: vals: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">toString</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> (</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">builtins</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.foldl' (a: b: a + b) </span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> vals)}</span></span></span><span class="hljs-string">"</span></span>)
  [
    { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">100</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span>; }
  ]
=&gt; { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-string"><span class="hljs-string">"a 11"</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-string"><span class="hljs-string">"b 101"</span></span>; }
     </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.zipAttrsWith" shape="rect"></a>5.1.2.23.&nbsp;<code class="function">lib.attrsets.zipAttrsWith</code></h4></div><div><h5 class="subtitle"><code class="literal">zipAttrsWith :: (String -&gt; [ Any ] -&gt; Any) -&gt; [ AttrSet ] -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.zipAttrsWith" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L356" target="_top" shape="rect">lib/attrsets.nix:356</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Merge sets of attributes and use the function <code class="varname">f</code> to merge attribute values. Similar to <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.zipAttrsWithNames" title="5.1.2.22. lib.attrsets.zipAttrsWithNames" shape="rect">Section&nbsp;5.1.2.22, “<code class="function">lib.attrsets.zipAttrsWithNames</code>”</a> where all key names are passed for <code class="varname">names</code>.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          <code class="literal">(String -&gt; [ Any ] -&gt; Any</code>
         </p><p>
          Accepts an attribute name, all the values, and returns a combined value.
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">name</code>
           </span></dt><dd><p>
             The name of the attribute each value came from.
            </p></dd><dt><span class="term">
            <code class="varname">vs</code>
           </span></dt><dd><p>
             A list of values collected from the list of attribute sets.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">sets</code>
        </span></dt><dd><p>
          A list of attribute sets to zip together.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.zipAttrsWith-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.30.&nbsp;Summing a list of attribute sets of numbers</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.zipAttrsWith
  (name: vals: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">toString</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> (</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">builtins</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.foldl' (a: b: a + b) </span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> vals)}</span></span></span><span class="hljs-string">"</span></span>)
  [
    { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">100</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span>; }
  ]
=&gt; { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-string"><span class="hljs-string">"a 11"</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-string"><span class="hljs-string">"b 101"</span></span>; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-string"><span class="hljs-string">"c 1001"</span></span>; }
     </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.zipAttrs" shape="rect"></a>5.1.2.24.&nbsp;<code class="function">lib.attrsets.zipAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">zipAttrsWith :: [ AttrSet ] -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.zipAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L363" target="_top" shape="rect">lib/attrsets.nix:363</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Merge sets of attributes and combine each attribute value in to a list. Similar to <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#function-library-lib.attrsets.zipAttrsWith" title="5.1.2.23. lib.attrsets.zipAttrsWith" shape="rect">Section&nbsp;5.1.2.23, “<code class="function">lib.attrsets.zipAttrsWith</code>”</a> where the merge function returns a list of all values.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">sets</code>
        </span></dt><dd><p>
          A list of attribute sets to zip together.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.zipAttrs-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.31.&nbsp;Combining a list of attribute sets</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.zipAttrs
  [
    { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">100</span></span>; }
    { <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span>; }
  ]
=&gt; { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ]; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> ]; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> ]; }
     </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.recursiveUpdateUntil" shape="rect"></a>5.1.2.25.&nbsp;<code class="function">lib.attrsets.recursiveUpdateUntil</code></h4></div><div><h5 class="subtitle"><code class="literal">recursiveUpdateUntil :: ( [ String ] -&gt; AttrSet -&gt; AttrSet -&gt; Bool ) -&gt; AttrSet -&gt; AttrSet -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.recursiveUpdateUntil" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L393" target="_top" shape="rect">lib/attrsets.nix:393</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Does the same as the update operator <code class="literal">//</code> except that attributes are merged until the given predicate is verified. The predicate should accept 3 arguments which are the path to reach the attribute, a part of the first attribute set and a part of the second attribute set. When the predicate is verified, the value of the first attribute set is replaced by the value of the second attribute set.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          <code class="literal">[ String ] -&gt; AttrSet -&gt; AttrSet -&gt; Bool</code>
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">path</code>
           </span></dt><dd><p>
             The path to the values in the left and right hand sides.
            </p></dd><dt><span class="term">
            <code class="varname">l</code>
           </span></dt><dd><p>
             The left hand side value.
            </p></dd><dt><span class="term">
            <code class="varname">r</code>
           </span></dt><dd><p>
             The right hand side value.
            </p></dd></dl></div></dd><dt><span class="term">
         <code class="varname">lhs</code>
        </span></dt><dd><p>
          The left hand attribute set of the merge.
         </p></dd><dt><span class="term">
         <code class="varname">rhs</code>
        </span></dt><dd><p>
          The right hand attribute set of the merge.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.recursiveUpdateUntil-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.32.&nbsp;Recursively merging two attribute sets</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">lib.attrsets.recursiveUpdateUntil (path: l: r: <span class="hljs-attr"><span class="hljs-attr">path</span></span> == [<span class="hljs-string"><span class="hljs-string">"foo"</span></span>])
  {
    <span class="hljs-comment"><span class="hljs-comment"># first attribute set</span></span>
    foo.<span class="hljs-attr"><span class="hljs-attr">bar</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>;
    foo.<span class="hljs-attr"><span class="hljs-attr">baz</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">bar</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>;
  }
  {
    <span class="hljs-comment"><span class="hljs-comment">#second attribute set</span></span>
    foo.<span class="hljs-attr"><span class="hljs-attr">bar</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>;
    foo.<span class="hljs-attr"><span class="hljs-attr">quz</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">baz</span></span> = <span class="hljs-number"><span class="hljs-number">4</span></span>;
  }
=&gt; {
  foo.<span class="hljs-attr"><span class="hljs-attr">bar</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment"># 'foo.*' from the second set</span></span>
  foo.<span class="hljs-attr"><span class="hljs-attr">quz</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">#</span></span>
  <span class="hljs-attr"><span class="hljs-attr">bar</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>;     <span class="hljs-comment"><span class="hljs-comment"># 'bar' from the first set</span></span>
  <span class="hljs-attr"><span class="hljs-attr">baz</span></span> = <span class="hljs-number"><span class="hljs-number">4</span></span>;     <span class="hljs-comment"><span class="hljs-comment"># 'baz' from the second set</span></span>
}
     </pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.recursiveUpdate" shape="rect"></a>5.1.2.26.&nbsp;<code class="function">lib.attrsets.recursiveUpdate</code></h4></div><div><h5 class="subtitle"><code class="literal">recursiveUpdate :: AttrSet -&gt; AttrSet -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.recursiveUpdate" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L424" target="_top" shape="rect">lib/attrsets.nix:424</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       A recursive variant of the update operator <code class="literal">//</code>. The recursion stops when one of the attribute values is not an attribute set, in which case the right hand side value takes precedence over the left hand side value.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">lhs</code>
        </span></dt><dd><p>
          The left hand attribute set of the merge.
         </p></dd><dt><span class="term">
         <code class="varname">rhs</code>
        </span></dt><dd><p>
          The right hand attribute set of the merge.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.recursiveUpdate-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.33.&nbsp;Recursively merging two attribute sets</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">recursiveUpdate
  {
    boot.loader.grub.<span class="hljs-attr"><span class="hljs-attr">enable</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
    boot.loader.grub.<span class="hljs-attr"><span class="hljs-attr">device</span></span> = <span class="hljs-string"><span class="hljs-string">"/dev/hda"</span></span>;
  }
  {
    boot.loader.grub.<span class="hljs-attr"><span class="hljs-attr">device</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span>;
  }
=&gt; {
  boot.loader.grub.<span class="hljs-attr"><span class="hljs-attr">enable</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  boot.loader.grub.<span class="hljs-attr"><span class="hljs-attr">device</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span>;
}
</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.recurseIntoAttrs" shape="rect"></a>5.1.2.27.&nbsp;<code class="function">lib.attrsets.recurseIntoAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">recurseIntoAttrs :: AttrSet -&gt; AttrSet</code>
      </h5></div></div></div><p><a id="lib.attrsets.recurseIntoAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L483" target="_top" shape="rect">lib/attrsets.nix:483</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p><p>
       Make various Nix tools consider the contents of the resulting attribute set when looking for what to build, find, etc.
      </p><p>
       This function only affects a single attribute set; it does not apply itself recursively for nested attribute sets.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">attrs</code>
        </span></dt><dd><p>
          An attribute set to scan for derivations.
         </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.recurseIntoAttrs-example" shape="rect"></a><p class="title"><strong>Example&nbsp;5.34.&nbsp;Making Nix look inside an attribute set</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">{ pkgs ? <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {} }:
{
  <span class="hljs-attr"><span class="hljs-attr">myTools</span></span> = pkgs.lib.recurseIntoAttrs {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (pkgs) hello figlet;
  };
}
</pre></div></div><br class="example-break" clear="none"><br></section></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-functions-library-strings" class="title">5.1.3.&nbsp;String manipulation functions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-strings" aria-label="Anchor link for: sec functions library strings" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatStrings" shape="rect"></a>5.1.3.1.&nbsp;<code class="function">lib.strings.concatStrings</code></h4></div><div><h5 class="subtitle"><code class="literal">concatStrings :: [string] -&gt; string</code>
      </h5></div></div></div><p>
       Concatenate a list of strings.
      </p><div class="example"><a id="idm140737321930576" shape="rect"></a><p class="title"><strong>Example&nbsp;5.35.&nbsp;<code class="function">lib.strings.concatStrings</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">concatStrings [<span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"foobar"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.concatStrings" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L21" target="_top" shape="rect">lib/strings.nix:21</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatMapStrings" shape="rect"></a>5.1.3.2.&nbsp;<code class="function">lib.strings.concatMapStrings</code></h4></div><div><h5 class="subtitle"><code class="literal">concatMapStrings :: (a -&gt; string) -&gt; [a] -&gt; string</code>
      </h5></div></div></div><p>
       Map a function over a list and concatenate the resulting strings.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321919376" shape="rect"></a><p class="title"><strong>Example&nbsp;5.36.&nbsp;<code class="function">lib.strings.concatMapStrings</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">concatMapStrings (x: <span class="hljs-string"><span class="hljs-string">"a"</span></span> + x) [<span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"afooabar"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.concatMapStrings" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L31" target="_top" shape="rect">lib/strings.nix:31</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatImapStrings" shape="rect"></a>5.1.3.3.&nbsp;<code class="function">lib.strings.concatImapStrings</code></h4></div><div><h5 class="subtitle"><code class="literal">concatImapStrings :: (int -&gt; a -&gt; string) -&gt; [a] -&gt; string</code>
      </h5></div></div></div><p>
       Like `concatMapStrings` except that the f functions also gets the position as a parameter.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321908048" shape="rect"></a><p class="title"><strong>Example&nbsp;5.37.&nbsp;<code class="function">lib.strings.concatImapStrings</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">concatImapStrings (pos: x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">toString</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> pos}</span></span></span><span class="hljs-string">-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${x}</span></span></span><span class="hljs-string">"</span></span>) [<span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"1-foo2-bar"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.concatImapStrings" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L42" target="_top" shape="rect">lib/strings.nix:42</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.intersperse" shape="rect"></a>5.1.3.4.&nbsp;<code class="function">lib.strings.intersperse</code></h4></div><div><h5 class="subtitle"><code class="literal">intersperse :: a -&gt; [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Place an element between each element of a list
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">separator</code>
        </span></dt><dd><p>
          Separator to add between elements
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Input list
         </p></dd></dl></div><div class="example"><a id="idm140737321896704" shape="rect"></a><p class="title"><strong>Example&nbsp;5.38.&nbsp;<code class="function">lib.strings.intersperse</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">intersperse <span class="hljs-string"><span class="hljs-string">"/"</span></span> [<span class="hljs-string"><span class="hljs-string">"usr"</span></span> <span class="hljs-string"><span class="hljs-string">"local"</span></span> <span class="hljs-string"><span class="hljs-string">"bin"</span></span>]
=&gt; [<span class="hljs-string"><span class="hljs-string">"usr"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"local"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"bin"</span></span>].
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.intersperse" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L52" target="_top" shape="rect">lib/strings.nix:52</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatStringsSep" shape="rect"></a>5.1.3.5.&nbsp;<code class="function">lib.strings.concatStringsSep</code></h4></div><div><h5 class="subtitle"><code class="literal">concatStringsSep :: string -&gt; [string] -&gt; string</code>
      </h5></div></div></div><p>
       Concatenate a list of strings with a separator between each element
      </p><div class="example"><a id="idm140737321889856" shape="rect"></a><p class="title"><strong>Example&nbsp;5.39.&nbsp;<code class="function">lib.strings.concatStringsSep</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">concatStringsSep <span class="hljs-string"><span class="hljs-string">"/"</span></span> [<span class="hljs-string"><span class="hljs-string">"usr"</span></span> <span class="hljs-string"><span class="hljs-string">"local"</span></span> <span class="hljs-string"><span class="hljs-string">"bin"</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"usr/local/bin"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.concatStringsSep" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L69" target="_top" shape="rect">lib/strings.nix:69</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatMapStringsSep" shape="rect"></a>5.1.3.6.&nbsp;<code class="function">lib.strings.concatMapStringsSep</code></h4></div><div><h5 class="subtitle"><code class="literal">concatMapStringsSep :: string -&gt; (string -&gt; string) -&gt; [string] -&gt; string</code>
      </h5></div></div></div><p>
       Maps a function over a list of strings and then concatenates the result with the specified separator interspersed between elements.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">sep</code>
        </span></dt><dd><p>
          Separator to add between elements
         </p></dd><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function to map over the list
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          List of input strings
         </p></dd></dl></div><div class="example"><a id="idm140737321876480" shape="rect"></a><p class="title"><strong>Example&nbsp;5.40.&nbsp;<code class="function">lib.strings.concatMapStringsSep</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">concatMapStringsSep <span class="hljs-string"><span class="hljs-string">"-"</span></span> (x: toUpper x)  [<span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span> <span class="hljs-string"><span class="hljs-string">"baz"</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"FOO-BAR-BAZ"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.concatMapStringsSep" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L82" target="_top" shape="rect">lib/strings.nix:82</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatImapStringsSep" shape="rect"></a>5.1.3.7.&nbsp;<code class="function">lib.strings.concatImapStringsSep</code></h4></div><div><h5 class="subtitle"><code class="literal">concatIMapStringsSep :: string -&gt; (int -&gt; string -&gt; string) -&gt; [string] -&gt; string</code>
      </h5></div></div></div><p>
       Same as `concatMapStringsSep`, but the mapping function additionally receives the position of its argument.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">sep</code>
        </span></dt><dd><p>
          Separator to add between elements
         </p></dd><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function that receives elements and their positions
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          List of input strings
         </p></dd></dl></div><div class="example"><a id="idm140737321862976" shape="rect"></a><p class="title"><strong>Example&nbsp;5.41.&nbsp;<code class="function">lib.strings.concatImapStringsSep</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">concatImapStringsSep <span class="hljs-string"><span class="hljs-string">"-"</span></span> (pos: x: <span class="hljs-built_in"><span class="hljs-built_in">toString</span></span> (x / pos)) [ <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ]
=&gt; <span class="hljs-string"><span class="hljs-string">"6-3-2"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.concatImapStringsSep" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L99" target="_top" shape="rect">lib/strings.nix:99</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.makeSearchPath" shape="rect"></a>5.1.3.8.&nbsp;<code class="function">lib.strings.makeSearchPath</code></h4></div><div><h5 class="subtitle"><code class="literal">makeSearchPath :: string -&gt; [string] -&gt; string</code>
      </h5></div></div></div><p>
       Construct a Unix-style, colon-separated search path consisting of the given `subDir` appended to each of the given paths.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">subDir</code>
        </span></dt><dd><p>
          Directory name to append
         </p></dd><dt><span class="term">
         <code class="varname">paths</code>
        </span></dt><dd><p>
          List of base paths
         </p></dd></dl></div><div class="example"><a id="idm140737321851520" shape="rect"></a><p class="title"><strong>Example&nbsp;5.42.&nbsp;<code class="function">lib.strings.makeSearchPath</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">makeSearchPath <span class="hljs-string"><span class="hljs-string">"bin"</span></span> [<span class="hljs-string"><span class="hljs-string">"/root"</span></span> <span class="hljs-string"><span class="hljs-string">"/usr"</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/local"</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"/root/bin:/usr/bin:/usr/local/bin"</span></span>
makeSearchPath <span class="hljs-string"><span class="hljs-string">"bin"</span></span> [<span class="hljs-string"><span class="hljs-string">""</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"/bin"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.makeSearchPath" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L118" target="_top" shape="rect">lib/strings.nix:118</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.makeSearchPathOutput" shape="rect"></a>5.1.3.9.&nbsp;<code class="function">lib.strings.makeSearchPathOutput</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string -&gt; [package] -&gt; string</code>
      </h5></div></div></div><p>
       Construct a Unix-style search path by appending the given `subDir` to the specified `output` of each of the packages. If no output by the given name is found, fallback to `.out` and then to the default.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">output</code>
        </span></dt><dd><p>
          Package output to use
         </p></dd><dt><span class="term">
         <code class="varname">subDir</code>
        </span></dt><dd><p>
          Directory name to append
         </p></dd><dt><span class="term">
         <code class="varname">pkgs</code>
        </span></dt><dd><p>
          List of packages
         </p></dd></dl></div><div class="example"><a id="idm140737321838096" shape="rect"></a><p class="title"><strong>Example&nbsp;5.43.&nbsp;<code class="function">lib.strings.makeSearchPathOutput</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">makeSearchPathOutput <span class="hljs-string"><span class="hljs-string">"dev"</span></span> <span class="hljs-string"><span class="hljs-string">"bin"</span></span> [ pkgs.openssl pkgs.zlib ]
=&gt; <span class="hljs-string"><span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r-dev/bin:/nix/store/wwh7mhwh269sfjkm6k5665b5kgp7jrk2-zlib-1.2.8/bin"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.makeSearchPathOutput" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L136" target="_top" shape="rect">lib/strings.nix:136</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.makeLibraryPath" shape="rect"></a>5.1.3.10.&nbsp;<code class="function">lib.strings.makeLibraryPath</code></h4></div></div></div><p>
       Construct a library search path (such as RPATH) containing the libraries for a set of packages
      </p><div class="example"><a id="idm140737321832000" shape="rect"></a><p class="title"><strong>Example&nbsp;5.44.&nbsp;<code class="function">lib.strings.makeLibraryPath</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">makeLibraryPath [ <span class="hljs-string"><span class="hljs-string">"/usr"</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/local"</span></span> ]
=&gt; <span class="hljs-string"><span class="hljs-string">"/usr/lib:/usr/local/lib"</span></span>
<span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; { }
makeLibraryPath [ pkgs.openssl pkgs.zlib ]
=&gt; <span class="hljs-string"><span class="hljs-string">"/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r/lib:/nix/store/wwh7mhwh269sfjkm6k5665b5kgp7jrk2-zlib-1.2.8/lib"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.makeLibraryPath" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L154" target="_top" shape="rect">lib/strings.nix:154</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.makeBinPath" shape="rect"></a>5.1.3.11.&nbsp;<code class="function">lib.strings.makeBinPath</code></h4></div></div></div><p>
       Construct a binary search path (such as $PATH) containing the binaries for a set of packages.
      </p><div class="example"><a id="idm140737321826000" shape="rect"></a><p class="title"><strong>Example&nbsp;5.45.&nbsp;<code class="function">lib.strings.makeBinPath</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">makeBinPath [<span class="hljs-string"><span class="hljs-string">"/root"</span></span> <span class="hljs-string"><span class="hljs-string">"/usr"</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/local"</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"/root/bin:/usr/bin:/usr/local/bin"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.makeBinPath" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L163" target="_top" shape="rect">lib/strings.nix:163</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.optionalString" shape="rect"></a>5.1.3.12.&nbsp;<code class="function">lib.strings.optionalString</code></h4></div><div><h5 class="subtitle"><code class="literal">optionalString :: bool -&gt; string -&gt; string</code>
      </h5></div></div></div><p>
       Depending on the boolean `cond', return either the given string or the empty string. Useful to concatenate against a bigger string.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">cond</code>
        </span></dt><dd><p>
          Condition
         </p></dd><dt><span class="term">
         <code class="varname">string</code>
        </span></dt><dd><p>
          String to return if condition is true
         </p></dd></dl></div><div class="example"><a id="idm140737321814560" shape="rect"></a><p class="title"><strong>Example&nbsp;5.46.&nbsp;<code class="function">lib.strings.optionalString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">optionalString <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"some-string"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"some-string"</span></span>
optionalString <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-string"><span class="hljs-string">"some-string"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">""</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.optionalString" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L176" target="_top" shape="rect">lib/strings.nix:176</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.hasPrefix" shape="rect"></a>5.1.3.13.&nbsp;<code class="function">lib.strings.hasPrefix</code></h4></div><div><h5 class="subtitle"><code class="literal">hasPrefix :: string -&gt; string -&gt; bool</code>
      </h5></div></div></div><p>
       Determine whether a string has given prefix.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pref</code>
        </span></dt><dd><p>
          Prefix to check for
         </p></dd><dt><span class="term">
         <code class="varname">str</code>
        </span></dt><dd><p>
          Input string
         </p></dd></dl></div><div class="example"><a id="idm140737321803312" shape="rect"></a><p class="title"><strong>Example&nbsp;5.47.&nbsp;<code class="function">lib.strings.hasPrefix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">hasPrefix <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"foobar"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
hasPrefix <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"barfoo"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.hasPrefix" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L192" target="_top" shape="rect">lib/strings.nix:192</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.hasSuffix" shape="rect"></a>5.1.3.14.&nbsp;<code class="function">lib.strings.hasSuffix</code></h4></div><div><h5 class="subtitle"><code class="literal">hasSuffix :: string -&gt; string -&gt; bool</code>
      </h5></div></div></div><p>
       Determine whether a string has given suffix.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">suffix</code>
        </span></dt><dd><p>
          Suffix to check for
         </p></dd><dt><span class="term">
         <code class="varname">content</code>
        </span></dt><dd><p>
          Input string
         </p></dd></dl></div><div class="example"><a id="idm140737321792096" shape="rect"></a><p class="title"><strong>Example&nbsp;5.48.&nbsp;<code class="function">lib.strings.hasSuffix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">hasSuffix <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"foobar"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
hasSuffix <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"barfoo"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.hasSuffix" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L208" target="_top" shape="rect">lib/strings.nix:208</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.hasInfix" shape="rect"></a>5.1.3.15.&nbsp;<code class="function">lib.strings.hasInfix</code></h4></div><div><h5 class="subtitle"><code class="literal">hasInfix :: string -&gt; string -&gt; bool</code>
      </h5></div></div></div><p>
       Determine whether a string contains the given infix
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">infix</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">content</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321780848" shape="rect"></a><p class="title"><strong>Example&nbsp;5.49.&nbsp;<code class="function">lib.strings.hasInfix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">hasInfix <span class="hljs-string"><span class="hljs-string">"bc"</span></span> <span class="hljs-string"><span class="hljs-string">"abcd"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
hasInfix <span class="hljs-string"><span class="hljs-string">"ab"</span></span> <span class="hljs-string"><span class="hljs-string">"abcd"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
hasInfix <span class="hljs-string"><span class="hljs-string">"cd"</span></span> <span class="hljs-string"><span class="hljs-string">"abcd"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
hasInfix <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"abcd"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.hasInfix" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L233" target="_top" shape="rect">lib/strings.nix:233</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.stringToCharacters" shape="rect"></a>5.1.3.16.&nbsp;<code class="function">lib.strings.stringToCharacters</code></h4></div><div><h5 class="subtitle"><code class="literal">stringToCharacters :: string -&gt; [string]</code>
      </h5></div></div></div><p>
       Convert a string to a list of characters (i.e. singleton strings). This allows you to, e.g., map a function over each character. However, note that this will likely be horribly inefficient; Nix is not a general purpose programming language. Complex string manipulations should, if appropriate, be done in a derivation. Also note that Nix treats strings as a list of bytes and thus doesn't handle unicode.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">s</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321771600" shape="rect"></a><p class="title"><strong>Example&nbsp;5.50.&nbsp;<code class="function">lib.strings.stringToCharacters</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">stringToCharacters <span class="hljs-string"><span class="hljs-string">""</span></span>
=&gt; [ ]
stringToCharacters <span class="hljs-string"><span class="hljs-string">"abc"</span></span>
=&gt; [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> ]
stringToCharacters <span class="hljs-string"><span class="hljs-string">"💩"</span></span>
=&gt; [ <span class="hljs-string"><span class="hljs-string">"�"</span></span> <span class="hljs-string"><span class="hljs-string">"�"</span></span> <span class="hljs-string"><span class="hljs-string">"�"</span></span> <span class="hljs-string"><span class="hljs-string">"�"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.stringToCharacters" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L257" target="_top" shape="rect">lib/strings.nix:257</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.stringAsChars" shape="rect"></a>5.1.3.17.&nbsp;<code class="function">lib.strings.stringAsChars</code></h4></div><div><h5 class="subtitle"><code class="literal">stringAsChars :: (string -&gt; string) -&gt; string -&gt; string</code>
      </h5></div></div></div><p>
       Manipulate a string character by character and replace them by strings before concatenating the results.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function to map over each individual character
         </p></dd><dt><span class="term">
         <code class="varname">s</code>
        </span></dt><dd><p>
          Input string
         </p></dd></dl></div><div class="example"><a id="idm140737321760224" shape="rect"></a><p class="title"><strong>Example&nbsp;5.51.&nbsp;<code class="function">lib.strings.stringAsChars</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">stringAsChars (x: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-attr"><span class="hljs-attr">x</span></span> == <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">"i"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> x) <span class="hljs-string"><span class="hljs-string">"nax"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"nix"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.stringAsChars" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L269" target="_top" shape="rect">lib/strings.nix:269</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escape" shape="rect"></a>5.1.3.18.&nbsp;<code class="function">lib.strings.escape</code></h4></div><div><h5 class="subtitle"><code class="literal">escape :: [string] -&gt; string -&gt; string</code>
      </h5></div></div></div><p>
       Escape occurrence of the elements of `list` in `string` by prefixing it with a backslash.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321750880" shape="rect"></a><p class="title"><strong>Example&nbsp;5.52.&nbsp;<code class="function">lib.strings.escape</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">escape [<span class="hljs-string"><span class="hljs-string">"("</span></span> <span class="hljs-string"><span class="hljs-string">")"</span></span>] <span class="hljs-string"><span class="hljs-string">"(foo)"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"\\(foo\\)"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.escape" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L286" target="_top" shape="rect">lib/strings.nix:286</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escapeShellArg" shape="rect"></a>5.1.3.19.&nbsp;<code class="function">lib.strings.escapeShellArg</code></h4></div><div><h5 class="subtitle"><code class="literal">escapeShellArg :: string -&gt; string</code>
      </h5></div></div></div><p>
       Quote string to be used safely within the Bourne shell.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">arg</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321741632" shape="rect"></a><p class="title"><strong>Example&nbsp;5.53.&nbsp;<code class="function">lib.strings.escapeShellArg</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">escapeShellArg <span class="hljs-string"><span class="hljs-string">"esc'ape\nme"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"'esc'\\''ape\nme'"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.escapeShellArg" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L296" target="_top" shape="rect">lib/strings.nix:296</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escapeShellArgs" shape="rect"></a>5.1.3.20.&nbsp;<code class="function">lib.strings.escapeShellArgs</code></h4></div><div><h5 class="subtitle"><code class="literal">escapeShellArgs :: [string] -&gt; string</code>
      </h5></div></div></div><p>
       Quote all arguments to be safely passed to the Bourne shell.
      </p><div class="example"><a id="idm140737321734656" shape="rect"></a><p class="title"><strong>Example&nbsp;5.54.&nbsp;<code class="function">lib.strings.escapeShellArgs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">escapeShellArgs [<span class="hljs-string"><span class="hljs-string">"one"</span></span> <span class="hljs-string"><span class="hljs-string">"two three"</span></span> <span class="hljs-string"><span class="hljs-string">"four'five"</span></span>]
=&gt; <span class="hljs-string"><span class="hljs-string">"'one' 'two three' 'four'\\''five'"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.escapeShellArgs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L306" target="_top" shape="rect">lib/strings.nix:306</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escapeNixString" shape="rect"></a>5.1.3.21.&nbsp;<code class="function">lib.strings.escapeNixString</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string</code>
      </h5></div></div></div><p>
       Turn a string into a Nix expression representing that string
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">s</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321725264" shape="rect"></a><p class="title"><strong>Example&nbsp;5.55.&nbsp;<code class="function">lib.strings.escapeNixString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">escapeNixString <span class="hljs-string"><span class="hljs-string">"hello\</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${}</span></span></span><span class="hljs-string">\n"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"\"</span></span>hello\\\${}\\n\<span class="hljs-string"><span class="hljs-string">""</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.escapeNixString" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L316" target="_top" shape="rect">lib/strings.nix:316</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escapeNixIdentifier" shape="rect"></a>5.1.3.22.&nbsp;<code class="function">lib.strings.escapeNixIdentifier</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string</code>
      </h5></div></div></div><p>
       Quotes a string if it can't be used as an identifier directly.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">s</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321716032" shape="rect"></a><p class="title"><strong>Example&nbsp;5.56.&nbsp;<code class="function">lib.strings.escapeNixIdentifier</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">escapeNixIdentifier <span class="hljs-string"><span class="hljs-string">"hello"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"hello"</span></span>
escapeNixIdentifier <span class="hljs-string"><span class="hljs-string">"0abc"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"\"</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>abc\<span class="hljs-string"><span class="hljs-string">""</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.escapeNixIdentifier" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L328" target="_top" shape="rect">lib/strings.nix:328</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.toLower" shape="rect"></a>5.1.3.23.&nbsp;<code class="function">lib.strings.toLower</code></h4></div><div><h5 class="subtitle"><code class="literal">toLower :: string -&gt; string</code>
      </h5></div></div></div><p>
       Converts an ASCII string to lower-case.
      </p><div class="example"><a id="idm140737321709280" shape="rect"></a><p class="title"><strong>Example&nbsp;5.57.&nbsp;<code class="function">lib.strings.toLower</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">toLower <span class="hljs-string"><span class="hljs-string">"HOME"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"home"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.toLower" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L359" target="_top" shape="rect">lib/strings.nix:359</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.toUpper" shape="rect"></a>5.1.3.24.&nbsp;<code class="function">lib.strings.toUpper</code></h4></div><div><h5 class="subtitle"><code class="literal">toUpper :: string -&gt; string</code>
      </h5></div></div></div><p>
       Converts an ASCII string to upper-case.
      </p><div class="example"><a id="idm140737321702624" shape="rect"></a><p class="title"><strong>Example&nbsp;5.58.&nbsp;<code class="function">lib.strings.toUpper</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">toUpper <span class="hljs-string"><span class="hljs-string">"home"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"HOME"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.toUpper" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L369" target="_top" shape="rect">lib/strings.nix:369</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.addContextFrom" shape="rect"></a>5.1.3.25.&nbsp;<code class="function">lib.strings.addContextFrom</code></h4></div></div></div><p>
       Appends string context from another string. This is an implementation detail of Nix.
      </p><p>
       Strings in Nix carry an invisible `context` which is a list of strings representing store paths. If the string is later used in a derivation attribute, the derivation will properly populate the inputDrvs and inputSrcs.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">a</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">b</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321691440" shape="rect"></a><p class="title"><strong>Example&nbsp;5.59.&nbsp;<code class="function">lib.strings.addContextFrom</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; { };
addContextFrom pkgs.coreutils <span class="hljs-string"><span class="hljs-string">"bar"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"bar"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.addContextFrom" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L384" target="_top" shape="rect">lib/strings.nix:384</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.splitString" shape="rect"></a>5.1.3.26.&nbsp;<code class="function">lib.strings.splitString</code></h4></div></div></div><p>
       Cut a string with a separator and produces a list of strings which were separated by this separator.
      </p><p>
       NOTE: this function is not performant and should never be used.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">_sep</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">_s</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321680416" shape="rect"></a><p class="title"><strong>Example&nbsp;5.60.&nbsp;<code class="function">lib.strings.splitString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">splitString <span class="hljs-string"><span class="hljs-string">"."</span></span> <span class="hljs-string"><span class="hljs-string">"foo.bar.baz"</span></span>
=&gt; [ <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span> <span class="hljs-string"><span class="hljs-string">"baz"</span></span> ]
splitString <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/local/bin"</span></span>
=&gt; [ <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">"usr"</span></span> <span class="hljs-string"><span class="hljs-string">"local"</span></span> <span class="hljs-string"><span class="hljs-string">"bin"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.splitString" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L397" target="_top" shape="rect">lib/strings.nix:397</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.removePrefix" shape="rect"></a>5.1.3.27.&nbsp;<code class="function">lib.strings.removePrefix</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string -&gt; string</code>
      </h5></div></div></div><p>
       Return a string without the specified prefix, if the prefix matches.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">prefix</code>
        </span></dt><dd><p>
          Prefix to remove if it matches
         </p></dd><dt><span class="term">
         <code class="varname">str</code>
        </span></dt><dd><p>
          Input string
         </p></dd></dl></div><div class="example"><a id="idm140737321669072" shape="rect"></a><p class="title"><strong>Example&nbsp;5.61.&nbsp;<code class="function">lib.strings.removePrefix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">removePrefix <span class="hljs-string"><span class="hljs-string">"foo."</span></span> <span class="hljs-string"><span class="hljs-string">"foo.bar.baz"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"bar.baz"</span></span>
removePrefix <span class="hljs-string"><span class="hljs-string">"xxx"</span></span> <span class="hljs-string"><span class="hljs-string">"foo.bar.baz"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"foo.bar.baz"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.removePrefix" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L430" target="_top" shape="rect">lib/strings.nix:430</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.removeSuffix" shape="rect"></a>5.1.3.28.&nbsp;<code class="function">lib.strings.removeSuffix</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string -&gt; string</code>
      </h5></div></div></div><p>
       Return a string without the specified suffix, if the suffix matches.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">suffix</code>
        </span></dt><dd><p>
          Suffix to remove if it matches
         </p></dd><dt><span class="term">
         <code class="varname">str</code>
        </span></dt><dd><p>
          Input string
         </p></dd></dl></div><div class="example"><a id="idm140737321657744" shape="rect"></a><p class="title"><strong>Example&nbsp;5.62.&nbsp;<code class="function">lib.strings.removeSuffix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">removeSuffix <span class="hljs-string"><span class="hljs-string">"front"</span></span> <span class="hljs-string"><span class="hljs-string">"homefront"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"home"</span></span>
removeSuffix <span class="hljs-string"><span class="hljs-string">"xxx"</span></span> <span class="hljs-string"><span class="hljs-string">"homefront"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"homefront"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.removeSuffix" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L454" target="_top" shape="rect">lib/strings.nix:454</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.versionOlder" shape="rect"></a>5.1.3.29.&nbsp;<code class="function">lib.strings.versionOlder</code></h4></div></div></div><p>
       Return true if string v1 denotes a version older than v2.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">v1</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">v2</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321647232" shape="rect"></a><p class="title"><strong>Example&nbsp;5.63.&nbsp;<code class="function">lib.strings.versionOlder</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">versionOlder <span class="hljs-string"><span class="hljs-string">"1.1"</span></span> <span class="hljs-string"><span class="hljs-string">"1.2"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
versionOlder <span class="hljs-string"><span class="hljs-string">"1.1"</span></span> <span class="hljs-string"><span class="hljs-string">"1.1"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.versionOlder" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L476" target="_top" shape="rect">lib/strings.nix:476</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.versionAtLeast" shape="rect"></a>5.1.3.30.&nbsp;<code class="function">lib.strings.versionAtLeast</code></h4></div></div></div><p>
       Return true if string v1 denotes a version equal to or newer than v2.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">v1</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">v2</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321636752" shape="rect"></a><p class="title"><strong>Example&nbsp;5.64.&nbsp;<code class="function">lib.strings.versionAtLeast</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">versionAtLeast <span class="hljs-string"><span class="hljs-string">"1.1"</span></span> <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
versionAtLeast <span class="hljs-string"><span class="hljs-string">"1.1"</span></span> <span class="hljs-string"><span class="hljs-string">"1.1"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
versionAtLeast <span class="hljs-string"><span class="hljs-string">"1.1"</span></span> <span class="hljs-string"><span class="hljs-string">"1.2"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.versionAtLeast" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L488" target="_top" shape="rect">lib/strings.nix:488</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.getName" shape="rect"></a>5.1.3.31.&nbsp;<code class="function">lib.strings.getName</code></h4></div></div></div><p>
       This function takes an argument that's either a derivation or a derivation's "name" attribute and extracts the name part from that argument.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321628144" shape="rect"></a><p class="title"><strong>Example&nbsp;5.65.&nbsp;<code class="function">lib.strings.getName</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">getName <span class="hljs-string"><span class="hljs-string">"youtube-dl-2016.01.01"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"youtube-dl"</span></span>
getName pkgs.<span class="hljs-attr"><span class="hljs-attr">youtube-dl</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"youtube-dl"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.getName" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L500" target="_top" shape="rect">lib/strings.nix:500</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.getVersion" shape="rect"></a>5.1.3.32.&nbsp;<code class="function">lib.strings.getVersion</code></h4></div></div></div><p>
       This function takes an argument that's either a derivation or a derivation's "name" attribute and extracts the version part from that argument.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321619552" shape="rect"></a><p class="title"><strong>Example&nbsp;5.66.&nbsp;<code class="function">lib.strings.getVersion</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">getVersion <span class="hljs-string"><span class="hljs-string">"youtube-dl-2016.01.01"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"2016.01.01"</span></span>
getVersion pkgs.<span class="hljs-attr"><span class="hljs-attr">youtube-dl</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"2016.01.01"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.getVersion" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L517" target="_top" shape="rect">lib/strings.nix:517</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.nameFromURL" shape="rect"></a>5.1.3.33.&nbsp;<code class="function">lib.strings.nameFromURL</code></h4></div></div></div><p>
       Extract name with version from URL. Ask for separator which is supposed to start extension.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">url</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">sep</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321609008" shape="rect"></a><p class="title"><strong>Example&nbsp;5.67.&nbsp;<code class="function">lib.strings.nameFromURL</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">nameFromURL <span class="hljs-string"><span class="hljs-string">"https://nixos.org/releases/nix/nix-1.7/nix-1.7-x86_64-linux.tar.bz2"</span></span> <span class="hljs-string"><span class="hljs-string">"-"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"nix"</span></span>
nameFromURL <span class="hljs-string"><span class="hljs-string">"https://nixos.org/releases/nix/nix-1.7/nix-1.7-x86_64-linux.tar.bz2"</span></span> <span class="hljs-string"><span class="hljs-string">"_"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"nix-1.7-x86"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.nameFromURL" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L533" target="_top" shape="rect">lib/strings.nix:533</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.enableFeature" shape="rect"></a>5.1.3.34.&nbsp;<code class="function">lib.strings.enableFeature</code></h4></div></div></div><p>
       Create an --{enable,disable}-&lt;feat&gt; string that can be passed to standard GNU Autoconf scripts.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">enable</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">feat</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321598384" shape="rect"></a><p class="title"><strong>Example&nbsp;5.68.&nbsp;<code class="function">lib.strings.enableFeature</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">enableFeature <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"shared"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"--enable-shared"</span></span>
enableFeature <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-string"><span class="hljs-string">"shared"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"--disable-shared"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.enableFeature" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L549" target="_top" shape="rect">lib/strings.nix:549</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.enableFeatureAs" shape="rect"></a>5.1.3.35.&nbsp;<code class="function">lib.strings.enableFeatureAs</code></h4></div></div></div><p>
       Create an --{enable-&lt;feat&gt;=&lt;value&gt;,disable-&lt;feat&gt;} string that can be passed to standard GNU Autoconf scripts.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">enable</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">feat</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">value</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321585280" shape="rect"></a><p class="title"><strong>Example&nbsp;5.69.&nbsp;<code class="function">lib.strings.enableFeatureAs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">enableFeature <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"shared"</span></span> <span class="hljs-string"><span class="hljs-string">"foo"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"--enable-shared=foo"</span></span>
enableFeature <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-string"><span class="hljs-string">"shared"</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">throw</span></span> <span class="hljs-string"><span class="hljs-string">"ignored"</span></span>)
=&gt; <span class="hljs-string"><span class="hljs-string">"--disable-shared"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.enableFeatureAs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L560" target="_top" shape="rect">lib/strings.nix:560</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.withFeature" shape="rect"></a>5.1.3.36.&nbsp;<code class="function">lib.strings.withFeature</code></h4></div></div></div><p>
       Create an --{with,without}-&lt;feat&gt; string that can be passed to standard GNU Autoconf scripts.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">with_</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">feat</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321574496" shape="rect"></a><p class="title"><strong>Example&nbsp;5.70.&nbsp;<code class="function">lib.strings.withFeature</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">withFeature <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"shared"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"--with-shared"</span></span>
withFeature <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-string"><span class="hljs-string">"shared"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"--without-shared"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.withFeature" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L571" target="_top" shape="rect">lib/strings.nix:571</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.withFeatureAs" shape="rect"></a>5.1.3.37.&nbsp;<code class="function">lib.strings.withFeatureAs</code></h4></div></div></div><p>
       Create an --{with-&lt;feat&gt;=&lt;value&gt;,without-&lt;feat&gt;} string that can be passed to standard GNU Autoconf scripts.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">with_</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">feat</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">value</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321561856" shape="rect"></a><p class="title"><strong>Example&nbsp;5.71.&nbsp;<code class="function">lib.strings.withFeatureAs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">with_Feature <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"shared"</span></span> <span class="hljs-string"><span class="hljs-string">"foo"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"--with-shared=foo"</span></span>
with_Feature <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-string"><span class="hljs-string">"shared"</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">throw</span></span> <span class="hljs-string"><span class="hljs-string">"ignored"</span></span>)
=&gt; <span class="hljs-string"><span class="hljs-string">"--without-shared"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.withFeatureAs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L582" target="_top" shape="rect">lib/strings.nix:582</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.fixedWidthString" shape="rect"></a>5.1.3.38.&nbsp;<code class="function">lib.strings.fixedWidthString</code></h4></div><div><h5 class="subtitle"><code class="literal">fixedWidthString :: int -&gt; string -&gt; string</code>
      </h5></div></div></div><p>
       Create a fixed width string with additional prefix to match required width.
      </p><p>
       This function will fail if the input string is longer than the requested length.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">width</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">filler</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">str</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321547824" shape="rect"></a><p class="title"><strong>Example&nbsp;5.72.&nbsp;<code class="function">lib.strings.fixedWidthString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">fixedWidthString <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-string"><span class="hljs-string">"0"</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">toString</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>)
=&gt; <span class="hljs-string"><span class="hljs-string">"00015"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.fixedWidthString" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L596" target="_top" shape="rect">lib/strings.nix:596</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.fixedWidthNumber" shape="rect"></a>5.1.3.39.&nbsp;<code class="function">lib.strings.fixedWidthNumber</code></h4></div></div></div><p>
       Format a number adding leading zeroes up to fixed width.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">width</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">n</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321537408" shape="rect"></a><p class="title"><strong>Example&nbsp;5.73.&nbsp;<code class="function">lib.strings.fixedWidthNumber</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">fixedWidthNumber <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"00015"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.fixedWidthNumber" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L613" target="_top" shape="rect">lib/strings.nix:613</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.floatToString" shape="rect"></a>5.1.3.40.&nbsp;<code class="function">lib.strings.floatToString</code></h4></div></div></div><p>
       Convert a float to a string, but emit a warning when precision is lost during the conversion
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">float</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321528976" shape="rect"></a><p class="title"><strong>Example&nbsp;5.74.&nbsp;<code class="function">lib.strings.floatToString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs bash" xml:space="preserve">floatToString 0.000001
=&gt; <span class="hljs-string"><span class="hljs-string">"0.000001"</span></span>
floatToString 0.0000001
=&gt; trace: warning: Imprecise conversion from <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> to string 0.000000
<span class="hljs-string"><span class="hljs-string">"0.000000"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.floatToString" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L625" target="_top" shape="rect">lib/strings.nix:625</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.isCoercibleToString" shape="rect"></a>5.1.3.41.&nbsp;<code class="function">lib.strings.isCoercibleToString</code></h4></div></div></div><p>
       Check whether a value can be coerced to a string
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.strings.isCoercibleToString" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L632" target="_top" shape="rect">lib/strings.nix:632</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.isStorePath" shape="rect"></a>5.1.3.42.&nbsp;<code class="function">lib.strings.isStorePath</code></h4></div></div></div><p>
       Check whether a value is a store path.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321513488" shape="rect"></a><p class="title"><strong>Example&nbsp;5.75.&nbsp;<code class="function">lib.strings.isStorePath</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">isStorePath <span class="hljs-string"><span class="hljs-string">"/nix/store/d945ibfx9x185xf04b890y4f9g3cbb63-python-2.7.11/bin/python"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
isStorePath <span class="hljs-string"><span class="hljs-string">"/nix/store/d945ibfx9x185xf04b890y4f9g3cbb63-python-2.7.11/"</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
isStorePath pkgs.<span class="hljs-attr"><span class="hljs-attr">python</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
isStorePath [] || isStorePath <span class="hljs-number"><span class="hljs-number">42</span></span> || isStorePath {} || …
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.isStorePath" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L650" target="_top" shape="rect">lib/strings.nix:650</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.toInt" shape="rect"></a>5.1.3.43.&nbsp;<code class="function">lib.strings.toInt</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; int</code>
      </h5></div></div></div><p>
       Parse a string string as an int.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">str</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321504112" shape="rect"></a><p class="title"><strong>Example&nbsp;5.76.&nbsp;<code class="function">lib.strings.toInt</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">toInt <span class="hljs-string"><span class="hljs-string">"1337"</span></span>
=&gt; <span class="hljs-number"><span class="hljs-number">1337</span></span>
toInt <span class="hljs-string"><span class="hljs-string">"-4"</span></span>
=&gt; -<span class="hljs-number"><span class="hljs-number">4</span></span>
toInt <span class="hljs-string"><span class="hljs-string">"3.14"</span></span>
=&gt; error: floating point JSON numbers are not supported
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.toInt" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L671" target="_top" shape="rect">lib/strings.nix:671</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.readPathsFromFile" shape="rect"></a>5.1.3.44.&nbsp;<code class="function">lib.strings.readPathsFromFile</code></h4></div></div></div><p>
       Read a list of paths from `file`, relative to the `rootPath`. Lines beginning with `#` are treated as comments and ignored. Whitespace is significant.
      </p><p>
       NOTE: This function is not performant and should be avoided.
      </p><div class="example"><a id="idm140737321497392" shape="rect"></a><p class="title"><strong>Example&nbsp;5.77.&nbsp;<code class="function">lib.strings.readPathsFromFile</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">readPathsFromFile /prefix
./pkgs/development/libraries/qt-<span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">5.4</span></span>/qtbase/<span class="hljs-attr"><span class="hljs-attr">series</span></span>
=&gt; [ <span class="hljs-string"><span class="hljs-string">"/prefix/dlopen-resolv.patch"</span></span> <span class="hljs-string"><span class="hljs-string">"/prefix/tzdir.patch"</span></span>
<span class="hljs-string"><span class="hljs-string">"/prefix/dlopen-libXcursor.patch"</span></span> <span class="hljs-string"><span class="hljs-string">"/prefix/dlopen-openssl.patch"</span></span>
<span class="hljs-string"><span class="hljs-string">"/prefix/dlopen-dbus.patch"</span></span> <span class="hljs-string"><span class="hljs-string">"/prefix/xdg-config-dirs.patch"</span></span>
<span class="hljs-string"><span class="hljs-string">"/prefix/nix-profiles-library-paths.patch"</span></span>
<span class="hljs-string"><span class="hljs-string">"/prefix/compose-search-path.patch"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.readPathsFromFile" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L692" target="_top" shape="rect">lib/strings.nix:692</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.fileContents" shape="rect"></a>5.1.3.45.&nbsp;<code class="function">lib.strings.fileContents</code></h4></div><div><h5 class="subtitle"><code class="literal">fileContents :: path -&gt; string</code>
      </h5></div></div></div><p>
       Read the contents of a file removing the trailing \n
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">file</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321487840" shape="rect"></a><p class="title"><strong>Example&nbsp;5.78.&nbsp;<code class="function">lib.strings.fileContents</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">$ echo <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> &gt; ./version

fileContents ./<span class="hljs-attr"><span class="hljs-attr">version</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.fileContents" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L712" target="_top" shape="rect">lib/strings.nix:712</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.sanitizeDerivationName" shape="rect"></a>5.1.3.46.&nbsp;<code class="function">lib.strings.sanitizeDerivationName</code></h4></div><div><h5 class="subtitle"><code class="literal">sanitizeDerivationName :: String -&gt; String</code>
      </h5></div></div></div><p>
       Creates a valid derivation name from a potentially invalid one.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">string</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321478464" shape="rect"></a><p class="title"><strong>Example&nbsp;5.79.&nbsp;<code class="function">lib.strings.sanitizeDerivationName</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">sanitizeDerivationName <span class="hljs-string"><span class="hljs-string">"../hello.bar # foo"</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"-hello.bar-foo"</span></span>
sanitizeDerivationName <span class="hljs-string"><span class="hljs-string">""</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>
sanitizeDerivationName pkgs.<span class="hljs-attr"><span class="hljs-attr">hello</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"-nix-store-2g75chlbpxlrqn15zlby2dfh8hr9qwbk-hello-2.10"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.strings.sanitizeDerivationName" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L727" target="_top" shape="rect">lib/strings.nix:727</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-functions-library-trivial" class="title">5.1.4.&nbsp;Miscellaneous functions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-trivial" aria-label="Anchor link for: sec functions library trivial" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.id" shape="rect"></a>5.1.4.1.&nbsp;<code class="function">lib.trivial.id</code></h4></div><div><h5 class="subtitle"><code class="literal">id :: a -&gt; a</code>
      </h5></div></div></div><p>
       The identity function For when you need a function that does “nothing”.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          The value to return
         </p></dd></dl></div><p><a id="lib.trivial.id" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L12" target="_top" shape="rect">lib/trivial.nix:12</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.const" shape="rect"></a>5.1.4.2.&nbsp;<code class="function">lib.trivial.const</code></h4></div><div><h5 class="subtitle"><code class="literal">const :: a -&gt; b -&gt; a</code>
      </h5></div></div></div><p>
       The constant function
      </p><p>
       Ignores the second argument. If called with only one argument, constructs a function that always returns a static value.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Value to return
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          Value to ignore
         </p></dd></dl></div><div class="example"><a id="idm140737321456192" shape="rect"></a><p class="title"><strong>Example&nbsp;5.80.&nbsp;<code class="function">lib.trivial.const</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">f</span></span> = const <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> f <span class="hljs-number"><span class="hljs-number">10</span></span>
=&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.trivial.const" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L26" target="_top" shape="rect">lib/trivial.nix:26</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.pipe" shape="rect"></a>5.1.4.3.&nbsp;<code class="function">lib.trivial.pipe</code></h4></div><div><h5 class="subtitle"><code class="literal">pipe :: a -&gt; [&lt;functions&gt;] -&gt; &lt;return type of last function&gt;</code>
      </h5></div></div></div><p>
       Pipes a value through a list of functions, left to right.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">val</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">functions</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321444864" shape="rect"></a><p class="title"><strong>Example&nbsp;5.81.&nbsp;<code class="function">lib.trivial.pipe</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs bash" xml:space="preserve">pipe 2 [
(x: x + 2)  <span class="hljs-comment"><span class="hljs-comment"># 2 + 2 = 4</span></span>
(x: x * 2)  <span class="hljs-comment"><span class="hljs-comment"># 4 * 2 = 8</span></span>
]
=&gt; 8

<span class="hljs-comment"><span class="hljs-comment"># ideal to do text transformations</span></span>
pipe [ <span class="hljs-string"><span class="hljs-string">"a/b"</span></span> <span class="hljs-string"><span class="hljs-string">"a/c"</span></span> ] [

<span class="hljs-comment"><span class="hljs-comment"># create the cp command</span></span>
(map (file: <span class="hljs-string"><span class="hljs-string">''</span></span>cp <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${src}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${file}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-variable"><span class="hljs-variable">$out</span></span>\n<span class="hljs-string"><span class="hljs-string">''</span></span>))

<span class="hljs-comment"><span class="hljs-comment"># concatenate all commands into one string</span></span>
lib.concatStrings

<span class="hljs-comment"><span class="hljs-comment"># make that string into a nix derivation</span></span>
(pkgs.runCommand <span class="hljs-string"><span class="hljs-string">"copy-to-out"</span></span> {})

]
=&gt; &lt;drv <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> copies all files to <span class="hljs-variable"><span class="hljs-variable">$out</span></span>&gt;

The output <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> of each <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> has to be the input <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>
of the next <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>, and the last <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> returns the
final value.
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.trivial.pipe" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L61" target="_top" shape="rect">lib/trivial.nix:61</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.concat" shape="rect"></a>5.1.4.4.&nbsp;<code class="function">lib.trivial.concat</code></h4></div></div></div><p>
       note please don’t add a function like `compose = flip pipe`. This would confuse users, because the order of the functions in the list is not clear. With pipe, it’s obvious that it goes first-to-last. With `compose`, not so much.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.concat" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L80" target="_top" shape="rect">lib/trivial.nix:80</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.or" shape="rect"></a>5.1.4.5.&nbsp;<code class="function">lib.trivial.or</code></h4></div></div></div><p>
       boolean “or”
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.or" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L83" target="_top" shape="rect">lib/trivial.nix:83</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.and" shape="rect"></a>5.1.4.6.&nbsp;<code class="function">lib.trivial.and</code></h4></div></div></div><p>
       boolean “and”
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.and" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L86" target="_top" shape="rect">lib/trivial.nix:86</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.bitAnd" shape="rect"></a>5.1.4.7.&nbsp;<code class="function">lib.trivial.bitAnd</code></h4></div></div></div><p>
       bitwise “and”
      </p><p><a id="lib.trivial.bitAnd" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L89" target="_top" shape="rect">lib/trivial.nix:89</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.bitOr" shape="rect"></a>5.1.4.8.&nbsp;<code class="function">lib.trivial.bitOr</code></h4></div></div></div><p>
       bitwise “or”
      </p><p><a id="lib.trivial.bitOr" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L94" target="_top" shape="rect">lib/trivial.nix:94</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.bitXor" shape="rect"></a>5.1.4.9.&nbsp;<code class="function">lib.trivial.bitXor</code></h4></div></div></div><p>
       bitwise “xor”
      </p><p><a id="lib.trivial.bitXor" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L99" target="_top" shape="rect">lib/trivial.nix:99</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.bitNot" shape="rect"></a>5.1.4.10.&nbsp;<code class="function">lib.trivial.bitNot</code></h4></div></div></div><p>
       bitwise “not”
      </p><p><a id="lib.trivial.bitNot" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L104" target="_top" shape="rect">lib/trivial.nix:104</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.boolToString" shape="rect"></a>5.1.4.11.&nbsp;<code class="function">lib.trivial.boolToString</code></h4></div><div><h5 class="subtitle"><code class="literal">boolToString :: bool -&gt; string</code>
      </h5></div></div></div><p>
       Convert a boolean to a string.
      </p><p>
       This function uses the strings "true" and "false" to represent boolean values. Calling `toString` on a bool instead returns "1" and "" (sic!).
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">b</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.boolToString" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L114" target="_top" shape="rect">lib/trivial.nix:114</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.mergeAttrs" shape="rect"></a>5.1.4.12.&nbsp;<code class="function">lib.trivial.mergeAttrs</code></h4></div></div></div><p>
       Merge two attribute sets shallowly, right side trumps left
      </p><p>
       mergeAttrs :: attrs -&gt; attrs -&gt; attrs
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Left attribute set
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          Right attribute set (higher precedence for equal keys)
         </p></dd></dl></div><div class="example"><a id="idm140737321373200" shape="rect"></a><p class="title"><strong>Example&nbsp;5.82.&nbsp;<code class="function">lib.trivial.mergeAttrs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">mergeAttrs { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; } { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">4</span></span>; }
=&gt; { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">b</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">4</span></span>; }
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.trivial.mergeAttrs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L124" target="_top" shape="rect">lib/trivial.nix:124</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.flip" shape="rect"></a>5.1.4.13.&nbsp;<code class="function">lib.trivial.flip</code></h4></div><div><h5 class="subtitle"><code class="literal">flip :: (a -&gt; b -&gt; c) -&gt; (b -&gt; a -&gt; c)</code>
      </h5></div></div></div><p>
       Flip the order of the arguments of a binary function.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">a</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">b</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321360064" shape="rect"></a><p class="title"><strong>Example&nbsp;5.83.&nbsp;<code class="function">lib.trivial.flip</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">flip concat [1] [2]
=&gt; [ 2 1 ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.trivial.flip" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L138" target="_top" shape="rect">lib/trivial.nix:138</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.mapNullable" shape="rect"></a>5.1.4.14.&nbsp;<code class="function">lib.trivial.mapNullable</code></h4></div></div></div><p>
       Apply function if the supplied argument is non-null.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function to call
         </p></dd><dt><span class="term">
         <code class="varname">a</code>
        </span></dt><dd><p>
          Argument to check for null before passing it to `f`
         </p></dd></dl></div><div class="example"><a id="idm140737321349632" shape="rect"></a><p class="title"><strong>Example&nbsp;5.84.&nbsp;<code class="function">lib.trivial.mapNullable</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">mapNullable (x: x+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-attr"><span class="hljs-attr">null</span></span>
=&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span>
mapNullable (x: x+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">22</span></span>
=&gt; <span class="hljs-number"><span class="hljs-number">23</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.trivial.mapNullable" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L148" target="_top" shape="rect">lib/trivial.nix:148</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.version" shape="rect"></a>5.1.4.15.&nbsp;<code class="function">lib.trivial.version</code></h4></div></div></div><p>
       Returns the current full nixpkgs version number.
      </p><p><a id="lib.trivial.version" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L164" target="_top" shape="rect">lib/trivial.nix:164</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.release" shape="rect"></a>5.1.4.16.&nbsp;<code class="function">lib.trivial.release</code></h4></div></div></div><p>
       Returns the current nixpkgs release number as string.
      </p><p><a id="lib.trivial.release" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L167" target="_top" shape="rect">lib/trivial.nix:167</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.codeName" shape="rect"></a>5.1.4.17.&nbsp;<code class="function">lib.trivial.codeName</code></h4></div></div></div><p>
       Returns the current nixpkgs release code name.
      </p><p>
       On each release the first letter is bumped and a new animal is chosen starting with that new letter.
      </p><p><a id="lib.trivial.codeName" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L174" target="_top" shape="rect">lib/trivial.nix:174</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.versionSuffix" shape="rect"></a>5.1.4.18.&nbsp;<code class="function">lib.trivial.versionSuffix</code></h4></div></div></div><p>
       Returns the current nixpkgs version suffix as string.
      </p><p><a id="lib.trivial.versionSuffix" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L177" target="_top" shape="rect">lib/trivial.nix:177</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.revisionWithDefault" shape="rect"></a>5.1.4.19.&nbsp;<code class="function">lib.trivial.revisionWithDefault</code></h4></div><div><h5 class="subtitle"><code class="literal">revisionWithDefault :: string -&gt; string</code>
      </h5></div></div></div><p>
       Attempts to return the the current revision of nixpkgs and returns the supplied default value otherwise.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">default</code>
        </span></dt><dd><p>
          Default value to return if revision can not be determined
         </p></dd></dl></div><p><a id="lib.trivial.revisionWithDefault" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L188" target="_top" shape="rect">lib/trivial.nix:188</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.inNixShell" shape="rect"></a>5.1.4.20.&nbsp;<code class="function">lib.trivial.inNixShell</code></h4></div><div><h5 class="subtitle"><code class="literal">inNixShell :: bool</code>
      </h5></div></div></div><p>
       Determine whether the function is being called from inside a Nix shell.
      </p><p><a id="lib.trivial.inNixShell" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L206" target="_top" shape="rect">lib/trivial.nix:206</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.min" shape="rect"></a>5.1.4.21.&nbsp;<code class="function">lib.trivial.min</code></h4></div></div></div><p>
       Return minimum of two numbers.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.min" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L212" target="_top" shape="rect">lib/trivial.nix:212</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.max" shape="rect"></a>5.1.4.22.&nbsp;<code class="function">lib.trivial.max</code></h4></div></div></div><p>
       Return maximum of two numbers.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.max" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L215" target="_top" shape="rect">lib/trivial.nix:215</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.mod" shape="rect"></a>5.1.4.23.&nbsp;<code class="function">lib.trivial.mod</code></h4></div></div></div><p>
       Integer modulus
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">base</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">int</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321290976" shape="rect"></a><p class="title"><strong>Example&nbsp;5.85.&nbsp;<code class="function">lib.trivial.mod</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">mod 11 10
=&gt; 1
mod 1 10
=&gt; 1
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.trivial.mod" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L225" target="_top" shape="rect">lib/trivial.nix:225</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.compare" shape="rect"></a>5.1.4.24.&nbsp;<code class="function">lib.trivial.compare</code></h4></div></div></div><p>
       C-style comparisons
      </p><p>
       a &lt; b, compare a b =&gt; -1 a == b, compare a b =&gt; 0 a &gt; b, compare a b =&gt; 1
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">a</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">b</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.compare" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L236" target="_top" shape="rect">lib/trivial.nix:236</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.splitByAndCompare" shape="rect"></a>5.1.4.25.&nbsp;<code class="function">lib.trivial.splitByAndCompare</code></h4></div><div><h5 class="subtitle"><code class="literal">(a -&gt; bool) -&gt; (a -&gt; a -&gt; int) -&gt; (a -&gt; a -&gt; int) -&gt; (a -&gt; a -&gt; int)</code>
      </h5></div></div></div><p>
       Split type into two subtypes by predicate `p`, take all elements of the first subtype to be less than all the elements of the second subtype, compare elements of a single subtype with `yes` and `no` respectively.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">p</code>
        </span></dt><dd><p>
          Predicate
         </p></dd><dt><span class="term">
         <code class="varname">yes</code>
        </span></dt><dd><p>
          Comparison function if predicate holds for both values
         </p></dd><dt><span class="term">
         <code class="varname">no</code>
        </span></dt><dd><p>
          Comparison function if predicate holds for neither value
         </p></dd><dt><span class="term">
         <code class="varname">a</code>
        </span></dt><dd><p>
          First value to compare
         </p></dd><dt><span class="term">
         <code class="varname">b</code>
        </span></dt><dd><p>
          Second value to compare
         </p></dd></dl></div><div class="example"><a id="idm140737321264128" shape="rect"></a><p class="title"><strong>Example&nbsp;5.86.&nbsp;<code class="function">lib.trivial.splitByAndCompare</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">cmp</span></span> = splitByAndCompare (hasPrefix <span class="hljs-string"><span class="hljs-string">"foo"</span></span>) compare compare; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>

cmp <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"z"</span></span> =&gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>
cmp <span class="hljs-string"><span class="hljs-string">"fooa"</span></span> <span class="hljs-string"><span class="hljs-string">"fooz"</span></span> =&gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>

cmp <span class="hljs-string"><span class="hljs-string">"f"</span></span> <span class="hljs-string"><span class="hljs-string">"a"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>
cmp <span class="hljs-string"><span class="hljs-string">"fooa"</span></span> <span class="hljs-string"><span class="hljs-string">"a"</span></span> =&gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>
<span class="hljs-comment"><span class="hljs-comment"># while</span></span>
compare <span class="hljs-string"><span class="hljs-string">"fooa"</span></span> <span class="hljs-string"><span class="hljs-string">"a"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.trivial.splitByAndCompare" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L261" target="_top" shape="rect">lib/trivial.nix:261</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.importJSON" shape="rect"></a>5.1.4.26.&nbsp;<code class="function">lib.trivial.importJSON</code></h4></div></div></div><p>
       Reads a JSON file.
      </p><p>
       Type :: path -&gt; any
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">path</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.importJSON" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L281" target="_top" shape="rect">lib/trivial.nix:281</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.setFunctionArgs" shape="rect"></a>5.1.4.27.&nbsp;<code class="function">lib.trivial.setFunctionArgs</code></h4></div></div></div><p>
       Add metadata about expected function arguments to a function. The metadata should match the format given by builtins.functionArgs, i.e. a set from expected argument to a bool representing whether that argument has a default or not. setFunctionArgs : (a → b) → Map String Bool → (a → b)
      </p><p>
       This function is necessary because you can't dynamically create a function of the { a, b ? foo, ... }: format, but some facilities like callPackage expect to be able to query expected arguments.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">args</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.setFunctionArgs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L316" target="_top" shape="rect">lib/trivial.nix:316</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.functionArgs" shape="rect"></a>5.1.4.28.&nbsp;<code class="function">lib.trivial.functionArgs</code></h4></div></div></div><p>
       Extract the expected function arguments from a function. This works both with nix-native { a, b ? foo, ... }: style functions and functions with args set with 'setFunctionArgs'. It has the same return type and semantics as builtins.functionArgs. setFunctionArgs : (a → b) → Map String Bool.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.functionArgs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L328" target="_top" shape="rect">lib/trivial.nix:328</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.isFunction" shape="rect"></a>5.1.4.29.&nbsp;<code class="function">lib.trivial.isFunction</code></h4></div></div></div><p>
       Check whether something is a function or something annotated with function args.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.isFunction" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L333" target="_top" shape="rect">lib/trivial.nix:333</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.toHexString" shape="rect"></a>5.1.4.30.&nbsp;<code class="function">lib.trivial.toHexString</code></h4></div></div></div><p>
       Convert the given positive integer to a string of its hexadecimal representation. For example:
      </p><p>
       toHexString 0 =&gt; "0"
      </p><p>
       toHexString 16 =&gt; "10"
      </p><p>
       toHexString 250 =&gt; "FA"
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">i</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.toHexString" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L345" target="_top" shape="rect">lib/trivial.nix:345</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.toBaseDigits" shape="rect"></a>5.1.4.31.&nbsp;<code class="function">lib.trivial.toBaseDigits</code></h4></div></div></div><p>
       `toBaseDigits base i` converts the positive integer i to a list of its digits in the given base. For example:
      </p><p>
       toBaseDigits 10 123 =&gt; [ 1 2 3 ]
      </p><p>
       toBaseDigits 2 6 =&gt; [ 1 1 0 ]
      </p><p>
       toBaseDigits 16 250 =&gt; [ 15 10 ]
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">base</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">i</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.trivial.toBaseDigits" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L371" target="_top" shape="rect">lib/trivial.nix:371</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-functions-library-lists" class="title">5.1.5.&nbsp;List manipulation functions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-lists" aria-label="Anchor link for: sec functions library lists" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.singleton" shape="rect"></a>5.1.5.1.&nbsp;<code class="function">lib.lists.singleton</code></h4></div><div><h5 class="subtitle"><code class="literal">singleton :: a -&gt; [a]</code>
      </h5></div></div></div><p>
       Create a list consisting of a single element. `singleton x` is sometimes more convenient with respect to indentation than `[x]` when x spans multiple lines.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321201664" shape="rect"></a><p class="title"><strong>Example&nbsp;5.87.&nbsp;<code class="function">lib.lists.singleton</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">singleton <span class="hljs-string"><span class="hljs-string">"foo"</span></span>
=&gt; [ <span class="hljs-string"><span class="hljs-string">"foo"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.singleton" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L22" target="_top" shape="rect">lib/lists.nix:22</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.forEach" shape="rect"></a>5.1.5.2.&nbsp;<code class="function">lib.lists.forEach</code></h4></div><div><h5 class="subtitle"><code class="literal">forEach :: [a] -&gt; (a -&gt; b) -&gt; [b]</code>
      </h5></div></div></div><p>
       Apply the function to each element in the list. Same as `map`, but arguments flipped.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">xs</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321190480" shape="rect"></a><p class="title"><strong>Example&nbsp;5.88.&nbsp;<code class="function">lib.lists.forEach</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">forEach [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ] (x:
<span class="hljs-built_in"><span class="hljs-built_in">toString</span></span> x
)
=&gt; [ <span class="hljs-string"><span class="hljs-string">"1"</span></span> <span class="hljs-string"><span class="hljs-string">"2"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.forEach" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L35" target="_top" shape="rect">lib/lists.nix:35</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.foldr" shape="rect"></a>5.1.5.3.&nbsp;<code class="function">lib.lists.foldr</code></h4></div><div><h5 class="subtitle"><code class="literal">foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>
      </h5></div></div></div><p>
       “right fold” a binary function `op` between successive elements of `list` with `nul' as the starting value, i.e., `foldr op nul [x_1 x_2 ... x_n] == op x_1 (op x_2 ... (op x_n nul))`.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">op</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">nul</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321176832" shape="rect"></a><p class="title"><strong>Example&nbsp;5.89.&nbsp;<code class="function">lib.lists.foldr</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">concat</span></span> = foldr (a: b: a + b) <span class="hljs-string"><span class="hljs-string">"z"</span></span>
concat [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> ]
=&gt; <span class="hljs-string"><span class="hljs-string">"abcz"</span></span>
<span class="hljs-comment"><span class="hljs-comment"># different types</span></span>
<span class="hljs-attr"><span class="hljs-attr">strange</span></span> = foldr (int: str: <span class="hljs-built_in"><span class="hljs-built_in">toString</span></span> (int + <span class="hljs-number"><span class="hljs-number">1</span></span>) + str) <span class="hljs-string"><span class="hljs-string">"a"</span></span>
strange [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ]
=&gt; <span class="hljs-string"><span class="hljs-string">"2345a"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.foldr" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L52" target="_top" shape="rect">lib/lists.nix:52</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.fold" shape="rect"></a>5.1.5.4.&nbsp;<code class="function">lib.lists.fold</code></h4></div></div></div><p>
       `fold` is an alias of `foldr` for historic reasons
      </p><p><a id="lib.lists.fold" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L63" target="_top" shape="rect">lib/lists.nix:63</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.foldl" shape="rect"></a>5.1.5.5.&nbsp;<code class="function">lib.lists.foldl</code></h4></div><div><h5 class="subtitle"><code class="literal">foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>
      </h5></div></div></div><p>
       “left fold”, like `foldr`, but from the left: `foldl op nul [x_1 x_2 ... x_n] == op (... (op (op nul x_1) x_2) ... x_n)`.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">op</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">nul</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321159024" shape="rect"></a><p class="title"><strong>Example&nbsp;5.90.&nbsp;<code class="function">lib.lists.foldl</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">lconcat</span></span> = foldl (a: b: a + b) <span class="hljs-string"><span class="hljs-string">"z"</span></span>
lconcat [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> ]
=&gt; <span class="hljs-string"><span class="hljs-string">"zabc"</span></span>
<span class="hljs-comment"><span class="hljs-comment"># different types</span></span>
<span class="hljs-attr"><span class="hljs-attr">lstrange</span></span> = foldl (str: int: str + <span class="hljs-built_in"><span class="hljs-built_in">toString</span></span> (int + <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-string"><span class="hljs-string">"a"</span></span>
lstrange [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ]
=&gt; <span class="hljs-string"><span class="hljs-string">"a2345"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.foldl" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L80" target="_top" shape="rect">lib/lists.nix:80</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.foldl-prime" shape="rect"></a>5.1.5.6.&nbsp;<code class="function">lib.lists.foldl'</code></h4></div><div><h5 class="subtitle"><code class="literal">foldl' :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>
      </h5></div></div></div><p>
       Strict version of `foldl`.
      </p><p>
       The difference is that evaluation is forced upon access. Usually used with small whole results (in contrast with lazily-generated list or large lists where only a part is consumed.)
      </p><p><a id="lib.lists.foldl-prime" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L96" target="_top" shape="rect">lib/lists.nix:96</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.imap0" shape="rect"></a>5.1.5.7.&nbsp;<code class="function">lib.lists.imap0</code></h4></div><div><h5 class="subtitle"><code class="literal">imap0 :: (int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]</code>
      </h5></div></div></div><p>
       Map with index starting from 0
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321141936" shape="rect"></a><p class="title"><strong>Example&nbsp;5.91.&nbsp;<code class="function">lib.lists.imap0</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">imap0 (i: v: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${v}</span></span></span><span class="hljs-string">-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">toString</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> i}</span></span></span><span class="hljs-string">"</span></span>) [<span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span>]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"a-0"</span></span> <span class="hljs-string"><span class="hljs-string">"b-1"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.imap0" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L106" target="_top" shape="rect">lib/lists.nix:106</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.imap1" shape="rect"></a>5.1.5.8.&nbsp;<code class="function">lib.lists.imap1</code></h4></div><div><h5 class="subtitle"><code class="literal">imap1 :: (int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]</code>
      </h5></div></div></div><p>
       Map with index starting from 1
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321130608" shape="rect"></a><p class="title"><strong>Example&nbsp;5.92.&nbsp;<code class="function">lib.lists.imap1</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">imap1 (i: v: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${v}</span></span></span><span class="hljs-string">-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">toString</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> i}</span></span></span><span class="hljs-string">"</span></span>) [<span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span>]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"a-1"</span></span> <span class="hljs-string"><span class="hljs-string">"b-2"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.imap1" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L116" target="_top" shape="rect">lib/lists.nix:116</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.concatMap" shape="rect"></a>5.1.5.9.&nbsp;<code class="function">lib.lists.concatMap</code></h4></div><div><h5 class="subtitle"><code class="literal">concatMap :: (a -&gt; [b]) -&gt; [a] -&gt; [b]</code>
      </h5></div></div></div><p>
       Map and concatenate the result.
      </p><div class="example"><a id="idm140737321123888" shape="rect"></a><p class="title"><strong>Example&nbsp;5.93.&nbsp;<code class="function">lib.lists.concatMap</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">concatMap (x: [x] ++ [<span class="hljs-string"><span class="hljs-string">"z"</span></span>]) [<span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span>]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"z"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"z"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.concatMap" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L126" target="_top" shape="rect">lib/lists.nix:126</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.flatten" shape="rect"></a>5.1.5.10.&nbsp;<code class="function">lib.lists.flatten</code></h4></div></div></div><p>
       Flatten the argument into a single list; that is, nested lists are spliced into the top-level lists.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321115328" shape="rect"></a><p class="title"><strong>Example&nbsp;5.94.&nbsp;<code class="function">lib.lists.flatten</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">flatten [1 [2 [3] 4] 5]
=&gt; [1 2 3 4 5]
flatten 1
=&gt; [1]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.flatten" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L137" target="_top" shape="rect">lib/lists.nix:137</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.remove" shape="rect"></a>5.1.5.11.&nbsp;<code class="function">lib.lists.remove</code></h4></div><div><h5 class="subtitle"><code class="literal">remove :: a -&gt; [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Remove elements equal to 'e' from a list. Useful for buildInputs.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">e</code>
        </span></dt><dd><p>
          Element to remove from the list
         </p></dd></dl></div><div class="example"><a id="idm140737321106144" shape="rect"></a><p class="title"><strong>Example&nbsp;5.95.&nbsp;<code class="function">lib.lists.remove</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">remove 3 [ 1 3 4 3 ]
=&gt; [ 1 4 ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.remove" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L150" target="_top" shape="rect">lib/lists.nix:150</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.findSingle" shape="rect"></a>5.1.5.12.&nbsp;<code class="function">lib.lists.findSingle</code></h4></div><div><h5 class="subtitle"><code class="literal">findSingle :: (a -&gt; bool) -&gt; a -&gt; a -&gt; [a] -&gt; a</code>
      </h5></div></div></div><p>
       Find the sole element in the list matching the specified predicate, returns `default` if no such element exists, or `multiple` if there are multiple matching elements.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          Predicate
         </p></dd><dt><span class="term">
         <code class="varname">default</code>
        </span></dt><dd><p>
          Default value to return if element was not found.
         </p></dd><dt><span class="term">
         <code class="varname">multiple</code>
        </span></dt><dd><p>
          Default value to return if more than one element was found
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Input list
         </p></dd></dl></div><div class="example"><a id="idm140737321090736" shape="rect"></a><p class="title"><strong>Example&nbsp;5.96.&nbsp;<code class="function">lib.lists.findSingle</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">findSingle (x: <span class="hljs-attr"><span class="hljs-attr">x</span></span> == <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"none"</span></span> <span class="hljs-string"><span class="hljs-string">"multiple"</span></span> [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]
=&gt; <span class="hljs-string"><span class="hljs-string">"multiple"</span></span>
findSingle (x: <span class="hljs-attr"><span class="hljs-attr">x</span></span> == <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"none"</span></span> <span class="hljs-string"><span class="hljs-string">"multiple"</span></span> [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]
=&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>
findSingle (x: <span class="hljs-attr"><span class="hljs-attr">x</span></span> == <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"none"</span></span> <span class="hljs-string"><span class="hljs-string">"multiple"</span></span> [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> ]
=&gt; <span class="hljs-string"><span class="hljs-string">"none"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.findSingle" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L168" target="_top" shape="rect">lib/lists.nix:168</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.findFirst" shape="rect"></a>5.1.5.13.&nbsp;<code class="function">lib.lists.findFirst</code></h4></div><div><h5 class="subtitle"><code class="literal">findFirst :: (a -&gt; bool) -&gt; a -&gt; [a] -&gt; a</code>
      </h5></div></div></div><p>
       Find the first element in the list matching the specified predicate or return `default` if no such element exists.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          Predicate
         </p></dd><dt><span class="term">
         <code class="varname">default</code>
        </span></dt><dd><p>
          Default value to return
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Input list
         </p></dd></dl></div><div class="example"><a id="idm140737321077056" shape="rect"></a><p class="title"><strong>Example&nbsp;5.97.&nbsp;<code class="function">lib.lists.findFirst</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">findFirst (x: x &gt; 3) 7 [ 1 6 4 ]
=&gt; 6
findFirst (x: x &gt; 9) 7 [ 1 6 4 ]
=&gt; 7
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.findFirst" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L193" target="_top" shape="rect">lib/lists.nix:193</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.any" shape="rect"></a>5.1.5.14.&nbsp;<code class="function">lib.lists.any</code></h4></div><div><h5 class="subtitle"><code class="literal">any :: (a -&gt; bool) -&gt; [a] -&gt; bool</code>
      </h5></div></div></div><p>
       Return true if function `pred` returns true for at least one element of `list`.
      </p><div class="example"><a id="idm140737321070240" shape="rect"></a><p class="title"><strong>Example&nbsp;5.98.&nbsp;<code class="function">lib.lists.any</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">any isString [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">"a"</span></span> { } ]
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
any isString [ <span class="hljs-number"><span class="hljs-number">1</span></span> { } ]
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.any" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L214" target="_top" shape="rect">lib/lists.nix:214</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.all" shape="rect"></a>5.1.5.15.&nbsp;<code class="function">lib.lists.all</code></h4></div><div><h5 class="subtitle"><code class="literal">all :: (a -&gt; bool) -&gt; [a] -&gt; bool</code>
      </h5></div></div></div><p>
       Return true if function `pred` returns true for all elements of `list`.
      </p><div class="example"><a id="idm140737321063456" shape="rect"></a><p class="title"><strong>Example&nbsp;5.99.&nbsp;<code class="function">lib.lists.all</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">all (x: x &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ]
=&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
all (x: x &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]
=&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.all" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L227" target="_top" shape="rect">lib/lists.nix:227</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.count" shape="rect"></a>5.1.5.16.&nbsp;<code class="function">lib.lists.count</code></h4></div><div><h5 class="subtitle"><code class="literal">count :: (a -&gt; bool) -&gt; [a] -&gt; int</code>
      </h5></div></div></div><p>
       Count how many elements of `list` match the supplied predicate function.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          Predicate
         </p></dd></dl></div><div class="example"><a id="idm140737321054160" shape="rect"></a><p class="title"><strong>Example&nbsp;5.100.&nbsp;<code class="function">lib.lists.count</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">count (x: <span class="hljs-attr"><span class="hljs-attr">x</span></span> == <span class="hljs-number"><span class="hljs-number">3</span></span>) [ <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ]
=&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.count" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L238" target="_top" shape="rect">lib/lists.nix:238</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.optional" shape="rect"></a>5.1.5.17.&nbsp;<code class="function">lib.lists.optional</code></h4></div><div><h5 class="subtitle"><code class="literal">optional :: bool -&gt; a -&gt; [a]</code>
      </h5></div></div></div><p>
       Return a singleton list or an empty list, depending on a boolean value. Useful when building lists with optional elements (e.g. `++ optional (system == "i686-linux") flashplayer').
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">cond</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">elem</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321042976" shape="rect"></a><p class="title"><strong>Example&nbsp;5.101.&nbsp;<code class="function">lib.lists.optional</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">optional <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"foo"</span></span>
=&gt; [ <span class="hljs-string"><span class="hljs-string">"foo"</span></span> ]
optional <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-string"><span class="hljs-string">"foo"</span></span>
=&gt; [ ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.optional" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L254" target="_top" shape="rect">lib/lists.nix:254</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.optionals" shape="rect"></a>5.1.5.18.&nbsp;<code class="function">lib.lists.optionals</code></h4></div><div><h5 class="subtitle"><code class="literal">optionals :: bool -&gt; [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Return a list or an empty list, depending on a boolean value.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">cond</code>
        </span></dt><dd><p>
          Condition
         </p></dd><dt><span class="term">
         <code class="varname">elems</code>
        </span></dt><dd><p>
          List to return if condition is true
         </p></dd></dl></div><div class="example"><a id="idm140737321031616" shape="rect"></a><p class="title"><strong>Example&nbsp;5.102.&nbsp;<code class="function">lib.lists.optionals</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">optionals <span class="hljs-literal"><span class="hljs-literal">true</span></span> [ <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]
=&gt; [ <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]
optionals <span class="hljs-literal"><span class="hljs-literal">false</span></span> [ <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]
=&gt; [ ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.optionals" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L266" target="_top" shape="rect">lib/lists.nix:266</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.toList" shape="rect"></a>5.1.5.19.&nbsp;<code class="function">lib.lists.toList</code></h4></div></div></div><p>
       If argument is a list, return it; else, wrap it in a singleton list. If you're using this, you should almost certainly reconsider if there isn't a more "well-typed" approach.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737321023344" shape="rect"></a><p class="title"><strong>Example&nbsp;5.103.&nbsp;<code class="function">lib.lists.toList</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">toList [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ]
=&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ]
toList <span class="hljs-string"><span class="hljs-string">"hi"</span></span>
=&gt; [ <span class="hljs-string"><span class="hljs-string">"hi "</span></span>]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.toList" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L283" target="_top" shape="rect">lib/lists.nix:283</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.range" shape="rect"></a>5.1.5.20.&nbsp;<code class="function">lib.lists.range</code></h4></div><div><h5 class="subtitle"><code class="literal">range :: int -&gt; int -&gt; [int]</code>
      </h5></div></div></div><p>
       Return a list of integers from `first' up to and including `last'.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">first</code>
        </span></dt><dd><p>
          First integer in the range
         </p></dd><dt><span class="term">
         <code class="varname">last</code>
        </span></dt><dd><p>
          Last integer in the range
         </p></dd></dl></div><div class="example"><a id="idm140737321012128" shape="rect"></a><p class="title"><strong>Example&nbsp;5.104.&nbsp;<code class="function">lib.lists.range</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">range 2 4
=&gt; [ 2 3 4 ]
range 3 2
=&gt; [ ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.range" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L295" target="_top" shape="rect">lib/lists.nix:295</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.partition" shape="rect"></a>5.1.5.21.&nbsp;<code class="function">lib.lists.partition</code></h4></div><div><h5 class="subtitle"><code class="literal">(a -&gt; bool) -&gt; [a] -&gt; { right :: [a], wrong :: [a] }</code>
      </h5></div></div></div><p>
       Splits the elements of a list in two lists, `right` and `wrong`, depending on the evaluation of a predicate.
      </p><div class="example"><a id="idm140737321005184" shape="rect"></a><p class="title"><strong>Example&nbsp;5.105.&nbsp;<code class="function">lib.lists.partition</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">partition (x: x &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) [ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ]
=&gt; { <span class="hljs-attr"><span class="hljs-attr">right</span></span> = [ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ]; <span class="hljs-attr"><span class="hljs-attr">wrong</span></span> = [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ]; }
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.partition" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L314" target="_top" shape="rect">lib/lists.nix:314</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.groupBy-prime" shape="rect"></a>5.1.5.22.&nbsp;<code class="function">lib.lists.groupBy'</code></h4></div></div></div><p>
       Splits the elements of a list into many lists, using the return value of a predicate. Predicate should return a string which becomes keys of attrset `groupBy' returns.
      </p><p>
       `groupBy'` allows to customise the combining function and initial value
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">op</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">nul</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">lst</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320990048" shape="rect"></a><p class="title"><strong>Example&nbsp;5.106.&nbsp;<code class="function">lib.lists.groupBy'</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">groupBy (x: boolToString (x &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>)) [ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ]
=&gt; { <span class="hljs-attr"><span class="hljs-attr">true</span></span> = [ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ]; <span class="hljs-attr"><span class="hljs-attr">false</span></span> = [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ]; }
groupBy (x: x.name) [ {<span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"icewm"</span></span>; <span class="hljs-attr"><span class="hljs-attr">script</span></span> = <span class="hljs-string"><span class="hljs-string">"icewm &amp;"</span></span>;}
{<span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"xfce"</span></span>;  <span class="hljs-attr"><span class="hljs-attr">script</span></span> = <span class="hljs-string"><span class="hljs-string">"xfce4-session &amp;"</span></span>;}
{<span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"icewm"</span></span>; <span class="hljs-attr"><span class="hljs-attr">script</span></span> = <span class="hljs-string"><span class="hljs-string">"icewmbg &amp;"</span></span>;}
{<span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"mate"</span></span>;  <span class="hljs-attr"><span class="hljs-attr">script</span></span> = <span class="hljs-string"><span class="hljs-string">"gnome-session &amp;"</span></span>;}
]
=&gt; { <span class="hljs-attr"><span class="hljs-attr">icewm</span></span> = [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"icewm"</span></span>; <span class="hljs-attr"><span class="hljs-attr">script</span></span> = <span class="hljs-string"><span class="hljs-string">"icewm &amp;"</span></span>; }
{ <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"icewm"</span></span>; <span class="hljs-attr"><span class="hljs-attr">script</span></span> = <span class="hljs-string"><span class="hljs-string">"icewmbg &amp;"</span></span>; } ];
<span class="hljs-attr"><span class="hljs-attr">mate</span></span>  = [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"mate"</span></span>;  <span class="hljs-attr"><span class="hljs-attr">script</span></span> = <span class="hljs-string"><span class="hljs-string">"gnome-session &amp;"</span></span>; } ];
<span class="hljs-attr"><span class="hljs-attr">xfce</span></span>  = [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"xfce"</span></span>;  <span class="hljs-attr"><span class="hljs-attr">script</span></span> = <span class="hljs-string"><span class="hljs-string">"xfce4-session &amp;"</span></span>; } ];
}

groupBy' <span class="hljs-built_in"><span class="hljs-built_in">builtins</span></span>.add <span class="hljs-number"><span class="hljs-number">0</span></span> (x: boolToString (x &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>)) [ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ]
=&gt; { <span class="hljs-attr"><span class="hljs-attr">true</span></span> = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-attr"><span class="hljs-attr">false</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; }
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.groupBy-prime" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L343" target="_top" shape="rect">lib/lists.nix:343</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.zipListsWith" shape="rect"></a>5.1.5.23.&nbsp;<code class="function">lib.lists.zipListsWith</code></h4></div><div><h5 class="subtitle"><code class="literal">zipListsWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]</code>
      </h5></div></div></div><p>
       Merges two lists of the same size together. If the sizes aren't the same the merging stops at the shortest. How both lists are merged is defined by the first argument.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function to zip elements of both lists
         </p></dd><dt><span class="term">
         <code class="varname">fst</code>
        </span></dt><dd><p>
          First list
         </p></dd><dt><span class="term">
         <code class="varname">snd</code>
        </span></dt><dd><p>
          Second list
         </p></dd></dl></div><div class="example"><a id="idm140737320975184" shape="rect"></a><p class="title"><strong>Example&nbsp;5.107.&nbsp;<code class="function">lib.lists.zipListsWith</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">zipListsWith (a: b: a + b) [<span class="hljs-string"><span class="hljs-string">"h"</span></span> <span class="hljs-string"><span class="hljs-string">"l"</span></span>] [<span class="hljs-string"><span class="hljs-string">"e"</span></span> <span class="hljs-string"><span class="hljs-string">"o"</span></span>]
=&gt; [<span class="hljs-string"><span class="hljs-string">"he"</span></span> <span class="hljs-string"><span class="hljs-string">"lo"</span></span>]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.zipListsWith" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L363" target="_top" shape="rect">lib/lists.nix:363</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.zipLists" shape="rect"></a>5.1.5.24.&nbsp;<code class="function">lib.lists.zipLists</code></h4></div><div><h5 class="subtitle"><code class="literal">zipLists :: [a] -&gt; [b] -&gt; [{ fst :: a, snd :: b}]</code>
      </h5></div></div></div><p>
       Merges two lists of the same size together. If the sizes aren't the same the merging stops at the shortest.
      </p><div class="example"><a id="idm140737320968224" shape="rect"></a><p class="title"><strong>Example&nbsp;5.108.&nbsp;<code class="function">lib.lists.zipLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">zipLists [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ] [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ]
=&gt; [ { <span class="hljs-attr"><span class="hljs-attr">fst</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attr"><span class="hljs-attr">snd</span></span> = <span class="hljs-string"><span class="hljs-string">"a"</span></span>; } { <span class="hljs-attr"><span class="hljs-attr">fst</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attr"><span class="hljs-attr">snd</span></span> = <span class="hljs-string"><span class="hljs-string">"b"</span></span>; } ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.zipLists" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L382" target="_top" shape="rect">lib/lists.nix:382</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.reverseList" shape="rect"></a>5.1.5.25.&nbsp;<code class="function">lib.lists.reverseList</code></h4></div><div><h5 class="subtitle"><code class="literal">reverseList :: [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Reverse the order of the elements of a list.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">xs</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320958992" shape="rect"></a><p class="title"><strong>Example&nbsp;5.109.&nbsp;<code class="function">lib.lists.reverseList</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">
reverseList [ <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"o"</span></span> <span class="hljs-string"><span class="hljs-string">"j"</span></span> ]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"j"</span></span> <span class="hljs-string"><span class="hljs-string">"o"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.reverseList" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L393" target="_top" shape="rect">lib/lists.nix:393</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.listDfs" shape="rect"></a>5.1.5.26.&nbsp;<code class="function">lib.lists.listDfs</code></h4></div></div></div><p>
       Depth-First Search (DFS) for lists `list != []`.
      </p><p>
       `before a b == true` means that `b` depends on `a` (there's an edge from `b` to `a`).
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">stopOnCycles</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">before</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320945904" shape="rect"></a><p class="title"><strong>Example&nbsp;5.110.&nbsp;<code class="function">lib.lists.listDfs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">listDfs <span class="hljs-literal"><span class="hljs-literal">true</span></span> hasPrefix [ <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> <span class="hljs-string"><span class="hljs-string">"other"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/home"</span></span> ]
== { <span class="hljs-attr"><span class="hljs-attr">minimal</span></span> = <span class="hljs-string"><span class="hljs-string">"/"</span></span>;                  <span class="hljs-comment"><span class="hljs-comment"># minimal element</span></span>
<span class="hljs-attr"><span class="hljs-attr">visited</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> ];     <span class="hljs-comment"><span class="hljs-comment"># seen elements (in reverse order)</span></span>
<span class="hljs-attr"><span class="hljs-attr">rest</span></span>    = [ <span class="hljs-string"><span class="hljs-string">"/home"</span></span> <span class="hljs-string"><span class="hljs-string">"other"</span></span> ];  <span class="hljs-comment"><span class="hljs-comment"># everything else</span></span>
}

listDfs <span class="hljs-literal"><span class="hljs-literal">true</span></span> hasPrefix [ <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> <span class="hljs-string"><span class="hljs-string">"other"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/home"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> ]
== { <span class="hljs-attr"><span class="hljs-attr">cycle</span></span>   = <span class="hljs-string"><span class="hljs-string">"/"</span></span>;                  <span class="hljs-comment"><span class="hljs-comment"># cycle encountered at this element</span></span>
<span class="hljs-attr"><span class="hljs-attr">loops</span></span>   = [ <span class="hljs-string"><span class="hljs-string">"/"</span></span> ];              <span class="hljs-comment"><span class="hljs-comment"># and continues to these elements</span></span>
<span class="hljs-attr"><span class="hljs-attr">visited</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> ]; <span class="hljs-comment"><span class="hljs-comment"># elements leading to the cycle (in reverse order)</span></span>
<span class="hljs-attr"><span class="hljs-attr">rest</span></span>    = [ <span class="hljs-string"><span class="hljs-string">"/home"</span></span> <span class="hljs-string"><span class="hljs-string">"other"</span></span> ];  <span class="hljs-comment"><span class="hljs-comment"># everything else</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.listDfs" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L415" target="_top" shape="rect">lib/lists.nix:415</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.toposort" shape="rect"></a>5.1.5.27.&nbsp;<code class="function">lib.lists.toposort</code></h4></div></div></div><p>
       Sort a list based on a partial ordering using DFS. This implementation is O(N^2), if your ordering is linear, use `sort` instead.
      </p><p>
       `before a b == true` means that `b` should be after `a` in the result.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">before</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320933456" shape="rect"></a><p class="title"><strong>Example&nbsp;5.111.&nbsp;<code class="function">lib.lists.toposort</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">
toposort hasPrefix [ <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> <span class="hljs-string"><span class="hljs-string">"other"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/home"</span></span> ]
== { <span class="hljs-attr"><span class="hljs-attr">result</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/home"</span></span> <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> <span class="hljs-string"><span class="hljs-string">"other"</span></span> ]; }

toposort hasPrefix [ <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> <span class="hljs-string"><span class="hljs-string">"other"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/home"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> ]
== { <span class="hljs-attr"><span class="hljs-attr">cycle</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> ]; <span class="hljs-comment"><span class="hljs-comment"># path leading to a cycle</span></span>
<span class="hljs-attr"><span class="hljs-attr">loops</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/"</span></span> ]; }                <span class="hljs-comment"><span class="hljs-comment"># loops back to these elements</span></span>

toposort hasPrefix [ <span class="hljs-string"><span class="hljs-string">"other"</span></span> <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> <span class="hljs-string"><span class="hljs-string">"/home"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> ]
== { <span class="hljs-attr"><span class="hljs-attr">result</span></span> = [ <span class="hljs-string"><span class="hljs-string">"other"</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-string"><span class="hljs-string">"/home"</span></span> <span class="hljs-string"><span class="hljs-string">"/home/user"</span></span> ]; }

toposort (a: b: a &lt; b) [ <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ] == { <span class="hljs-attr"><span class="hljs-attr">result</span></span> = [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ]; }
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.toposort" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L454" target="_top" shape="rect">lib/lists.nix:454</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.sort" shape="rect"></a>5.1.5.28.&nbsp;<code class="function">lib.lists.sort</code></h4></div></div></div><p>
       Sort a list based on a comparator function which compares two elements and returns true if the first argument is strictly below the second argument. The returned list is sorted in an increasing order. The implementation does a quick-sort.
      </p><div class="example"><a id="idm140737320926640" shape="rect"></a><p class="title"><strong>Example&nbsp;5.112.&nbsp;<code class="function">lib.lists.sort</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">sort (a: b: a &lt; b) [ 5 3 7 ]
=&gt; [ 3 5 7 ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.sort" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L482" target="_top" shape="rect">lib/lists.nix:482</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.compareLists" shape="rect"></a>5.1.5.29.&nbsp;<code class="function">lib.lists.compareLists</code></h4></div></div></div><p>
       Compare two lists element-by-element.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">cmp</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">a</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">b</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320914224" shape="rect"></a><p class="title"><strong>Example&nbsp;5.113.&nbsp;<code class="function">lib.lists.compareLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">compareLists compare [] []
=&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>
compareLists compare [] [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> ]
=&gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>
compareLists compare [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> ] []
=&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>
compareLists compare [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ] [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> ]
=&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.compareLists" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L511" target="_top" shape="rect">lib/lists.nix:511</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.naturalSort" shape="rect"></a>5.1.5.30.&nbsp;<code class="function">lib.lists.naturalSort</code></h4></div></div></div><p>
       Sort list using "Natural sorting". Numeric portions of strings are sorted in numeric order.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">lst</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320905408" shape="rect"></a><p class="title"><strong>Example&nbsp;5.114.&nbsp;<code class="function">lib.lists.naturalSort</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">naturalSort [<span class="hljs-string"><span class="hljs-string">"disk11"</span></span> <span class="hljs-string"><span class="hljs-string">"disk8"</span></span> <span class="hljs-string"><span class="hljs-string">"disk100"</span></span> <span class="hljs-string"><span class="hljs-string">"disk9"</span></span>]
=&gt; [<span class="hljs-string"><span class="hljs-string">"disk8"</span></span> <span class="hljs-string"><span class="hljs-string">"disk9"</span></span> <span class="hljs-string"><span class="hljs-string">"disk11"</span></span> <span class="hljs-string"><span class="hljs-string">"disk100"</span></span>]
naturalSort [<span class="hljs-string"><span class="hljs-string">"10.46.133.149"</span></span> <span class="hljs-string"><span class="hljs-string">"10.5.16.62"</span></span> <span class="hljs-string"><span class="hljs-string">"10.54.16.25"</span></span>]
=&gt; [<span class="hljs-string"><span class="hljs-string">"10.5.16.62"</span></span> <span class="hljs-string"><span class="hljs-string">"10.46.133.149"</span></span> <span class="hljs-string"><span class="hljs-string">"10.54.16.25"</span></span>]
naturalSort [<span class="hljs-string"><span class="hljs-string">"v0.2"</span></span> <span class="hljs-string"><span class="hljs-string">"v0.15"</span></span> <span class="hljs-string"><span class="hljs-string">"v0.0.9"</span></span>]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"v0.0.9"</span></span> <span class="hljs-string"><span class="hljs-string">"v0.2"</span></span> <span class="hljs-string"><span class="hljs-string">"v0.15"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.naturalSort" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L534" target="_top" shape="rect">lib/lists.nix:534</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.take" shape="rect"></a>5.1.5.31.&nbsp;<code class="function">lib.lists.take</code></h4></div><div><h5 class="subtitle"><code class="literal">take :: int -&gt; [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Return the first (at most) N elements of a list.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">count</code>
        </span></dt><dd><p>
          Number of elements to take
         </p></dd></dl></div><div class="example"><a id="idm140737320895904" shape="rect"></a><p class="title"><strong>Example&nbsp;5.115.&nbsp;<code class="function">lib.lists.take</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">take <span class="hljs-number"><span class="hljs-number">2</span></span> [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> <span class="hljs-string"><span class="hljs-string">"d"</span></span> ]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> ]
take <span class="hljs-number"><span class="hljs-number">2</span></span> [ ]
=&gt; [ ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.take" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L552" target="_top" shape="rect">lib/lists.nix:552</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.drop" shape="rect"></a>5.1.5.32.&nbsp;<code class="function">lib.lists.drop</code></h4></div><div><h5 class="subtitle"><code class="literal">drop :: int -&gt; [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Remove the first (at most) N elements of a list.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">count</code>
        </span></dt><dd><p>
          Number of elements to drop
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Input list
         </p></dd></dl></div><div class="example"><a id="idm140737320884656" shape="rect"></a><p class="title"><strong>Example&nbsp;5.116.&nbsp;<code class="function">lib.lists.drop</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">drop <span class="hljs-number"><span class="hljs-number">2</span></span> [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> <span class="hljs-string"><span class="hljs-string">"d"</span></span> ]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"c"</span></span> <span class="hljs-string"><span class="hljs-string">"d"</span></span> ]
drop <span class="hljs-number"><span class="hljs-number">2</span></span> [ ]
=&gt; [ ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.drop" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L566" target="_top" shape="rect">lib/lists.nix:566</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.sublist" shape="rect"></a>5.1.5.33.&nbsp;<code class="function">lib.lists.sublist</code></h4></div><div><h5 class="subtitle"><code class="literal">sublist :: int -&gt; int -&gt; [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Return a list consisting of at most `count` elements of `list`, starting at index `start`.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">start</code>
        </span></dt><dd><p>
          Index at which to start the sublist
         </p></dd><dt><span class="term">
         <code class="varname">count</code>
        </span></dt><dd><p>
          Number of elements to take
         </p></dd><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Input list
         </p></dd></dl></div><div class="example"><a id="idm140737320871264" shape="rect"></a><p class="title"><strong>Example&nbsp;5.117.&nbsp;<code class="function">lib.lists.sublist</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">sublist <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> [ <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> <span class="hljs-string"><span class="hljs-string">"d"</span></span> <span class="hljs-string"><span class="hljs-string">"e"</span></span> ]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-string"><span class="hljs-string">"c"</span></span> <span class="hljs-string"><span class="hljs-string">"d"</span></span> ]
sublist <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> [ ]
=&gt; [ ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.sublist" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L583" target="_top" shape="rect">lib/lists.nix:583</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.last" shape="rect"></a>5.1.5.34.&nbsp;<code class="function">lib.lists.last</code></h4></div><div><h5 class="subtitle"><code class="literal">last :: [a] -&gt; a</code>
      </h5></div></div></div><p>
       Return the last element of a list.
      </p><p>
       This function throws an error if the list is empty.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320861344" shape="rect"></a><p class="title"><strong>Example&nbsp;5.118.&nbsp;<code class="function">lib.lists.last</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">last [ 1 2 3 ]
=&gt; 3
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.last" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L607" target="_top" shape="rect">lib/lists.nix:607</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.init" shape="rect"></a>5.1.5.35.&nbsp;<code class="function">lib.lists.init</code></h4></div><div><h5 class="subtitle"><code class="literal">init :: [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Return all elements but the last.
      </p><p>
       This function throws an error if the list is empty.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">list</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320851600" shape="rect"></a><p class="title"><strong>Example&nbsp;5.119.&nbsp;<code class="function">lib.lists.init</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">init [ 1 2 3 ]
=&gt; [ 1 2 ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.init" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L621" target="_top" shape="rect">lib/lists.nix:621</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.crossLists" shape="rect"></a>5.1.5.36.&nbsp;<code class="function">lib.lists.crossLists</code></h4></div></div></div><p>
       Return the image of the cross product of some lists by a function.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320843152" shape="rect"></a><p class="title"><strong>Example&nbsp;5.120.&nbsp;<code class="function">lib.lists.crossLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">crossLists (x:y: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">toString</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> x}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">toString</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> y}</span></span></span><span class="hljs-string">"</span></span>) [[<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>] [<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>]]
=&gt; [ <span class="hljs-string"><span class="hljs-string">"13"</span></span> <span class="hljs-string"><span class="hljs-string">"14"</span></span> <span class="hljs-string"><span class="hljs-string">"23"</span></span> <span class="hljs-string"><span class="hljs-string">"24"</span></span> ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.crossLists" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L632" target="_top" shape="rect">lib/lists.nix:632</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.unique" shape="rect"></a>5.1.5.37.&nbsp;<code class="function">lib.lists.unique</code></h4></div><div><h5 class="subtitle"><code class="literal">unique :: [a] -&gt; [a]</code>
      </h5></div></div></div><p>
       Remove duplicate elements from the list. O(n^2) complexity.
      </p><div class="example"><a id="idm140737320836256" shape="rect"></a><p class="title"><strong>Example&nbsp;5.121.&nbsp;<code class="function">lib.lists.unique</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">unique [ 3 2 3 4 ]
=&gt; [ 3 2 4 ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.unique" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L643" target="_top" shape="rect">lib/lists.nix:643</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.intersectLists" shape="rect"></a>5.1.5.38.&nbsp;<code class="function">lib.lists.intersectLists</code></h4></div></div></div><p>
       Intersects list 'e' and another list. O(nm) complexity.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">e</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320827776" shape="rect"></a><p class="title"><strong>Example&nbsp;5.122.&nbsp;<code class="function">lib.lists.intersectLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">intersectLists [ 1 2 3 ] [ 6 3 2 ]
=&gt; [ 3 2 ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.intersectLists" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L651" target="_top" shape="rect">lib/lists.nix:651</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.subtractLists" shape="rect"></a>5.1.5.39.&nbsp;<code class="function">lib.lists.subtractLists</code></h4></div></div></div><p>
       Subtracts list 'e' from another list. O(nm) complexity.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">e</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320819200" shape="rect"></a><p class="title"><strong>Example&nbsp;5.123.&nbsp;<code class="function">lib.lists.subtractLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs" xml:space="preserve">subtractLists [ 3 2 ] [ 1 2 3 4 5 3 ]
=&gt; [ 1 4 5 ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.lists.subtractLists" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L659" target="_top" shape="rect">lib/lists.nix:659</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.mutuallyExclusive" shape="rect"></a>5.1.5.40.&nbsp;<code class="function">lib.lists.mutuallyExclusive</code></h4></div></div></div><p>
       Test if two lists have no common element. It should be slightly more efficient than (intersectLists a b == [])
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">a</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">b</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.lists.mutuallyExclusive" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L664" target="_top" shape="rect">lib/lists.nix:664</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-functions-library-debug" class="title">5.1.6.&nbsp;Debugging functions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-debug" aria-label="Anchor link for: sec functions library debug" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceIf" shape="rect"></a>5.1.6.1.&nbsp;<code class="function">lib.debug.traceIf</code></h4></div><div><h5 class="subtitle"><code class="literal">traceIf :: bool -&gt; string -&gt; a -&gt; a</code>
      </h5></div></div></div><p>
       Conditionally trace the supplied message, based on a predicate.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pred</code>
        </span></dt><dd><p>
          Predicate to check
         </p></dd><dt><span class="term">
         <code class="varname">msg</code>
        </span></dt><dd><p>
          Message that should be traced
         </p></dd><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Value to return
         </p></dd></dl></div><div class="example"><a id="idm140737320794320" shape="rect"></a><p class="title"><strong>Example&nbsp;5.124.&nbsp;<code class="function">lib.debug.traceIf</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">traceIf <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>
trace: <span class="hljs-attr"><span class="hljs-attr">hello</span></span>
=&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.debug.traceIf" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L35" target="_top" shape="rect">lib/debug.nix:35</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValFn" shape="rect"></a>5.1.6.2.&nbsp;<code class="function">lib.debug.traceValFn</code></h4></div><div><h5 class="subtitle"><code class="literal">traceValFn :: (a -&gt; b) -&gt; a -&gt; a</code>
      </h5></div></div></div><p>
       Trace the supplied value after applying a function to it, and return the original value.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function to apply
         </p></dd><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Value to trace and return
         </p></dd></dl></div><div class="example"><a id="idm140737320783056" shape="rect"></a><p class="title"><strong>Example&nbsp;5.125.&nbsp;<code class="function">lib.debug.traceValFn</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">traceValFn (v: <span class="hljs-string"><span class="hljs-string">"mystring </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${v}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span>
trace: mystring <span class="hljs-attr"><span class="hljs-attr">foo</span></span>
=&gt; <span class="hljs-string"><span class="hljs-string">"foo"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.debug.traceValFn" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L53" target="_top" shape="rect">lib/debug.nix:53</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceVal" shape="rect"></a>5.1.6.3.&nbsp;<code class="function">lib.debug.traceVal</code></h4></div><div><h5 class="subtitle"><code class="literal">traceVal :: a -&gt; a</code>
      </h5></div></div></div><p>
       Trace the supplied value and return it.
      </p><div class="example"><a id="idm140737320776320" shape="rect"></a><p class="title"><strong>Example&nbsp;5.126.&nbsp;<code class="function">lib.debug.traceVal</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">traceVal <span class="hljs-number"><span class="hljs-number">42</span></span>
<span class="hljs-comment"><span class="hljs-comment"># trace: 42</span></span>
=&gt; <span class="hljs-number"><span class="hljs-number">42</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.debug.traceVal" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L68" target="_top" shape="rect">lib/debug.nix:68</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceSeq" shape="rect"></a>5.1.6.4.&nbsp;<code class="function">lib.debug.traceSeq</code></h4></div><div><h5 class="subtitle"><code class="literal">traceSeq :: a -&gt; b -&gt; b</code>
      </h5></div></div></div><p>
       `builtins.trace`, but the value is `builtins.deepSeq`ed first.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          The value to trace
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          The value to return
         </p></dd></dl></div><div class="example"><a id="idm140737320765088" shape="rect"></a><p class="title"><strong>Example&nbsp;5.127.&nbsp;<code class="function">lib.debug.traceSeq</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">trace { a.b.<span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-literal"><span class="hljs-literal">null</span></span>
trace: { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = &lt;CODE&gt;; }
=&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span>
traceSeq { a.b.<span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-literal"><span class="hljs-literal">null</span></span>
trace: { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = { <span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; }; }; }
=&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.debug.traceSeq" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L82" target="_top" shape="rect">lib/debug.nix:82</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceSeqN" shape="rect"></a>5.1.6.5.&nbsp;<code class="function">lib.debug.traceSeqN</code></h4></div></div></div><p>
       Like `traceSeq`, but only evaluate down to depth n. This is very useful because lots of `traceSeq` usages lead to an infinite recursion.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">depth</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">y</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320752416" shape="rect"></a><p class="title"><strong>Example&nbsp;5.128.&nbsp;<code class="function">lib.debug.traceSeqN</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">traceSeqN <span class="hljs-number"><span class="hljs-number">2</span></span> { a.b.<span class="hljs-attr"><span class="hljs-attr">c</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-literal"><span class="hljs-literal">null</span></span>
trace: { <span class="hljs-attr"><span class="hljs-attr">a</span></span> = { <span class="hljs-attr"><span class="hljs-attr">b</span></span> = {…}; }; }
=&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.debug.traceSeqN" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L97" target="_top" shape="rect">lib/debug.nix:97</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValSeqFn" shape="rect"></a>5.1.6.6.&nbsp;<code class="function">lib.debug.traceValSeqFn</code></h4></div></div></div><p>
       A combination of `traceVal` and `traceSeq` that applies a provided function to the value to be traced after `deepSeq`ing it.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function to apply
         </p></dd><dt><span class="term">
         <code class="varname">v</code>
        </span></dt><dd><p>
          Value to trace
         </p></dd></dl></div><p><a id="lib.debug.traceValSeqFn" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L114" target="_top" shape="rect">lib/debug.nix:114</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValSeq" shape="rect"></a>5.1.6.7.&nbsp;<code class="function">lib.debug.traceValSeq</code></h4></div></div></div><p>
       A combination of `traceVal` and `traceSeq`.
      </p><p><a id="lib.debug.traceValSeq" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L121" target="_top" shape="rect">lib/debug.nix:121</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValSeqNFn" shape="rect"></a>5.1.6.8.&nbsp;<code class="function">lib.debug.traceValSeqNFn</code></h4></div></div></div><p>
       A combination of `traceVal` and `traceSeqN` that applies a provided function to the value to be traced.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">f</code>
        </span></dt><dd><p>
          Function to apply
         </p></dd><dt><span class="term">
         <code class="varname">depth</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">v</code>
        </span></dt><dd><p>
          Value to trace
         </p></dd></dl></div><p><a id="lib.debug.traceValSeqNFn" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L125" target="_top" shape="rect">lib/debug.nix:125</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValSeqN" shape="rect"></a>5.1.6.9.&nbsp;<code class="function">lib.debug.traceValSeqN</code></h4></div></div></div><p>
       A combination of `traceVal` and `traceSeqN`.
      </p><p><a id="lib.debug.traceValSeqN" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L133" target="_top" shape="rect">lib/debug.nix:133</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.runTests" shape="rect"></a>5.1.6.10.&nbsp;<code class="function">lib.debug.runTests</code></h4></div></div></div><p>
       Evaluate a set of tests. A test is an attribute set `{expr, expected}`, denoting an expression and its expected result. The result is a list of failed tests, each represented as `{name, expected, actual}`, denoting the attribute name of the failing test and its expected and actual results.
      </p><p>
       Used for regression testing of the functions in lib; see tests.nix for an example. Only tests having names starting with "test" are run.
      </p><p>
       Add attr { tests = ["testName"]; } to run these tests only.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">tests</code>
        </span></dt><dd><p>
          Tests to run
         </p></dd></dl></div><p><a id="lib.debug.runTests" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L150" target="_top" shape="rect">lib/debug.nix:150</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.testAllTrue" shape="rect"></a>5.1.6.11.&nbsp;<code class="function">lib.debug.testAllTrue</code></h4></div></div></div><p>
       Create a test assuming that list elements are `true`.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">expr</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320707248" shape="rect"></a><p class="title"><strong>Example&nbsp;5.129.&nbsp;<code class="function">lib.debug.testAllTrue</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">{ <span class="hljs-attr"><span class="hljs-attr">testX</span></span> = allTrue [ <span class="hljs-literal"><span class="hljs-literal">true</span></span> ]; }
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.debug.testAllTrue" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L166" target="_top" shape="rect">lib/debug.nix:166</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-functions-library-options" class="title">5.1.7.&nbsp;NixOS / nixpkgs option handling<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-options" aria-label="Anchor link for: sec functions library options" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.isOption" shape="rect"></a>5.1.7.1.&nbsp;<code class="function">lib.options.isOption</code></h4></div><div><h5 class="subtitle"><code class="literal">isOption :: a -&gt; bool</code>
      </h5></div></div></div><p>
       Returns true when the given argument is an option
      </p><div class="example"><a id="idm140737320697776" shape="rect"></a><p class="title"><strong>Example&nbsp;5.130.&nbsp;<code class="function">lib.options.isOption</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">isOption <span class="hljs-number"><span class="hljs-number">1</span></span>             // =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>
isOption (mkOption {}) // =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.options.isOption" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L19" target="_top" shape="rect">lib/options.nix:19</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.mkOption" shape="rect"></a>5.1.7.2.&nbsp;<code class="function">lib.options.mkOption</code></h4></div></div></div><p>
       Creates an Option attribute set. mkOption accepts an attribute set with the following keys:
      </p><p>
       All keys default to `null` when not given.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">pattern</code>
        </span></dt><dd><p>
          Structured function argument
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <code class="varname">default</code>
           </span></dt><dd><p>
             Default value used when no definition is given in the configuration.
            </p></dd><dt><span class="term">
            <code class="varname">defaultText</code>
           </span></dt><dd><p>
             Textual representation of the default, for the manual.
            </p></dd><dt><span class="term">
            <code class="varname">example</code>
           </span></dt><dd><p>
             Example value used in the manual.
            </p></dd><dt><span class="term">
            <code class="varname">description</code>
           </span></dt><dd><p>
             String describing the option.
            </p></dd><dt><span class="term">
            <code class="varname">relatedPackages</code>
           </span></dt><dd><p>
             Related packages used in the manual (see `genRelatedPackages` in ../nixos/lib/make-options-doc/default.nix).
            </p></dd><dt><span class="term">
            <code class="varname">type</code>
           </span></dt><dd><p>
             Option type, providing type-checking and value merging.
            </p></dd><dt><span class="term">
            <code class="varname">apply</code>
           </span></dt><dd><p>
             Function that converts the option value to something else.
            </p></dd><dt><span class="term">
            <code class="varname">internal</code>
           </span></dt><dd><p>
             Whether the option is for NixOS developers only.
            </p></dd><dt><span class="term">
            <code class="varname">visible</code>
           </span></dt><dd><p>
             Whether the option shows up in the manual.
            </p></dd><dt><span class="term">
            <code class="varname">readOnly</code>
           </span></dt><dd><p>
             Whether the option can be set only once
            </p></dd><dt><span class="term">
            <code class="varname">options</code>
           </span></dt><dd><p>
             Deprecated, used by types.optionSet.
            </p></dd></dl></div></dd></dl></div><div class="example"><a id="idm140737320665808" shape="rect"></a><p class="title"><strong>Example&nbsp;5.131.&nbsp;<code class="function">lib.options.mkOption</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">mkOption { }  // =&gt; { <span class="hljs-attr"><span class="hljs-attr">_type</span></span> = <span class="hljs-string"><span class="hljs-string">"option"</span></span>; }
mkOption { <span class="hljs-attr"><span class="hljs-attr">defaultText</span></span> = <span class="hljs-string"><span class="hljs-string">"foo"</span></span>; } // =&gt; { <span class="hljs-attr"><span class="hljs-attr">_type</span></span> = <span class="hljs-string"><span class="hljs-string">"option"</span></span>; <span class="hljs-attr"><span class="hljs-attr">defaultText</span></span> = <span class="hljs-string"><span class="hljs-string">"foo"</span></span>; }
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.options.mkOption" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L29" target="_top" shape="rect">lib/options.nix:29</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.mkEnableOption" shape="rect"></a>5.1.7.3.&nbsp;<code class="function">lib.options.mkEnableOption</code></h4></div></div></div><p>
       Creates an Option attribute set for a boolean value option i.e an option to be toggled on or off:
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">name</code>
        </span></dt><dd><p>
          Name for the created option
         </p></dd></dl></div><div class="example"><a id="idm140737320657184" shape="rect"></a><p class="title"><strong>Example&nbsp;5.132.&nbsp;<code class="function">lib.options.mkEnableOption</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">mkEnableOption <span class="hljs-string"><span class="hljs-string">"foo"</span></span>
=&gt; { <span class="hljs-attr"><span class="hljs-attr">_type</span></span> = <span class="hljs-string"><span class="hljs-string">"option"</span></span>; <span class="hljs-attr"><span class="hljs-attr">default</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"Whether to enable foo."</span></span>; <span class="hljs-attr"><span class="hljs-attr">example</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-attr"><span class="hljs-attr">type</span></span> = { ... }; }
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.options.mkEnableOption" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L63" target="_top" shape="rect">lib/options.nix:63</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.mkSinkUndeclaredOptions" shape="rect"></a>5.1.7.4.&nbsp;<code class="function">lib.options.mkSinkUndeclaredOptions</code></h4></div></div></div><p>
       This option accepts anything, but it does not produce any result.
      </p><p>
       This is useful for sharing a module across different module sets without having to implement similar features as long as the values of the options are not accessed.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">attrs</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.options.mkSinkUndeclaredOptions" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L77" target="_top" shape="rect">lib/options.nix:77</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.mergeEqualOption" shape="rect"></a>5.1.7.5.&nbsp;<code class="function">lib.options.mergeEqualOption</code></h4></div></div></div><p>
       "Merge" option definitions by checking that they all have the same value.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">loc</code>
        </span></dt><dd><p>
          Function argument
         </p></dd><dt><span class="term">
         <code class="varname">defs</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.options.mergeEqualOption" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L108" target="_top" shape="rect">lib/options.nix:108</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.getValues" shape="rect"></a>5.1.7.6.&nbsp;<code class="function">lib.options.getValues</code></h4></div><div><h5 class="subtitle"><code class="literal">getValues :: [ { value :: a } ] -&gt; [a]</code>
      </h5></div></div></div><p>
       Extracts values of all "value" keys of the given list.
      </p><div class="example"><a id="idm140737320633712" shape="rect"></a><p class="title"><strong>Example&nbsp;5.133.&nbsp;<code class="function">lib.options.getValues</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">getValues [ { <span class="hljs-attr"><span class="hljs-attr">value</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; } { <span class="hljs-attr"><span class="hljs-attr">value</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; } ] // =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ]
getValues [ ]                               // =&gt; [ ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.options.getValues" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L124" target="_top" shape="rect">lib/options.nix:124</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.getFiles" shape="rect"></a>5.1.7.7.&nbsp;<code class="function">lib.options.getFiles</code></h4></div><div><h5 class="subtitle"><code class="literal">getFiles :: [ { file :: a } ] -&gt; [a]</code>
      </h5></div></div></div><p>
       Extracts values of all "file" keys of the given list
      </p><div class="example"><a id="idm140737320626880" shape="rect"></a><p class="title"><strong>Example&nbsp;5.134.&nbsp;<code class="function">lib.options.getFiles</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">getFiles [ { <span class="hljs-attr"><span class="hljs-attr">file</span></span> = <span class="hljs-string"><span class="hljs-string">"file1"</span></span>; } { <span class="hljs-attr"><span class="hljs-attr">file</span></span> = <span class="hljs-string"><span class="hljs-string">"file2"</span></span>; } ] // =&gt; [ <span class="hljs-string"><span class="hljs-string">"file1"</span></span> <span class="hljs-string"><span class="hljs-string">"file2"</span></span> ]
getFiles [ ]                                         // =&gt; [ ]
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.options.getFiles" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L134" target="_top" shape="rect">lib/options.nix:134</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.scrubOptionValue" shape="rect"></a>5.1.7.8.&nbsp;<code class="function">lib.options.scrubOptionValue</code></h4></div></div></div><p>
       This function recursively removes all derivation attributes from `x` except for the `name` attribute.
      </p><p>
       This is to make the generation of `options.xml` much more efficient: the XML representation of derivations is very large (on the order of megabytes) and is not actually used by the manual generator.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">x</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.options.scrubOptionValue" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L173" target="_top" shape="rect">lib/options.nix:173</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.literalExample" shape="rect"></a>5.1.7.9.&nbsp;<code class="function">lib.options.literalExample</code></h4></div></div></div><p>
       For use in the `example` option attribute. It causes the given text to be included verbatim in documentation. This is necessary for example values that are not simple values, e.g., functions.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">text</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><p><a id="lib.options.literalExample" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L185" target="_top" shape="rect">lib/options.nix:185</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.showOption" shape="rect"></a>5.1.7.10.&nbsp;<code class="function">lib.options.showOption</code></h4></div></div></div><p>
       Convert an option, described as a list of the option parts in to a safe, human readable version.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <code class="varname">parts</code>
        </span></dt><dd><p>
          Function argument
         </p></dd></dl></div><div class="example"><a id="idm140737320604144" shape="rect"></a><p class="title"><strong>Example&nbsp;5.135.&nbsp;<code class="function">lib.options.showOption</code> usage example</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">(showOption [<span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span> <span class="hljs-string"><span class="hljs-string">"baz"</span></span>]) == <span class="hljs-string"><span class="hljs-string">"foo.bar.baz"</span></span>
(showOption [<span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"bar.baz"</span></span> <span class="hljs-string"><span class="hljs-string">"tux"</span></span>]) == <span class="hljs-string"><span class="hljs-string">"foo.bar.baz.tux"</span></span>

Placeholders will not be quoted as they are not actual values:
(showOption [<span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"*"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span>]) == <span class="hljs-string"><span class="hljs-string">"foo.*.bar"</span></span>
(showOption [<span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;name&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"bar"</span></span>]) == <span class="hljs-string"><span class="hljs-string">"foo.&lt;name&gt;.bar"</span></span>

Unlike attributes, options can also start <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> numbers:
(showOption [<span class="hljs-string"><span class="hljs-string">"windowManager"</span></span> <span class="hljs-string"><span class="hljs-string">"2bwm"</span></span> <span class="hljs-string"><span class="hljs-string">"enable"</span></span>]) == <span class="hljs-string"><span class="hljs-string">"windowManager.2bwm.enable"</span></span>
</pre></div></div><br class="example-break" clear="none"><br><p><a id="lib.options.showOption" shape="rect"></a>
       Located at <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L203" target="_top" shape="rect">lib/options.nix:203</a> in <code class="literal">&lt;nixpkgs&gt;</code>.
      </p></section></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-generators" class="title" style="clear: both">5.2.&nbsp;Generators<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-generators" aria-label="Anchor link for: sec generators" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Generators are functions that create file formats from nix data structures, e. g. for configuration files. There are generators available for: <code class="literal">INI</code>, <code class="literal">JSON</code> and <code class="literal">YAML</code>
    </p><p>
     All generators follow a similar call interface: <code class="code">generatorName configFunctions data</code>, where <code class="literal">configFunctions</code> is an attrset of user-defined functions that format nested parts of the content. They each have common defaults, so often they do not need to be set manually. An example is <code class="code">mkSectionName ? (name: libStr.escape [ "[" "]" ] name)</code> from the <code class="literal">INI</code> generator. It receives the name of a section and sanitizes it. The default <code class="literal">mkSectionName</code> escapes <code class="literal">[</code> and <code class="literal">]</code> with a backslash.
    </p><p>
     Generators can be fine-tuned to produce exactly the file format required by your application/service. One example is an INI-file format which uses <code class="literal">: </code> as separator, the strings <code class="literal">"yes"</code>/<code class="literal">"no"</code> as boolean values and requires all string values to be quoted:
    </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib;
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">customToINI</span></span> = generators.toINI {
    <span class="hljs-comment"><span class="hljs-comment"># specifies how to format a key/value pair</span></span>
    <span class="hljs-attr"><span class="hljs-attr">mkKeyValue</span></span> = generators.mkKeyValueDefault {
      <span class="hljs-comment"><span class="hljs-comment"># specifies the generated string for a subset of nix values</span></span>
      <span class="hljs-attr"><span class="hljs-attr">mkValueString</span></span> = v:
             <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-attr"><span class="hljs-attr">v</span></span> == <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">''"yes"''</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-attr"><span class="hljs-attr">v</span></span> == <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">''"no"''</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isString v <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">''"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${v}</span></span></span><span class="hljs-string">"''</span></span>
        <span class="hljs-comment"><span class="hljs-comment"># and delegats all other values to the default generator</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> generators.mkValueStringDefault {} v;
    } <span class="hljs-string"><span class="hljs-string">":"</span></span>;
  };

<span class="hljs-comment"><span class="hljs-comment"># the INI file can now be given as plain old nix values</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> customToINI {
  <span class="hljs-attr"><span class="hljs-attr">main</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">pushinfo</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">autopush</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">host</span></span> = <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">port</span></span> = <span class="hljs-number"><span class="hljs-number">42</span></span>;
  };
  <span class="hljs-attr"><span class="hljs-attr">mergetool</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">merge</span></span> = <span class="hljs-string"><span class="hljs-string">"diff3"</span></span>;
  };
}
</pre><p>
     This will produce the following INI file as nix string:
    </p><pre class="programlisting hljs nix" xml:space="preserve">[main]
autopush:<span class="hljs-string"><span class="hljs-string">"no"</span></span>
host:<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>
port:<span class="hljs-number"><span class="hljs-number">42</span></span>
pushinfo:<span class="hljs-string"><span class="hljs-string">"yes"</span></span>
str\:ange:<span class="hljs-string"><span class="hljs-string">"very::strange"</span></span>

[mergetool]
merge:<span class="hljs-string"><span class="hljs-string">"diff3"</span></span>
</pre><div class="alert alert-info"><strong>Note:</strong> 
      Nix store paths can be converted to strings by enclosing a derivation attribute like so: <code class="code">"${drv}"</code>.
     </div><p>
     Detailed documentation for each generator can be found in <code class="literal">lib/generators.nix</code>.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-debug" class="title" style="clear: both">5.3.&nbsp;Debugging Nix Expressions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-debug" aria-label="Anchor link for: sec debug" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Nix is a unityped, dynamic language, this means every value can potentially appear anywhere. Since it is also non-strict, evaluation order and what ultimately is evaluated might surprise you. Therefore it is important to be able to debug nix expressions.
    </p><p>
     In the <code class="literal">lib/debug.nix</code> file you will find a number of functions that help (pretty-)printing values while evaluation is runnnig. You can even specify how deep these values should be printed recursively, and transform them on the fly. Please consult the docstrings in <code class="literal">lib/debug.nix</code> for usage information.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-prefer-remote-fetch" class="title" style="clear: both">5.4.&nbsp;prefer-remote-fetch overlay<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-prefer-remote-fetch" aria-label="Anchor link for: sec prefer remote fetch" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <code class="function">prefer-remote-fetch</code> is an overlay that download sources on remote builder. This is useful when the evaluating machine has a slow upload while the builder can fetch faster directly from the source. To use it, put the following snippet as a new overlay:
</p><pre class="programlisting hljs" xml:space="preserve">self: super:
  (super.prefer-remote-fetch self super)
</pre><p>
     A full configuration example for that sets the overlay up for your own account, could look like this
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>mkdir ~/.config/nixpkgs/overlays/
<code class="prompt">$ </code>cat &gt; ~/.config/nixpkgs/overlays/prefer-remote-fetch.nix &lt;&lt;EOF
  self: super: super.prefer-remote-fetch self super
EOF
</pre><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkgs-nix-gitignore" class="title" style="clear: both">5.5.&nbsp;pkgs.nix-gitignore<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore" aria-label="Anchor link for: sec pkgs nix gitignore" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <code class="function">pkgs.nix-gitignore</code> is a function that acts similarly to <code class="literal">builtins.filterSource</code> but also allows filtering with the help of the gitignore format.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-pkgs-nix-gitignore-usage" class="title">5.5.1.&nbsp;Usage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore-usage" aria-label="Anchor link for: sec pkgs nix gitignore usage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      <code class="literal">pkgs.nix-gitignore</code> exports a number of functions, but you'll most likely need either <code class="literal">gitignoreSource</code> or <code class="literal">gitignoreSourcePure</code>. As their first argument, they both accept either 1. a file with gitignore lines or 2. a string with gitignore lines, or 3. a list of either of the two. They will be concatenated into a single big string.
     </p><pre class="programlisting hljs bash" xml:space="preserve">{ pkgs ? import &lt;nixpkgs&gt; {} }:

 nix-gitignore.gitignoreSource [] ./<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>
     <span class="hljs-comment"><span class="hljs-comment"># Simplest version</span></span>

 nix-gitignore.gitignoreSource <span class="hljs-string"><span class="hljs-string">"supplemental-ignores\n"</span></span> ./<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>
     <span class="hljs-comment"><span class="hljs-comment"># This one reads the ./source/.gitignore and concats the auxiliary ignores</span></span>

 nix-gitignore.gitignoreSourcePure <span class="hljs-string"><span class="hljs-string">"ignore-this\nignore-that\n"</span></span> ./<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>
     <span class="hljs-comment"><span class="hljs-comment"># Use this string as gitignore, don't read ./source/.gitignore.</span></span>

 nix-gitignore.gitignoreSourcePure [<span class="hljs-string"><span class="hljs-string">"ignore-this\nignore-that\n"</span></span>, ~/.gitignore] ./<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>
     <span class="hljs-comment"><span class="hljs-comment"># It also accepts a list (of strings and paths) that will be concatenated</span></span>
     <span class="hljs-comment"><span class="hljs-comment"># once the paths are turned to strings via readFile.</span></span>
  </pre><p>
      These functions are derived from the <code class="literal">Filter</code> functions by setting the first filter argument to <code class="literal">(_: _: true)</code>:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">gitignoreSourcePure</span></span> = gitignoreFilterSourcePure (_: _: <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
<span class="hljs-attr"><span class="hljs-attr">gitignoreSource</span></span> = gitignoreFilterSource (_: _: <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
  </pre><p>
      Those filter functions accept the same arguments the <code class="literal">builtins.filterSource</code> function would pass to its filters, thus <code class="literal">fn: gitignoreFilterSourcePure fn ""</code> should be extensionally equivalent to <code class="literal">filterSource</code>. The file is blacklisted iff it's blacklisted by either your filter or the gitignoreFilter.
     </p><p>
      If you want to make your own filter from scratch, you may use
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">gitignoreFilter</span></span> = ign: root: filterPattern (gitignoreToPatterns ign) root;
  </pre></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-pkgs-nix-gitignore-usage-recursive" class="title">5.5.2.&nbsp;gitignore files in subdirectories<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore-usage-recursive" aria-label="Anchor link for: sec pkgs nix gitignore usage recursive" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      If you wish to use a filter that would search for .gitignore files in subdirectories, just like git does by default, use this function:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">gitignoreFilterRecursiveSource</span></span> = filter: patterns: root:
<span class="hljs-comment"><span class="hljs-comment"># OR</span></span>
<span class="hljs-attr"><span class="hljs-attr">gitignoreRecursiveSource</span></span> = gitignoreFilterSourcePure (_: _: <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
  </pre></section></section></section></div><div class="part"><div class="titlepage"><div><div><div class="page-header"><h1 id="idm140737320561136" class="title">Part&nbsp;II.&nbsp;Standard environment<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#idm140737320561136" aria-label="Anchor link for: idm140737320561136" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h1></div></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" shape="rect">6. The Standard Environment</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-meta" shape="rect">7. Meta-attributes</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output" shape="rect">8. Multiple-output packages</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-cross" shape="rect">9. Cross-compilation</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-notes" shape="rect">10. Platform Notes</a></span></dt></dl></div><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-stdenv" class="title">Chapter&nbsp;6.&nbsp;The Standard Environment<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" aria-label="Anchor link for: chap stdenv" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv" shape="rect">6.1. Using <code class="literal">stdenv</code></a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-tools-of-stdenv" shape="rect">6.2. Tools provided by <code class="literal">stdenv</code></a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies" shape="rect">6.3. Specifying dependencies</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-attributes" shape="rect">6.4. Attributes</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" shape="rect">6.5. Phases</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-functions" shape="rect">6.6. Shell functions</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" shape="rect">6.7. Package setup hooks</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-purity-in-nixpkgs" shape="rect">6.8. Purity in Nixpkgs</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-hardening-in-nixpkgs" shape="rect">6.9. Hardening in Nixpkgs</a></span></dt></dl></div><p>
    The standard build environment in the Nix Packages collection provides an environment for building Unix packages that does a lot of common build tasks automatically. In fact, for Unix packages that use the standard <code class="literal">./configure; make; make install</code> build interface, you don’t need to write a build script at all; the standard environment does everything automatically. If <code class="literal">stdenv</code> doesn’t do what you need automatically, you can easily customise or override the various build phases.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-using-stdenv" class="title" style="clear: both">6.1.&nbsp;Using <code class="literal">stdenv</code><a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv" aria-label="Anchor link for: sec using stdenv" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     To build a package with the standard environment, you use the function <code class="varname">stdenv.mkDerivation</code>, instead of the primitive built-in function <code class="varname">derivation</code>, e.g.
</p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"libfoo-1.2.3"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://example.org/libfoo-1.2.3.tar.bz2"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0x2g1jqygyr5wiwg4ma1nd7w4ydpy82z9gkcv8vh2v8dn3y58v5m"</span></span>;
  };
}</pre><p>
     (<code class="varname">stdenv</code> needs to be in scope, so if you write this in a separate Nix expression from <code class="filename">pkgs/all-packages.nix</code>, you need to pass it as a function argument.) Specifying a <code class="varname">name</code> and a <code class="varname">src</code> is the absolute minimum Nix requires. For convenience, you can also use <code class="varname">pname</code> and <code class="varname">version</code> attributes and <code class="literal">mkDerivation</code> will automatically set <code class="varname">name</code> to <code class="literal">"${pname}-${version}"</code> by default. Since <a class="link" href="https://github.com/NixOS/rfcs/pull/35" target="_top" shape="rect">RFC 0035</a>, this is preferred for packages in Nixpkgs, as it allows us to reuse the version easily:
</p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"libfoo"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"1.2.3"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://example.org/libfoo-source-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${version}</span></span></span><span class="hljs-string">.tar.bz2"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0x2g1jqygyr5wiwg4ma1nd7w4ydpy82z9gkcv8vh2v8dn3y58v5m"</span></span>;
  };
}</pre><p>
    </p><p>
     Many packages have dependencies that are not provided in the standard environment. It’s usually sufficient to specify those dependencies in the <code class="varname">buildInputs</code> attribute:
</p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"libfoo-1.2.3"</span></span>;
  ...
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [libbar perl ncurses];
}</pre><p>
     This attribute ensures that the <code class="filename">bin</code> subdirectories of these packages appear in the <code class="envar">PATH</code> environment variable during the build, that their <code class="filename">include</code> subdirectories are searched by the C compiler, and so on. (See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="6.7. Package setup hooks" shape="rect">Section&nbsp;6.7, “Package setup hooks”</a> for details.)
    </p><p>
     Often it is necessary to override or modify some aspect of the build. To make this easier, the standard environment breaks the package build into a number of <span class="emphasis"><em>phases</em></span>, all of which can be overridden or modified individually: unpacking the sources, applying patches, configuring, building, and installing. (There are some others; see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" title="6.5. Phases" shape="rect">Section&nbsp;6.5, “Phases”</a>.) For instance, a package that doesn’t supply a makefile but instead has to be compiled “manually” could be handled like this:
</p><pre class="programlisting hljs bash" xml:space="preserve">stdenv.mkDerivation {
  name = <span class="hljs-string"><span class="hljs-string">"fnord-4.5"</span></span>;
  ...
  buildPhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    gcc foo.c -o foo
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
  installPhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    mkdir -p <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin
    cp foo <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
}</pre><p>
     (Note the use of <code class="literal">''</code>-style string literals, which are very convenient for large multi-line script fragments because they don’t need escaping of <code class="literal">"</code> and <code class="literal">\</code>, and because indentation is intelligently removed.)
    </p><p>
     There are many other attributes to customise the build. These are listed in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-attributes" title="6.4. Attributes" shape="rect">Section&nbsp;6.4, “Attributes”</a>.
    </p><p>
     While the standard environment provides a generic builder, you can still supply your own build script:
</p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"libfoo-1.2.3"</span></span>;
  ...
  <span class="hljs-attr"><span class="hljs-attr">builder</span></span> = ./builder.sh;
}</pre><p>
     where the builder can do anything it wants, but typically starts with
</p><pre class="programlisting hljs bash" xml:space="preserve"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> <span class="hljs-variable"><span class="hljs-variable">$stdenv</span></span>/setup
</pre><p>
     to let <code class="literal">stdenv</code> set up the environment (e.g., process the <code class="varname">buildInputs</code>). If you want, you can still use <code class="literal">stdenv</code>’s generic builder:
</p><pre class="programlisting hljs bash" xml:space="preserve"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> <span class="hljs-variable"><span class="hljs-variable">$stdenv</span></span>/setup

<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildPhase</span></span></span></span>() {
  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"... this is my custom build phase ..."</span></span>
  gcc foo.c -o foo
}

<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">installPhase</span></span></span></span>() {
  mkdir -p <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin
  cp foo <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin
}

genericBuild
</pre><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-tools-of-stdenv" class="title" style="clear: both">6.2.&nbsp;Tools provided by <code class="literal">stdenv</code><a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-tools-of-stdenv" aria-label="Anchor link for: sec tools of stdenv" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The standard environment provides the following packages:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The GNU C Compiler, configured with C and C++ support.
       </p></li><li class="listitem"><p>
        GNU coreutils (contains a few dozen standard Unix commands).
       </p></li><li class="listitem"><p>
        GNU findutils (contains <span class="command"><strong>find</strong></span>).
       </p></li><li class="listitem"><p>
        GNU diffutils (contains <span class="command"><strong>diff</strong></span>, <span class="command"><strong>cmp</strong></span>).
       </p></li><li class="listitem"><p>
        GNU <span class="command"><strong>sed</strong></span>.
       </p></li><li class="listitem"><p>
        GNU <span class="command"><strong>grep</strong></span>.
       </p></li><li class="listitem"><p>
        GNU <span class="command"><strong>awk</strong></span>.
       </p></li><li class="listitem"><p>
        GNU <span class="command"><strong>tar</strong></span>.
       </p></li><li class="listitem"><p>
        <span class="command"><strong>gzip</strong></span>, <span class="command"><strong>bzip2</strong></span> and <span class="command"><strong>xz</strong></span>.
       </p></li><li class="listitem"><p>
        GNU Make.
       </p></li><li class="listitem"><p>
        Bash. This is the shell used for all builders in the Nix Packages collection. Not using <span class="command"><strong>/bin/sh</strong></span> removes a large source of portability problems.
       </p></li><li class="listitem"><p>
        The <span class="command"><strong>patch</strong></span> command.
       </p></li></ul></div><p>
    </p><p>
     On Linux, <code class="literal">stdenv</code> also includes the <span class="command"><strong>patchelf</strong></span> utility.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="ssec-stdenv-dependencies" class="title" style="clear: both">6.3.&nbsp;Specifying dependencies<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies" aria-label="Anchor link for: ssec stdenv dependencies" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     As described in the Nix manual, almost any <code class="filename">*.drv</code> store path in a derivation's attribute set will induce a dependency on that derivation. <code class="varname">mkDerivation</code>, however, takes a few attributes intended to, between them, include all the dependencies of a package. This is done both for structure and consistency, but also so that certain other setup can take place. For example, certain dependencies need their bin directories added to the <code class="envar">PATH</code>. That is built-in, but other setup is done via a pluggable mechanism that works in conjunction with these dependency attributes. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="6.7. Package setup hooks" shape="rect">Section&nbsp;6.7, “Package setup hooks”</a> for details.
    </p><p>
     Dependencies can be broken down along three axes: their host and target platforms relative to the new derivation's, and whether they are propagated. The platform distinctions are motivated by cross compilation; see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#chap-cross" title="Chapter 9. Cross-compilation" shape="rect">Chapter&nbsp;9, <em>Cross-compilation</em></a> for exactly what each platform means.
     <a href="https://nixos.org/manual/nixpkgs/stable/#ftn.footnote-stdenv-ignored-build-platform" class="footnote" id="footnote-stdenv-ignored-build-platform" shape="rect"><sup class="footnote">[1]</sup></a>
     But even if one is not cross compiling, the platforms imply whether or not the dependency is needed at run-time or build-time, a concept that makes perfect sense outside of cross compilation. By default, the run-time/build-time distinction is just a hint for mental clarity, but with <code class="varname">strictDeps</code> set it is mostly enforced even in the native case.
    </p><p>
     The extension of <code class="envar">PATH</code> with dependencies, alluded to above, proceeds according to the relative platforms alone. The process is carried out only for dependencies whose host platform matches the new derivation's build platform i.e. dependencies which run on the platform where the new derivation will be built.
     <a href="https://nixos.org/manual/nixpkgs/stable/#ftn.footnote-stdenv-native-dependencies-in-path" class="footnote" id="footnote-stdenv-native-dependencies-in-path" shape="rect"><sup class="footnote">[2]</sup></a>
     For each dependency <em class="replaceable"><code>dep</code></em> of those dependencies, <code class="filename"><em class="replaceable"><code>dep</code></em>/bin</code>, if present, is added to the <code class="envar">PATH</code> environment variable.
    </p><p>
     The dependency is propagated when it forces some of its other-transitive (non-immediate) downstream dependencies to also take it on as an immediate dependency. Nix itself already takes a package's transitive dependencies into account, but this propagation ensures nixpkgs-specific infrastructure like setup hooks (mentioned above) also are run as if the propagated dependency.
    </p><p>
     It is important to note that dependencies are not necessarily propagated as the same sort of dependency that they were before, but rather as the corresponding sort so that the platform rules still line up. The exact rules for dependency propagation can be given by assigning to each dependency two integers based one how its host and target platforms are offset from the depending derivation's platforms. Those offsets are given below in the descriptions of each dependency list attribute. Algorithmically, we traverse propagated inputs, accumulating every propagated dependency's propagated dependencies and adjusting them to account for the "shift in perspective" described by the current dependency's platform offsets. This results in sort a transitive closure of the dependency relation, with the offsets being approximately summed when two dependency links are combined. We also prune transitive dependencies whose combined offsets go out-of-bounds, which can be viewed as a filter over that transitive closure removing dependencies that are blatantly absurd.
    </p><p>
     We can define the process precisely with <a class="link" href="https://en.wikipedia.org/wiki/Natural_deduction" target="_top" shape="rect">Natural Deduction</a> using the inference rules. This probably seems a bit obtuse, but so is the bash code that actually implements it!
     <a href="https://nixos.org/manual/nixpkgs/stable/#ftn.footnote-stdenv-find-inputs-location" class="footnote" id="footnote-stdenv-find-inputs-location" shape="rect"><sup class="footnote">[3]</sup></a>
     They're confusing in very different ways so... hopefully if something doesn't make sense in one presentation, it will in the other!
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mapOffset(h, t, i) = i + (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> h <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> t - <span class="hljs-number"><span class="hljs-number">1</span></span>)

propagated-dep(h0, t0, A, B)
propagated-dep(h1, t1, B, C)
h0 + h1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}
h0 + t1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}
-------------------------------------- Transitive property
propagated-dep(mapOffset(h0, t0, h1),
               mapOffset(h0, t0, t1),
               A, C)</pre><p>
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mapOffset(h, t, i) = i + (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> h <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> t - <span class="hljs-number"><span class="hljs-number">1</span></span>)

dep(h0, _, A, B)
propagated-dep(h1, t1, B, C)
h0 + h1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}
h0 + t1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>}
----------------------------- Take immediate dependencies' propagated dependencies
propagated-dep(mapOffset(h0, t0, h1),
               mapOffset(h0, t0, t1),
               A, C)</pre><p>
</p><pre class="programlisting hljs" xml:space="preserve">propagated-dep(h, t, A, B)
----------------------------- Propagated dependencies count as dependencies
dep(h, t, A, B)</pre><p>
     Some explanation of this monstrosity is in order. In the common case, the target offset of a dependency is the successor to the target offset: <code class="literal">t = h + 1</code>. That means that:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> f(h, t, i) = i + (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> h <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> t - <span class="hljs-number"><span class="hljs-number">1</span></span>)
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> f(h, h + <span class="hljs-number"><span class="hljs-number">1</span></span>, i) = i + (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> h <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> (h + <span class="hljs-number"><span class="hljs-number">1</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>)
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> f(h, h + <span class="hljs-number"><span class="hljs-number">1</span></span>, i) = i + (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> h <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> h)
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> f(h, h + <span class="hljs-number"><span class="hljs-number">1</span></span>, i) = i + h
</pre><p>
     This is where "sum-like" comes in from above: We can just sum all of the host offsets to get the host offset of the transitive dependency. The target offset is the transitive dependency is simply the host offset + 1, just as it was with the dependencies composed to make this transitive one; it can be ignored as it doesn't add any new information.
    </p><p>
     Because of the bounds checks, the uncommon cases are <code class="literal">h = t</code> and <code class="literal">h + 2 = t</code>. In the former case, the motivation for <code class="function">mapOffset</code> is that since its host and target platforms are the same, no transitive dependency of it should be able to "discover" an offset greater than its reduced target offsets. <code class="function">mapOffset</code> effectively "squashes" all its transitive dependencies' offsets so that none will ever be greater than the target offset of the original <code class="literal">h = t</code> package. In the other case, <code class="literal">h + 1</code> is skipped over between the host and target offsets. Instead of squashing the offsets, we need to "rip" them apart so no transitive dependencies' offset is that one.
    </p><p>
     Overall, the unifying theme here is that propagation shouldn't be introducing transitive dependencies involving platforms the depending package is unaware of. [One can imagine the dependending package asking for dependencies with the platforms it knows about; other platforms it doesn't know how to ask for. The platform description in that scenario is a kind of unforagable capability.] The offset bounds checking and definition of <code class="function">mapOffset</code> together ensure that this is the case. Discovering a new offset is discovering a new platform, and since those platforms weren't in the derivation "spec" of the needing package, they cannot be relevant. From a capability perspective, we can imagine that the host and target platforms of a package are the capabilities a package requires, and the depending package must provide the capability to the dependency.
    </p><div class="variablelist"><p class="title"><strong>Variables specifying dependencies</strong></p><dl class="variablelist"><dt><a id="var-stdenv-depsBuildBuild" shape="rect"></a><span class="term">
       <code class="varname">depsBuildBuild</code>
      </span></dt><dd><p>
        A list of dependencies whose host and target platforms are the new derivation's build platform. This means a <code class="literal">-1</code> host and <code class="literal">-1</code> target offset from the new derivation's platforms. These are programs and libraries used at build time that produce programs and libraries also used at build time. If the dependency doesn't care about the target platform (i.e. isn't a compiler or similar tool), put it in <code class="varname">nativeBuildInputs</code> instead. The most common use of this <code class="literal">buildPackages.stdenv.cc</code>, the default C compiler for this role. That example crops up more than one might think in old commonly used C libraries.
       </p><p>
        Since these packages are able to be run at build-time, they are always added to the <code class="envar">PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn't persist as run-time dependencies. This isn't currently enforced, but could be in the future.
       </p></dd><dt><a id="var-stdenv-nativeBuildInputs" shape="rect"></a><span class="term">
       <code class="varname">nativeBuildInputs</code>
      </span></dt><dd><p>
        A list of dependencies whose host platform is the new derivation's build platform, and target platform is the new derivation's host platform. This means a <code class="literal">-1</code> host offset and <code class="literal">0</code> target offset from the new derivation's platforms. These are programs and libraries used at build-time that, if they are a compiler or similar tool, produce code to run at run-time—i.e. tools used to build the new derivation. If the dependency doesn't care about the target platform (i.e. isn't a compiler or similar tool), put it here, rather than in <code class="varname">depsBuildBuild</code> or <code class="varname">depsBuildTarget</code>. This could be called <code class="varname">depsBuildHost</code> but <code class="varname">nativeBuildInputs</code> is used for historical continuity.
       </p><p>
        Since these packages are able to be run at build-time, they are added to the <code class="envar">PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn't persist as run-time dependencies. This isn't currently enforced, but could be in the future.
       </p></dd><dt><a id="var-stdenv-depsBuildTarget" shape="rect"></a><span class="term">
       <code class="varname">depsBuildTarget</code>
      </span></dt><dd><p>
        A list of dependencies whose host platform is the new derivation's build platform, and target platform is the new derivation's target platform. This means a <code class="literal">-1</code> host offset and <code class="literal">1</code> target offset from the new derivation's platforms. These are programs used at build time that produce code to run with code produced by the depending package. Most commonly, these are tools used to build the runtime or standard library that the currently-being-built compiler will inject into any code it compiles. In many cases, the currently-being-built-compiler is itself employed for that task, but when that compiler won't run (i.e. its build and host platform differ) this is not possible. Other times, the compiler relies on some other tool, like binutils, that is always built separately so that the dependency is unconditional.
       </p><p>
        This is a somewhat confusing concept to wrap one’s head around, and for good reason. As the only dependency type where the platform offsets are not adjacent integers, it requires thinking of a bootstrapping stage <span class="emphasis"><em>two</em></span> away from the current one. It and its use-case go hand in hand and are both considered poor form: try to not need this sort of dependency, and try to avoid building standard libraries and runtimes in the same derivation as the compiler produces code using them. Instead strive to build those like a normal library, using the newly-built compiler just as a normal library would. In short, do not use this attribute unless you are packaging a compiler and are sure it is needed.
       </p><p>
        Since these packages are able to run at build time, they are added to the <code class="envar">PATH</code>, as described above. But since these packages are only guaranteed to be able to run then, they shouldn't persist as run-time dependencies. This isn't currently enforced, but could be in the future.
       </p></dd><dt><a id="var-stdenv-depsHostHost" shape="rect"></a><span class="term">
       <code class="varname">depsHostHost</code>
      </span></dt><dd><p>
        A list of dependencies whose host and target platforms match the new derivation's host platform. This means a <code class="literal">0</code> host offset and <code class="literal">0</code> target offset from the new derivation's host platform. These are packages used at run-time to generate code also used at run-time. In practice, this would usually be tools used by compilers for macros or a metaprogramming system, or libraries used by the macros or metaprogramming code itself. It's always preferable to use a <code class="varname">depsBuildBuild</code> dependency in the derivation being built over a <code class="varname">depsHostHost</code> on the tool doing the building for this purpose.
       </p></dd><dt><a id="var-stdenv-buildInputs" shape="rect"></a><span class="term">
       <code class="varname">buildInputs</code>
      </span></dt><dd><p>
        A list of dependencies whose host platform and target platform match the new derivation's. This means a <code class="literal">0</code> host offset and a <code class="literal">1</code> target offset from the new derivation's host platform. This would be called <code class="varname">depsHostTarget</code> but for historical continuity. If the dependency doesn't care about the target platform (i.e. isn't a compiler or similar tool), put it here, rather than in <code class="varname">depsBuildBuild</code>.
       </p><p>
        These are often programs and libraries used by the new derivation at <span class="emphasis"><em>run</em></span>-time, but that isn't always the case. For example, the machine code in a statically-linked library is only used at run-time, but the derivation containing the library is only needed at build-time. Even in the dynamic case, the library may also be needed at build-time to appease the linker.
       </p></dd><dt><a id="var-stdenv-depsTargetTarget" shape="rect"></a><span class="term">
       <code class="varname">depsTargetTarget</code>
      </span></dt><dd><p>
        A list of dependencies whose host platform matches the new derivation's target platform. This means a <code class="literal">1</code> offset from the new derivation's platforms. These are packages that run on the target platform, e.g. the standard library or run-time deps of standard library that a compiler insists on knowing about. It's poor form in almost all cases for a package to depend on another from a future stage [future stage corresponding to positive offset]. Do not use this attribute unless you are packaging a compiler and are sure it is needed.
       </p></dd><dt><a id="var-stdenv-depsBuildBuildPropagated" shape="rect"></a><span class="term">
       <code class="varname">depsBuildBuildPropagated</code>
      </span></dt><dd><p>
        The propagated equivalent of <code class="varname">depsBuildBuild</code>. This perhaps never ought to be used, but it is included for consistency [see below for the others].
       </p></dd><dt><a id="var-stdenv-propagatedNativeBuildInputs" shape="rect"></a><span class="term">
       <code class="varname">propagatedNativeBuildInputs</code>
      </span></dt><dd><p>
        The propagated equivalent of <code class="varname">nativeBuildInputs</code>. This would be called <code class="varname">depsBuildHostPropagated</code> but for historical continuity. For example, if package <code class="varname">Y</code> has <code class="literal">propagatedNativeBuildInputs = [X]</code>, and package <code class="varname">Z</code> has <code class="literal">buildInputs = [Y]</code>, then package <code class="varname">Z</code> will be built as if it included package <code class="varname">X</code> in its <code class="varname">nativeBuildInputs</code>. If instead, package <code class="varname">Z</code> has <code class="literal">nativeBuildInputs = [Y]</code>, then <code class="varname">Z</code> will be built as if it included <code class="varname">X</code> in the <code class="varname">depsBuildBuild</code> of package <code class="varname">Z</code>, because of the sum of the two <code class="literal">-1</code> host offsets.
       </p></dd><dt><a id="var-stdenv-depsBuildTargetPropagated" shape="rect"></a><span class="term">
       <code class="varname">depsBuildTargetPropagated</code>
      </span></dt><dd><p>
        The propagated equivalent of <code class="varname">depsBuildTarget</code>. This is prefixed for the same reason of alerting potential users.
       </p></dd><dt><a id="var-stdenv-depsHostHostPropagated" shape="rect"></a><span class="term">
       <code class="varname">depsHostHostPropagated</code>
      </span></dt><dd><p>
        The propagated equivalent of <code class="varname">depsHostHost</code>.
       </p></dd><dt><a id="var-stdenv-propagatedBuildInputs" shape="rect"></a><span class="term">
       <code class="varname">propagatedBuildInputs</code>
      </span></dt><dd><p>
        The propagated equivalent of <code class="varname">buildInputs</code>. This would be called <code class="varname">depsHostTargetPropagated</code> but for historical continuity.
       </p></dd><dt><a id="var-stdenv-depsTargetTargetPropagated" shape="rect"></a><span class="term">
       <code class="varname">depsTargetTargetPropagated</code>
      </span></dt><dd><p>
        The propagated equivalent of <code class="varname">depsTargetTarget</code>. This is prefixed for the same reason of alerting potential users.
       </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h2 id="ssec-stdenv-attributes" class="title" style="clear: both">6.4.&nbsp;Attributes<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-attributes" aria-label="Anchor link for: ssec stdenv attributes" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="variablelist"><p class="title"><strong>Variables affecting <code class="literal">stdenv</code> initialisation</strong></p><dl class="variablelist"><dt><a id="var-stdenv-NIX_DEBUG" shape="rect"></a><span class="term">
       <code class="varname">NIX_DEBUG</code>
      </span></dt><dd><p>
        A natural number indicating how much information to log. If set to 1 or higher, <code class="literal">stdenv</code> will print moderate debugging information during the build. In particular, the <span class="command"><strong>gcc</strong></span> and <span class="command"><strong>ld</strong></span> wrapper scripts will print out the complete command line passed to the wrapped tools. If set to 6 or higher, the <code class="literal">stdenv</code> setup script will be run with <code class="literal">set -x</code> tracing. If set to 7 or higher, the <span class="command"><strong>gcc</strong></span> and <span class="command"><strong>ld</strong></span> wrapper scripts will also be run with <code class="literal">set -x</code> tracing.
       </p></dd></dl></div><div class="variablelist"><p class="title"><strong>Attributes affecting build properties</strong></p><dl class="variablelist"><dt><a id="var-stdenv-enableParallelBuilding" shape="rect"></a><span class="term">
       <code class="varname">enableParallelBuilding</code>
      </span></dt><dd><p>
        If set to <code class="literal">true</code>, <code class="literal">stdenv</code> will pass specific flags to <code class="literal">make</code> and other build tools to enable parallel building with up to <code class="literal">build-cores</code> workers.
       </p><p>
        Unless set to <code class="literal">false</code>, some build systems with good support for parallel building including <code class="literal">cmake</code>, <code class="literal">meson</code>, and <code class="literal">qmake</code> will set it to <code class="literal">true</code>.
       </p></dd></dl></div><div class="variablelist"><p class="title"><strong>Special variables</strong></p><dl class="variablelist"><dt><a id="var-stdenv-passthru" shape="rect"></a><span class="term">
       <code class="varname">passthru</code>
      </span></dt><dd><p>
        This is an attribute set which can be filled with arbitrary values. For example:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">passthru</span></span> = {
  <span class="hljs-attr"><span class="hljs-attr">foo</span></span> = <span class="hljs-string"><span class="hljs-string">"bar"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">baz</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">value1</span></span> = <span class="hljs-number"><span class="hljs-number">4</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">value2</span></span> = <span class="hljs-number"><span class="hljs-number">5</span></span>;
  };
}
</pre><p>
       </p><p>
        Values inside it are not passed to the builder, so you can change them without triggering a rebuild. However, they can be accessed outside of a derivation directly, as if they were set inside a derivation itself, e.g. <code class="literal">hello.baz.value1</code>. We don't specify any usage or schema of <code class="literal">passthru</code> - it is meant for values that would be useful outside the derivation in other parts of a Nix expression (e.g. in other derivations). An example would be to convey some specific dependency of your derivation which contains a program with plugins support. Later, others who make derivations with plugins can use passed-through dependency to ensure that their plugin would be binary-compatible with built program.
       </p></dd><dt><a id="var-passthru-updateScript" shape="rect"></a><span class="term">
       <code class="varname">passthru.updateScript</code>
      </span></dt><dd><p>
        A script to be run by <code class="filename">maintainers/scripts/update.nix</code> when the package is matched. It needs to be an executable file, either on the file system:
</p><pre class="programlisting hljs nix" xml:space="preserve">passthru.<span class="hljs-attr"><span class="hljs-attr">updateScript</span></span> = ./update.sh;
</pre><p>
        or inside the expression itself:
</p><pre class="programlisting hljs bash" xml:space="preserve">passthru.updateScript = writeScript <span class="hljs-string"><span class="hljs-string">"update-zoom-us"</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>
  <span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env nix-shell</span></span>
  <span class="hljs-comment"><span class="hljs-comment">#!nix-shell -i bash -p curl pcre common-updater-scripts</span></span>

  <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -eu -o pipefail

  version=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(curl -sI https://zoom.us/client/latest/zoom_x86_64.tar.xz | grep -Fi 'Location:' | pcregrep -o1 '/(([0-9]\.?)</span></span></span><span class="hljs-string">+)/')"</span></span>
  update-source-version zoom-us <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$version</span></span></span><span class="hljs-string">"</span></span>
<span class="hljs-string"><span class="hljs-string">''</span></span>;
</pre><p>
        The attribute can also contain a list, a script followed by arguments to be passed to it:
</p><pre class="programlisting hljs nix" xml:space="preserve">passthru.<span class="hljs-attr"><span class="hljs-attr">updateScript</span></span> = [ ../../update.sh pname <span class="hljs-string"><span class="hljs-string">"--requested-release=unstable"</span></span> ];
</pre><p>
       </p><p>
        The script will be usually run from the root of the Nixpkgs repository but you should not rely on that. Also note that the update scripts will be run in parallel by default; you should avoid running <span class="command"><strong>git commit</strong></span> or any other commands that cannot handle that.
       </p><p>
        For information about how to run the updates, execute <span class="command"><strong>nix-shell maintainers/scripts/update.nix</strong></span>.
       </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-stdenv-phases" class="title" style="clear: both">6.5.&nbsp;Phases<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" aria-label="Anchor link for: sec stdenv phases" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The generic builder has a number of <span class="emphasis"><em>phases</em></span>. Package builds are split into phases to make it easier to override specific parts of the build (e.g., unpacking the sources or installing the binaries). Furthermore, it allows a nicer presentation of build logs in the Nix build farm.
    </p><p>
     Each phase can be overridden in its entirety either by setting the environment variable <code class="varname"><em class="replaceable"><code>name</code></em>Phase</code> to a string containing some shell commands to be executed, or by redefining the shell function <code class="varname"><em class="replaceable"><code>name</code></em>Phase</code>. The former is convenient to override a phase from the derivation, while the latter is convenient from a build script. However, typically one only wants to <span class="emphasis"><em>add</em></span> some commands to a phase, e.g. by defining <code class="literal">postInstall</code> or <code class="literal">preFixup</code>, as skipping some of the default actions may have unexpected consequences. The default script for each phase is defined in the file <code class="filename">pkgs/stdenv/generic/setup.sh</code>.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="ssec-controlling-phases" class="title">6.5.1.&nbsp;Controlling phases<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-controlling-phases" aria-label="Anchor link for: ssec controlling phases" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      There are a number of variables that control what phases are executed and in what order:
      </p><div class="variablelist"><p class="title"><strong>Variables affecting phase control</strong></p><dl class="variablelist"><dt><a id="var-stdenv-phases" shape="rect"></a><span class="term">
         <code class="varname">phases</code>
        </span></dt><dd><p>
          Specifies the phases. You can change the order in which phases are executed, or add new phases, by setting this variable. If it’s not set, the default value is used, which is <code class="literal">$prePhases unpackPhase patchPhase $preConfigurePhases configurePhase $preBuildPhases buildPhase checkPhase $preInstallPhases installPhase fixupPhase installCheckPhase $preDistPhases distPhase $postPhases</code>.
         </p><p>
          Usually, if you just want to add a few phases, it’s more convenient to set one of the variables below (such as <code class="varname">preInstallPhases</code>), as you then don’t specify all the normal phases.
         </p></dd><dt><a id="var-stdenv-prePhases" shape="rect"></a><span class="term">
         <code class="varname">prePhases</code>
        </span></dt><dd><p>
          Additional phases executed before any of the default phases.
         </p></dd><dt><a id="var-stdenv-preConfigurePhases" shape="rect"></a><span class="term">
         <code class="varname">preConfigurePhases</code>
        </span></dt><dd><p>
          Additional phases executed just before the configure phase.
         </p></dd><dt><a id="var-stdenv-preBuildPhases" shape="rect"></a><span class="term">
         <code class="varname">preBuildPhases</code>
        </span></dt><dd><p>
          Additional phases executed just before the build phase.
         </p></dd><dt><a id="var-stdenv-preInstallPhases" shape="rect"></a><span class="term">
         <code class="varname">preInstallPhases</code>
        </span></dt><dd><p>
          Additional phases executed just before the install phase.
         </p></dd><dt><a id="var-stdenv-preFixupPhases" shape="rect"></a><span class="term">
         <code class="varname">preFixupPhases</code>
        </span></dt><dd><p>
          Additional phases executed just before the fixup phase.
         </p></dd><dt><a id="var-stdenv-preDistPhases" shape="rect"></a><span class="term">
         <code class="varname">preDistPhases</code>
        </span></dt><dd><p>
          Additional phases executed just before the distribution phase.
         </p></dd><dt><a id="var-stdenv-postPhases" shape="rect"></a><span class="term">
         <code class="varname">postPhases</code>
        </span></dt><dd><p>
          Additional phases executed after any of the default phases.
         </p></dd></dl></div><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-unpack-phase" class="title">6.5.2.&nbsp;The unpack phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-unpack-phase" aria-label="Anchor link for: ssec unpack phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The unpack phase is responsible for unpacking the source code of the package. The default implementation of <code class="function">unpackPhase</code> unpacks the source files listed in the <code class="envar">src</code> environment variable to the current directory. It supports the following files by default:
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         Tar files
        </span></dt><dd><p>
          These can optionally be compressed using <span class="command"><strong>gzip</strong></span> (<code class="filename">.tar.gz</code>, <code class="filename">.tgz</code> or <code class="filename">.tar.Z</code>), <span class="command"><strong>bzip2</strong></span> (<code class="filename">.tar.bz2</code>, <code class="filename">.tbz2</code> or <code class="filename">.tbz</code>) or <span class="command"><strong>xz</strong></span> (<code class="filename">.tar.xz</code>, <code class="filename">.tar.lzma</code> or <code class="filename">.txz</code>).
         </p></dd><dt><span class="term">
         Zip files
        </span></dt><dd><p>
          Zip files are unpacked using <span class="command"><strong>unzip</strong></span>. However, <span class="command"><strong>unzip</strong></span> is not in the standard environment, so you should add it to <code class="varname">nativeBuildInputs</code> yourself.
         </p></dd><dt><span class="term">
         Directories in the Nix store
        </span></dt><dd><p>
          These are simply copied to the current directory. The hash part of the file name is stripped, e.g. <code class="filename">/nix/store/1wydxgby13cz...-my-sources</code> would be copied to <code class="filename">my-sources</code>.
         </p></dd></dl></div><p>
      Additional file types can be supported by setting the <code class="varname">unpackCmd</code> variable (see below).
     </p><p></p><div class="variablelist"><p class="title"><strong>Variables controlling the unpack phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-src" shape="rect"></a><span class="term">
        <code class="varname">srcs</code> / <code class="varname">src</code>
       </span></dt><dd><p>
         The list of source files or directories to be unpacked or copied. One of these must be set.
        </p></dd><dt><a id="var-stdenv-sourceRoot" shape="rect"></a><span class="term">
        <code class="varname">sourceRoot</code>
       </span></dt><dd><p>
         After running <code class="function">unpackPhase</code>, the generic builder changes the current directory to the directory created by unpacking the sources. If there are multiple source directories, you should set <code class="varname">sourceRoot</code> to the name of the intended directory.
        </p></dd><dt><a id="var-stdenv-setSourceRoot" shape="rect"></a><span class="term">
        <code class="varname">setSourceRoot</code>
       </span></dt><dd><p>
         Alternatively to setting <code class="varname">sourceRoot</code>, you can set <code class="varname">setSourceRoot</code> to a shell command to be evaluated by the unpack phase after the sources have been unpacked. This command must set <code class="varname">sourceRoot</code>.
        </p></dd><dt><a id="var-stdenv-preUnpack" shape="rect"></a><span class="term">
        <code class="varname">preUnpack</code>
       </span></dt><dd><p>
         Hook executed at the start of the unpack phase.
        </p></dd><dt><a id="var-stdenv-postUnpack" shape="rect"></a><span class="term">
        <code class="varname">postUnpack</code>
       </span></dt><dd><p>
         Hook executed at the end of the unpack phase.
        </p></dd><dt><a id="var-stdenv-dontUnpack" shape="rect"></a><span class="term">
        <code class="varname">dontUnpack</code>
       </span></dt><dd><p>
         Set to true to skip the unpack phase.
        </p></dd><dt><a id="var-stdenv-dontMakeSourcesWritable" shape="rect"></a><span class="term">
        <code class="varname">dontMakeSourcesWritable</code>
       </span></dt><dd><p>
         If set to <code class="literal">1</code>, the unpacked sources are <span class="emphasis"><em>not</em></span> made writable. By default, they are made writable to prevent problems with read-only sources. For example, copied store directories would be read-only without this.
        </p></dd><dt><a id="var-stdenv-unpackCmd" shape="rect"></a><span class="term">
        <code class="varname">unpackCmd</code>
       </span></dt><dd><p>
         The unpack phase evaluates the string <code class="literal">$unpackCmd</code> for any unrecognised file. The path to the current source file is contained in the <code class="varname">curSrc</code> variable.
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-patch-phase" class="title">6.5.3.&nbsp;The patch phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-patch-phase" aria-label="Anchor link for: ssec patch phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The patch phase applies the list of patches defined in the <code class="varname">patches</code> variable.
     </p><div class="variablelist"><p class="title"><strong>Variables controlling the patch phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-dontPatch" shape="rect"></a><span class="term">
        <code class="varname">dontPatch</code>
       </span></dt><dd><p>
         Set to true to skip the patch phase.
        </p></dd><dt><a id="var-stdenv-patches" shape="rect"></a><span class="term">
        <code class="varname">patches</code>
       </span></dt><dd><p>
         The list of patches. They must be in the format accepted by the <span class="command"><strong>patch</strong></span> command, and may optionally be compressed using <span class="command"><strong>gzip</strong></span> (<code class="filename">.gz</code>), <span class="command"><strong>bzip2</strong></span> (<code class="filename">.bz2</code>) or <span class="command"><strong>xz</strong></span> (<code class="filename">.xz</code>).
        </p></dd><dt><a id="var-stdenv-patchFlags" shape="rect"></a><span class="term">
        <code class="varname">patchFlags</code>
       </span></dt><dd><p>
         Flags to be passed to <span class="command"><strong>patch</strong></span>. If not set, the argument <code class="option">-p1</code> is used, which causes the leading directory component to be stripped from the file names in each patch.
        </p></dd><dt><a id="var-stdenv-prePatch" shape="rect"></a><span class="term">
        <code class="varname">prePatch</code>
       </span></dt><dd><p>
         Hook executed at the start of the patch phase.
        </p></dd><dt><a id="var-stdenv-postPatch" shape="rect"></a><span class="term">
        <code class="varname">postPatch</code>
       </span></dt><dd><p>
         Hook executed at the end of the patch phase.
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-configure-phase" class="title">6.5.4.&nbsp;The configure phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-configure-phase" aria-label="Anchor link for: ssec configure phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The configure phase prepares the source tree for building. The default <code class="function">configurePhase</code> runs <code class="filename">./configure</code> (typically an Autoconf-generated script) if it exists.
     </p><div class="variablelist"><p class="title"><strong>Variables controlling the configure phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-configureScript" shape="rect"></a><span class="term">
        <code class="varname">configureScript</code>
       </span></dt><dd><p>
         The name of the configure script. It defaults to <code class="filename">./configure</code> if it exists; otherwise, the configure phase is skipped. This can actually be a command (like <code class="literal">perl ./Configure.pl</code>).
        </p></dd><dt><a id="var-stdenv-configureFlags" shape="rect"></a><span class="term">
        <code class="varname">configureFlags</code>
       </span></dt><dd><p>
         A list of strings passed as additional arguments to the configure script.
        </p></dd><dt><a id="var-stdenv-dontConfigure" shape="rect"></a><span class="term">
        <code class="varname">dontConfigure</code>
       </span></dt><dd><p>
         Set to true to skip the configure phase.
        </p></dd><dt><a id="var-stdenv-configureFlagsArray" shape="rect"></a><span class="term">
        <code class="varname">configureFlagsArray</code>
       </span></dt><dd><p>
         A shell array containing additional arguments passed to the configure script. You must use this instead of <code class="varname">configureFlags</code> if the arguments contain spaces.
        </p></dd><dt><a id="var-stdenv-dontAddPrefix" shape="rect"></a><span class="term">
        <code class="varname">dontAddPrefix</code>
       </span></dt><dd><p>
         By default, the flag <code class="literal">--prefix=$prefix</code> is added to the configure flags. If this is undesirable, set this variable to true.
        </p></dd><dt><a id="var-stdenv-prefix" shape="rect"></a><span class="term">
        <code class="varname">prefix</code>
       </span></dt><dd><p>
         The prefix under which the package must be installed, passed via the <code class="option">--prefix</code> option to the configure script. It defaults to <code class="option">$out</code>.
        </p></dd><dt><a id="var-stdenv-prefixKey" shape="rect"></a><span class="term">
        <code class="varname">prefixKey</code>
       </span></dt><dd><p>
         The key to use when specifying the prefix. By default, this is set to <code class="option">--prefix=</code> as that is used by the majority of packages.
        </p></dd><dt><a id="var-stdenv-dontAddDisableDepTrack" shape="rect"></a><span class="term">
        <code class="varname">dontAddDisableDepTrack</code>
       </span></dt><dd><p>
         By default, the flag <code class="literal">--disable-dependency-tracking</code> is added to the configure flags to speed up Automake-based builds. If this is undesirable, set this variable to true.
        </p></dd><dt><a id="var-stdenv-dontFixLibtool" shape="rect"></a><span class="term">
        <code class="varname">dontFixLibtool</code>
       </span></dt><dd><p>
         By default, the configure phase applies some special hackery to all files called <code class="filename">ltmain.sh</code> before running the configure script in order to improve the purity of Libtool-based packages
         <a href="https://nixos.org/manual/nixpkgs/stable/#ftn.footnote-stdenv-sys-lib-search-path" class="footnote" id="footnote-stdenv-sys-lib-search-path" shape="rect"><sup class="footnote">[4]</sup></a>
         . If this is undesirable, set this variable to true.
        </p></dd><dt><a id="var-stdenv-dontDisableStatic" shape="rect"></a><span class="term">
        <code class="varname">dontDisableStatic</code>
       </span></dt><dd><p>
         By default, when the configure script has <code class="option">--enable-static</code>, the option <code class="option">--disable-static</code> is added to the configure flags.
        </p><p>
         If this is undesirable, set this variable to true.
        </p></dd><dt><a id="var-stdenv-configurePlatforms" shape="rect"></a><span class="term">
        <code class="varname">configurePlatforms</code>
       </span></dt><dd><p>
         By default, when cross compiling, the configure script has <code class="option">--build=...</code> and <code class="option">--host=...</code> passed. Packages can instead pass <code class="literal">[ "build" "host" "target" ]</code> or a subset to control exactly which platform flags are passed. Compilers and other tools can use this to also pass the target platform.
         <a href="https://nixos.org/manual/nixpkgs/stable/#ftn.footnote-stdenv-build-time-guessing-impurity" class="footnote" id="footnote-stdenv-build-time-guessing-impurity" shape="rect"><sup class="footnote">[5]</sup></a>
        </p></dd><dt><a id="var-stdenv-preConfigure" shape="rect"></a><span class="term">
        <code class="varname">preConfigure</code>
       </span></dt><dd><p>
         Hook executed at the start of the configure phase.
        </p></dd><dt><a id="var-stdenv-postConfigure" shape="rect"></a><span class="term">
        <code class="varname">postConfigure</code>
       </span></dt><dd><p>
         Hook executed at the end of the configure phase.
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="build-phase" class="title">6.5.5.&nbsp;The build phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#build-phase" aria-label="Anchor link for: build phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The build phase is responsible for actually building the package (e.g. compiling it). The default <code class="function">buildPhase</code> simply calls <span class="command"><strong>make</strong></span> if a file named <code class="filename">Makefile</code>, <code class="filename">makefile</code> or <code class="filename">GNUmakefile</code> exists in the current directory (or the <code class="varname">makefile</code> is explicitly set); otherwise it does nothing.
     </p><div class="variablelist"><p class="title"><strong>Variables controlling the build phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-dontBuild" shape="rect"></a><span class="term">
        <code class="varname">dontBuild</code>
       </span></dt><dd><p>
         Set to true to skip the build phase.
        </p></dd><dt><a id="var-stdenv-makefile" shape="rect"></a><span class="term">
        <code class="varname">makefile</code>
       </span></dt><dd><p>
         The file name of the Makefile.
        </p></dd><dt><a id="var-stdenv-makeFlags" shape="rect"></a><span class="term">
        <code class="varname">makeFlags</code>
       </span></dt><dd><p>
         A list of strings passed as additional flags to <span class="command"><strong>make</strong></span>. These flags are also used by the default install and check phase. For setting make flags specific to the build phase, use <code class="varname">buildFlags</code> (see below).
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">makeFlags</span></span> = [ <span class="hljs-string"><span class="hljs-string">"PREFIX=$(out)"</span></span> ];
</pre><p>
         </p><div class="alert alert-info"><strong>Note:</strong> 
           The flags are quoted in bash, but environment variables can be specified by using the make syntax.
          </div><p>
        </p></dd><dt><a id="var-stdenv-makeFlagsArray" shape="rect"></a><span class="term">
        <code class="varname">makeFlagsArray</code>
       </span></dt><dd><p>
         A shell array containing additional arguments passed to <span class="command"><strong>make</strong></span>. You must use this instead of <code class="varname">makeFlags</code> if the arguments contain spaces, e.g.
</p><pre class="programlisting hljs bash" xml:space="preserve">preBuild = <span class="hljs-string"><span class="hljs-string">''</span></span>
  makeFlagsArray+=(CFLAGS=<span class="hljs-string"><span class="hljs-string">"-O0 -g"</span></span> LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-lfoo -lbar"</span></span>)
<span class="hljs-string"><span class="hljs-string">''</span></span>;
</pre><p>
         Note that shell arrays cannot be passed through environment variables, so you cannot set <code class="varname">makeFlagsArray</code> in a derivation attribute (because those are passed through environment variables): you have to define them in shell code.
        </p></dd><dt><a id="var-stdenv-buildFlags" shape="rect"></a><span class="term">
        <code class="varname">buildFlags</code> / <code class="varname">buildFlagsArray</code>
       </span></dt><dd><p>
         A list of strings passed as additional flags to <span class="command"><strong>make</strong></span>. Like <code class="varname">makeFlags</code> and <code class="varname">makeFlagsArray</code>, but only used by the build phase.
        </p></dd><dt><a id="var-stdenv-preBuild" shape="rect"></a><span class="term">
        <code class="varname">preBuild</code>
       </span></dt><dd><p>
         Hook executed at the start of the build phase.
        </p></dd><dt><a id="var-stdenv-postBuild" shape="rect"></a><span class="term">
        <code class="varname">postBuild</code>
       </span></dt><dd><p>
         Hook executed at the end of the build phase.
        </p></dd></dl></div><p>
      You can set flags for <span class="command"><strong>make</strong></span> through the <code class="varname">makeFlags</code> variable.
     </p><p>
      Before and after running <span class="command"><strong>make</strong></span>, the hooks <code class="varname">preBuild</code> and <code class="varname">postBuild</code> are called, respectively.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-check-phase" class="title">6.5.6.&nbsp;The check phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-check-phase" aria-label="Anchor link for: ssec check phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The check phase checks whether the package was built correctly by running its test suite. The default <code class="function">checkPhase</code> calls <span class="command"><strong>make check</strong></span>, but only if the <code class="varname">doCheck</code> variable is enabled.
     </p><div class="variablelist"><p class="title"><strong>Variables controlling the check phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-doCheck" shape="rect"></a><span class="term">
        <code class="varname">doCheck</code>
       </span></dt><dd><p>
         Controls whether the check phase is executed. By default it is skipped, but if <code class="varname">doCheck</code> is set to true, the check phase is usually executed. Thus you should set
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">doCheck</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</pre><p>
         in the derivation to enable checks. The exception is cross compilation. Cross compiled builds never run tests, no matter how <code class="varname">doCheck</code> is set, as the newly-built program won't run on the platform used to build it.
        </p></dd><dt><span class="term">
        <code class="varname">makeFlags</code> / <code class="varname">makeFlagsArray</code> / <code class="varname">makefile</code>
       </span></dt><dd><p>
         See the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-makeFlags" shape="rect">build phase</a> for details.
        </p></dd><dt><a id="var-stdenv-checkTarget" shape="rect"></a><span class="term">
        <code class="varname">checkTarget</code>
       </span></dt><dd><p>
         The make target that runs the tests. Defaults to <code class="literal">check</code>.
        </p></dd><dt><a id="var-stdenv-checkFlags" shape="rect"></a><span class="term">
        <code class="varname">checkFlags</code> / <code class="varname">checkFlagsArray</code>
       </span></dt><dd><p>
         A list of strings passed as additional flags to <span class="command"><strong>make</strong></span>. Like <code class="varname">makeFlags</code> and <code class="varname">makeFlagsArray</code>, but only used by the check phase.
        </p></dd><dt><a id="var-stdenv-checkInputs" shape="rect"></a><span class="term">
        <code class="varname">checkInputs</code>
       </span></dt><dd><p>
         A list of dependencies used by the phase. This gets included in <code class="varname">nativeBuildInputs</code> when <code class="varname">doCheck</code> is set.
        </p></dd><dt><a id="var-stdenv-preCheck" shape="rect"></a><span class="term">
        <code class="varname">preCheck</code>
       </span></dt><dd><p>
         Hook executed at the start of the check phase.
        </p></dd><dt><a id="var-stdenv-postCheck" shape="rect"></a><span class="term">
        <code class="varname">postCheck</code>
       </span></dt><dd><p>
         Hook executed at the end of the check phase.
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-install-phase" class="title">6.5.7.&nbsp;The install phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-install-phase" aria-label="Anchor link for: ssec install phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The install phase is responsible for installing the package in the Nix store under <code class="envar">out</code>. The default <code class="function">installPhase</code> creates the directory <code class="literal">$out</code> and calls <span class="command"><strong>make install</strong></span>.
     </p><div class="variablelist"><p class="title"><strong>Variables controlling the install phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-dontInstall" shape="rect"></a><span class="term">
        <code class="varname">dontInstall</code>
       </span></dt><dd><p>
         Set to true to skip the install phase.
        </p></dd><dt><span class="term">
        <code class="varname">makeFlags</code> / <code class="varname">makeFlagsArray</code> / <code class="varname">makefile</code>
       </span></dt><dd><p>
         See the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-stdenv-makeFlags" shape="rect">build phase</a> for details.
        </p></dd><dt><a id="var-stdenv-installTargets" shape="rect"></a><span class="term">
        <code class="varname">installTargets</code>
       </span></dt><dd><p>
         The make targets that perform the installation. Defaults to <code class="literal">install</code>. Example:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">installTargets</span></span> = <span class="hljs-string"><span class="hljs-string">"install-bin install-doc"</span></span>;</pre><p>
        </p></dd><dt><a id="var-stdenv-installFlags" shape="rect"></a><span class="term">
        <code class="varname">installFlags</code> / <code class="varname">installFlagsArray</code>
       </span></dt><dd><p>
         A list of strings passed as additional flags to <span class="command"><strong>make</strong></span>. Like <code class="varname">makeFlags</code> and <code class="varname">makeFlagsArray</code>, but only used by the install phase.
        </p></dd><dt><a id="var-stdenv-preInstall" shape="rect"></a><span class="term">
        <code class="varname">preInstall</code>
       </span></dt><dd><p>
         Hook executed at the start of the install phase.
        </p></dd><dt><a id="var-stdenv-postInstall" shape="rect"></a><span class="term">
        <code class="varname">postInstall</code>
       </span></dt><dd><p>
         Hook executed at the end of the install phase.
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-fixup-phase" class="title">6.5.8.&nbsp;The fixup phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-fixup-phase" aria-label="Anchor link for: ssec fixup phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The fixup phase performs some (Nix-specific) post-processing actions on the files installed under <code class="filename">$out</code> by the install phase. The default <code class="function">fixupPhase</code> does the following:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         It moves the <code class="filename">man/</code>, <code class="filename">doc/</code> and <code class="filename">info/</code> subdirectories of <code class="envar">$out</code> to <code class="filename">share/</code>.
        </p></li><li class="listitem"><p>
         It strips libraries and executables of debug information.
        </p></li><li class="listitem"><p>
         On Linux, it applies the <span class="command"><strong>patchelf</strong></span> command to ELF executables and libraries to remove unused directories from the <code class="literal">RPATH</code> in order to prevent unnecessary runtime dependencies.
        </p></li><li class="listitem"><p>
         It rewrites the interpreter paths of shell scripts to paths found in <code class="envar">PATH</code>. E.g., <code class="filename">/usr/bin/perl</code> will be rewritten to <code class="filename">/nix/store/<em class="replaceable"><code>some-perl</code></em>/bin/perl</code> found in <code class="envar">PATH</code>.
        </p></li></ul></div><p>
     </p><div class="variablelist"><p class="title"><strong>Variables controlling the fixup phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-dontFixup" shape="rect"></a><span class="term">
        <code class="varname">dontFixup</code>
       </span></dt><dd><p>
         Set to true to skip the fixup phase.
        </p></dd><dt><a id="var-stdenv-dontStrip" shape="rect"></a><span class="term">
        <code class="varname">dontStrip</code>
       </span></dt><dd><p>
         If set, libraries and executables are not stripped. By default, they are.
        </p></dd><dt><a id="var-stdenv-dontStripHost" shape="rect"></a><span class="term">
        <code class="varname">dontStripHost</code>
       </span></dt><dd><p>
         Like <code class="varname">dontStrip</code>, but only affects the <span class="command"><strong>strip</strong></span> command targetting the package's host platform. Useful when supporting cross compilation, but otherwise feel free to ignore.
        </p></dd><dt><a id="var-stdenv-dontStripTarget" shape="rect"></a><span class="term">
        <code class="varname">dontStripTarget</code>
       </span></dt><dd><p>
         Like <code class="varname">dontStrip</code>, but only affects the <span class="command"><strong>strip</strong></span> command targetting the packages' target platform. Useful when supporting cross compilation, but otherwise feel free to ignore.
        </p></dd><dt><a id="var-stdenv-dontMoveSbin" shape="rect"></a><span class="term">
        <code class="varname">dontMoveSbin</code>
       </span></dt><dd><p>
         If set, files in <code class="filename">$out/sbin</code> are not moved to <code class="filename">$out/bin</code>. By default, they are.
        </p></dd><dt><a id="var-stdenv-stripAllList" shape="rect"></a><span class="term">
        <code class="varname">stripAllList</code>
       </span></dt><dd><p>
         List of directories to search for libraries and executables from which <span class="emphasis"><em>all</em></span> symbols should be stripped. By default, it’s empty. Stripping all symbols is risky, since it may remove not just debug symbols but also ELF information necessary for normal execution.
        </p></dd><dt><a id="var-stdenv-stripAllFlags" shape="rect"></a><span class="term">
        <code class="varname">stripAllFlags</code>
       </span></dt><dd><p>
         Flags passed to the <span class="command"><strong>strip</strong></span> command applied to the files in the directories listed in <code class="varname">stripAllList</code>. Defaults to <code class="option">-s</code> (i.e. <code class="option">--strip-all</code>).
        </p></dd><dt><a id="var-stdenv-stripDebugList" shape="rect"></a><span class="term">
        <code class="varname">stripDebugList</code>
       </span></dt><dd><p>
         List of directories to search for libraries and executables from which only debugging-related symbols should be stripped. It defaults to <code class="literal">lib lib32 lib64 libexec bin sbin</code>.
        </p></dd><dt><a id="var-stdenv-stripDebugFlags" shape="rect"></a><span class="term">
        <code class="varname">stripDebugFlags</code>
       </span></dt><dd><p>
         Flags passed to the <span class="command"><strong>strip</strong></span> command applied to the files in the directories listed in <code class="varname">stripDebugList</code>. Defaults to <code class="option">-S</code> (i.e. <code class="option">--strip-debug</code>).
        </p></dd><dt><a id="var-stdenv-dontPatchELF" shape="rect"></a><span class="term">
        <code class="varname">dontPatchELF</code>
       </span></dt><dd><p>
         If set, the <span class="command"><strong>patchelf</strong></span> command is not used to remove unnecessary <code class="literal">RPATH</code> entries. Only applies to Linux.
        </p></dd><dt><a id="var-stdenv-dontPatchShebangs" shape="rect"></a><span class="term">
        <code class="varname">dontPatchShebangs</code>
       </span></dt><dd><p>
         If set, scripts starting with <code class="literal">#!</code> do not have their interpreter paths rewritten to paths in the Nix store.
        </p></dd><dt><a id="var-stdenv-dontPruneLibtoolFiles" shape="rect"></a><span class="term">
        <code class="varname">dontPruneLibtoolFiles</code>
       </span></dt><dd><p>
         If set, libtool <code class="literal">.la</code> files associated with shared libraries won't have their <code class="literal">dependency_libs</code> field cleared.
        </p></dd><dt><a id="var-stdenv-forceShare" shape="rect"></a><span class="term">
        <code class="varname">forceShare</code>
       </span></dt><dd><p>
         The list of directories that must be moved from <code class="filename">$out</code> to <code class="filename">$out/share</code>. Defaults to <code class="literal">man doc info</code>.
        </p></dd><dt><a id="var-stdenv-setupHook" shape="rect"></a><span class="term">
        <code class="varname">setupHook</code>
       </span></dt><dd><p>
         A package can export a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" title="6.7. Package setup hooks" shape="rect">setup hook</a> by setting this variable. The setup hook, if defined, is copied to <code class="filename">$out/nix-support/setup-hook</code>. Environment variables are then substituted in it using <code class="function"><a class="function" href="https://nixos.org/manual/nixpkgs/stable/#fun-substituteAll" shape="rect">substituteAll</a></code>.
        </p></dd><dt><a id="var-stdenv-preFixup" shape="rect"></a><span class="term">
        <code class="varname">preFixup</code>
       </span></dt><dd><p>
         Hook executed at the start of the fixup phase.
        </p></dd><dt><a id="var-stdenv-postFixup" shape="rect"></a><span class="term">
        <code class="varname">postFixup</code>
       </span></dt><dd><p>
         Hook executed at the end of the fixup phase.
        </p></dd><dt><a id="stdenv-separateDebugInfo" shape="rect"></a><span class="term">
        <code class="varname">separateDebugInfo</code>
       </span></dt><dd><p>
         If set to <code class="literal">true</code>, the standard environment will enable debug information in C/C++ builds. After installation, the debug information will be separated from the executables and stored in the output named <code class="literal">debug</code>. (This output is enabled automatically; you don’t need to set the <code class="varname">outputs</code> attribute explicitly.) To be precise, the debug information is stored in <code class="filename"><em class="replaceable"><code>debug</code></em>/lib/debug/.build-id/<em class="replaceable"><code>XX</code></em>/<em class="replaceable"><code>YYYY…</code></em></code>, where <em class="replaceable"><code>XXYYYY…</code></em> is the <em class="replaceable"><code>build ID</code></em> of the binary — a SHA-1 hash of the contents of the binary. Debuggers like GDB use the build ID to look up the separated debug information.
        </p><p>
         For example, with GDB, you can add
</p><pre class="programlisting hljs bash" xml:space="preserve"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> debug-file-directory ~/.nix-profile/lib/debug
</pre><p>
         to <code class="filename">~/.gdbinit</code>. GDB will then be able to find debug information installed via <code class="literal">nix-env -i</code>.
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-installCheck-phase" class="title">6.5.9.&nbsp;The installCheck phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-installCheck-phase" aria-label="Anchor link for: ssec installCheck phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The installCheck phase checks whether the package was installed correctly by running its test suite against the installed directories. The default <code class="function">installCheck</code> calls <span class="command"><strong>make installcheck</strong></span>.
     </p><div class="variablelist"><p class="title"><strong>Variables controlling the installCheck phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-doInstallCheck" shape="rect"></a><span class="term">
        <code class="varname">doInstallCheck</code>
       </span></dt><dd><p>
         Controls whether the installCheck phase is executed. By default it is skipped, but if <code class="varname">doInstallCheck</code> is set to true, the installCheck phase is usually executed. Thus you should set
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">doInstallCheck</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</pre><p>
         in the derivation to enable install checks. The exception is cross compilation. Cross compiled builds never run tests, no matter how <code class="varname">doInstallCheck</code> is set, as the newly-built program won't run on the platform used to build it.
        </p></dd><dt><a id="var-stdenv-installCheckTarget" shape="rect"></a><span class="term">
        <code class="varname">installCheckTarget</code>
       </span></dt><dd><p>
         The make target that runs the install tests. Defaults to <code class="literal">installcheck</code>.
        </p></dd><dt><a id="var-stdenv-installCheckFlags" shape="rect"></a><span class="term">
        <code class="varname">installCheckFlags</code> / <code class="varname">installCheckFlagsArray</code>
       </span></dt><dd><p>
         A list of strings passed as additional flags to <span class="command"><strong>make</strong></span>. Like <code class="varname">makeFlags</code> and <code class="varname">makeFlagsArray</code>, but only used by the installCheck phase.
        </p></dd><dt><a id="var-stdenv-installCheckInputs" shape="rect"></a><span class="term">
        <code class="varname">installCheckInputs</code>
       </span></dt><dd><p>
         A list of dependencies used by the phase. This gets included in <code class="varname">nativeBuildInputs</code> when <code class="varname">doInstallCheck</code> is set.
        </p></dd><dt><a id="var-stdenv-preInstallCheck" shape="rect"></a><span class="term">
        <code class="varname">preInstallCheck</code>
       </span></dt><dd><p>
         Hook executed at the start of the installCheck phase.
        </p></dd><dt><a id="var-stdenv-postInstallCheck" shape="rect"></a><span class="term">
        <code class="varname">postInstallCheck</code>
       </span></dt><dd><p>
         Hook executed at the end of the installCheck phase.
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-distribution-phase" class="title">6.5.10.&nbsp;The distribution phase<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-distribution-phase" aria-label="Anchor link for: ssec distribution phase" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The distribution phase is intended to produce a source distribution of the package. The default <code class="function">distPhase</code> first calls <span class="command"><strong>make dist</strong></span>, then it copies the resulting source tarballs to <code class="filename">$out/tarballs/</code>. This phase is only executed if the attribute <code class="varname">doDist</code> is set.
     </p><div class="variablelist"><p class="title"><strong>Variables controlling the distribution phase</strong></p><dl class="variablelist"><dt><a id="var-stdenv-distTarget" shape="rect"></a><span class="term">
        <code class="varname">distTarget</code>
       </span></dt><dd><p>
         The make target that produces the distribution. Defaults to <code class="literal">dist</code>.
        </p></dd><dt><a id="var-stdenv-distFlags" shape="rect"></a><span class="term">
        <code class="varname">distFlags</code> / <code class="varname">distFlagsArray</code>
       </span></dt><dd><p>
         Additional flags passed to <span class="command"><strong>make</strong></span>.
        </p></dd><dt><a id="var-stdenv-tarballs" shape="rect"></a><span class="term">
        <code class="varname">tarballs</code>
       </span></dt><dd><p>
         The names of the source distribution files to be copied to <code class="filename">$out/tarballs/</code>. It can contain shell wildcards. The default is <code class="filename">*.tar.gz</code>.
        </p></dd><dt><a id="var-stdenv-dontCopyDist" shape="rect"></a><span class="term">
        <code class="varname">dontCopyDist</code>
       </span></dt><dd><p>
         If set, no files are copied to <code class="filename">$out/tarballs/</code>.
        </p></dd><dt><a id="var-stdenv-preDist" shape="rect"></a><span class="term">
        <code class="varname">preDist</code>
       </span></dt><dd><p>
         Hook executed at the start of the distribution phase.
        </p></dd><dt><a id="var-stdenv-postDist" shape="rect"></a><span class="term">
        <code class="varname">postDist</code>
       </span></dt><dd><p>
         Hook executed at the end of the distribution phase.
        </p></dd></dl></div></section></section><section class="section"><div class="titlepage"><div><div><h2 id="ssec-stdenv-functions" class="title" style="clear: both">6.6.&nbsp;Shell functions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-functions" aria-label="Anchor link for: ssec stdenv functions" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The standard environment provides a number of useful functions.
    </p><div class="variablelist"><dl class="variablelist"><dt><a id="fun-makeWrapper" shape="rect"></a><span class="term">
       <code class="function">makeWrapper</code> <em class="replaceable"><code>executable</code></em> <em class="replaceable"><code>wrapperfile</code></em> <em class="replaceable"><code>args</code></em>
      </span></dt><dd><p>
        Constructs a wrapper for a program with various possible arguments. For example:
</p><pre class="programlisting hljs bash" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment"># adds `FOOBAR=baz` to `$out/bin/foo`’s environment</span></span>
makeWrapper <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin/foo <span class="hljs-variable"><span class="hljs-variable">$wrapperfile</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> FOOBAR baz

<span class="hljs-comment"><span class="hljs-comment"># prefixes the binary paths of `hello` and `git`</span></span>
<span class="hljs-comment"><span class="hljs-comment"># Be advised that paths often should be patched in directly</span></span>
<span class="hljs-comment"><span class="hljs-comment"># (via string replacements or in `configurePhase`).</span></span>
makeWrapper <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin/foo <span class="hljs-variable"><span class="hljs-variable">$wrapperfile</span></span> --prefix PATH : <span class="hljs-variable"><span class="hljs-variable">${lib.makeBinPath [ hello git ]}</span></span>
</pre><p>
        There’s many more kinds of arguments, they are documented in <code class="literal">nixpkgs/pkgs/build-support/setup-hooks/make-wrapper.sh</code>.
       </p><p>
        <code class="literal">wrapProgram</code> is a convenience function you probably want to use most of the time.
       </p></dd><dt><a id="fun-substitute" shape="rect"></a><span class="term">
       <code class="function">substitute</code> <em class="replaceable"><code>infile</code></em> <em class="replaceable"><code>outfile</code></em> <em class="replaceable"><code>subs</code></em>
      </span></dt><dd><p>
        Performs string substitution on the contents of <em class="replaceable"><code>infile</code></em>, writing the result to <em class="replaceable"><code>outfile</code></em>. The substitutions in <em class="replaceable"><code>subs</code></em> are of the following form:
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="option">--replace</code> <em class="replaceable"><code>s1</code></em> <em class="replaceable"><code>s2</code></em>
          </span></dt><dd><p>
            Replace every occurrence of the string <em class="replaceable"><code>s1</code></em> by <em class="replaceable"><code>s2</code></em>.
           </p></dd><dt><span class="term">
           <code class="option">--subst-var</code> <em class="replaceable"><code>varName</code></em>
          </span></dt><dd><p>
            Replace every occurrence of <code class="literal">@<em class="replaceable"><code>varName</code></em>@</code> by the contents of the environment variable <em class="replaceable"><code>varName</code></em>. This is useful for generating files from templates, using <code class="literal">@<em class="replaceable"><code>...</code></em>@</code> in the template as placeholders.
           </p></dd><dt><span class="term">
           <code class="option">--subst-var-by</code> <em class="replaceable"><code>varName</code></em> <em class="replaceable"><code>s</code></em>
          </span></dt><dd><p>
            Replace every occurrence of <code class="literal">@<em class="replaceable"><code>varName</code></em>@</code> by the string <em class="replaceable"><code>s</code></em>.
           </p></dd></dl></div><p>
       </p><p>
        Example:
</p><pre class="programlisting hljs nix" xml:space="preserve">substitute ./foo.<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ./foo.out \
    --replace /usr/bin/bar $bar/bin/bar \
    --replace <span class="hljs-string"><span class="hljs-string">"a string containing spaces"</span></span> <span class="hljs-string"><span class="hljs-string">"some other text"</span></span> \
    --subst-var someVar
</pre><p>
       </p><p>
        <code class="function">substitute</code> is implemented using the <span class="command"><strong><a class="command" href="http://replace.richardlloyd.org.uk/" target="_top" shape="rect">replace</a></strong></span> command. Unlike with the <span class="command"><strong>sed</strong></span> command, you don’t have to worry about escaping special characters. It supports performing substitutions on binary files (such as executables), though there you’ll probably want to make sure that the replacement string is as long as the replaced string.
       </p></dd><dt><a id="fun-substituteInPlace" shape="rect"></a><span class="term">
       <code class="function">substituteInPlace</code> <em class="replaceable"><code>file</code></em> <em class="replaceable"><code>subs</code></em>
      </span></dt><dd><p>
        Like <code class="function">substitute</code>, but performs the substitutions in place on the file <em class="replaceable"><code>file</code></em>.
       </p></dd><dt><a id="fun-substituteAll" shape="rect"></a><span class="term">
       <code class="function">substituteAll</code> <em class="replaceable"><code>infile</code></em> <em class="replaceable"><code>outfile</code></em>
      </span></dt><dd><p>
        Replaces every occurrence of <code class="literal">@<em class="replaceable"><code>varName</code></em>@</code>, where <em class="replaceable"><code>varName</code></em> is any environment variable, in <em class="replaceable"><code>infile</code></em>, writing the result to <em class="replaceable"><code>outfile</code></em>. For instance, if <em class="replaceable"><code>infile</code></em> has the contents
</p><pre class="programlisting hljs bash" xml:space="preserve"><span class="hljs-meta"><span class="hljs-meta">#! @bash@/bin/sh</span></span>
PATH=@coreutils@/bin
<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> @foo@
</pre><p>
        and the environment contains <code class="literal">bash=/nix/store/bmwp0q28cf21...-bash-3.2-p39</code> and <code class="literal">coreutils=/nix/store/68afga4khv0w...-coreutils-6.12</code>, but does not contain the variable <code class="varname">foo</code>, then the output will be
</p><pre class="programlisting hljs bash" xml:space="preserve"><span class="hljs-meta"><span class="hljs-meta">#! /nix/store/bmwp0q28cf21...-bash-3.2-p39/bin/sh</span></span>
PATH=/nix/store/68afga4khv0w...-coreutils-6.12/bin
<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> @foo@
</pre><p>
        That is, no substitution is performed for undefined variables.
       </p><p>
        Environment variables that start with an uppercase letter or an underscore are filtered out, to prevent global variables (like <code class="literal">HOME</code>) or private variables (like <code class="literal">__ETC_PROFILE_DONE</code>) from accidentally getting substituted. The variables also have to be valid bash “names”, as defined in the bash manpage (alphanumeric or <code class="literal">_</code>, must not start with a number).
       </p></dd><dt><a id="fun-substituteAllInPlace" shape="rect"></a><span class="term">
       <code class="function">substituteAllInPlace</code> <em class="replaceable"><code>file</code></em>
      </span></dt><dd><p>
        Like <code class="function">substituteAll</code>, but performs the substitutions in place on the file <em class="replaceable"><code>file</code></em>.
       </p></dd><dt><a id="fun-stripHash" shape="rect"></a><span class="term">
       <code class="function">stripHash</code> <em class="replaceable"><code>path</code></em>
      </span></dt><dd><p>
        Strips the directory and hash part of a store path, outputting the name part to <code class="literal">stdout</code>. For example:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment"># prints coreutils-8.24</span></span>
stripHash <span class="hljs-string"><span class="hljs-string">"/nix/store/9s9r019176g7cvn2nvcw41gsp862y6b4-coreutils-8.24"</span></span>
</pre><p>
        If you wish to store the result in another variable, then the following idiom may be useful:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">name="/nix/store/9s9r019176g7cvn2nvcw41gsp862y6b4-coreutils-8.24"</span></span>
<span class="hljs-attr"><span class="hljs-attr">someVar=$(stripHash</span></span> $name)
</pre><p>
       </p></dd><dt><a id="fun-wrapProgram" shape="rect"></a><span class="term">
       <code class="function">wrapProgram</code> <em class="replaceable"><code>executable</code></em> <em class="replaceable"><code>makeWrapperArgs</code></em>
      </span></dt><dd><p>
        Convenience function for <code class="literal">makeWrapper</code> that automatically creates a sane wrapper file. It takes all the same arguments as <code class="literal">makeWrapper</code>, except for <code class="literal">--argv0</code>.
       </p><p>
        It cannot be applied multiple times, since it will overwrite the wrapper file.
       </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h2 id="ssec-setup-hooks" class="title" style="clear: both">6.7.&nbsp;Package setup hooks<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" aria-label="Anchor link for: ssec setup hooks" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Nix itself considers a build-time dependency as merely something that should previously be built and accessible at build time—packages themselves are on their own to perform any additional setup. In most cases, that is fine, and the downstream derivation can deal with its own dependencies. But for a few common tasks, that would result in almost every package doing the same sort of setup work—depending not on the package itself, but entirely on which dependencies were used.
    </p><p>
     In order to alleviate this burden, the <em class="firstterm">setup hook</em> mechanism was written, where any package can include a shell script that [by convention rather than enforcement by Nix], any downstream reverse-dependency will source as part of its build process. That allows the downstream dependency to merely specify its dependencies, and lets those dependencies effectively initialize themselves. No boilerplate mirroring the list of dependencies is needed.
    </p><p>
     The setup hook mechanism is a bit of a sledgehammer though: a powerful feature with a broad and indiscriminate area of effect. The combination of its power and implicit use may be expedient, but isn't without costs. Nix itself is unchanged, but the spirit of added dependencies being effect-free is violated even if the letter isn't. For example, if a derivation path is mentioned more than once, Nix itself doesn't care and simply makes sure the dependency derivation is already built just the same—depending is just needing something to exist, and needing is idempotent. However, a dependency specified twice will have its setup hook run twice, and that could easily change the build environment (though a well-written setup hook will therefore strive to be idempotent so this is in fact not observable). More broadly, setup hooks are anti-modular in that multiple dependencies, whether the same or different, should not interfere and yet their setup hooks may well do so.
    </p><p>
     The most typical use of the setup hook is actually to add other hooks which are then run (i.e. after all the setup hooks) on each dependency. For example, the C compiler wrapper's setup hook feeds itself flags for each dependency that contains relevant libraries and headers. This is done by defining a bash function, and appending its name to one of <code class="envar">envBuildBuildHooks</code>, <code class="envar">envBuildHostHooks</code>, <code class="envar">envBuildTargetHooks</code>, <code class="envar">envHostHostHooks</code>, <code class="envar">envHostTargetHooks</code>, or <code class="envar">envTargetTargetHooks</code>. These 6 bash variables correspond to the 6 sorts of dependencies by platform (there's 12 total but we ignore the propagated/non-propagated axis).
    </p><p>
     Packages adding a hook should not hard code a specific hook, but rather choose a variable <span class="emphasis"><em>relative</em></span> to how they are included. Returning to the C compiler wrapper example, if the wrapper itself is an <code class="literal">n</code> dependency, then it only wants to accumulate flags from <code class="literal">n + 1</code> dependencies, as only those ones match the compiler's target platform. The <code class="envar">hostOffset</code> variable is defined with the current dependency's host offset <code class="envar">targetOffset</code> with its target offset, before its setup hook is sourced. Additionally, since most environment hooks don't care about the target platform, that means the setup hook can append to the right bash array by doing something like
</p><pre class="programlisting hljs bash" xml:space="preserve">addEnvHooks <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$hostOffset</span></span></span><span class="hljs-string">"</span></span> myBashFunction
</pre><p>
    </p><p>
     The <span class="emphasis"><em>existence</em></span> of setups hooks has long been documented and packages inside Nixpkgs are free to use this mechanism. Other packages, however, should not rely on these mechanisms not changing between Nixpkgs versions. Because of the existing issues with this system, there's little benefit from mandating it be stable for any period of time.
    </p><p>
     First, let’s cover some setup hooks that are part of Nixpkgs default stdenv. This means that they are run for every package built using <code class="function">stdenv.mkDerivation</code>. Some of these are platform specific, so they may run on Linux but not Darwin or vice-versa.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="literal">move-docs.sh</code>
       </span></dt><dd><p>
         This setup hook moves any installed documentation to the <code class="literal">/share</code> subdirectory directory. This includes the man, doc and info directories. This is needed for legacy programs that do not know how to use the <code class="literal">share</code> subdirectory.
        </p></dd><dt><span class="term">
        <code class="literal">compress-man-pages.sh</code>
       </span></dt><dd><p>
         This setup hook compresses any man pages that have been installed. The compression is done using the gzip program. This helps to reduce the installed size of packages.
        </p></dd><dt><span class="term">
        <code class="literal">strip.sh</code>
       </span></dt><dd><p>
         This runs the strip command on installed binaries and libraries. This removes unnecessary information like debug symbols when they are not needed. This also helps to reduce the installed size of packages.
        </p></dd><dt><span class="term">
        <code class="literal">patch-shebangs.sh</code>
       </span></dt><dd><p>
         This setup hook patches installed scripts to use the full path to the shebang interpreter. A shebang interpreter is the first commented line of a script telling the operating system which program will run the script (e.g <code class="literal">#!/bin/bash</code>). In Nix, we want an exact path to that interpreter to be used. This often replaces <code class="literal">/bin/sh</code> with a path in the Nix store.
        </p></dd><dt><span class="term">
        <code class="literal">audit-tmpdir.sh</code>
       </span></dt><dd><p>
         This verifies that no references are left from the install binaries to the directory used to build those binaries. This ensures that the binaries do not need things outside the Nix store. This is currently supported in Linux only.
        </p></dd><dt><span class="term">
        <code class="literal">multiple-outputs.sh</code>
       </span></dt><dd><p>
         This setup hook adds configure flags that tell packages to install files into any one of the proper outputs listed in <code class="literal">outputs</code>. This behavior can be turned off by setting <code class="literal">setOutputFlags</code> to false in the derivation environment. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output" title="Chapter 8. Multiple-output packages" shape="rect">Chapter&nbsp;8, <em>Multiple-output packages</em></a> for more information.
        </p></dd><dt><span class="term">
        <code class="literal">move-sbin.sh</code>
       </span></dt><dd><p>
         This setup hook moves any binaries installed in the sbin subdirectory into bin. In addition, a link is provided from sbin to bin for compatibility.
        </p></dd><dt><span class="term">
        <code class="literal">move-lib64.sh</code>
       </span></dt><dd><p>
         This setup hook moves any libraries installed in the lib64 subdirectory into lib. In addition, a link is provided from lib64 to lib for compatibility.
        </p></dd><dt><span class="term">
        <code class="literal">set-source-date-epoch-to-latest.sh</code>
       </span></dt><dd><p>
         This sets <code class="literal">SOURCE_DATE_EPOCH</code> to the modification time of the most recent file.
        </p></dd><dt><span class="term">
        Bintools Wrapper
       </span></dt><dd><p>
         The Bintools Wrapper wraps the binary utilities for a bunch of miscellaneous purposes. These are GNU Binutils when targetting Linux, and a mix of cctools and GNU binutils for Darwin. [The "Bintools" name is supposed to be a compromise between "Binutils" and "cctools" not denoting any specific implementation.] Specifically, the underlying bintools package, and a C standard library (glibc or Darwin's libSystem, just for the dynamic loader) are all fed in, and dependency finding, hardening (see below), and purity checks for each are handled by the Bintools Wrapper. Packages typically depend on CC Wrapper, which in turn (at run time) depends on the Bintools Wrapper.
        </p><p>
         The Bintools Wrapper was only just recently split off from CC Wrapper, so the division of labor is still being worked out. For example, it shouldn't care about the C standard library, but just take a derivation with the dynamic loader (which happens to be the glibc on linux). Dependency finding however is a task both wrappers will continue to need to share, and probably the most important to understand. It is currently accomplished by collecting directories of host-platform dependencies (i.e. <code class="varname">buildInputs</code> and <code class="varname">nativeBuildInputs</code>) in environment variables. The Bintools Wrapper's setup hook causes any <code class="filename">lib</code> and <code class="filename">lib64</code> subdirectories to be added to <code class="envar">NIX_LDFLAGS</code>. Since the CC Wrapper and the Bintools Wrapper use the same strategy, most of the Bintools Wrapper code is sparsely commented and refers to the CC Wrapper. But the CC Wrapper's code, by contrast, has quite lengthy comments. The Bintools Wrapper merely cites those, rather than repeating them, to avoid falling out of sync.
        </p><p>
         A final task of the setup hook is defining a number of standard environment variables to tell build systems which executables fulfill which purpose. They are defined to just be the base name of the tools, under the assumption that the Bintools Wrapper's binaries will be on the path. Firstly, this helps poorly-written packages, e.g. ones that look for just <span class="command"><strong>gcc</strong></span> when <code class="envar">CC</code> isn't defined yet <span class="command"><strong>clang</strong></span> is to be used. Secondly, this helps packages not get confused when cross-compiling, in which case multiple Bintools Wrappers may simultaneously be in use.
         <a href="https://nixos.org/manual/nixpkgs/stable/#ftn.footnote-stdenv-per-platform-wrapper" class="footnote" id="footnote-stdenv-per-platform-wrapper" shape="rect"><sup class="footnote">[6]</sup></a>
         <code class="envar">BUILD_</code>- and <code class="envar">TARGET_</code>-prefixed versions of the normal environment variable are defined for additional Bintools Wrappers, properly disambiguating them.
        </p><p>
         A problem with this final task is that the Bintools Wrapper is honest and defines <code class="envar">LD</code> as <span class="command"><strong>ld</strong></span>. Most packages, however, firstly use the C compiler for linking, secondly use <code class="envar">LD</code> anyways, defining it as the C compiler, and thirdly, only so define <code class="envar">LD</code> when it is undefined as a fallback. This triple-threat means Bintools Wrapper will break those packages, as LD is already defined as the actual linker which the package won't override yet doesn't want to use. The workaround is to define, just for the problematic package, <code class="envar">LD</code> as the C compiler. A good way to do this would be <span class="command"><strong>preConfigure = "LD=$CC"</strong></span>.
        </p></dd><dt><span class="term">
        CC Wrapper
       </span></dt><dd><p>
         The CC Wrapper wraps a C toolchain for a bunch of miscellaneous purposes. Specifically, a C compiler (GCC or Clang), wrapped binary tools, and a C standard library (glibc or Darwin's libSystem, just for the dynamic loader) are all fed in, and dependency finding, hardening (see below), and purity checks for each are handled by the CC Wrapper. Packages typically depend on the CC Wrapper, which in turn (at run-time) depends on the Bintools Wrapper.
        </p><p>
         Dependency finding is undoubtedly the main task of the CC Wrapper. This works just like the Bintools Wrapper, except that any <code class="filename">include</code> subdirectory of any relevant dependency is added to <code class="envar">NIX_CFLAGS_COMPILE</code>. The setup hook itself contains some lengthy comments describing the exact convoluted mechanism by which this is accomplished.
        </p><p>
         Similarly, the CC Wrapper follows the Bintools Wrapper in defining standard environment variables with the names of the tools it wraps, for the same reasons described above. Importantly, while it includes a <span class="command"><strong>cc</strong></span> symlink to the c compiler for portability, the <code class="envar">CC</code> will be defined using the compiler's "real name" (i.e. <span class="command"><strong>gcc</strong></span> or <span class="command"><strong>clang</strong></span>). This helps lousy build systems that inspect on the name of the compiler rather than run it.
        </p></dd></dl></div><p>
    </p><p>
     Here are some more packages that provide a setup hook. Since the list of hooks is extensible, this is not an exhaustive list. The mechanism is only to be used as a last resort, so it might cover most uses.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        Perl
       </span></dt><dd><p>
         Adds the <code class="filename">lib/site_perl</code> subdirectory of each build input to the <code class="envar">PERL5LIB</code> environment variable. For instance, if <code class="varname">buildInputs</code> contains Perl, then the <code class="filename">lib/site_perl</code> subdirectory of each input is added to the <code class="envar">PERL5LIB</code> environment variable.
        </p></dd><dt><span class="term">
        Python
       </span></dt><dd><p>
         Adds the <code class="filename">lib/${python.libPrefix}/site-packages</code> subdirectory of each build input to the <code class="envar">PYTHONPATH</code> environment variable.
        </p></dd><dt><span class="term">
        pkg-config
       </span></dt><dd><p>
         Adds the <code class="filename">lib/pkgconfig</code> and <code class="filename">share/pkgconfig</code> subdirectories of each build input to the <code class="envar">PKG_CONFIG_PATH</code> environment variable.
        </p></dd><dt><span class="term">
        Automake
       </span></dt><dd><p>
         Adds the <code class="filename">share/aclocal</code> subdirectory of each build input to the <code class="envar">ACLOCAL_PATH</code> environment variable.
        </p></dd><dt><span class="term">
        Autoconf
       </span></dt><dd><p>
         The <code class="varname">autoreconfHook</code> derivation adds <code class="varname">autoreconfPhase</code>, which runs autoreconf, libtoolize and automake, essentially preparing the configure script in autotools-based builds. Most autotools-based packages come with the configure script pre-generated, but this hook is necessary for a few packages and when you need to patch the package’s configure scripts.
        </p></dd><dt><span class="term">
        libxml2
       </span></dt><dd><p>
         Adds every file named <code class="filename">catalog.xml</code> found under the <code class="filename">xml/dtd</code> and <code class="filename">xml/xsl</code> subdirectories of each build input to the <code class="envar">XML_CATALOG_FILES</code> environment variable.
        </p></dd><dt><span class="term">
        teTeX / TeX Live
       </span></dt><dd><p>
         Adds the <code class="filename">share/texmf-nix</code> subdirectory of each build input to the <code class="envar">TEXINPUTS</code> environment variable.
        </p></dd><dt><span class="term">
        Qt 4
       </span></dt><dd><p>
         Sets the <code class="envar">QTDIR</code> environment variable to Qt’s path.
        </p></dd><dt><span class="term">
        gdk-pixbuf
       </span></dt><dd><p>
         Exports <code class="envar">GDK_PIXBUF_MODULE_FILE</code> environment variable to the builder. Add librsvg package to <code class="varname">buildInputs</code> to get svg support.
        </p></dd><dt><span class="term">
        GHC
       </span></dt><dd><p>
         Creates a temporary package database and registers every Haskell build input in it (TODO: how?).
        </p></dd><dt><span class="term">
        GNOME platform
       </span></dt><dd><p>
         Hooks related to GNOME platform and related libraries like GLib, GTK and GStreamer are described in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-gnome" title="15.8. GNOME" shape="rect">Section&nbsp;15.8, “GNOME”</a>.
        </p></dd><dt><a id="setup-hook-autopatchelfhook" shape="rect"></a><span class="term">
        autoPatchelfHook
       </span></dt><dd><p>
         This is a special setup hook which helps in packaging proprietary software in that it automatically tries to find missing shared library dependencies of ELF files based on the given <code class="varname">buildInputs</code> and <code class="varname">nativeBuildInputs</code>.
        </p><p>
         You can also specify a <code class="varname">runtimeDependencies</code> variable which lists dependencies to be unconditionally added to <em class="glossterm">rpath</em> of all executables. This is useful for programs that use <span class="citerefentry"><span class="refentrytitle">dlopen</span>(3)</span> to load libraries at runtime.
        </p><p>
         In certain situations you may want to run the main command (<span class="command"><strong>autoPatchelf</strong></span>) of the setup hook on a file or a set of directories instead of unconditionally patching all outputs. This can be done by setting the <code class="varname">dontAutoPatchelf</code> environment variable to a non-empty value.
        </p><p>
         By default <span class="command"><strong>autoPatchelf</strong></span> will fail as soon as any ELF file requires a dependency which cannot be resolved via the given build inputs. In some situations you might prefer to just leave missing dependencies unpatched and continue to patch the rest. This can be achieved by setting the <code class="envar">autoPatchelfIgnoreMissingDeps</code> environment variable to a non-empty value.
        </p><p>
         The <span class="command"><strong>autoPatchelf</strong></span> command also recognizes a <em class="parameter"><code>--no-recurse</code></em> command line flag, which prevents it from recursing into subdirectories.
        </p></dd><dt><span class="term">
        breakpointHook
       </span></dt><dd><p>
         This hook will make a build pause instead of stopping when a failure happens. It prevents nix from cleaning up the build environment immediately and allows the user to attach to a build environment using the <span class="command"><strong>cntr</strong></span> command. Upon build error it will print instructions on how to use <span class="command"><strong>cntr</strong></span>, which can be used to enter the environment for debugging. Installing cntr and running the command will provide shell access to the build sandbox of failed build. At <code class="filename">/var/lib/cntr</code> the sandboxed filesystem is mounted. All commands and files of the system are still accessible within the shell. To execute commands from the sandbox use the cntr exec subcommand. <span class="command"><strong>cntr</strong></span> is only supported on Linux-based platforms. To use it first add <code class="literal">cntr</code> to your <code class="literal">environment.systemPackages</code> on NixOS or alternatively to the root user on non-NixOS systems. Then in the package that is supposed to be inspected, add <code class="literal">breakpointHook</code> to <code class="literal">nativeBuildInputs</code>.
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [ breakpointHook ];
</pre><p>
         When a build failure happens there will be an instruction printed that shows how to attach with <code class="literal">cntr</code> to the build sandbox.
        </p><div class="alert alert-info"><strong>Note:</strong> 
          This won't work with remote builds as the build environment is on a different machine and can't be accessed by <span class="command"><strong>cntr</strong></span>. Remote builds can be turned off by setting <code class="literal">--option builders ''</code> for <span class="command"><strong>nix-build</strong></span> or <code class="literal">--builders ''</code> for <span class="command"><strong>nix build</strong></span>.
         </div></dd><dt><span class="term">
        installShellFiles
       </span></dt><dd><p>
         This hook helps with installing manpages and shell completion files. It exposes 2 shell functions <code class="literal">installManPage</code> and <code class="literal">installShellCompletion</code> that can be used from your <code class="literal">postInstall</code> hook.
        </p><p>
         The <code class="literal">installManPage</code> function takes one or more paths to manpages to install. The manpages must have a section suffix, and may optionally be compressed (with <code class="literal">.gz</code> suffix). This function will place them into the correct directory.
        </p><p>
         The <code class="literal">installShellCompletion</code> function takes one or more paths to shell completion files. By default it will autodetect the shell type from the completion file extension, but you may also specify it by passing one of <code class="literal">--bash</code>, <code class="literal">--fish</code>, or <code class="literal">--zsh</code>. These flags apply to all paths listed after them (up until another shell flag is given). Each path may also have a custom installation name provided by providing a flag <code class="literal">--name NAME</code> before the path. If this flag is not provided, zsh completions will be renamed automatically such that <code class="literal">foobar.zsh</code> becomes <code class="literal">_foobar</code>.
</p><pre class="programlisting hljs bash" xml:space="preserve">nativeBuildInputs = [ installShellFiles ];
postInstall = <span class="hljs-string"><span class="hljs-string">''</span></span>
  installManPage doc/foobar.1 doc/barfoo.3
  <span class="hljs-comment"><span class="hljs-comment"># explicit behavior</span></span>
  installShellCompletion --bash --name foobar.bash share/completions.bash
  installShellCompletion --fish --name foobar.fish share/completions.fish
  installShellCompletion --zsh --name _foobar share/completions.zsh
  <span class="hljs-comment"><span class="hljs-comment"># implicit behavior</span></span>
  installShellCompletion share/completions/foobar.{bash,fish,zsh}
<span class="hljs-string"><span class="hljs-string">''</span></span>;
</pre><p>
        </p></dd><dt><span class="term">
        libiconv, libintl
       </span></dt><dd><p>
         A few libraries automatically add to <code class="literal">NIX_LDFLAGS</code> their library, making their symbols automatically available to the linker. This includes libiconv and libintl (gettext). This is done to provide compatibility between GNU Linux, where libiconv and libintl are bundled in, and other systems where that might not be the case. Sometimes, this behavior is not desired. To disable this behavior, set <code class="literal">dontAddExtraLibs</code>.
        </p></dd><dt><span class="term">
        validatePkgConfig
       </span></dt><dd><p>
         The <code class="literal">validatePkgConfig</code> hook validates all pkg-config (<code class="filename">.pc</code>) files in a package. This helps catching some common errors in pkg-config files, such as undefined variables.
        </p></dd><dt><span class="term">
        cmake
       </span></dt><dd><p>
         Overrides the default configure phase to run the CMake command. By default, we use the Make generator of CMake. In addition, dependencies are added automatically to CMAKE_PREFIX_PATH so that packages are correctly detected by CMake. Some additional flags are passed in to give similar behavior to configure-based packages. You can disable this hook’s behavior by setting configurePhase to a custom value, or by setting dontUseCmakeConfigure. cmakeFlags controls flags passed only to CMake. By default, parallel building is enabled as CMake supports parallel building almost everywhere. When Ninja is also in use, CMake will detect that and use the ninja generator.
        </p></dd><dt><span class="term">
        xcbuildHook
       </span></dt><dd><p>
         Overrides the build and install phases to run the “xcbuild” command. This hook is needed when a project only comes with build files for the XCode build system. You can disable this behavior by setting buildPhase and configurePhase to a custom value. xcbuildFlags controls flags passed only to xcbuild.
        </p></dd><dt><span class="term">
        Meson
       </span></dt><dd><p>
         Overrides the configure phase to run meson to generate Ninja files. To run these files, you should accompany Meson with ninja. By default, <code class="varname">enableParallelBuilding</code> is enabled as Meson supports parallel building almost everywhere.
        </p><div class="variablelist"><p class="title"><strong>Variables controlling Meson</strong></p><dl class="variablelist"><dt><span class="term">
           <code class="varname">mesonFlags</code>
          </span></dt><dd><p>
            Controls the flags passed to meson.
           </p></dd><dt><span class="term">
           <code class="varname">mesonBuildType</code>
          </span></dt><dd><p>
            Which <a class="link" href="https://mesonbuild.com/Builtin-options.html#core-options" target="_top" shape="rect"><span class="command"><strong>--buildtype</strong></span></a> to pass to Meson. We default to <code class="literal">plain</code>.
           </p></dd><dt><span class="term">
           <code class="varname">mesonAutoFeatures</code>
          </span></dt><dd><p>
            What value to set <a class="link" href="https://mesonbuild.com/Builtin-options.html#core-options" target="_top" shape="rect"><span class="command"><strong>-Dauto_features=</strong></span></a> to. We default to <span class="command"><strong>enabled</strong></span>.
           </p></dd><dt><span class="term">
           <code class="varname">mesonWrapMode</code>
          </span></dt><dd><p>
            What value to set <a class="link" href="https://mesonbuild.com/Builtin-options.html#core-options" target="_top" shape="rect"><span class="command"><strong>-Dwrap_mode=</strong></span></a> to. We default to <span class="command"><strong>nodownload</strong></span> as we disallow network access.
           </p></dd><dt><span class="term">
           <code class="varname">dontUseMesonConfigure</code>
          </span></dt><dd><p>
            Disables using Meson's <code class="varname">configurePhase</code>.
           </p></dd></dl></div></dd><dt><span class="term">
        ninja
       </span></dt><dd><p>
         Overrides the build, install, and check phase to run ninja instead of make. You can disable this behavior with the dontUseNinjaBuild, dontUseNinjaInstall, and dontUseNinjaCheck, respectively. Parallel building is enabled by default in Ninja.
        </p></dd><dt><span class="term">
        unzip
       </span></dt><dd><p>
         This setup hook will allow you to unzip .zip files specified in $src. There are many similar packages like unrar, undmg, etc.
        </p></dd><dt><span class="term">
        wafHook
       </span></dt><dd><p>
         Overrides the configure, build, and install phases. This will run the "waf" script used by many projects. If wafPath (default ./waf) doesn’t exist, it will copy the version of waf available in Nixpkgs. wafFlags can be used to pass flags to the waf script.
        </p></dd><dt><span class="term">
        scons
       </span></dt><dd><p>
         Overrides the build, install, and check phases. This uses the scons build system as a replacement for make. scons does not provide a configure phase, so everything is managed at build and install time.
        </p></dd></dl></div><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-purity-in-nixpkgs" class="title" style="clear: both">6.8.&nbsp;Purity in Nixpkgs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-purity-in-nixpkgs" aria-label="Anchor link for: sec purity in nixpkgs" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     [measures taken to prevent dependencies on packages outside the store, and what you can do to prevent them]
    </p><p>
     GCC doesn't search in locations such as <code class="filename">/usr/include</code>. In fact, attempts to add such directories through the <code class="option">-I</code> flag are filtered out. Likewise, the linker (from GNU binutils) doesn't search in standard locations such as <code class="filename">/usr/lib</code>. Programs built on Linux are linked against a GNU C Library that likewise doesn't search in the default system locations.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-hardening-in-nixpkgs" class="title" style="clear: both">6.9.&nbsp;Hardening in Nixpkgs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-hardening-in-nixpkgs" aria-label="Anchor link for: sec hardening in nixpkgs" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     There are flags available to harden packages at compile or link-time. These can be toggled using the <code class="varname">stdenv.mkDerivation</code> parameters <code class="varname">hardeningDisable</code> and <code class="varname">hardeningEnable</code>.
    </p><p>
     Both parameters take a list of flags as strings. The special <code class="varname">"all"</code> flag can be passed to <code class="varname">hardeningDisable</code> to turn off all hardening. These flags can also be used as environment variables for testing or development purposes.
    </p><p>
     The following flags are enabled by default and might require disabling with <code class="varname">hardeningDisable</code> if the program to package is incompatible.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="varname">format</code>
      </span></dt><dd><p>
        Adds the <code class="option">-Wformat -Wformat-security -Werror=format-security</code> compiler options. At present, this warns about calls to <code class="varname">printf</code> and <code class="varname">scanf</code> functions where the format string is not a string literal and there are no format arguments, as in <code class="literal">printf(foo);</code>. This may be a security hole if the format string came from untrusted input and contains <code class="literal">%n</code>.
       </p><p>
        This needs to be turned off or fixed for errors similar to:
       </p><pre class="programlisting hljs nix" xml:space="preserve">/tmp/nix-build-zynaddsubfx-<span class="hljs-number"><span class="hljs-number">2.5</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.drv-<span class="hljs-number"><span class="hljs-number">0</span></span>/zynaddsubfx-<span class="hljs-number"><span class="hljs-number">2.5</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>/src/UI/guimain.cpp:<span class="hljs-number"><span class="hljs-number">571</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span>: error: format not a string literal <span class="hljs-literal"><span class="hljs-literal">and</span></span> no format arguments [<span class="hljs-attr"><span class="hljs-attr">-Werror=format-security]</span></span>
         printf(help_message);
                            ^
cc1plus: some warnings being treated as errors
</pre></dd><dt><span class="term">
       <code class="varname">stackprotector</code>
      </span></dt><dd><p>
        Adds the <code class="option">-fstack-protector-strong --param ssp-buffer-size=4</code> compiler options. This adds safety checks against stack overwrites rendering many potential code injection attacks into aborting situations. In the best case this turns code injection vulnerabilities into denial of service or into non-issues (depending on the application).
       </p><p>
        This needs to be turned off or fixed for errors similar to:
       </p><pre class="programlisting hljs bash" xml:space="preserve">bin/blib.a(bios_console.o): In <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> `bios_handle_cup<span class="hljs-string"><span class="hljs-string">':
/tmp/nix-build-ipxe-20141124-5cbdc41.drv-0/ipxe-5cbdc41/src/arch/i386/firmware/pcbios/bios_console.c:86: undefined reference to `__stack_chk_fail'</span></span>
</pre></dd><dt><span class="term">
       <code class="varname">fortify</code>
      </span></dt><dd><p>
        Adds the <code class="option">-O2 -D_FORTIFY_SOURCE=2</code> compiler options. During code generation the compiler knows a great deal of information about buffer sizes (where possible), and attempts to replace insecure unlimited length buffer function calls with length-limited ones. This is especially useful for old, crufty code. Additionally, format strings in writable memory that contain '%n' are blocked. If an application depends on such a format string, it will need to be worked around.
       </p><p>
        Additionally, some warnings are enabled which might trigger build failures if compiler warnings are treated as errors in the package build. In this case, set <code class="option">NIX_CFLAGS_COMPILE</code> to <code class="option">-Wno-error=warning-type</code>.
       </p><p>
        This needs to be turned off or fixed for errors similar to:
       </p><pre class="programlisting hljs bash" xml:space="preserve">malloc.c:404:15: error: <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> is an incomplete <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>
malloc.c:410:19: error: storage size of <span class="hljs-string"><span class="hljs-string">'ms'</span></span> isn<span class="hljs-string"><span class="hljs-string">'t known
</span></span></pre><pre class="programlisting hljs bash" xml:space="preserve">strdup.h:22:1: error: expected identifier or <span class="hljs-string"><span class="hljs-string">'('</span></span> before <span class="hljs-string"><span class="hljs-string">'__extension__'</span></span>
</pre><pre class="programlisting hljs bash" xml:space="preserve">strsep.c:65:23: error: register name not specified <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'delim'</span></span>
</pre><pre class="programlisting hljs bash" xml:space="preserve">installwatch.c:3751:5: error: conflicting types <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'__open_2'</span></span>
</pre><pre class="programlisting hljs nix" xml:space="preserve">fcntl2.h:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>: error: call to '__open_missing_mode' declared <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> attribute error: open <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> O_CREAT <span class="hljs-literal"><span class="hljs-literal">or</span></span> O_TMPFILE <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> second argument needs <span class="hljs-number"><span class="hljs-number">3</span></span> arguments
</pre></dd><dt><span class="term">
       <code class="varname">pic</code>
      </span></dt><dd><p>
        Adds the <code class="option">-fPIC</code> compiler options. This options adds support for position independent code in shared libraries and thus making ASLR possible.
       </p><p>
        Most notably, the Linux kernel, kernel modules and other code not running in an operating system environment like boot loaders won't build with PIC enabled. The compiler will is most cases complain that PIC is not supported for a specific build.
       </p><p>
        This needs to be turned off or fixed for assembler errors similar to:
       </p><pre class="programlisting hljs nix" xml:space="preserve">ccbLfRgg.s: Assembler messages:
ccbLfRgg.s:<span class="hljs-number"><span class="hljs-number">33</span></span>: Error: missing <span class="hljs-literal"><span class="hljs-literal">or</span></span> invalid displacement expression `private_key_len@GOTOFF'
</pre></dd><dt><span class="term">
       <code class="varname">strictoverflow</code>
      </span></dt><dd><p>
        Signed integer overflow is undefined behaviour according to the C standard. If it happens, it is an error in the program as it should check for overflow before it can happen, not afterwards. GCC provides built-in functions to perform arithmetic with overflow checking, which are correct and faster than any custom implementation. As a workaround, the option <code class="option">-fno-strict-overflow</code> makes gcc behave as if signed integer overflows were defined.
       </p><p>
        This flag should not trigger any build or runtime errors.
       </p></dd><dt><span class="term">
       <code class="varname">relro</code>
      </span></dt><dd><p>
        Adds the <code class="option">-z relro</code> linker option. During program load, several ELF memory sections need to be written to by the linker, but can be turned read-only before turning over control to the program. This prevents some GOT (and .dtors) overwrite attacks, but at least the part of the GOT used by the dynamic linker (.got.plt) is still vulnerable.
       </p><p>
        This flag can break dynamic shared object loading. For instance, the module systems of Xorg and OpenCV are incompatible with this flag. In almost all cases the <code class="varname">bindnow</code> flag must also be disabled and incompatible programs typically fail with similar errors at runtime.
       </p></dd><dt><span class="term">
       <code class="varname">bindnow</code>
      </span></dt><dd><p>
        Adds the <code class="option">-z bindnow</code> linker option. During program load, all dynamic symbols are resolved, allowing for the complete GOT to be marked read-only (due to <code class="varname">relro</code>). This prevents GOT overwrite attacks. For very large applications, this can incur some performance loss during initial load while symbols are resolved, but this shouldn't be an issue for daemons.
       </p><p>
        This flag can break dynamic shared object loading. For instance, the module systems of Xorg and PHP are incompatible with this flag. Programs incompatible with this flag often fail at runtime due to missing symbols, like:
       </p><pre class="programlisting hljs" xml:space="preserve">intel_drv.so: undefined symbol: vgaHWFreeHWRec
</pre></dd></dl></div><p>
     The following flags are disabled by default and should be enabled with <code class="varname">hardeningEnable</code> for packages that take untrusted input like network services.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="varname">pie</code>
      </span></dt><dd><p>
        Adds the <code class="option">-fPIE</code> compiler and <code class="option">-pie</code> linker options. Position Independent Executables are needed to take advantage of Address Space Layout Randomization, supported by modern kernel versions. While ASLR can already be enforced for data areas in the stack and heap (brk and mmap), the code areas must be compiled as position-independent. Shared libraries already do this with the <code class="varname">pic</code> flag, so they gain ASLR automatically, but binary .text regions need to be build with <code class="varname">pie</code> to gain ASLR. When this happens, ROP attacks are much harder since there are no static locations to bounce off of during a memory corruption attack.
       </p></dd></dl></div><p>
     For more in-depth information on these hardening flags and hardening in general, refer to the <a class="link" href="https://wiki.debian.org/Hardening" target="_top" shape="rect">Debian Wiki</a>, <a class="link" href="https://wiki.ubuntu.com/Security/Features" target="_top" shape="rect">Ubuntu Wiki</a>, <a class="link" href="https://wiki.gentoo.org/wiki/Project:Hardened" target="_top" shape="rect">Gentoo Wiki</a>, and the <a class="link" href="https://wiki.archlinux.org/index.php/DeveloperWiki:Security" target="_top" shape="rect"> Arch Wiki</a>.
    </p></section><div class="footnotes"><br clear="none"><br><hr style="width:100; text-align:left;margin-left: 0"><div id="ftn.footnote-stdenv-ignored-build-platform" class="footnote"><p><a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-ignored-build-platform" class="para" shape="rect"><sup class="para">[1] </sup></a>
       The build platform is ignored because it is a mere implementation detail of the package satisfying the dependency: As a general programming principle, dependencies are always <span class="emphasis"><em>specified</em></span> as interfaces, not concrete implementation.
      </p></div><div id="ftn.footnote-stdenv-native-dependencies-in-path" class="footnote"><p><a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-native-dependencies-in-path" class="para" shape="rect"><sup class="para">[2] </sup></a>
       Currently, this means for native builds all dependencies are put on the <code class="envar">PATH</code>. But in the future that may not be the case for sake of matching cross: the platforms would be assumed to be unique for native and cross builds alike, so only the <code class="varname">depsBuild*</code> and <code class="varname">nativeBuildInputs</code> would be added to the <code class="envar">PATH</code>.
      </p></div><div id="ftn.footnote-stdenv-find-inputs-location" class="footnote"><p><a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-find-inputs-location" class="para" shape="rect"><sup class="para">[3] </sup></a>
       The <code class="function">findInputs</code> function, currently residing in <code class="filename">pkgs/stdenv/generic/setup.sh</code>, implements the propagation logic.
      </p></div><div id="ftn.footnote-stdenv-sys-lib-search-path" class="footnote"><p><a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-sys-lib-search-path" class="para" shape="rect"><sup class="para">[4] </sup></a>
           It clears the <code class="varname">sys_lib_<em class="replaceable"><code>*</code></em>search_path</code> variables in the Libtool script to prevent Libtool from using libraries in <code class="filename">/usr/lib</code> and such.
          </p></div><div id="ftn.footnote-stdenv-build-time-guessing-impurity" class="footnote"><p><a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-build-time-guessing-impurity" class="para" shape="rect"><sup class="para">[5] </sup></a>
           Eventually these will be passed building natively as well, to improve determinism: build-time guessing, as is done today, is a risk of impurity.
          </p></div><div id="ftn.footnote-stdenv-per-platform-wrapper" class="footnote"><p><a href="https://nixos.org/manual/nixpkgs/stable/#footnote-stdenv-per-platform-wrapper" class="para" shape="rect"><sup class="para">[6] </sup></a>
           Each wrapper targets a single platform, so if binaries for multiple platforms are needed, the underlying binaries must be wrapped multiple times. As this is a property of the wrapper itself, the multiple wrappings are needed whether or not the same underlying binaries can target multiple platforms.
          </p></div></div></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-meta" class="title">Chapter&nbsp;7.&nbsp;Meta-attributes<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-meta" aria-label="Anchor link for: chap meta" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-standard-meta-attributes" shape="rect">7.1. Standard meta-attributes</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-license" shape="rect">7.2. Licenses</a></span></dt></dl></div><p>
    Nix packages can declare <span class="emphasis"><em>meta-attributes</em></span> that contain information about a package such as a description, its homepage, its license, and so on. For instance, the GNU Hello package has a <code class="varname">meta</code> declaration like this:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> stdenv.lib; {
  <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"A program that produces a familiar, friendly greeting"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">longDescription</span></span> = <span class="hljs-string"><span class="hljs-string">''
    GNU Hello is a program that prints "Hello, world!" when you run it.
    It is fully customizable.
  ''</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://www.gnu.org/software/hello/manual/"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.gpl3Plus;
  <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = [ maintainers.eelco ];
  <span class="hljs-attr"><span class="hljs-attr">platforms</span></span> = platforms.all;
};
</pre><p>
   </p><p>
    Meta-attributes are not passed to the builder of the package. Thus, a change to a meta-attribute doesn’t trigger a recompilation of the package. The value of a meta-attribute must be a string.
   </p><p>
    The meta-attributes of a package can be queried from the command-line using <span class="command"><strong>nix-env</strong></span>:
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>nix-env -qa hello --json
{
    <span class="hljs-string"><span class="hljs-string">"hello"</span></span>: {
        <span class="hljs-string"><span class="hljs-string">"meta"</span></span>: {
            <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"A program that produces a familiar, friendly greeting"</span></span>,
            <span class="hljs-string"><span class="hljs-string">"homepage"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://www.gnu.org/software/hello/manual/"</span></span>,
            <span class="hljs-string"><span class="hljs-string">"license"</span></span>: {
                <span class="hljs-string"><span class="hljs-string">"fullName"</span></span>: <span class="hljs-string"><span class="hljs-string">"GNU General Public License version 3 or later"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"shortName"</span></span>: <span class="hljs-string"><span class="hljs-string">"GPLv3+"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://www.fsf.org/licensing/licenses/gpl.html"</span></span>
            },
            <span class="hljs-string"><span class="hljs-string">"longDescription"</span></span>: <span class="hljs-string"><span class="hljs-string">"GNU Hello is a program that prints \"</span></span>Hello, world!\<span class="hljs-string"><span class="hljs-string">" when you run it.\nIt is fully customizable.\n"</span></span>,
            <span class="hljs-string"><span class="hljs-string">"maintainers"</span></span>: [
                <span class="hljs-string"><span class="hljs-string">"Ludovic Court\u00e8s &lt;ludo@gnu.org&gt;"</span></span>
            ],
            <span class="hljs-string"><span class="hljs-string">"platforms"</span></span>: [
                <span class="hljs-string"><span class="hljs-string">"i686-linux"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"x86_64-linux"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"armv5tel-linux"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"armv7l-linux"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"mips32-linux"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"x86_64-darwin"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"i686-cygwin"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"i686-freebsd"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"x86_64-freebsd"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"i686-openbsd"</span></span>,
                <span class="hljs-string"><span class="hljs-string">"x86_64-openbsd"</span></span>
            ],
            <span class="hljs-string"><span class="hljs-string">"position"</span></span>: <span class="hljs-string"><span class="hljs-string">"/home/user/dev/nixpkgs/pkgs/applications/misc/hello/default.nix:14"</span></span>
        },
        <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"hello-2.9"</span></span>,
        <span class="hljs-string"><span class="hljs-string">"system"</span></span>: <span class="hljs-string"><span class="hljs-string">"x86_64-linux"</span></span>
    }
}


</pre><p>
    <span class="command"><strong>nix-env</strong></span> knows about the <code class="varname">description</code> field specifically:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-env -qa hello --description
hello-2.3  A program that produces a familiar, friendly greeting
</pre><p>
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-standard-meta-attributes" class="title" style="clear: both">7.1.&nbsp;Standard meta-attributes<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-standard-meta-attributes" aria-label="Anchor link for: sec standard meta attributes" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     It is expected that each meta-attribute is one of the following:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="varname">description</code>
      </span></dt><dd><p>
        A short (one-line) description of the package. This is shown by <span class="command"><strong>nix-env -q --description</strong></span> and also on the Nixpkgs release pages.
       </p><p>
        Don’t include a period at the end. Don’t include newline characters. Capitalise the first character. For brevity, don’t repeat the name of package — just describe what it does.
       </p><p>
        Wrong: <code class="literal">"libpng is a library that allows you to decode PNG images."</code>
       </p><p>
        Right: <code class="literal">"A library for decoding PNG images"</code>
       </p></dd><dt><span class="term">
       <code class="varname">longDescription</code>
      </span></dt><dd><p>
        An arbitrarily long description of the package.
       </p></dd><dt><span class="term">
       <code class="varname">branch</code>
      </span></dt><dd><p>
        Release branch. Used to specify that a package is not going to receive updates that are not in this branch; for example, Linux kernel 3.0 is supposed to be updated to 3.0.X, not 3.1.
       </p></dd><dt><span class="term">
       <code class="varname">homepage</code>
      </span></dt><dd><p>
        The package’s homepage. Example: <code class="literal">https://www.gnu.org/software/hello/manual/</code>
       </p></dd><dt><span class="term">
       <code class="varname">downloadPage</code>
      </span></dt><dd><p>
        The page where a link to the current version can be found. Example: <code class="literal">https://ftp.gnu.org/gnu/hello/</code>
       </p></dd><dt><span class="term">
       <code class="varname">changelog</code>
      </span></dt><dd><p>
        A link or a list of links to the location of Changelog for a package. A link may use expansion to refer to the correct changelog version. Example: <code class="literal">"https://git.savannah.gnu.org/cgit/hello.git/plain/NEWS?h=v${version}"</code>
       </p></dd><dt><span class="term">
       <code class="varname">license</code>
      </span></dt><dd><p>
        The license, or licenses, for the package. One from the attribute set defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/licenses.nix" target="_top" shape="rect"> <code class="filename">nixpkgs/lib/licenses.nix</code></a>. At this moment using both a list of licenses and a single license is valid. If the license field is in the form of a list representation, then it means that parts of the package are licensed differently. Each license should preferably be referenced by their attribute. The non-list attribute value can also be a space delimited string representation of the contained attribute shortNames or spdxIds. The following are all valid examples:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           Single license referenced by attribute (preferred) <code class="literal">stdenv.lib.licenses.gpl3Only</code>.
          </p></li><li class="listitem"><p>
           Single license referenced by its attribute shortName (frowned upon) <code class="literal">"gpl3Only"</code>.
          </p></li><li class="listitem"><p>
           Single license referenced by its attribute spdxId (frowned upon) <code class="literal">"GPL-3.0-only"</code>.
          </p></li><li class="listitem"><p>
           Multiple licenses referenced by attribute (preferred) <code class="literal">with stdenv.lib.licenses; [ asl20 free ofl ]</code>.
          </p></li><li class="listitem"><p>
           Multiple licenses referenced as a space delimited string of attribute shortNames (frowned upon) <code class="literal">"asl20 free ofl"</code>.
          </p></li></ul></div><p>
        For details, see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-license" title="7.2. Licenses" shape="rect">Section&nbsp;7.2, “Licenses”</a>.
       </p></dd><dt><span class="term">
       <code class="varname">maintainers</code>
      </span></dt><dd><p>
        A list of names and e-mail addresses of the maintainers of this Nix expression. If you would like to be a maintainer of a package, you may want to add yourself to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/maintainers/maintainer-list.nix" target="_top" shape="rect"><code class="filename">nixpkgs/maintainers/maintainer-list.nix</code></a> and write something like <code class="literal">[ stdenv.lib.maintainers.alice stdenv.lib.maintainers.bob ]</code>.
       </p></dd><dt><span class="term">
       <code class="varname">priority</code>
      </span></dt><dd><p>
        The <span class="emphasis"><em>priority</em></span> of the package, used by <span class="command"><strong>nix-env</strong></span> to resolve file name conflicts between packages. See the Nix manual page for <span class="command"><strong>nix-env</strong></span> for details. Example: <code class="literal">"10"</code> (a low-priority package).
       </p></dd><dt><span class="term">
       <code class="varname">platforms</code>
      </span></dt><dd><p>
        The list of Nix platform types on which the package is supported. Hydra builds packages according to the platform specified. If no platform is specified, the package does not have prebuilt binaries. An example is:
</p><pre class="programlisting hljs nix" xml:space="preserve">meta.<span class="hljs-attr"><span class="hljs-attr">platforms</span></span> = stdenv.lib.platforms.linux;
</pre><p>
        Attribute Set <code class="varname">stdenv.lib.platforms</code> defines <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/systems/doubles.nix" target="_top" shape="rect"> various common lists</a> of platforms types.
       </p></dd><dt><span class="term">
       <code class="varname">tests</code>
      </span></dt><dd><div class="alert alert-warning"><strong>Warning:</strong> 
         This attribute is special in that it is not actually under the <code class="literal">meta</code> attribute set but rather under the <code class="literal">passthru</code> attribute set. This is due to how <code class="literal">meta</code> attributes work, and the fact that they are supposed to contain only metadata, not derivations.
        </div><p>
        An attribute set with as values tests. A test is a derivation, which builds successfully when the test passes, and fails to build otherwise. A derivation that is a test needs to have <code class="literal">meta.timeout</code> defined.
       </p><p>
        The NixOS tests are available as <code class="literal">nixosTests</code> in parameters of derivations. For instance, the OpenSMTPD derivation includes lines similar to:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>, nixosTests }:
{
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  passthru.<span class="hljs-attr"><span class="hljs-attr">tests</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">basic-functionality-and-dovecot-integration</span></span> = nixosTests.opensmtpd;
  };
}
</pre><p>
       </p></dd><dt><span class="term">
       <code class="varname">timeout</code>
      </span></dt><dd><p>
        A timeout (in seconds) for building the derivation. If the derivation takes longer than this time to build, it can fail due to breaking the timeout. However, all computers do not have the same computing power, hence some builders may decide to apply a multiplicative factor to this value. When filling this value in, try to keep it approximately consistent with other values already present in <code class="literal">nixpkgs</code>.
       </p></dd><dt><span class="term">
       <code class="varname">hydraPlatforms</code>
      </span></dt><dd><p>
        The list of Nix platform types for which the Hydra instance at <code class="literal">hydra.nixos.org</code> will build the package. (Hydra is the Nix-based continuous build system.) It defaults to the value of <code class="varname">meta.platforms</code>. Thus, the only reason to set <code class="varname">meta.hydraPlatforms</code> is if you want <code class="literal">hydra.nixos.org</code> to build the package on a subset of <code class="varname">meta.platforms</code>, or not at all, e.g.
</p><pre class="programlisting hljs nix" xml:space="preserve">meta.<span class="hljs-attr"><span class="hljs-attr">platforms</span></span> = stdenv.lib.platforms.linux;
meta.<span class="hljs-attr"><span class="hljs-attr">hydraPlatforms</span></span> = [];
</pre><p>
       </p></dd><dt><span class="term">
       <code class="varname">broken</code>
      </span></dt><dd><p>
        If set to <code class="literal">true</code>, the package is marked as “broken”, meaning that it won’t show up in <code class="literal">nix-env -qa</code>, and cannot be built or installed. Such packages should be removed from Nixpkgs eventually unless they are fixed.
       </p></dd><dt><span class="term">
       <code class="varname">updateWalker</code>
      </span></dt><dd><p>
        If set to <code class="literal">true</code>, the package is tested to be updated correctly by the <code class="literal">update-walker.sh</code> script without additional settings. Such packages have <code class="varname">meta.version</code> set and their homepage (or the page specified by <code class="varname">meta.downloadPage</code>) contains a direct link to the package tarball.
       </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-meta-license" class="title" style="clear: both">7.2.&nbsp;Licenses<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-license" aria-label="Anchor link for: sec meta license" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The <code class="varname">meta.license</code> attribute should preferrably contain a value from <code class="varname">stdenv.lib.licenses</code> defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/licenses.nix" target="_top" shape="rect"> <code class="filename">nixpkgs/lib/licenses.nix</code></a>, or in-place license description of the same format if the license is unlikely to be useful in another expression.
    </p><p>
     Although it's typically better to indicate the specific license, a few generic options are available:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">stdenv.lib.licenses.free</code>, <code class="varname">"free"</code>
       </span></dt><dd><p>
         Catch-all for free software licenses not listed above.
        </p></dd><dt><span class="term">
        <code class="varname">stdenv.lib.licenses.unfreeRedistributable</code>, <code class="varname">"unfree-redistributable"</code>
       </span></dt><dd><p>
         Unfree package that can be redistributed in binary form. That is, it’s legal to redistribute the <span class="emphasis"><em>output</em></span> of the derivation. This means that the package can be included in the Nixpkgs channel.
        </p><p>
         Sometimes proprietary software can only be redistributed unmodified. Make sure the builder doesn’t actually modify the original binaries; otherwise we’re breaking the license. For instance, the NVIDIA X11 drivers can be redistributed unmodified, but our builder applies <span class="command"><strong>patchelf</strong></span> to make them work. Thus, its license is <code class="varname">"unfree"</code> and it cannot be included in the Nixpkgs channel.
        </p></dd><dt><span class="term">
        <code class="varname">stdenv.lib.licenses.unfree</code>, <code class="varname">"unfree"</code>
       </span></dt><dd><p>
         Unfree package that cannot be redistributed. You can build it yourself, but you cannot redistribute the output of the derivation. Thus it cannot be included in the Nixpkgs channel.
        </p></dd><dt><span class="term">
        <code class="varname">stdenv.lib.licenses.unfreeRedistributableFirmware</code>, <code class="varname">"unfree-redistributable-firmware"</code>
       </span></dt><dd><p>
         This package supplies unfree, redistributable firmware. This is a separate value from <code class="varname">unfree-redistributable</code> because not everybody cares whether firmware is free.
        </p></dd></dl></div><p>
    </p></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-multiple-output" class="title">Chapter&nbsp;8.&nbsp;Multiple-output packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output" aria-label="Anchor link for: chap multiple output" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-introduction" shape="rect">8.1. Introduction</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-installing" shape="rect">8.2. Installing a split package</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-using-split-packages" shape="rect">8.3. Using a split package</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-" shape="rect">8.4. Writing a split derivation</a></span></dt></dl></div><section class="section"><div class="titlepage"><div><div><h2 id="sec-multiple-outputs-introduction" class="title" style="clear: both">8.1.&nbsp;Introduction<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-introduction" aria-label="Anchor link for: sec multiple outputs introduction" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The Nix language allows a derivation to produce multiple outputs, which is similar to what is utilized by other Linux distribution packaging systems. The outputs reside in separate Nix store paths, so they can be mostly handled independently of each other, including passing to build inputs, garbage collection or binary substitution. The exception is that building from source always produces all the outputs.
    </p><p>
     The main motivation is to save disk space by reducing runtime closure sizes; consequently also sizes of substituted binaries get reduced. Splitting can be used to have more granular runtime dependencies, for example the typical reduction is to split away development-only files, as those are typically not needed during runtime. As a result, closure sizes of many packages can get reduced to a half or even much less.
    </p><div class="alert alert-info"><strong>Note:</strong> 
      The reduction effects could be instead achieved by building the parts in completely separate derivations. That would often additionally reduce build-time closures, but it tends to be much harder to write such derivations, as build systems typically assume all parts are being built at once. This compromise approach of single source package producing multiple binary packages is also utilized often by rpm and deb.
     </div><p>
     A number of attributes can be used to work with a derivation with multiple outputs. The attribute <code class="varname">outputs</code> is a list of strings, which are the names of the outputs. For each of these names, an identically named attribute is created, corresponding to that output. The attribute <code class="varname">meta.outputsToInstall</code> is used to determine the default set of outputs to install when using the derivation name unqualified.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-multiple-outputs-installing" class="title" style="clear: both">8.2.&nbsp;Installing a split package<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-installing" aria-label="Anchor link for: sec multiple outputs installing" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     When installing a package with multiple outputs, the package's <code class="varname">meta.outputsToInstall</code> attribute determines which outputs are actually installed. <code class="varname">meta.outputsToInstall</code> is a list whose <a class="link" href="https://github.com/NixOS/nixpkgs/blob/f1680774340d5443a1409c3421ced84ac1163ba9/pkgs/stdenv/generic/make-derivation.nix#L310-L320" target="_top" shape="rect">default installs binaries and the associated man pages</a>. The following sections describe ways to install different outputs.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-multiple-outputs-installing-nixos" class="title">8.2.1.&nbsp;Selecting outputs to install via NixOS<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-installing-nixos" aria-label="Anchor link for: sec multiple outputs installing nixos" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      NixOS provides two ways to select the outputs to install for packages listed in <code class="varname">environment.systemPackages</code>:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The configuration option <code class="varname">environment.extraOutputsToInstall</code> is appended to each package's <code class="varname">meta.outputsToInstall</code> attribute to determine the outputs to install. It can for example be used to install <code class="literal">info</code> documentation or debug symbols for all packages.
       </p></li><li class="listitem"><p>
        The outputs can be listed as packages in <code class="varname">environment.systemPackages</code>. For example, the <code class="literal">"out"</code> and <code class="literal">"info"</code> outputs for the <code class="varname">coreutils</code> package can be installed by including <code class="varname">coreutils</code> and <code class="varname">coreutils.info</code> in <code class="varname">environment.systemPackages</code>.
       </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-multiple-outputs-installing-nix-env" class="title">8.2.2.&nbsp;Selecting outputs to install via <span class="command"><strong>nix-env</strong></span><a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-installing-nix-env" aria-label="Anchor link for: sec multiple outputs installing nix env" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      <span class="command"><strong>nix-env</strong></span> lacks an easy way to select the outputs to install. When installing a package, <span class="command"><strong>nix-env</strong></span> always installs the outputs listed in <code class="varname">meta.outputsToInstall</code>, even when the user explicitly selects an output.
     </p><div class="alert alert-warning"><p>
       <span class="command"><strong>nix-env</strong></span> silenty disregards the outputs selected by the user, and instead installs the outputs from <code class="varname">meta.outputsToInstall</code>. For example,
      </p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-env -iA nixpkgs.coreutils.info</pre><p>
       installs the <code class="literal">"out"</code> output (<code class="varname">coreutils.meta.outputsToInstall</code> is <code class="literal">[ "out" ]</code>) instead of the requested <code class="literal">"info"</code>.
      </p></div><p>
      The only recourse to select an output with <span class="command"><strong>nix-env</strong></span> is to override the package's <code class="varname">meta.outputsToInstall</code>, using the functions described in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#chap-overrides" title="Chapter 4. Overriding" shape="rect">Chapter&nbsp;4, <em>Overriding</em></a>. For example, the following overlay adds the <code class="literal">"info"</code> output for the <code class="varname">coreutils</code> package:
     </p><pre class="programlisting hljs nix" xml:space="preserve">self: super:
{
  <span class="hljs-attr"><span class="hljs-attr">coreutils</span></span> = super.coreutils.overrideAttrs (oldAttrs: {
    <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = oldAttrs.meta // { <span class="hljs-attr"><span class="hljs-attr">outputsToInstall</span></span> = oldAttrs.meta.outputsToInstall <span class="hljs-literal"><span class="hljs-literal">or</span></span> [ <span class="hljs-string"><span class="hljs-string">"out"</span></span> ] ++ [ <span class="hljs-string"><span class="hljs-string">"info"</span></span> ]; };
  });
}
</pre></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-multiple-outputs-using-split-packages" class="title" style="clear: both">8.3.&nbsp;Using a split package<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-using-split-packages" aria-label="Anchor link for: sec multiple outputs using split packages" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     In the Nix language the individual outputs can be reached explicitly as attributes, e.g. <code class="varname">coreutils.info</code>, but the typical case is just using packages as build inputs.
    </p><p>
     When a multiple-output derivation gets into a build input of another derivation, the <code class="varname">dev</code> output is added if it exists, otherwise the first output is added. In addition to that, <code class="varname">propagatedBuildOutputs</code> of that package which by default contain <code class="varname">$outputBin</code> and <code class="varname">$outputLib</code> are also added. (See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#multiple-output-file-type-groups" title="8.4.2. File type groups" shape="rect">Section&nbsp;8.4.2, “File type groups”</a>.)
    </p><p>
     In some cases it may be desirable to combine different outputs under a single store path. A function <code class="literal">symlinkJoin</code> can be used to do this. (Note that it may negate some closure size benefits of using a multiple-output package.)
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-multiple-outputs-" class="title" style="clear: both">8.4.&nbsp;Writing a split derivation<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-" aria-label="Anchor link for: sec multiple outputs " data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Here you find how to write a derivation that produces multiple outputs.
    </p><p>
     In nixpkgs there is a framework supporting multiple-output derivations. It tries to cover most cases by default behavior. You can find the source separated in &lt;<code class="filename">nixpkgs/pkgs/build-support/setup-hooks/multiple-outputs.sh</code>&gt;; it's relatively well-readable. The whole machinery is triggered by defining the <code class="varname">outputs</code> attribute to contain the list of desired output names (strings).
    </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">outputs</span></span> = [ <span class="hljs-string"><span class="hljs-string">"bin"</span></span> <span class="hljs-string"><span class="hljs-string">"dev"</span></span> <span class="hljs-string"><span class="hljs-string">"out"</span></span> <span class="hljs-string"><span class="hljs-string">"doc"</span></span> ];</pre><p>
     Often such a single line is enough. For each output an equally named environment variable is passed to the builder and contains the path in nix store for that output. Typically you also want to have the main <code class="varname">out</code> output, as it catches any files that didn't get elsewhere.
    </p><div class="alert alert-info"><strong>Note:</strong> 
      There is a special handling of the <code class="varname">debug</code> output, described at <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#stdenv-separateDebugInfo" shape="rect">
        <code class="varname">separateDebugInfo</code>
       </a>.
     </div><section class="section"><div class="titlepage"><div><div><h3 id="multiple-output-file-binaries-first-convention" class="title">8.4.1.&nbsp;<span class="quote">“<span class="quote">Binaries first</span>”</span><a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#multiple-output-file-binaries-first-convention" aria-label="Anchor link for: multiple output file binaries first convention" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      A commonly adopted convention in <code class="literal">nixpkgs</code> is that executables provided by the package are contained within its first output. This convention allows the dependent packages to reference the executables provided by packages in a uniform manner. For instance, provided with the knowledge that the <code class="literal">perl</code> package contains a <code class="literal">perl</code> executable it can be referenced as <code class="literal">${pkgs.perl}/bin/perl</code> within a Nix derivation that needs to execute a Perl script.
     </p><p>
      The <code class="literal">glibc</code> package is a deliberate single exception to the <span class="quote">“<span class="quote">binaries first</span>”</span> convention. The <code class="literal">glibc</code> has <code class="literal">libs</code> as its first output allowing the libraries provided by <code class="literal">glibc</code> to be referenced directly (e.g. <code class="literal">${stdenv.glibc}/lib/ld-linux-x86-64.so.2</code>). The executables provided by <code class="literal">glibc</code> can be accessed via its <code class="literal">bin</code> attribute (e.g. <code class="literal">${stdenv.glibc.bin}/bin/ldd</code>).
     </p><p>
      The reason for why <code class="literal">glibc</code> deviates from the convention is because referencing a library provided by <code class="literal">glibc</code> is a very common operation among Nix packages. For instance, third-party executables packaged by Nix are typically patched and relinked with the relevant version of <code class="literal">glibc</code> libraries from Nix packages (please see the documentation on <a class="link" href="https://github.com/NixOS/patchelf/blob/master/README" target="_top" shape="rect">patchelf</a> for more details).
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="multiple-output-file-type-groups" class="title">8.4.2.&nbsp;File type groups<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#multiple-output-file-type-groups" aria-label="Anchor link for: multiple output file type groups" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The support code currently recognizes some particular kinds of outputs and either instructs the build system of the package to put files into their desired outputs or it moves the files during the fixup phase. Each group of file types has an <code class="varname">outputFoo</code> variable specifying the output name where they should go. If that variable isn't defined by the derivation writer, it is guessed – a default output name is defined, falling back to other possibilities if the output isn't defined.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname"> $outputDev</code>
       </span></dt><dd><p>
         is for development-only files. These include C(++) headers, pkg-config, cmake and aclocal files. They go to <code class="varname">dev</code> or <code class="varname">out</code> by default.
        </p></dd><dt><span class="term">
        <code class="varname"> $outputBin</code>
       </span></dt><dd><p>
         is meant for user-facing binaries, typically residing in bin/. They go to <code class="varname">bin</code> or <code class="varname">out</code> by default.
        </p></dd><dt><span class="term">
        <code class="varname"> $outputLib</code>
       </span></dt><dd><p>
         is meant for libraries, typically residing in <code class="filename">lib/</code> and <code class="filename">libexec/</code>. They go to <code class="varname">lib</code> or <code class="varname">out</code> by default.
        </p></dd><dt><span class="term">
        <code class="varname"> $outputDoc</code>
       </span></dt><dd><p>
         is for user documentation, typically residing in <code class="filename">share/doc/</code>. It goes to <code class="varname">doc</code> or <code class="varname">out</code> by default.
        </p></dd><dt><span class="term">
        <code class="varname"> $outputDevdoc</code>
       </span></dt><dd><p>
         is for <span class="emphasis"><em>developer</em></span> documentation. Currently we count gtk-doc and devhelp books in there. It goes to <code class="varname">devdoc</code> or is removed (!) by default. This is because e.g. gtk-doc tends to be rather large and completely unused by nixpkgs users.
        </p></dd><dt><span class="term">
        <code class="varname"> $outputMan</code>
       </span></dt><dd><p>
         is for man pages (except for section 3). They go to <code class="varname">man</code> or <code class="varname">$outputBin</code> by default.
        </p></dd><dt><span class="term">
        <code class="varname"> $outputDevman</code>
       </span></dt><dd><p>
         is for section 3 man pages. They go to <code class="varname">devman</code> or <code class="varname">$outputMan</code> by default.
        </p></dd><dt><span class="term">
        <code class="varname"> $outputInfo</code>
       </span></dt><dd><p>
         is for info pages. They go to <code class="varname">info</code> or <code class="varname">$outputBin</code> by default.
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-multiple-outputs-caveats" class="title">8.4.3.&nbsp;Common caveats<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-multiple-outputs-caveats" aria-label="Anchor link for: sec multiple outputs caveats" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Some configure scripts don't like some of the parameters passed by default by the framework, e.g. <code class="literal">--docdir=/foo/bar</code>. You can disable this by setting <code class="literal">setOutputFlags = false;</code>.
       </p></li><li class="listitem"><p>
        The outputs of a single derivation can retain references to each other, but note that circular references are not allowed. (And each strongly-connected component would act as a single output anyway.)
       </p></li><li class="listitem"><p>
        Most of split packages contain their core functionality in libraries. These libraries tend to refer to various kind of data that typically gets into <code class="varname">out</code>, e.g. locale strings, so there is often no advantage in separating the libraries into <code class="varname">lib</code>, as keeping them in <code class="varname">out</code> is easier.
       </p></li><li class="listitem"><p>
        Some packages have hidden assumptions on install paths, which complicates splitting.
       </p></li></ul></div></section></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-cross" class="title">Chapter&nbsp;9.&nbsp;Cross-compilation<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-cross" aria-label="Anchor link for: chap cross" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-intro" shape="rect">9.1. Introduction</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-packaging" shape="rect">9.2. Packaging in a cross-friendly manner</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-usage" shape="rect">9.3. Cross-building packages</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-infra" shape="rect">9.4. Cross-compilation infrastructure</a></span></dt></dl></div><section class="section"><div class="titlepage"><div><div><h2 id="sec-cross-intro" class="title" style="clear: both">9.1.&nbsp;Introduction<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-intro" aria-label="Anchor link for: sec cross intro" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     "Cross-compilation" means compiling a program on one machine for another type of machine. For example, a typical use of cross-compilation is to compile programs for embedded devices. These devices often don't have the computing power and memory to compile their own programs. One might think that cross-compilation is a fairly niche concern. However, there are significant advantages to rigorously distinguishing between build-time and run-time environments! Significant, because the benefits apply even when one is developing and deploying on the same machine. Nixpkgs is increasingly adopting the opinion that packages should be written with cross-compilation in mind, and nixpkgs should evaluate in a similar way (by minimizing cross-compilation-specific special cases) whether or not one is cross-compiling.
    </p><p>
     This chapter will be organized in three parts. First, it will describe the basics of how to package software in a way that supports cross-compilation. Second, it will describe how to use Nixpkgs when cross-compiling. Third, it will describe the internal infrastructure supporting cross-compilation.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-cross-packaging" class="title" style="clear: both">9.2.&nbsp;Packaging in a cross-friendly manner<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-packaging" aria-label="Anchor link for: sec cross packaging" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="ssec-cross-platform-parameters" class="title">9.2.1.&nbsp;Platform parameters<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-platform-parameters" aria-label="Anchor link for: ssec cross platform parameters" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Nixpkgs follows the <a class="link" href="https://gcc.gnu.org/onlinedocs/gccint/Configure-Terms.html" target="_top" shape="rect">conventions of GNU autoconf</a>. We distinguish between 3 types of platforms when building a derivation: <em class="wordasword">build</em>, <em class="wordasword">host</em>, and <em class="wordasword">target</em>. In summary, <em class="wordasword">build</em> is the platform on which a package is being built, <em class="wordasword">host</em> is the platform on which it will run. The third attribute, <em class="wordasword">target</em>, is relevant only for certain specific compilers and build tools.
     </p><p>
      In Nixpkgs, these three platforms are defined as attribute sets under the names <code class="literal">buildPlatform</code>, <code class="literal">hostPlatform</code>, and <code class="literal">targetPlatform</code>. They are always defined as attributes in the standard environment. That means one can access them like:
</p><pre class="programlisting hljs" xml:space="preserve">{ stdenv, fooDep, barDep, .. }: ...stdenv.buildPlatform...</pre><p>
      .
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">buildPlatform</code>
       </span></dt><dd><p>
         The "build platform" is the platform on which a package is built. Once someone has a built package, or pre-built binary package, the build platform should not matter and can be ignored.
        </p></dd><dt><span class="term">
        <code class="varname">hostPlatform</code>
       </span></dt><dd><p>
         The "host platform" is the platform on which a package will be run. This is the simplest platform to understand, but also the one with the worst name.
        </p></dd><dt><span class="term">
        <code class="varname">targetPlatform</code>
       </span></dt><dd><p>
         The "target platform" attribute is, unlike the other two attributes, not actually fundamental to the process of building software. Instead, it is only relevant for compatibility with building certain specific compilers and build tools. It can be safely ignored for all other packages.
        </p><p>
         The build process of certain compilers is written in such a way that the compiler resulting from a single build can itself only produce binaries for a single platform. The task of specifying this single "target platform" is thus pushed to build time of the compiler. The root cause of this is that the compiler (which will be run on the host) and the standard library/runtime (which will be run on the target) are built by a single build process.
        </p><p>
         There is no fundamental need to think about a single target ahead of time like this. If the tool supports modular or pluggable backends, both the need to specify the target at build time and the constraint of having only a single target disappear. An example of such a tool is LLVM.
        </p><p>
         Although the existence of a "target platfom" is arguably a historical mistake, it is a common one: examples of tools that suffer from it are GCC, Binutils, GHC and Autoconf. Nixpkgs tries to avoid sharing in the mistake where possible. Still, because the concept of a target platform is so ingrained, it is best to support it as is.
        </p></dd></dl></div><p>
      The exact schema these fields follow is a bit ill-defined due to a long and convoluted evolution, but this is slowly being cleaned up. You can see examples of ones used in practice in <code class="literal">lib.systems.examples</code>; note how they are not all very consistent. For now, here are few fields can count on them containing:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">system</code>
       </span></dt><dd><p>
         This is a two-component shorthand for the platform. Examples of this would be "x86_64-darwin" and "i686-linux"; see <code class="literal">lib.systems.doubles</code> for more. The first component corresponds to the CPU architecture of the platform and the second to the operating system of the platform (<code class="literal">[cpu]-[os]</code>). This format has built-in support in Nix, such as the <code class="varname">builtins.currentSystem</code> impure string.
        </p></dd><dt><span class="term">
        <code class="varname">config</code>
       </span></dt><dd><p>
         This is a 3- or 4- component shorthand for the platform. Examples of this would be <code class="literal">x86_64-unknown-linux-gnu</code> and <code class="literal">aarch64-apple-darwin14</code>. This is a standard format called the "LLVM target triple", as they are pioneered by LLVM. In the 4-part form, this corresponds to <code class="literal">[cpu]-[vendor]-[os]-[abi]</code>. This format is strictly more informative than the "Nix host double", as the previous format could analogously be termed. This needs a better name than <code class="varname">config</code>!
        </p></dd><dt><span class="term">
        <code class="varname">parsed</code>
       </span></dt><dd><p>
         This is a Nix representation of a parsed LLVM target triple with white-listed components. This can be specified directly, or actually parsed from the <code class="varname">config</code>. See <code class="literal">lib.systems.parse</code> for the exact representation.
        </p></dd><dt><span class="term">
        <code class="varname">libc</code>
       </span></dt><dd><p>
         This is a string identifying the standard C library used. Valid identifiers include "glibc" for GNU libc, "libSystem" for Darwin's Libsystem, and "uclibc" for µClibc. It should probably be refactored to use the module system, like <code class="varname">parse</code>.
        </p></dd><dt><span class="term">
        <code class="varname">is*</code>
       </span></dt><dd><p>
         These predicates are defined in <code class="literal">lib.systems.inspect</code>, and slapped onto every platform. They are superior to the ones in <code class="varname">stdenv</code> as they force the user to be explicit about which platform they are inspecting. Please use these instead of those.
        </p></dd><dt><span class="term">
        <code class="varname">platform</code>
       </span></dt><dd><p>
         This is, quite frankly, a dumping ground of ad-hoc settings (it's an attribute set). See <code class="literal">lib.systems.platforms</code> for examples—there's hopefully one in there that will work verbatim for each platform that is working. Please help us triage these flags and give them better homes!
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-cross-dependency-categorization" class="title">9.2.2.&nbsp;Theory of dependency categorization<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-categorization" aria-label="Anchor link for: ssec cross dependency categorization" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><div class="alert alert-info"><strong>Note:</strong> 
       This is a rather philosophical description that isn't very Nixpkgs-specific. For an overview of all the relevant attributes given to <code class="varname">mkDerivation</code>, see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies" title="6.3. Specifying dependencies" shape="rect">Section&nbsp;6.3, “Specifying dependencies”</a>. For a description of how everything is implemented, see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-implementation" title="9.4.1. Implementation of dependencies" shape="rect">Section&nbsp;9.4.1, “Implementation of dependencies”</a>.
      </div><p>
      In this section we explore the relationship between both runtime and build-time dependencies and the 3 Autoconf platforms.
     </p><p>
      A run time dependency between two packages requires that their host platforms match. This is directly implied by the meaning of "host platform" and "runtime dependency": The package dependency exists while both packages are running on a single host platform.
     </p><p>
      A build time dependency, however, has a shift in platforms between the depending package and the depended-on package. "build time dependency" means that to build the depending package we need to be able to run the depended-on's package. The depending package's build platform is therefore equal to the depended-on package's host platform.
     </p><p>
      If both the dependency and depending packages aren't compilers or other machine-code-producing tools, we're done. And indeed <code class="varname">buildInputs</code> and <code class="varname">nativeBuildInputs</code> have covered these simpler build-time and run-time (respectively) changes for many years. But if the dependency does produce machine code, we might need to worry about its target platform too. In principle, that target platform might be any of the depending package's build, host, or target platforms, but we prohibit dependencies from a "later" platform to an earlier platform to limit confusion because we've never seen a legitimate use for them.
     </p><p>
      Finally, if the depending package is a compiler or other machine-code-producing tool, it might need dependencies that run at "emit time". This is for compilers that (regrettably) insist on being built together with their source langauges' standard libraries. Assuming build != host != target, a run-time dependency of the standard library cannot be run at the compiler's build time or run time, but only at the run time of code emitted by the compiler.
     </p><p>
      Putting this all together, that means we have dependencies in the form "host → target", in at most the following six combinations:
      </p><div class="table"><a id="idm140737319592656" shape="rect"></a><p class="title"><strong>Table&nbsp;9.1.&nbsp;Possible dependency types</strong></p><div class="table-contents"><table class="table table-striped"><thead><tr>
         <th rowspan="1" colspan="1">Dependency's host platform</th>
         <th rowspan="1" colspan="1">Dependency's target platform</th>
        </tr></thead><tbody><tr>
         <td rowspan="1" colspan="1">build</td>
         <td rowspan="1" colspan="1">build</td>
        </tr><tr>
         <td rowspan="1" colspan="1">build</td>
         <td rowspan="1" colspan="1">host</td>
        </tr><tr>
         <td rowspan="1" colspan="1">build</td>
         <td rowspan="1" colspan="1">target</td>
        </tr><tr>
         <td rowspan="1" colspan="1">host</td>
         <td rowspan="1" colspan="1">host</td>
        </tr><tr>
         <td rowspan="1" colspan="1">host</td>
         <td rowspan="1" colspan="1">target</td>
        </tr><tr>
         <td rowspan="1" colspan="1">target</td>
         <td rowspan="1" colspan="1">target</td>
        </tr></tbody></table></div></div><p><br class="table-break" clear="none"><br>
     </p><p>
      Some examples will make this table clearer. Suppose there's some package that is being built with a <code class="literal">(build, host, target)</code> platform triple of <code class="literal">(foo, bar, baz)</code>. If it has a build-time library dependency, that would be a "host → build" dependency with a triple of <code class="literal">(foo, foo, *)</code> (the target platform is irrelevant). If it needs a compiler to be built, that would be a "build → host" dependency with a triple of <code class="literal">(foo, foo, *)</code> (the target platform is irrelevant). That compiler, would be built with another compiler, also "build → host" dependency, with a triple of <code class="literal">(foo, foo, foo)</code>.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-cross-cookbook" class="title">9.2.3.&nbsp;Cross packaging cookbook<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-cookbook" aria-label="Anchor link for: ssec cross cookbook" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Some frequently encountered problems when packaging for cross-compilation should be answered here. Ideally, the information above is exhaustive, so this section cannot provide any new information, but it is ludicrous and cruel to expect everyone to spend effort working through the interaction of many features just to figure out the same answer to the same common problem. Feel free to add to this list!
     </p><div class="qandaset"><a id="idm140737319576992" shape="rect"></a><dl><dt>9.2.3.1. <a href="https://nixos.org/manual/nixpkgs/stable/#cross-qa-build-c-program-in-build-environment" shape="rect">
         What if my package's build system needs to build a C program to be run under the build environment?
        </a></dt><dt>9.2.3.2. <a href="https://nixos.org/manual/nixpkgs/stable/#cross-qa-fails-to-find-ar" shape="rect">
         My package fails to find ar.
        </a></dt><dt>9.2.3.3. <a href="https://nixos.org/manual/nixpkgs/stable/#cross-testsuite-runs-host-code" shape="rect">
         My package's testsuite needs to run host platform code.
        </a></dt></dl><table class="table table-striped" border="0" style="width: 100%;"><colgroup span="1"><col align="left" width="1%" span="1"><col span="1"></colgroup><tbody><tr class="question"><td align="left" valign="top" rowspan="1" colspan="1"><a id="cross-qa-build-c-program-in-build-environment" shape="rect"></a><a id="idm140737319575872" shape="rect"></a><p><strong>9.2.3.1.</strong></p></td><td align="left" valign="top" rowspan="1" colspan="1"><p>
         What if my package's build system needs to build a C program to be run under the build environment?
        </p></td></tr><tr class="answer"><td align="left" valign="top" rowspan="1" colspan="1"></td><td align="left" valign="top" rowspan="1" colspan="1"><p>
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">depsBuildBuild</span></span> = [ buildPackages.stdenv.cc ];</pre><p>
         Add it to your <code class="function">mkDerivation</code> invocation.
        </p></td></tr><tr class="question"><td align="left" valign="top" rowspan="1" colspan="1"><a id="cross-qa-fails-to-find-ar" shape="rect"></a><a id="idm140737319572528" shape="rect"></a><p><strong>9.2.3.2.</strong></p></td><td align="left" valign="top" rowspan="1" colspan="1"><p>
         My package fails to find <span class="command"><strong>ar</strong></span>.
        </p></td></tr><tr class="answer"><td align="left" valign="top" rowspan="1" colspan="1"></td><td align="left" valign="top" rowspan="1" colspan="1"><p>
         Many packages assume that an unprefixed <span class="command"><strong>ar</strong></span> is available, but Nix doesn't provide one. It only provides a prefixed one, just as it only does for all the other binutils programs. It may be necessary to patch the package to fix the build system to use a prefixed <span class="command"><strong>ar</strong></span>.
        </p></td></tr><tr class="question"><td align="left" valign="top" rowspan="1" colspan="1"><a id="cross-testsuite-runs-host-code" shape="rect"></a><a id="idm140737319568528" shape="rect"></a><p><strong>9.2.3.3.</strong></p></td><td align="left" valign="top" rowspan="1" colspan="1"><p>
         My package's testsuite needs to run host platform code.
        </p></td></tr><tr class="answer"><td align="left" valign="top" rowspan="1" colspan="1"></td><td align="left" valign="top" rowspan="1" colspan="1"><p>
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">doCheck</span></span> = stdenv.<span class="hljs-attr"><span class="hljs-attr">hostPlatform</span></span> == stdenv.buildPlatfrom;</pre><p>
         Add it to your <code class="function">mkDerivation</code> invocation.
        </p></td></tr></tbody></table></div></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-cross-usage" class="title" style="clear: both">9.3.&nbsp;Cross-building packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-usage" aria-label="Anchor link for: sec cross usage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Nixpkgs can be instantiated with <code class="varname">localSystem</code> alone, in which case there is no cross-compiling and everything is built by and for that system, or also with <code class="varname">crossSystem</code>, in which case packages run on the latter, but all building happens on the former. Both parameters take the same schema as the 3 (build, host, and target) platforms defined in the previous section. As mentioned above, <code class="literal">lib.systems.examples</code> has some platforms which are used as arguments for these parameters in practice. You can use them programmatically, or on the command line:
</p><pre class="programlisting hljs bash" xml:space="preserve">nix-build <span class="hljs-string"><span class="hljs-string">'&lt;nixpkgs&gt;'</span></span> --arg crossSystem <span class="hljs-string"><span class="hljs-string">'(import &lt;nixpkgs/lib&gt;).systems.examples.fooBarBaz'</span></span> -A whatever</pre><p>
    </p><div class="note"><h3 class="title" id="note">Note<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#note" aria-label="Anchor link for: note" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3><p>
      Eventually we would like to make these platform examples an unnecessary convenience so that
</p><pre class="programlisting hljs nix" xml:space="preserve">nix-build '&lt;nixpkgs&gt;' --arg crossSystem '{ <span class="hljs-attr"><span class="hljs-attr">config</span></span> = <span class="hljs-string"><span class="hljs-string">"&lt;arch&gt;-&lt;os&gt;-&lt;vendor&gt;-&lt;abi&gt;"</span></span>; }' -A whatever</pre><p>
      works in the vast majority of cases. The problem today is dependencies on other sorts of configuration which aren't given proper defaults. We rely on the examples to crudely to set those configuration parameters in some vaguely sane manner on the users behalf. Issue <a class="link" href="https://github.com/NixOS/nixpkgs/issues/34274" target="_top" shape="rect">#34274</a> tracks this inconvenience along with its root cause in crufty configuration options.
     </p></div><p>
     While one is free to pass both parameters in full, there's a lot of logic to fill in missing fields. As discussed in the previous section, only one of <code class="varname">system</code>, <code class="varname">config</code>, and <code class="varname">parsed</code> is needed to infer the other two. Additionally, <code class="varname">libc</code> will be inferred from <code class="varname">parse</code>. Finally, <code class="literal">localSystem.system</code> is also <span class="emphasis"><em>impurely</em></span> inferred based on the platform evaluation occurs. This means it is often not necessary to pass <code class="varname">localSystem</code> at all, as in the command-line example in the previous paragraph.
    </p><div class="alert alert-info"><strong>Note:</strong> 
      Many sources (manual, wiki, etc) probably mention passing <code class="varname">system</code>, <code class="varname">platform</code>, along with the optional <code class="varname">crossSystem</code> to nixpkgs: <code class="literal">import &lt;nixpkgs&gt; { system = ..; platform = ..; crossSystem = ..; }</code>. Passing those two instead of <code class="varname">localSystem</code> is still supported for compatibility, but is discouraged. Indeed, much of the inference we do for these parameters is motivated by compatibility as much as convenience.
     </div><p>
     One would think that <code class="varname">localSystem</code> and <code class="varname">crossSystem</code> overlap horribly with the three <code class="varname">*Platforms</code> (<code class="varname">buildPlatform</code>, <code class="varname">hostPlatform,</code> and <code class="varname">targetPlatform</code>; see <code class="varname">stage.nix</code> or the manual). Actually, those identifiers are purposefully not used here to draw a subtle but important distinction: While the granularity of having 3 platforms is necessary to properly *build* packages, it is overkill for specifying the user's *intent* when making a build plan or package set. A simple "build vs deploy" dichotomy is adequate: the sliding window principle described in the previous section shows how to interpolate between the these two "end points" to get the 3 platform triple for each bootstrapping stage. That means for any package a given package set, even those not bound on the top level but only reachable via dependencies or <code class="varname">buildPackages</code>, the three platforms will be defined as one of <code class="varname">localSystem</code> or <code class="varname">crossSystem</code>, with the former replacing the latter as one traverses build-time dependencies. A last simple difference is that <code class="varname">crossSystem</code> should be null when one doesn't want to cross-compile, while the <code class="varname">*Platform</code>s are always non-null. <code class="varname">localSystem</code> is always non-null.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-cross-infra" class="title" style="clear: both">9.4.&nbsp;Cross-compilation infrastructure<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-cross-infra" aria-label="Anchor link for: sec cross infra" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="ssec-cross-dependency-implementation" class="title">9.4.1.&nbsp;Implementation of dependencies<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-implementation" aria-label="Anchor link for: ssec cross dependency implementation" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The categorizes of dependencies developed in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-cross-dependency-categorization" title="9.2.2. Theory of dependency categorization" shape="rect">Section&nbsp;9.2.2, “Theory of dependency categorization”</a> are specified as lists of derivations given to <code class="varname">mkDerivation</code>, as documented in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-dependencies" title="6.3. Specifying dependencies" shape="rect">Section&nbsp;6.3, “Specifying dependencies”</a>. In short, each list of dependencies for "host → target" of "foo → bar" is called <code class="varname">depsFooBar</code>, with exceptions for backwards compatibility that <code class="varname">depsBuildHost</code> is instead called <code class="varname">nativeBuildInputs</code> and <code class="varname">depsHostTarget</code> is instead called <code class="varname">buildInputs</code>. Nixpkgs is now structured so that each <code class="varname">depsFooBar</code> is automatically taken from <code class="varname">pkgsFooBar</code>. (These <code class="varname">pkgsFooBar</code>s are quite new, so there is no special case for <code class="varname">nativeBuildInputs</code> and <code class="varname">buildInputs</code>.) For example, <code class="varname">pkgsBuildHost.gcc</code> should be used at build-time, while <code class="varname">pkgsHostTarget.gcc</code> should be used at run-time.
     </p><p>
      Now, for most of Nixpkgs's history, there were no <code class="varname">pkgsFooBar</code> attributes, and most packages have not been refactored to use it explicitly. Prior to those, there were just <code class="varname">buildPackages</code>, <code class="varname">pkgs</code>, and <code class="varname">targetPackages</code>. Those are now redefined as aliases to <code class="varname">pkgsBuildHost</code>, <code class="varname">pkgsHostTarget</code>, and <code class="varname">pkgsTargetTarget</code>. It is acceptable, even recommended, to use them for libraries to show that the host platform is irrelevant.
     </p><p>
      But before that, there was just <code class="varname">pkgs</code>, even though both <code class="varname">buildInputs</code> and <code class="varname">nativeBuildInputs</code> existed. [Cross barely worked, and those were implemented with some hacks on <code class="varname">mkDerivation</code> to override dependencies.] What this means is the vast majority of packages do not use any explicit package set to populate their dependencies, just using whatever <code class="varname">callPackage</code> gives them even if they do correctly sort their dependencies into the multiple lists described above. And indeed, asking that users both sort their dependencies, <span class="emphasis"><em>and</em></span> take them from the right attribute set, is both too onerous and redundant, so the recommended approach (for now) is to continue just categorizing by list and not using an explicit package set.
     </p><p>
      To make this work, we "splice" together the six <code class="varname">pkgsFooBar</code> package sets and have <code class="varname">callPackage</code> actually take its arguments from that. This is currently implemented in <code class="filename">pkgs/top-level/splice.nix</code>. <code class="varname">mkDerivation</code> then, for each dependency attribute, pulls the right derivation out from the splice. This splicing can be skipped when not cross-compiling as the package sets are the same, but still is a bit slow for cross-compiling. We'd like to do something better, but haven't come up with anything yet.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-bootstrapping" class="title">9.4.2.&nbsp;Bootstrapping<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-bootstrapping" aria-label="Anchor link for: ssec bootstrapping" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Each of the package sets described above come from a single bootstrapping stage. While <code class="filename">pkgs/top-level/default.nix</code>, coordinates the composition of stages at a high level, <code class="filename">pkgs/top-level/stage.nix</code> "ties the knot" (creates the fixed point) of each stage. The package sets are defined per-stage however, so they can be thought of as edges between stages (the nodes) in a graph. Compositions like <code class="literal">pkgsBuildTarget.targetPackages</code> can be thought of as paths to this graph.
     </p><p>
      While there are many package sets, and thus many edges, the stages can also be arranged in a linear chain. In other words, many of the edges are redundant as far as connectivity is concerned. This hinges on the type of bootstrapping we do. Currently for cross it is:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
         <code class="literal">(native, native, native)</code>
        </p></li><li class="listitem"><p>
         <code class="literal">(native, native, foreign)</code>
        </p></li><li class="listitem"><p>
         <code class="literal">(native, foreign, foreign)</code>
        </p></li></ol></div><p>
      In each stage, <code class="varname">pkgsBuildHost</code> refers to the previous stage, <code class="varname">pkgsBuildBuild</code> refers to the one before that, and <code class="varname">pkgsHostTarget</code> refers to the current one, and <code class="varname">pkgsTargetTarget</code> refers to the next one. When there is no previous or next stage, they instead refer to the current stage. Note how all the invariants regarding the mapping between dependency and depending packages' build host and target platforms are preserved. <code class="varname">pkgsBuildTarget</code> and <code class="varname">pkgsHostHost</code> are more complex in that the stage fitting the requirements isn't always a fixed chain of "prevs" and "nexts" away (modulo the "saturating" self-references at the ends). We just special case each instead. All the primary edges are implemented is in <code class="filename">pkgs/stdenv/booter.nix</code>, and secondarily aliases in <code class="filename">pkgs/top-level/stage.nix</code>.
     </p><div class="alert alert-info"><strong>Note:</strong> 
       Note the native stages are bootstrapped in legacy ways that predate the current cross implementation. This is why the bootstrapping stages leading up to the final stages are ignored inthe previous paragraph.
      </div><p>
      If one looks at the 3 platform triples, one can see that they overlap such that one could put them together into a chain like:
</p><pre class="programlisting hljs" xml:space="preserve">(native, native, native, foreign, foreign)
</pre><p>
      If one imagines the saturating self references at the end being replaced with infinite stages, and then overlays those platform triples, one ends up with the infinite tuple:
</p><pre class="programlisting hljs" xml:space="preserve">(native..., native, native, native, foreign, foreign, foreign...)
</pre><p>
      On can then imagine any sequence of platforms such that there are bootstrap stages with their 3 platforms determined by "sliding a window" that is the 3 tuple through the sequence. This was the original model for bootstrapping. Without a target platform (assume a better world where all compilers are multi-target and all standard libraries are built in their own derivation), this is sufficient. Conversely if one wishes to cross compile "faster", with a "Canadian Cross" bootstraping stage where <code class="literal">build != host != target</code>, more bootstrapping stages are needed since no sliding window providess the pesky <code class="varname">pkgsBuildTarget</code> package set since it skips the Canadian cross stage's "host".
     </p><div class="note"><h3 class="title" id="note-1">Note<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#note-1" aria-label="Anchor link for: note 1" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3><p>
       It is much better to refer to <code class="varname">buildPackages</code> than <code class="varname">targetPackages</code>, or more broadly package sets that do not mention "target". There are three reasons for this.
      </p><p>
       First, it is because bootstrapping stages do not have a unique <code class="varname">targetPackages</code>. For example a <code class="literal">(x86-linux, x86-linux, arm-linux)</code> and <code class="literal">(x86-linux, x86-linux, x86-windows)</code> package set both have a <code class="literal">(x86-linux, x86-linux, x86-linux)</code> package set. Because there is no canonical <code class="varname">targetPackages</code> for such a native (<code class="literal">build == host == target</code>) package set, we set their <code class="varname">targetPackages</code>
      </p><p>
       Second, it is because this is a frequent source of hard-to-follow "infinite recursions" / cycles. When only package sets that don't mention target are used, the package set forms a directed acyclic graph. This means that all cycles that exist are confined to one stage. This means they are a lot smaller, and easier to follow in the code or a backtrace. It also means they are present in native and cross builds alike, and so more likely to be caught by CI and other users.
      </p><p>
       Thirdly, it is because everything target-mentioning only exists to accommodate compilers with lousy build systems that insist on the compiler itself and standard library being built together. Of course that is bad because bigger derivations means longer rebuilds. It is also problematic because it tends to make the standard libraries less like other libraries than they could be, complicating code and build systems alike. Because of the other problems, and because of these innate disadvantages, compilers ought to be packaged another way where possible.
      </p></div><div class="alert alert-info"><strong>Note:</strong> 
       If one explores Nixpkgs, they will see derivations with names like <code class="literal">gccCross</code>. Such <code class="literal">*Cross</code> derivations is a holdover from before we properly distinguished between the host and target platforms—the derivation with "Cross" in the name covered the <code class="literal">build = host != target</code> case, while the other covered the <code class="literal">host = target</code>, with build platform the same or not based on whether one was using its <code class="literal">.nativeDrv</code> or <code class="literal">.crossDrv</code>. This ugliness will disappear soon.
      </div></section></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-platform-notes" class="title">Chapter&nbsp;10.&nbsp;Platform Notes<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-platform-notes" aria-label="Anchor link for: chap platform notes" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin" shape="rect">10.1. Darwin (macOS)</a></span></dt></dl></div><section class="section"><div class="titlepage"><div><div><h2 id="sec-darwin" class="title" style="clear: both">10.1.&nbsp;Darwin (macOS)<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin" aria-label="Anchor link for: sec darwin" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Some common issues when packaging software for Darwin:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       The Darwin <code class="literal">stdenv</code> uses clang instead of gcc. When referring to the compiler <code class="varname">$CC</code> or <span class="command"><strong>cc</strong></span> will work in both cases. Some builds hardcode gcc/g++ in their build scripts, that can usually be fixed with using something like <code class="literal">makeFlags = [ "CC=cc" ];</code> or by patching the build scripts.
      </p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"libfoo-1.2.3"</span></span>;
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  <span class="hljs-attr"><span class="hljs-attr">buildPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
    $CC -o hello hello.c
  ''</span></span>;
}
</pre></li><li class="listitem"><p>
       On Darwin, libraries are linked using absolute paths, libraries are resolved by their <code class="literal">install_name</code> at link time. Sometimes packages won't set this correctly causing the library lookups to fail at runtime. This can be fixed by adding extra linker flags or by running <span class="command"><strong>install_name_tool -id</strong></span> during the <code class="function">fixupPhase</code>.
      </p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"libfoo-1.2.3"</span></span>;
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  <span class="hljs-attr"><span class="hljs-attr">makeFlags</span></span> = stdenv.lib.optional stdenv.isDarwin <span class="hljs-string"><span class="hljs-string">"LDFLAGS=-Wl,-install_name,$(out)/lib/libfoo.dylib"</span></span>;
}
</pre></li><li class="listitem"><p>
       Even if the libraries are linked using absolute paths and resolved via their <code class="literal">install_name</code> correctly, tests can sometimes fail to run binaries. This happens because the <code class="varname">checkPhase</code> runs before the libraries are installed.
      </p><p>
       This can usually be solved by running the tests after the <code class="varname">installPhase</code> or alternatively by using <code class="varname">DYLD_LIBRARY_PATH</code>. More information about this variable can be found in the <span class="citerefentry"><span class="refentrytitle">dyld</span>(1)</span> manpage.
      </p><pre class="programlisting hljs bash" xml:space="preserve">dyld: Library not loaded: /nix/store/7hnmbscpayxzxrixrgxvvlifzlxdsdir-jq-1.5-lib/lib/libjq.1.dylib
Referenced from: /private/tmp/nix-build-jq-1.5.drv-0/jq-1.5/tests/../jq
Reason: image not found
./tests/jqtest: line 5: 75779 Abort <span class="hljs-built_in"><span class="hljs-built_in">trap</span></span>: 6
</pre><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"libfoo-1.2.3"</span></span>;
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  <span class="hljs-attr"><span class="hljs-attr">doInstallCheck</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">installCheckTarget</span></span> = <span class="hljs-string"><span class="hljs-string">"check"</span></span>;
}
</pre></li><li class="listitem"><p>
       Some packages assume xcode is available and use <span class="command"><strong>xcrun</strong></span> to resolve build tools like <span class="command"><strong>clang</strong></span>, etc. This causes errors like <code class="code">xcode-select: error: no developer tools were found at '/Applications/Xcode.app'</code> while the build doesn't actually depend on xcode.
      </p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"libfoo-1.2.3"</span></span>;
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  <span class="hljs-attr"><span class="hljs-attr">prePatch</span></span> = <span class="hljs-string"><span class="hljs-string">''
    substituteInPlace Makefile \
        --replace '/usr/bin/xcrun clang' clang
  ''</span></span>;
}
</pre><p>
       The package <code class="literal">xcbuild</code> can be used to build projects that really depend on Xcode. However, this replacement is not 100% compatible with Xcode and can occasionally cause issues.
      </p></li></ul></div></section></section></div><div class="part"><div class="titlepage"><div><div><div class="page-header"><h1 id="idm140737319477504" class="title">Part&nbsp;III.&nbsp;Builders<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#idm140737319477504" aria-label="Anchor link for: idm140737319477504" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h1></div></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers" shape="rect">11. Fetchers</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-trivial-builders" shape="rect">12. Trivial builders</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-special" shape="rect">13. Special builders</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-images" shape="rect">14. Images</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support" shape="rect">15. Languages and frameworks</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-packages" shape="rect">16. Packages</a></span></dt></dl></div><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-pkgs-fetchers" class="title">Chapter&nbsp;11.&nbsp;Fetchers<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers" aria-label="Anchor link for: chap pkgs fetchers" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
    When using Nix, you will frequently need to download source code and other files from the internet. Nixpkgs comes with a few helper functions that allow you to fetch fixed-output derivations in a structured way.
   </p><p>
    The two fetcher primitives are <code class="function">fetchurl</code> and <code class="function">fetchzip</code>. Both of these have two required arguments, a URL and a hash. The hash is typically <code class="literal">sha256</code>, although many more hash algorithms are supported. Nixpkgs contributors are currently recommended to use <code class="literal">sha256</code>. This hash will be used by Nix to identify your source. A typical usage of fetchurl is provided below.
   </p><pre class="programlisting hljs nix" xml:space="preserve">{ stdenv, fetchurl }:

stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://www.example.org/hello.tar.gz"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1111111111111111111111111111111111111111111111111111"</span></span>;
  };
}
</pre><p>
    The main difference between <code class="function">fetchurl</code> and <code class="function">fetchzip</code> is in how they store the contents. <code class="function">fetchurl</code> will store the unaltered contents of the URL within the Nix store. <code class="function">fetchzip</code> on the other hand will decompress the archive for you, making files and directories directly accessible in the future. <code class="function">fetchzip</code> can only be used with archives. Despite the name, <code class="function">fetchzip</code> is not limited to .zip files and can also be used with any tarball.
   </p><p>
    <code class="function">fetchpatch</code> works very similarly to <code class="function">fetchurl</code> with the same arguments expected. It expects patch files as a source and and performs normalization on them before computing the checksum. For example it will remove comments or other unstable parts that are sometimes added by version control systems and can change over time.
   </p><p>
    Other fetcher functions allow you to add source code directly from a VCS such as subversion or git. These are mostly straightforward names based on the name of the command used with the VCS system. Because they give you a working repository, they act most like <code class="function">fetchzip</code>.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="literal">fetchsvn</code>
     </span></dt><dd><p>
       Used with Subversion. Expects <code class="literal">url</code> to a Subversion directory, <code class="literal">rev</code>, and <code class="literal">sha256</code>.
      </p></dd><dt><span class="term">
      <code class="literal">fetchgit</code>
     </span></dt><dd><p>
       Used with Git. Expects <code class="literal">url</code> to a Git repo, <code class="literal">rev</code>, and <code class="literal">sha256</code>. <code class="literal">rev</code> in this case can be full the git commit id (SHA1 hash) or a tag name like <code class="literal">refs/tags/v1.0</code>.
      </p></dd><dt><span class="term">
      <code class="literal">fetchfossil</code>
     </span></dt><dd><p>
       Used with Fossil. Expects <code class="literal">url</code> to a Fossil archive, <code class="literal">rev</code>, and <code class="literal">sha256</code>.
      </p></dd><dt><span class="term">
      <code class="literal">fetchcvs</code>
     </span></dt><dd><p>
       Used with CVS. Expects <code class="literal">cvsRoot</code>, <code class="literal">tag</code>, and <code class="literal">sha256</code>.
      </p></dd><dt><span class="term">
      <code class="literal">fetchhg</code>
     </span></dt><dd><p>
       Used with Mercurial. Expects <code class="literal">url</code>, <code class="literal">rev</code>, and <code class="literal">sha256</code>.
      </p></dd></dl></div><p>
    A number of fetcher functions wrap part of <code class="function">fetchurl</code> and <code class="function">fetchzip</code>. They are mainly convenience functions intended for commonly used destinations of source code in Nixpkgs. These wrapper fetchers are listed below.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="literal">fetchFromGitHub</code>
     </span></dt><dd><p>
       <code class="function">fetchFromGitHub</code> expects four arguments. <code class="literal">owner</code> is a string corresponding to the GitHub user or organization that controls this repository. <code class="literal">repo</code> corresponds to the name of the software repository. These are located at the top of every GitHub HTML page as <code class="literal">owner</code>/<code class="literal">repo</code>. <code class="literal">rev</code> corresponds to the Git commit hash or tag (e.g <code class="literal">v1.0</code>) that will be downloaded from Git. Finally, <code class="literal">sha256</code> corresponds to the hash of the extracted directory. Again, other hash algorithms are also available but <code class="literal">sha256</code> is currently preferred.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromGitLab</code>
     </span></dt><dd><p>
       This is used with GitLab repositories. The arguments expected are very similar to fetchFromGitHub above.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromGitiles</code>
     </span></dt><dd><p>
       This is used with Gitiles repositories. The arguments expected are similar to fetchgit.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromBitbucket</code>
     </span></dt><dd><p>
       This is used with BitBucket repositories. The arguments expected are very similar to fetchFromGitHub above.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromSavannah</code>
     </span></dt><dd><p>
       This is used with Savannah repositories. The arguments expected are very similar to fetchFromGitHub above.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromRepoOrCz</code>
     </span></dt><dd><p>
       This is used with repo.or.cz repositories. The arguments expected are very similar to fetchFromGitHub above.
      </p></dd></dl></div></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-trivial-builders" class="title">Chapter&nbsp;12.&nbsp;Trivial builders<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-trivial-builders" aria-label="Anchor link for: chap trivial builders" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
    Nixpkgs provides a couple of functions that help with building derivations. The most important one, <code class="function">stdenv.mkDerivation</code>, has already been documented above. The following functions wrap <code class="function">stdenv.mkDerivation</code>, making it easier to use in certain cases.
   </p><div class="variablelist"><dl class="variablelist"><dt><a id="trivial-builder-runCommand" shape="rect"></a><span class="term">
      <code class="literal">runCommand</code>
     </span></dt><dd><p>
       This takes three arguments, <code class="literal">name</code>, <code class="literal">env</code>, and <code class="literal">buildCommand</code>. <code class="literal">name</code> is just the name that Nix will append to the store path in the same way that <code class="literal">stdenv.mkDerivation</code> uses its <code class="literal">name</code> attribute. <code class="literal">env</code> is an attribute set specifying environment variables that will be set for this derivation. These attributes are then passed to the wrapped <code class="literal">stdenv.mkDerivation</code>. <code class="literal">buildCommand</code> specifies the commands that will be run to create this derivation. Note that you will need to create <code class="literal">$out</code> for Nix to register the command as successful.
      </p><p>
       An example of using <code class="literal">runCommand</code> is provided below.
      </p><pre class="programlisting hljs bash" xml:space="preserve">(import &lt;nixpkgs&gt; {}).runCommand <span class="hljs-string"><span class="hljs-string">"my-example"</span></span> {} <span class="hljs-string"><span class="hljs-string">''</span></span>
  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> My example <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> is running

  mkdir <span class="hljs-variable"><span class="hljs-variable">$out</span></span>

  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> I can write data to the Nix store &gt; <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/message

  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> I can also run basic commands like:

  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ls
  ls

  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> whoami
  whoami

  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> date
  date
<span class="hljs-string"><span class="hljs-string">''</span></span>
</pre></dd><dt><a id="trivial-builder-runCommandCC" shape="rect"></a><span class="term">
      <code class="literal">runCommandCC</code>
     </span></dt><dd><p>
       This works just like <code class="literal">runCommand</code>. The only difference is that it also provides a C compiler in <code class="literal">buildCommand</code>’s environment. To minimize your dependencies, you should only use this if you are sure you will need a C compiler as part of running your command.
      </p></dd><dt><a id="trivial-builder-runCommandLocal" shape="rect"></a><span class="term">
      <code class="literal">runCommandLocal</code>
     </span></dt><dd><p>
       Variant of <code class="literal">runCommand</code> that forces the derivation to be built locally, it is not substituted. This is intended for very cheap commands (&lt;1s execution time). It saves on the network roundrip and can speed up a build.
      </p><div class="alert alert-info"><strong>Note:</strong> 
        This sets <a class="link" href="https://nixos.org/nix/manual/#adv-attr-allowSubstitutes" target="_top" shape="rect"><code class="literal">allowSubstitutes</code> to <code class="literal">false</code></a>, so only use <code class="literal">runCommandLocal</code> if you are certain the user will always have a builder for the <code class="literal">system</code> of the derivation. This should be true for most trivial use cases (e.g. just copying some files to a different location or adding symlinks), because there the <code class="literal">system</code> is usually the same as <code class="literal">builtins.currentSystem</code>.
       </div></dd><dt><a id="trivial-builder-writeText" shape="rect"></a><span class="term">
      <code class="literal">writeTextFile</code>, <code class="literal">writeText</code>, <code class="literal">writeTextDir</code>, <code class="literal">writeScript</code>, <code class="literal">writeScriptBin</code>
     </span></dt><dd><p>
       These functions write <code class="literal">text</code> to the Nix store. This is useful for creating scripts from Nix expressions. <code class="literal">writeTextFile</code> takes an attribute set and expects two arguments, <code class="literal">name</code> and <code class="literal">text</code>. <code class="literal">name</code> corresponds to the name used in the Nix store path. <code class="literal">text</code> will be the contents of the file. You can also set <code class="literal">executable</code> to true to make this file have the executable bit set.
      </p><p>
       Many more commands wrap <code class="literal">writeTextFile</code> including <code class="literal">writeText</code>, <code class="literal">writeTextDir</code>, <code class="literal">writeScript</code>, and <code class="literal">writeScriptBin</code>. These are convenience functions over <code class="literal">writeTextFile</code>.
      </p></dd><dt><a id="trivial-builder-symlinkJoin" shape="rect"></a><span class="term">
      <code class="literal">symlinkJoin</code>
     </span></dt><dd><p>
       This can be used to put many derivations into the same directory structure. It works by creating a new derivation and adding symlinks to each of the paths listed. It expects two arguments, <code class="literal">name</code>, and <code class="literal">paths</code>. <code class="literal">name</code> is the name used in the Nix store path for the created derivation. <code class="literal">paths</code> is a list of paths that will be symlinked. These paths can be to Nix store derivations or any other subdirectory contained within.
      </p></dd></dl></div></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-special" class="title">Chapter&nbsp;13.&nbsp;Special builders<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-special" aria-label="Anchor link for: chap special" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-fhs-environments" shape="rect">13.1. buildFHSUserEnv</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell" shape="rect">13.2. pkgs.mkShell</a></span></dt></dl></div><p>
    This chapter describes several special builders.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-fhs-environments" class="title" style="clear: both">13.1.&nbsp;buildFHSUserEnv<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-fhs-environments" aria-label="Anchor link for: sec fhs environments" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <code class="function">buildFHSUserEnv</code> provides a way to build and run FHS-compatible lightweight sandboxes. It creates an isolated root with bound <code class="filename">/nix/store</code>, so its footprint in terms of disk space needed is quite small. This allows one to run software which is hard or unfeasible to patch for NixOS -- 3rd-party source trees with FHS assumptions, games distributed as tarballs, software with integrity checking and/or external self-updated binaries. It uses Linux namespaces feature to create temporary lightweight environments which are destroyed after all child processes exit, without root user rights requirement. Accepted arguments are:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="literal">name</code>
      </span></dt><dd><p>
        Environment name.
       </p></dd><dt><span class="term">
       <code class="literal">targetPkgs</code>
      </span></dt><dd><p>
        Packages to be installed for the main host's architecture (i.e. x86_64 on x86_64 installations). Along with libraries binaries are also installed.
       </p></dd><dt><span class="term">
       <code class="literal">multiPkgs</code>
      </span></dt><dd><p>
        Packages to be installed for all architectures supported by a host (i.e. i686 and x86_64 on x86_64 installations). Only libraries are installed by default.
       </p></dd><dt><span class="term">
       <code class="literal">extraBuildCommands</code>
      </span></dt><dd><p>
        Additional commands to be executed for finalizing the directory structure.
       </p></dd><dt><span class="term">
       <code class="literal">extraBuildCommandsMulti</code>
      </span></dt><dd><p>
        Like <code class="literal">extraBuildCommands</code>, but executed only on multilib architectures.
       </p></dd><dt><span class="term">
       <code class="literal">extraOutputsToInstall</code>
      </span></dt><dd><p>
        Additional derivation outputs to be linked for both target and multi-architecture packages.
       </p></dd><dt><span class="term">
       <code class="literal">extraInstallCommands</code>
      </span></dt><dd><p>
        Additional commands to be executed for finalizing the derivation with runner script.
       </p></dd><dt><span class="term">
       <code class="literal">runScript</code>
      </span></dt><dd><p>
        A command that would be executed inside the sandbox and passed all the command line arguments. It defaults to <code class="literal">bash</code>.
       </p></dd></dl></div><p>
     One can create a simple environment using a <code class="literal">shell.nix</code> like that:
    </p><pre class="programlisting hljs nix" xml:space="preserve">{ pkgs ? <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {} }:

(pkgs.buildFHSUserEnv {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"simple-x11-env"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">targetPkgs</span></span> = pkgs: (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs;
    [ udev
      alsaLib
    ]) ++ (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.xorg;
    [ libX11
      libXcursor
      libXrandr
    ]);
  <span class="hljs-attr"><span class="hljs-attr">multiPkgs</span></span> = pkgs: (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs;
    [ udev
      alsaLib
    ]);
  <span class="hljs-attr"><span class="hljs-attr">runScript</span></span> = <span class="hljs-string"><span class="hljs-string">"bash"</span></span>;
}).env
</pre><p>
     Running <code class="literal">nix-shell</code> would then drop you into a shell with these libraries and binaries available. You can use this to run closed-source applications which expect FHS structure without hassles: simply change <code class="literal">runScript</code> to the application path, e.g. <code class="filename">./bin/start.sh</code> -- relative paths are supported.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkgs-mkShell" class="title" style="clear: both">13.2.&nbsp;pkgs.mkShell<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell" aria-label="Anchor link for: sec pkgs mkShell" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <code class="function">pkgs.mkShell</code> is a special kind of derivation that is only useful when using it combined with <span class="command"><strong>nix-shell</strong></span>. It will in fact fail to instantiate when invoked with <span class="command"><strong>nix-build</strong></span>.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-pkgs-mkShell-usage" class="title">13.2.1.&nbsp;Usage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell-usage" aria-label="Anchor link for: sec pkgs mkShell usage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><pre class="programlisting hljs nix" xml:space="preserve">{ pkgs ? <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {} }:
pkgs.mkShell {
  <span class="hljs-comment"><span class="hljs-comment"># this will make all the build inputs from hello and gnutar</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># available to the shell environment</span></span>
  <span class="hljs-attr"><span class="hljs-attr">inputsFrom</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; [ hello gnutar ];
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ pkgs.gnumake ];
}
</pre></section></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-images" class="title">Chapter&nbsp;14.&nbsp;Images<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-images" aria-label="Anchor link for: chap images" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-appimageTools" shape="rect">14.1. pkgs.appimageTools</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-dockerTools" shape="rect">14.2. pkgs.dockerTools</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-ociTools" shape="rect">14.3. pkgs.ociTools</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-snapTools" shape="rect">14.4. pkgs.snapTools</a></span></dt></dl></div><p>
    This chapter describes tools for creating various types of images.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkgs-appimageTools" class="title" style="clear: both">14.1.&nbsp;pkgs.appimageTools<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-appimageTools" aria-label="Anchor link for: sec pkgs appimageTools" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <code class="varname">pkgs.appimageTools</code> is a set of functions for extracting and wrapping <a class="link" href="https://appimage.org/" target="_top" shape="rect">AppImage</a> files. They are meant to be used if traditional packaging from source is infeasible, or it would take too long. To quickly run an AppImage file, <code class="literal">pkgs.appimage-run</code> can be used as well.
    </p><div class="alert alert-warning"><strong>Warning:</strong> 
      The <code class="varname">appimageTools</code> API is unstable and may be subject to backwards-incompatible changes in the future.
     </div><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-appimageTools-formats" class="title">14.1.1.&nbsp;AppImage formats<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-appimageTools-formats" aria-label="Anchor link for: ssec pkgs appimageTools formats" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      There are different formats for AppImages, see <a class="link" href="https://github.com/AppImage/AppImageSpec/blob/74ad9ca2f94bf864a4a0dac1f369dd4f00bd1c28/draft.md#image-format" target="_top" shape="rect">the specification</a> for details.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Type 1 images are ISO 9660 files that are also ELF executables.
       </p></li><li class="listitem"><p>
        Type 2 images are ELF executables with an appended filesystem.
       </p></li></ul></div><p>
      They can be told apart with <span class="command"><strong>file -k</strong></span>:
     </p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code>file -k type1.AppImage
type1.AppImage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV) ISO 9660 CD-ROM filesystem data <span class="hljs-string"><span class="hljs-string">'AppImage'</span></span> (Lepton 3.x), scale 0-0,
spot sensor temperature 0.000000, unit celsius, color scheme 0, calibration: offset 0.000000, slope 0.000000, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GNU/Linux 2.6.18, BuildID[sha1]=d629f6099d2344ad82818172add1d38c5e11bc6d, stripped\012- data

<code class="prompt">$ </code>file -k type2.AppImage
type2.AppImage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV) (Lepton 3.x), scale 232-60668, spot sensor temperature -4.187500, color scheme 15, show scale bar, calibration: offset -0.000000, slope 0.000000 (Lepton 2.x), scale 4111-45000, spot sensor temperature 412442.250000, color scheme 3, minimum point enabled, calibration: offset -75402534979642766821519867692934234112.000000, slope 5815371847733706829839455140374904832.000000, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GNU/Linux 2.6.18, BuildID[sha1]=79dcc4e55a61c293c5e19edbd8d65b202842579f, stripped\012- data
</pre><p>
      Note how the type 1 AppImage is described as an <code class="literal">ISO 9660 CD-ROM filesystem</code>, and the type 2 AppImage is not.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-appimageTools-wrapping" class="title">14.1.2.&nbsp;Wrapping<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-appimageTools-wrapping" aria-label="Anchor link for: ssec pkgs appimageTools wrapping" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Depending on the type of AppImage you're wrapping, you'll have to use <code class="varname">wrapType1</code> or <code class="varname">wrapType2</code>.
     </p><pre class="programlisting hljs nix" xml:space="preserve">appimageTools.wrapType2 { <span class="hljs-comment"><span class="hljs-comment"># or wrapType1</span></span>
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"patchwork"</span></span>; <a id="ex-appimageTools-wrapping-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl { <a id="ex-appimageTools-wrapping-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/ssbc/patchwork/releases/download/v3.11.4/Patchwork-3.11.4-linux-x86_64.AppImage"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> =  <span class="hljs-string"><span class="hljs-string">"1blsprpkvm0ws9b96gb36f0rbf8f5jgmw4x6dsb1kswr4ysf591s"</span></span>;
  };
  <span class="hljs-attr"><span class="hljs-attr">extraPkgs</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; [ ]; <a id="ex-appimageTools-wrapping-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>
}</pre><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-appimageTools-wrapping-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">name</code> specifies the name of the resulting image.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-appimageTools-wrapping-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">src</code> specifies the AppImage file to extract.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-appimageTools-wrapping-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">extraPkgs</code> allows you to pass a function to include additional packages inside the FHS environment your AppImage is going to run in. There are a few ways to learn which dependencies an application needs:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           Looking through the extracted AppImage files, reading its scripts and running <span class="command"><strong>patchelf</strong></span> and <span class="command"><strong>ldd</strong></span> on its executables. This can also be done in <span class="command"><strong>appimage-run</strong></span>, by setting <span class="command"><strong>APPIMAGE_DEBUG_EXEC=bash</strong></span>.
          </p></li><li class="listitem"><p>
           Running <span class="command"><strong>strace -vfefile</strong></span> on the wrapped executable, looking for libraries that can't be found.
          </p></li></ul></div><p>
       </p></td></tr></tbody></table></div></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkgs-dockerTools" class="title" style="clear: both">14.2.&nbsp;pkgs.dockerTools<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-dockerTools" aria-label="Anchor link for: sec pkgs dockerTools" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <code class="varname">pkgs.dockerTools</code> is a set of functions for creating and manipulating Docker images according to the <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#docker-image-specification-v120" target="_top" shape="rect"> Docker Image Specification v1.2.0 </a>. Docker itself is not used to perform any of the operations done by these functions.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-dockerTools-buildImage" class="title">14.2.1.&nbsp;buildImage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildImage" aria-label="Anchor link for: ssec pkgs dockerTools buildImage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      This function is analogous to the <span class="command"><strong>docker build</strong></span> command, in that it can be used to build a Docker-compatible repository tarball containing a single image with one or multiple layers. As such, the result is suitable for being loaded in Docker with <span class="command"><strong>docker load</strong></span>.
     </p><p>
      The parameters of <code class="varname">buildImage</code> with relative example values are described below:
     </p><div class="example"><a id="ex-dockerTools-buildImage" shape="rect"></a><p class="title"><strong>Example&nbsp;14.1.&nbsp;Docker build</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">buildImage {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"redis"</span></span>; <a id="ex-dockerTools-buildImage-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">tag</span></span> = <span class="hljs-string"><span class="hljs-string">"latest"</span></span>; <a id="ex-dockerTools-buildImage-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">fromImage</span></span> = someBaseImage; <a id="ex-dockerTools-buildImage-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">fromImageName</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <a id="ex-dockerTools-buildImage-4" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">fromImageTag</span></span> = <span class="hljs-string"><span class="hljs-string">"latest"</span></span>; <a id="ex-dockerTools-buildImage-5" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/5.svg" alt="5" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">contents</span></span> = pkgs.redis; <a id="ex-dockerTools-buildImage-6" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/6.svg" alt="6" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">runAsRoot</span></span> = <span class="hljs-string"><span class="hljs-string">'' </span></span><a id="ex-dockerTools-buildImage-runAsRoot" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/7.svg" alt="7" border="0"></span><span class="hljs-string"><span class="hljs-string">
    #!</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.runtimeShell}</span></span></span><span class="hljs-string">
    mkdir -p /data
  ''</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">config</span></span> = { <a id="ex-dockerTools-buildImage-8" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/8.svg" alt="8" border="0"></span>
    <span class="hljs-attr"><span class="hljs-attr">Cmd</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/bin/redis-server"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">WorkingDir</span></span> = <span class="hljs-string"><span class="hljs-string">"/data"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">Volumes</span></span> = {
      <span class="hljs-string"><span class="hljs-string">"/data"</span></span> = {};
    };
  };
}
</pre></div></div><br class="example-break" clear="none"><br><p>
      The above example will build a Docker image <code class="literal">redis/latest</code> from the given base image. Loading and running this image in Docker results in <code class="literal">redis-server</code> being started automatically.
     </p><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">name</code> specifies the name of the resulting image. This is the only required argument for <code class="varname">buildImage</code>.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">tag</code> specifies the tag of the resulting image. By default it's <code class="literal">null</code>, which indicates that the nix output hash will be used as tag.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">fromImage</code> is the repository tarball containing the base image. It must be a valid Docker image, such as exported by <span class="command"><strong>docker save</strong></span>. By default it's <code class="literal">null</code>, which can be seen as equivalent to <code class="literal">FROM scratch</code> of a <code class="filename">Dockerfile</code>.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-4" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">fromImageName</code> can be used to further specify the base image within the repository, in case it contains multiple images. By default it's <code class="literal">null</code>, in which case <code class="varname">buildImage</code> will peek the first image available in the repository.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-5" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/5.svg" alt="5" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">fromImageTag</code> can be used to further specify the tag of the base image within the repository, in case an image contains multiple tags. By default it's <code class="literal">null</code>, in which case <code class="varname">buildImage</code> will peek the first tag available for the base image.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-6" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/6.svg" alt="6" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">contents</code> is a derivation that will be copied in the new layer of the resulting image. This can be similarly seen as <span class="command"><strong>ADD contents/ /</strong></span> in a <code class="filename">Dockerfile</code>. By default it's <code class="literal">null</code>.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-runAsRoot" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/7.svg" alt="7" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">runAsRoot</code> is a bash script that will run as root in an environment that overlays the existing layers of the base image with the new resulting layer, including the previously copied <code class="varname">contents</code> derivation. This can be similarly seen as <span class="command"><strong>RUN ...</strong></span> in a <code class="filename">Dockerfile</code>.
        </p><div class="alert alert-info"><strong>Note:</strong> 
          Using this parameter requires the <code class="literal">kvm</code> device to be available.
         </div><p>
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-8" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/8.svg" alt="8" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">config</code> is used to specify the configuration of the containers that will be started off the built image in Docker. The available options are listed in the <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#image-json-field-descriptions" target="_top" shape="rect"> Docker Image Specification v1.2.0 </a>.
       </p></td></tr></tbody></table></div><p>
      After the new layer has been created, its closure (to which <code class="varname">contents</code>, <code class="varname">config</code> and <code class="varname">runAsRoot</code> contribute) will be copied in the layer itself. Only new dependencies that are not already in the existing layers will be copied.
     </p><p>
      At the end of the process, only one new single layer will be produced and added to the resulting image.
     </p><p>
      The resulting repository will only list the single image <code class="varname">image/tag</code>. In the case of <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage" title="Example 14.1. Docker build" shape="rect">Example&nbsp;14.1, “Docker build”</a> it would be <code class="varname">redis/latest</code>.
     </p><p>
      It is possible to inspect the arguments with which an image was built using its <code class="varname">buildArgs</code> attribute.
     </p><div class="alert alert-info"><strong>Note:</strong> 
       If you see errors similar to <code class="literal">getProtocolByName: does not exist (no such protocol name: tcp)</code> you may need to add <code class="literal">pkgs.iana-etc</code> to <code class="varname">contents</code>.
      </div><div class="alert alert-info"><strong>Note:</strong> 
       If you see errors similar to <code class="literal">Error_Protocol ("certificate has unknown CA",True,UnknownCa)</code> you may need to add <code class="literal">pkgs.cacert</code> to <code class="varname">contents</code>.
      </div><div class="example"><a id="example-pkgs-dockerTools-buildImage-creation-date" shape="rect"></a><p class="title"><strong>Example&nbsp;14.2.&nbsp;Impurely Defining a Docker Layer's Creation Date</strong></p><div class="example-contents"><p>
       By default <code class="function">buildImage</code> will use a static date of one second past the UNIX Epoch. This allows <code class="function">buildImage</code> to produce binary reproducible images. When listing images with <span class="command"><strong>docker images</strong></span>, the newly created images will be listed like this:
      </p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>docker images
REPOSITORY   TAG      IMAGE ID       CREATED        SIZE
hello        latest   08c791c7846e   48 years ago   25.2MB
</pre><p>
       You can break binary reproducibility but have a sorted, meaningful <code class="literal">CREATED</code> column by setting <code class="literal">created</code> to <code class="literal">now</code>.
      </p><pre class="programlisting hljs nix" xml:space="preserve">pkgs.dockerTools.buildImage {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">tag</span></span> = <span class="hljs-string"><span class="hljs-string">"latest"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">created</span></span> = <span class="hljs-string"><span class="hljs-string">"now"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">contents</span></span> = pkgs.hello;

  config.<span class="hljs-attr"><span class="hljs-attr">Cmd</span></span> = [ <span class="hljs-string"><span class="hljs-string">"/bin/hello"</span></span> ];
}
</pre><p>
       and now the Docker CLI will display a reasonable date and sort the images as expected:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>docker images
REPOSITORY   TAG      IMAGE ID       CREATED              SIZE
hello        latest   de2bf4786de6   About a minute ago   25.2MB
</pre><p>
       however, the produced images will not be binary reproducible.
      </p></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-dockerTools-buildLayeredImage" class="title">14.2.2.&nbsp;buildLayeredImage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildLayeredImage" aria-label="Anchor link for: ssec pkgs dockerTools buildLayeredImage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Create a Docker image with many of the store paths being on their own layer to improve sharing between images. The image is realized into the Nix store as a gzipped tarball. Depending on the intended usage, many users might prefer to use <code class="function">streamLayeredImage</code> instead, which this function uses internally.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">name</code>
       </span></dt><dd><p>
         The name of the resulting image.
        </p></dd><dt><span class="term">
        <code class="varname">tag</code> <span class="emphasis"><em>optional</em></span>
       </span></dt><dd><p>
         Tag of the generated image.
        </p><p>
         <span class="emphasis"><em>Default:</em></span> the output path's hash
        </p></dd><dt><span class="term">
        <code class="varname">contents</code> <span class="emphasis"><em>optional</em></span>
       </span></dt><dd><p>
         Top level paths in the container. Either a single derivation, or a list of derivations.
        </p><p>
         <span class="emphasis"><em>Default:</em></span> <code class="literal">[]</code>
        </p></dd><dt><span class="term">
        <code class="varname">config</code> <span class="emphasis"><em>optional</em></span>
       </span></dt><dd><p>
         Run-time configuration of the container. A full list of the options are available at in the <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#image-json-field-descriptions" target="_top" shape="rect"> Docker Image Specification v1.2.0 </a>.
        </p><p>
         <span class="emphasis"><em>Default:</em></span> <code class="literal">{}</code>
        </p></dd><dt><span class="term">
        <code class="varname">created</code> <span class="emphasis"><em>optional</em></span>
       </span></dt><dd><p>
         Date and time the layers were created. Follows the same <code class="literal">now</code> exception supported by <code class="literal">buildImage</code>.
        </p><p>
         <span class="emphasis"><em>Default:</em></span> <code class="literal">1970-01-01T00:00:01Z</code>
        </p></dd><dt><span class="term">
        <code class="varname">maxLayers</code> <span class="emphasis"><em>optional</em></span>
       </span></dt><dd><p>
         Maximum number of layers to create.
        </p><p>
         <span class="emphasis"><em>Default:</em></span> <code class="literal">100</code>
        </p><p>
         <span class="emphasis"><em>Maximum:</em></span> <code class="literal">125</code>
        </p></dd><dt><span class="term">
        <code class="varname">extraCommands</code> <span class="emphasis"><em>optional</em></span>
       </span></dt><dd><p>
         Shell commands to run while building the final layer, without access to most of the layer contents. Changes to this layer are "on top" of all the other layers, so can create additional directories and files.
        </p></dd></dl></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="dockerTools-buildLayeredImage-arg-contents" shape="rect"></a>14.2.2.1.&nbsp;Behavior of <code class="varname">contents</code> in the final image</h4></div></div></div><p>
       Each path directly listed in <code class="varname">contents</code> will have a symlink in the root of the image.
      </p><p>
       For example:
</p><pre class="programlisting hljs nix" xml:space="preserve">pkgs.dockerTools.buildLayeredImage {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">contents</span></span> = [ pkgs.hello ];
}
</pre><p>
       will create symlinks for all the paths in the <code class="literal">hello</code> package:
</p><pre class="screen hljs bash" xml:space="preserve">/bin/hello -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/bin/hello
/share/info/hello.info -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/share/info/hello.info
/share/locale/<span class="hljs-built_in"><span class="hljs-built_in">bg</span></span>/LC_MESSAGES/hello.mo -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/share/locale/<span class="hljs-built_in"><span class="hljs-built_in">bg</span></span>/LC_MESSAGES/hello.mo
</pre><p>
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="dockerTools-buildLayeredImage-arg-config" shape="rect"></a>14.2.2.2.&nbsp;Automatic inclusion of <code class="varname">config</code> references</h4></div></div></div><p>
       The closure of <code class="varname">config</code> is automatically included in the closure of the final image.
      </p><p>
       This allows you to make very simple Docker images with very little code. This container will start up and run <span class="command"><strong>hello</strong></span>:
</p><pre class="programlisting hljs nix" xml:space="preserve">pkgs.dockerTools.buildLayeredImage {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>;
  config.<span class="hljs-attr"><span class="hljs-attr">Cmd</span></span> = [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.hello}</span></span></span><span class="hljs-string">/bin/hello"</span></span> ];
}
</pre><p>
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="dockerTools-buildLayeredImage-arg-maxLayers" shape="rect"></a>14.2.2.3.&nbsp;Adjusting <code class="varname">maxLayers</code></h4></div></div></div><p>
       Increasing the <code class="varname">maxLayers</code> increases the number of layers which have a chance to be shared between different images.
      </p><p>
       Modern Docker installations support up to 128 layers, however older versions support as few as 42.
      </p><p>
       If the produced image will not be extended by other Docker builds, it is safe to set <code class="varname">maxLayers</code> to <code class="literal">128</code>. However it will be impossible to extend the image further.
      </p><p>
       The first (<code class="literal">maxLayers-2</code>) most "popular" paths will have their own individual layers, then layer #<code class="literal">maxLayers-1</code> will contain all the remaining "unpopular" paths, and finally layer #<code class="literal">maxLayers</code> will contain the Image configuration.
      </p><p>
       Docker's Layers are not inherently ordered, they are content-addressable and are not explicitly layered until they are composed in to an Image.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-dockerTools-streamLayeredImage" class="title">14.2.3.&nbsp;streamLayeredImage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-streamLayeredImage" aria-label="Anchor link for: ssec pkgs dockerTools streamLayeredImage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Builds a script which, when run, will stream an uncompressed tarball of a Docker image to stdout. The arguments to this function are as for <code class="function">buildLayeredImage</code>. This method of constructing an image does not realize the image into the Nix store, so it saves on IO and disk/cache space, particularly with large images.
     </p><p>
      The image produced by running the output script can be piped directly into <span class="command"><strong>docker load</strong></span>, to load it into the local docker daemon:
</p><pre class="screen hljs" xml:space="preserve">$(nix-build) | docker load
    </pre><p>
     </p><p>
      Alternatively, the image be piped via <span class="command"><strong>gzip</strong></span> into <span class="command"><strong>skopeo</strong></span>, e.g. to copy it into a registry:
</p><pre class="screen hljs" xml:space="preserve">$(nix-build) | gzip --fast | skopeo copy docker-archive:/dev/stdin docker://some_docker_registry/myimage:tag
    </pre><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-dockerTools-fetchFromRegistry" class="title">14.2.4.&nbsp;pullImage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-fetchFromRegistry" aria-label="Anchor link for: ssec pkgs dockerTools fetchFromRegistry" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      This function is analogous to the <span class="command"><strong>docker pull</strong></span> command, in that it can be used to pull a Docker image from a Docker registry. By default <a class="link" href="https://hub.docker.com/" target="_top" shape="rect">Docker Hub</a> is used to pull images.
     </p><p>
      Its parameters are described in the example below:
     </p><div class="example"><a id="ex-dockerTools-pullImage" shape="rect"></a><p class="title"><strong>Example&nbsp;14.3.&nbsp;Docker pull</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">pullImage {
  <span class="hljs-attr"><span class="hljs-attr">imageName</span></span> = <span class="hljs-string"><span class="hljs-string">"nixos/nix"</span></span>; <a id="ex-dockerTools-pullImage-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">imageDigest</span></span> = <span class="hljs-string"><span class="hljs-string">"sha256:20d9485b25ecfd89204e843a962c1bd70e9cc6858d65d7f5fadc340246e2116b"</span></span>; <a id="ex-dockerTools-pullImage-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">finalImageName</span></span> = <span class="hljs-string"><span class="hljs-string">"nix"</span></span>; <a id="ex-dockerTools-pullImage-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">finalImageTag</span></span> = <span class="hljs-string"><span class="hljs-string">"1.11"</span></span>;  <a id="ex-dockerTools-pullImage-4" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0mqjy3zq2v6rrhizgb9nvhczl87lcfphq9601wcprdika2jz7qh8"</span></span>; <a id="ex-dockerTools-pullImage-5" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/5.svg" alt="5" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">os</span></span> = <span class="hljs-string"><span class="hljs-string">"linux"</span></span>; <a id="ex-dockerTools-pullImage-6" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/6.svg" alt="6" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">arch</span></span> = <span class="hljs-string"><span class="hljs-string">"x86_64"</span></span>; <a id="ex-dockerTools-pullImage-7" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/7.svg" alt="7" border="0"></span>
}
</pre></div></div><br class="example-break" clear="none"><br><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-pullImage-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">imageName</code> specifies the name of the image to be downloaded, which can also include the registry namespace (e.g. <code class="literal">nixos</code>). This argument is required.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-pullImage-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">imageDigest</code> specifies the digest of the image to be downloaded. This argument is required.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-pullImage-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">finalImageName</code>, if specified, this is the name of the image to be created. Note it is never used to fetch the image since we prefer to rely on the immutable digest ID. By default it's equal to <code class="varname">imageName</code>.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-pullImage-4" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">finalImageTag</code>, if specified, this is the tag of the image to be created. Note it is never used to fetch the image since we prefer to rely on the immutable digest ID. By default it's <code class="literal">latest</code>.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-pullImage-5" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/5.svg" alt="5" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">sha256</code> is the checksum of the whole fetched image. This argument is required.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-pullImage-6" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/6.svg" alt="6" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">os</code>, if specified, is the operating system of the fetched image. By default it's <code class="literal">linux</code>.
       </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-pullImage-7" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/7.svg" alt="7" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
        <code class="varname">arch</code>, if specified, is the cpu architecture of the fetched image. By default it's <code class="literal">x86_64</code>.
       </p></td></tr></tbody></table></div><p>
      <code class="literal">nix-prefetch-docker</code> command can be used to get required image parameters:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix run nixpkgs.nix-prefetch-docker -c nix-prefetch-docker --image-name mysql --image-tag 5
</pre><p>
      Since a given <code class="varname">imageName</code> may transparently refer to a manifest list of images which support multiple architectures and/or operating systems, you can supply the <code class="option">--os</code> and <code class="option">--arch</code> arguments to specify exactly which image you want. By default it will match the OS and architecture of the host the command is run on.
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-prefetch-docker --image-name mysql --image-tag 5 --arch x86_64 --os linux
</pre><p>
      Desired image name and tag can be set using <code class="option">--final-image-name</code> and <code class="option">--final-image-tag</code> arguments:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-prefetch-docker --image-name mysql --image-tag 5 --final-image-name eu.gcr.io/my-project/mysql --final-image-tag prod
</pre><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-dockerTools-exportImage" class="title">14.2.5.&nbsp;exportImage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-exportImage" aria-label="Anchor link for: ssec pkgs dockerTools exportImage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      This function is analogous to the <span class="command"><strong>docker export</strong></span> command, in that it can be used to flatten a Docker image that contains multiple layers. It is in fact the result of the merge of all the layers of the image. As such, the result is suitable for being imported in Docker with <span class="command"><strong>docker import</strong></span>.
     </p><div class="alert alert-info"><strong>Note:</strong> 
       Using this function requires the <code class="literal">kvm</code> device to be available.
      </div><p>
      The parameters of <code class="varname">exportImage</code> are the following:
     </p><div class="example"><a id="ex-dockerTools-exportImage" shape="rect"></a><p class="title"><strong>Example&nbsp;14.4.&nbsp;Docker export</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">exportImage {
  <span class="hljs-attr"><span class="hljs-attr">fromImage</span></span> = someLayeredImage;
  <span class="hljs-attr"><span class="hljs-attr">fromImageName</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">fromImageTag</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = someLayeredImage.name;
}
</pre></div></div><br class="example-break" clear="none"><br><p>
      The parameters relative to the base image have the same synopsis as described in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-buildImage" title="14.2.1. buildImage" shape="rect">Section&nbsp;14.2.1, “buildImage”</a>, except that <code class="varname">fromImage</code> is the only required argument in this case.
     </p><p>
      The <code class="varname">name</code> argument is the name of the derivation output, which defaults to <code class="varname">fromImage.name</code>.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-dockerTools-shadowSetup" class="title">14.2.6.&nbsp;shadowSetup<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-dockerTools-shadowSetup" aria-label="Anchor link for: ssec pkgs dockerTools shadowSetup" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      This constant string is a helper for setting up the base files for managing users and groups, only if such files don't exist already. It is suitable for being used in a <code class="varname">runAsRoot</code> <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ex-dockerTools-buildImage-runAsRoot" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/7.svg" alt="7" border="0"></span></a> script for cases like in the example below:
     </p><div class="example"><a id="ex-dockerTools-shadowSetup" shape="rect"></a><p class="title"><strong>Example&nbsp;14.5.&nbsp;Shadow base files</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">buildImage {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"shadow-basic"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">runAsRoot</span></span> = <span class="hljs-string"><span class="hljs-string">''
    #!</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.runtimeShell}</span></span></span><span class="hljs-string">
    </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${shadowSetup}</span></span></span><span class="hljs-string">
    groupadd -r redis
    useradd -r -g redis redis
    mkdir /data
    chown redis:redis /data
  ''</span></span>;
}
</pre></div></div><br class="example-break" clear="none"><br><p>
      Creating base files like <code class="literal">/etc/passwd</code> or <code class="literal">/etc/login.defs</code> is necessary for shadow-utils to manipulate users and groups.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkgs-ociTools" class="title" style="clear: both">14.3.&nbsp;pkgs.ociTools<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-ociTools" aria-label="Anchor link for: sec pkgs ociTools" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <code class="varname">pkgs.ociTools</code> is a set of functions for creating containers according to the <a class="link" href="https://github.com/opencontainers/runtime-spec" target="_top" shape="rect">OCI container specification v1.0.0</a>. Beyond that it makes no assumptions about the container runner you choose to use to run the created container.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-ociTools-buildContainer" class="title">14.3.1.&nbsp;buildContainer<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-ociTools-buildContainer" aria-label="Anchor link for: ssec pkgs ociTools buildContainer" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      This function creates a simple OCI container that runs a single command inside of it. An OCI container consists of a <code class="varname">config.json</code> and a rootfs directory.The nix store of the container will contain all referenced dependencies of the given command.
     </p><p>
      The parameters of <code class="varname">buildContainer</code> with an example value are described below:
     </p><div class="example"><a id="ex-ociTools-buildContainer" shape="rect"></a><p class="title"><strong>Example&nbsp;14.6.&nbsp;Build Container</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">buildContainer {
  <span class="hljs-attr"><span class="hljs-attr">args</span></span> = [ (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; writeScript <span class="hljs-string"><span class="hljs-string">"run.sh"</span></span> <span class="hljs-string"><span class="hljs-string">''
    #!</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${bash}</span></span></span><span class="hljs-string">/bin/bash
    exec </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${bash}</span></span></span><span class="hljs-string">/bin/bash
  ''</span></span>).outPath ]; <a id="ex-ociTools-buildContainer-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">mounts</span></span> = {
    <span class="hljs-string"><span class="hljs-string">"/data"</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">type</span></span> = <span class="hljs-string"><span class="hljs-string">"none"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">source</span></span> = <span class="hljs-string"><span class="hljs-string">"/var/lib/mydata"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">options</span></span> = [ <span class="hljs-string"><span class="hljs-string">"bind"</span></span> ];
    };
  };<a id="ex-ociTools-buildContainer-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">readonly</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <a id="ex-ociTools-buildContainer-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>
}
</pre><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-ociTools-buildContainer-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">args</code> specifies a set of arguments to run inside the container. This is the only required argument for <code class="varname">buildContainer</code>. All referenced packages inside the derivation will be made available inside the container
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-ociTools-buildContainer-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">mounts</code> specifies additional mount points chosen by the user. By default only a minimal set of necessary filesystems are mounted into the container (e.g procfs, cgroupfs)
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-ociTools-buildContainer-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">readonly</code> makes the container's rootfs read-only if it is set to true. The default value is false <code class="literal">false</code>.
        </p></td></tr></tbody></table></div></div></div><br class="example-break" clear="none"><br></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-pkgs-snapTools" class="title" style="clear: both">14.4.&nbsp;pkgs.snapTools<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-snapTools" aria-label="Anchor link for: sec pkgs snapTools" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <code class="varname">pkgs.snapTools</code> is a set of functions for creating Snapcraft images. Snap and Snapcraft is not used to perform these operations.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-snapTools-makeSnap-signature" class="title">14.4.1.&nbsp;The makeSnap Function<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-makeSnap-signature" aria-label="Anchor link for: ssec pkgs snapTools makeSnap signature" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      <code class="function">makeSnap</code> takes a single named argument, <em class="parameter"><code>meta</code></em>. This argument mirrors <a class="link" href="https://docs.snapcraft.io/snap-format" target="_top" shape="rect">the upstream <code class="filename">snap.yaml</code> format</a> exactly.
     </p><p>
      The <em class="parameter"><code>base</code></em> should not be be specified, as <code class="function">makeSnap</code> will force set it.
     </p><p>
      Currently, <code class="function">makeSnap</code> does not support creating GUI stubs.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-snapTools-build-a-snap-hello" class="title">14.4.2.&nbsp;Build a Hello World Snap<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-build-a-snap-hello" aria-label="Anchor link for: ssec pkgs snapTools build a snap hello" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><div class="example"><a id="ex-snapTools-buildSnap-hello" shape="rect"></a><p class="title"><strong>Example&nbsp;14.7.&nbsp;Making a Hello World Snap</strong></p><div class="example-contents"><p>
       The following expression packages GNU Hello as a Snapcraft snap.
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; { }) snapTools hello;
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> snapTools.makeSnap {
  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">summary</span></span> = hello.meta.description;
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = hello.meta.longDescription;
    <span class="hljs-attr"><span class="hljs-attr">architectures</span></span> = [ <span class="hljs-string"><span class="hljs-string">"amd64"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">confinement</span></span> = <span class="hljs-string"><span class="hljs-string">"strict"</span></span>;
    apps.hello.<span class="hljs-attr"><span class="hljs-attr">command</span></span> = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${hello}</span></span></span><span class="hljs-string">/bin/hello"</span></span>;
  };
}
</pre><p>
       <span class="command"><strong>nix-build</strong></span> this expression and install it with <span class="command"><strong>snap install ./result --dangerous</strong></span>. <span class="command"><strong>hello</strong></span> will now be the Snapcraft version of the package.
      </p></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-pkgs-snapTools-build-a-snap-firefox" class="title">14.4.3.&nbsp;Build a Hello World Snap<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-pkgs-snapTools-build-a-snap-firefox" aria-label="Anchor link for: ssec pkgs snapTools build a snap firefox" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><div class="example"><a id="ex-snapTools-buildSnap-firefox" shape="rect"></a><p class="title"><strong>Example&nbsp;14.8.&nbsp;Making a Graphical Snap</strong></p><div class="example-contents"><p>
       Graphical programs require many more integrations with the host. This example uses Firefox as an example, because it is one of the most complicated programs we could package.
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; { }) snapTools firefox;
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> snapTools.makeSnap {
  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"nix-example-firefox"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">summary</span></span> = firefox.meta.description;
    <span class="hljs-attr"><span class="hljs-attr">architectures</span></span> = [ <span class="hljs-string"><span class="hljs-string">"amd64"</span></span> ];
    apps.<span class="hljs-attr"><span class="hljs-attr">nix-example-firefox</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">command</span></span> = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${firefox}</span></span></span><span class="hljs-string">/bin/firefox"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">plugs</span></span> = [
        <span class="hljs-string"><span class="hljs-string">"pulseaudio"</span></span>
        <span class="hljs-string"><span class="hljs-string">"camera"</span></span>
        <span class="hljs-string"><span class="hljs-string">"browser-support"</span></span>
        <span class="hljs-string"><span class="hljs-string">"avahi-observe"</span></span>
        <span class="hljs-string"><span class="hljs-string">"cups-control"</span></span>
        <span class="hljs-string"><span class="hljs-string">"desktop"</span></span>
        <span class="hljs-string"><span class="hljs-string">"desktop-legacy"</span></span>
        <span class="hljs-string"><span class="hljs-string">"gsettings"</span></span>
        <span class="hljs-string"><span class="hljs-string">"home"</span></span>
        <span class="hljs-string"><span class="hljs-string">"network"</span></span>
        <span class="hljs-string"><span class="hljs-string">"mount-observe"</span></span>
        <span class="hljs-string"><span class="hljs-string">"removable-media"</span></span>
        <span class="hljs-string"><span class="hljs-string">"x11"</span></span>
      ];
    };
    <span class="hljs-attr"><span class="hljs-attr">confinement</span></span> = <span class="hljs-string"><span class="hljs-string">"strict"</span></span>;
  };
}
</pre><p>
       <span class="command"><strong>nix-build</strong></span> this expression and install it with <span class="command"><strong>snap install ./result --dangerous</strong></span>. <span class="command"><strong>nix-example-firefox</strong></span> will now be the Snapcraft version of the Firefox package.
      </p><p>
       The specific meaning behind plugs can be looked up in the <a class="link" href="https://docs.snapcraft.io/supported-interfaces" target="_top" shape="rect">Snapcraft interface documentation</a>.
      </p></div></div><br class="example-break" clear="none"><br></section></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-language-support" class="title">Chapter&nbsp;15.&nbsp;Languages and frameworks<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support" aria-label="Anchor link for: chap language support" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#agda" shape="rect">15.1. Agda</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#android" shape="rect">15.2. Android</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-beam" shape="rect">15.3. BEAM Languages (Erlang, Elixir &amp; LFE)</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-bower" shape="rect">15.4. Bower</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-coq" shape="rect">15.5. Coq</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#crystal" shape="rect">15.6. Crystal</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#emscripten" shape="rect">15.7. Emscripten</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-gnome" shape="rect">15.8. GNOME</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-go" shape="rect">15.9. Go</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#haskell" shape="rect">15.10. Haskell</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#idris" shape="rect">15.11. Idris</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#ios" shape="rect">15.12. iOS</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-java" shape="rect">15.13. Java</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#users-guide-to-lua-infrastructure" shape="rect">15.14. User’s Guide to Lua Infrastructure</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#node.js" shape="rect">15.15. Node.js</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ocaml" shape="rect">15.16. OCaml</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-perl" shape="rect">15.17. Perl</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-php" shape="rect">15.18. PHP</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#python" shape="rect">15.19. Python</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-qt" shape="rect">15.20. Qt</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#r" shape="rect">15.21. R</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ruby" shape="rect">15.22. Ruby</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#rust" shape="rect">15.23. Rust</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive" shape="rect">15.24. TeX Live</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#titanium" shape="rect">15.25. Titanium</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#vim" shape="rect">15.26. Vim</a></span></dt></dl></div><p>
    The <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" title="Chapter 6. The Standard Environment" shape="rect">standard build environment</a> makes it easy to build typical Autotools-based packages with very little code. Any other kind of package can be accomodated by overriding the appropriate phases of <code class="literal">stdenv</code>. However, there are specialised functions in Nixpkgs to easily build packages for other programming languages, such as Perl or Haskell. These are described in this chapter.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="agda" class="title" style="clear: both">15.1.&nbsp;Agda<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#agda" aria-label="Anchor link for: agda" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="how-to-use-agda" class="title">15.1.1.&nbsp;How to use Agda<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#how-to-use-agda" aria-label="Anchor link for: how to use agda" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Agda can be installed from <code class="literal">agda</code>:
     </p><pre class="programlisting hljs" xml:space="preserve">$ nix-env -iA agda
</pre><p>
      To use agda with libraries, the <code class="literal">agda.withPackages</code> function can be used. This function either takes: + A list of packages, + or a function which returns a list of packages when given the <code class="literal">agdaPackages</code> attribute set, + or an attribute set containing a list of packages and a GHC derivation for compilation (see below).
     </p><p>
      For example, suppose we wanted a version of agda which has access to the standard library. This can be obtained with the expressions:
     </p><pre class="programlisting hljs" xml:space="preserve">agda.withPackages [ agdaPackages.standard-library ]
</pre><p>
      or
     </p><pre class="programlisting hljs" xml:space="preserve">agda.withPackages (p: [ p.standard-library ])
</pre><p>
      or can be called as in the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#compiling-agda" title="15.1.2. Compiling Agda" shape="rect">Compiling Agda</a> section.
     </p><p>
      If you want to use a library in your home directory (for instance if it is a development version) then typecheck it manually (using <code class="literal">agda.withPackages</code> if necessary) and then override the <code class="literal">src</code> attribute of the package to point to your local repository.
     </p><p>
      Agda will not by default use these libraries. To tell agda to use the library we have some options: - Call <code class="literal">agda</code> with the library flag:
     </p><pre class="programlisting hljs" xml:space="preserve">$ agda -l standard-library -i . MyFile.agda
</pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Write a <code class="literal">my-library.agda-lib</code> file for the project you are working on which may look like:
       </p></li></ul></div><pre class="programlisting hljs" xml:space="preserve">name: my-library
include: .
depend: standard-library
</pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Create the file <code class="literal">~/.agda/defaults</code> and add any libraries you want to use by default.
       </p></li></ul></div><p>
      More information can be found in the <a class="link" href="https://agda.readthedocs.io/en/v2.6.1/tools/package-system.html" target="_top" shape="rect">official Agda documentation on library management</a>.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="compiling-agda" class="title">15.1.2.&nbsp;Compiling Agda<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#compiling-agda" aria-label="Anchor link for: compiling agda" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Agda modules can be compiled with the <code class="literal">--compile</code> flag. A version of <code class="literal">ghc</code> with <code class="literal">ieee</code> is made available to the Agda program via the <code class="literal">--with-compiler</code> flag. This can be overridden by a different version of <code class="literal">ghc</code> as follows:
     </p><pre class="programlisting hljs nix" xml:space="preserve">agda.withPackages {
  <span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = [ ... ];
  <span class="hljs-attr"><span class="hljs-attr">ghc</span></span> = haskell.compiler.ghcHEAD;
}
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="writing-agda-packages" class="title">15.1.3.&nbsp;Writing Agda packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#writing-agda-packages" aria-label="Anchor link for: writing agda packages" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      To write a nix derivation for an agda library, first check that the library has a <code class="literal">*.agda-lib</code> file.
     </p><p>
      A derivation can then be written using <code class="literal">agdaPackages.mkDerivation</code>. This has similar arguments to <code class="literal">stdenv.mkDerivation</code> with the following additions: + <code class="literal">everythingFile</code> can be used to specify the location of the <code class="literal">Everything.agda</code> file, defaulting to <code class="literal">./Everything.agda</code>. If this file does not exist then either it should be patched in or the <code class="literal">buildPhase</code> should be overridden (see below). + <code class="literal">libraryName</code> should be the name that appears in the <code class="literal">*.agda-lib</code> file, defaulting to <code class="literal">pname</code>. + <code class="literal">libraryFile</code> should be the file name of the <code class="literal">*.agda-lib</code> file, defaulting to <code class="literal">${libraryName}.agda-lib</code>.
     </p><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="building-agda-packages" shape="rect"></a>15.1.3.1.&nbsp;Building Agda packages</h4></div></div></div><p>
       The default build phase for <code class="literal">agdaPackages.mkDerivation</code> simply runs <code class="literal">agda</code> on the <code class="literal">Everything.agda</code> file. If something else is needed to build the package (e.g.&nbsp;<code class="literal">make</code>) then the <code class="literal">buildPhase</code> should be overridden. Additionally, a <code class="literal">preBuild</code> or <code class="literal">configurePhase</code> can be used if there are steps that need to be done prior to checking the <code class="literal">Everything.agda</code> file. <code class="literal">agda</code> and the Agda libraries contained in <code class="literal">buildInputs</code> are made available during the build phase.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="installing-agda-packages" shape="rect"></a>15.1.3.2.&nbsp;Installing Agda packages</h4></div></div></div><p>
       The default install phase copies agda source files, agda interface files (<code class="literal">*.agdai</code>) and <code class="literal">*.agda-lib</code> files to the output directory. This can be overridden.
      </p><p>
       By default, agda sources are files ending on <code class="literal">.agda</code>, or literate agda files ending on <code class="literal">.lagda</code>, <code class="literal">.lagda.tex</code>, <code class="literal">.lagda.org</code>, <code class="literal">.lagda.md</code>, <code class="literal">.lagda.rst</code>. The list of recognised agda source extensions can be extended by setting the <code class="literal">extraExtensions</code> config variable.
      </p><p>
       To add an agda package to <code class="literal">nixpkgs</code>, the derivation should be written to <code class="literal">pkgs/development/libraries/agda/${library-name}/</code> and an entry should be added to <code class="literal">pkgs/top-level/agda-packages.nix</code>. Here it is called in a scope with access to all other agda libraries, so the top line of the <code class="literal">default.nix</code> can look like:
      </p><pre class="programlisting hljs" xml:space="preserve">{ mkDerivation, standard-library, fetchFromGitHub }:
</pre><p>
       and <code class="literal">mkDerivation</code> should be called instead of <code class="literal">agdaPackages.mkDerivation</code>. Here is an example skeleton derivation for iowa-stdlib:
      </p><pre class="programlisting hljs nix" xml:space="preserve">mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"1.5.0"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"iowa-stdlib"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = ...

  <span class="hljs-attr"><span class="hljs-attr">libraryFile</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">libraryName</span></span> = <span class="hljs-string"><span class="hljs-string">"IAL-1.3"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">buildPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
    patchShebangs find-deps.sh
    make
  ''</span></span>;
}
</pre><p>
       This library has a file called <code class="literal">.agda-lib</code>, and so we give an empty string to <code class="literal">libraryFile</code> as nothing precedes <code class="literal">.agda-lib</code> in the filename. This file contains <code class="literal">name: IAL-1.3</code>, and so we let <code class="literal">libraryName = "IAL-1.3"</code>. This library does not use an <code class="literal">Everything.agda</code> file and instead has a Makefile, so there is no need to set <code class="literal">everythingFile</code> and we set a custom <code class="literal">buildPhase</code>.
      </p><p>
       When writing an agda package it is essential to make sure that no <code class="literal">.agda-lib</code> file gets added to the store as a single file (for example by using <code class="literal">writeText</code>). This causes agda to think that the nix store is a agda library and it will attempt to write to it whenever it typechecks something. See <a class="link" href="https://github.com/agda/agda/issues/4613" target="_top" shape="rect">https://github.com/agda/agda/issues/4613</a>.
      </p></section></section></section><section class="section"><div class="titlepage"><div><div><h2 id="android" class="title" style="clear: both">15.2.&nbsp;Android<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#android" aria-label="Anchor link for: android" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The Android build environment provides three major features and a number of supporting features.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="deploying-an-android-sdk-installation-with-plugins" class="title">15.2.1.&nbsp;Deploying an Android SDK installation with plugins<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#deploying-an-android-sdk-installation-with-plugins" aria-label="Anchor link for: deploying an android sdk installation with plugins" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The first use case is deploying the SDK with a desired set of plugins or subsets of an SDK.
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">androidComposition</span></span> = androidenv.composeAndroidPackages {
    <span class="hljs-attr"><span class="hljs-attr">toolsVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"25.2.5"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">platformToolsVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"27.0.1"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">buildToolsVersions</span></span> = [ <span class="hljs-string"><span class="hljs-string">"27.0.3"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">includeEmulator</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">emulatorVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"27.2.0"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">platformVersions</span></span> = [ <span class="hljs-string"><span class="hljs-string">"24"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">includeSources</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">includeDocs</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">includeSystemImages</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">systemImageTypes</span></span> = [ <span class="hljs-string"><span class="hljs-string">"default"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">abiVersions</span></span> = [ <span class="hljs-string"><span class="hljs-string">"armeabi-v7a"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">lldbVersions</span></span> = [ <span class="hljs-string"><span class="hljs-string">"2.0.2558144"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">cmakeVersions</span></span> = [ <span class="hljs-string"><span class="hljs-string">"3.6.4111459"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">includeNDK</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">ndkVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"16.1.4479499"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">useGoogleAPIs</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">useGoogleTVAddOns</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">includeExtras</span></span> = [
      <span class="hljs-string"><span class="hljs-string">"extras;google;gcm"</span></span>
    ];
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
androidComposition.androidsdk
</pre><p>
      The above function invocation states that we want an Android SDK with the above specified plugin versions. By default, most plugins are disabled. Notable exceptions are the tools, platform-tools and build-tools sub packages.
     </p><p>
      The following parameters are supported:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">toolsVersion</code>, specifies the version of the tools package to use
       </p></li><li class="listitem"><p>
        <code class="literal">platformsToolsVersion</code> specifies the version of the <code class="literal">platform-tools</code> plugin
       </p></li><li class="listitem"><p>
        <code class="literal">buildToolsVersion</code> specifies the versions of the <code class="literal">build-tools</code> plugins to use.
       </p></li><li class="listitem"><p>
        <code class="literal">includeEmulator</code> specifies whether to deploy the emulator package (<code class="literal">false</code> by default). When enabled, the version of the emulator to deploy can be specified by setting the <code class="literal">emulatorVersion</code> parameter.
       </p></li><li class="listitem"><p>
        <code class="literal">includeDocs</code> specifies whether the documentation catalog should be included.
       </p></li><li class="listitem"><p>
        <code class="literal">lldbVersions</code> specifies what LLDB versions should be deployed.
       </p></li><li class="listitem"><p>
        <code class="literal">cmakeVersions</code> specifies which CMake versions should be deployed.
       </p></li><li class="listitem"><p>
        <code class="literal">includeNDK</code> specifies that the Android NDK bundle should be included. Defaults to: <code class="literal">false</code>.
       </p></li><li class="listitem"><p>
        <code class="literal">ndkVersion</code> specifies the NDK version that we want to use.
       </p></li><li class="listitem"><p>
        <code class="literal">includeExtras</code> is an array of identifier strings referring to arbitrary add-on packages that should be installed.
       </p></li><li class="listitem"><p>
        <code class="literal">platformVersions</code> specifies which platform SDK versions should be included.
       </p></li></ul></div><p>
      For each platform version that has been specified, we can apply the following options:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">includeSystemImages</code> specifies whether a system image for each platform SDK should be included.
       </p></li><li class="listitem"><p>
        <code class="literal">includeSources</code> specifies whether the sources for each SDK version should be included.
       </p></li><li class="listitem"><p>
        <code class="literal">useGoogleAPIs</code> specifies that for each selected platform version the Google API should be included.
       </p></li><li class="listitem"><p>
        <code class="literal">useGoogleTVAddOns</code> specifies that for each selected platform version the Google TV add-on should be included.
       </p></li></ul></div><p>
      For each requested system image we can specify the following options:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">systemImageTypes</code> specifies what kind of system images should be included. Defaults to: <code class="literal">default</code>.
       </p></li><li class="listitem"><p>
        <code class="literal">abiVersions</code> specifies what kind of ABI version of each system image should be included. Defaults to: <code class="literal">armeabi-v7a</code>.
       </p></li></ul></div><p>
      Most of the function arguments have reasonable default settings.
     </p><p>
      When building the above expression with:
     </p><pre class="programlisting hljs" xml:space="preserve">$ nix-build
</pre><p>
      The Android SDK gets deployed with all desired plugin versions.
     </p><p>
      We can also deploy subsets of the Android SDK. For example, to only the <code class="literal">platform-tools</code> package, you can evaluate the following expression:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">androidComposition</span></span> = androidenv.composeAndroidPackages {
    <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
androidComposition.platform-tools
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="using-predefine-android-package-compositions" class="title">15.2.2.&nbsp;Using predefine Android package compositions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#using-predefine-android-package-compositions" aria-label="Anchor link for: using predefine android package compositions" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      In addition to composing an Android package set manually, it is also possible to use a predefined composition that contains all basic packages for a specific Android version, such as version 9.0 (API-level 28).
     </p><p>
      The following Nix expression can be used to deploy the entire SDK with all basic plugins:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

androidenv.androidPkgs_9_0.androidsdk
</pre><p>
      It is also possible to use one plugin only:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

androidenv.androidPkgs_9_0.platform-tools
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="building-an-android-application" class="title">15.2.3.&nbsp;Building an Android application<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#building-an-android-application" aria-label="Anchor link for: building an android application" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      In addition to the SDK, it is also possible to build an Ant-based Android project and automatically deploy all the Android plugins that a project requires.
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

androidenv.buildApp {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"MyAndroidApp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = ./myappsources;
  <span class="hljs-attr"><span class="hljs-attr">release</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># If release is set to true, you need to specify the following parameters</span></span>
  <span class="hljs-attr"><span class="hljs-attr">keyStore</span></span> = ./keystore;
  <span class="hljs-attr"><span class="hljs-attr">keyAlias</span></span> = <span class="hljs-string"><span class="hljs-string">"myfirstapp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">keyStorePassword</span></span> = <span class="hljs-string"><span class="hljs-string">"mykeystore"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">keyAliasPassword</span></span> = <span class="hljs-string"><span class="hljs-string">"myfirstapp"</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># Any Android SDK parameters that install all the relevant plugins that a</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># build requires</span></span>
  <span class="hljs-attr"><span class="hljs-attr">platformVersions</span></span> = [ <span class="hljs-string"><span class="hljs-string">"24"</span></span> ];

  <span class="hljs-comment"><span class="hljs-comment"># When we include the NDK, then ndk-build is invoked before Ant gets invoked</span></span>
  <span class="hljs-attr"><span class="hljs-attr">includeNDK</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}
</pre><p>
      Aside from the app-specific build parameters (<code class="literal">name</code>, <code class="literal">src</code>, <code class="literal">release</code> and keystore parameters), the <code class="literal">buildApp {}</code> function supports all the function parameters that the SDK composition function (the function shown in the previous section) supports.
     </p><p>
      This build function is particularly useful when it is desired to use <a class="link" href="https://nixos.org/hydra" target="_top" shape="rect">Hydra</a>: the Nix-based continuous integration solution to build Android apps. An Android APK gets exposed as a build product and can be installed on any Android device with a web browser by navigating to the build result page.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="spawning-emulator-instances" class="title">15.2.4.&nbsp;Spawning emulator instances<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#spawning-emulator-instances" aria-label="Anchor link for: spawning emulator instances" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      For testing purposes, it can also be quite convenient to automatically generate scripts that spawn emulator instances with all desired configuration settings.
     </p><p>
      An emulator spawn script can be configured by invoking the <code class="literal">emulateApp {}</code> function:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

androidenv.emulateApp {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"emulate-MyAndroidApp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">platformVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"28"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">abiVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"x86"</span></span>; <span class="hljs-comment"><span class="hljs-comment"># armeabi-v7a, mips, x86_64</span></span>
  <span class="hljs-attr"><span class="hljs-attr">systemImageType</span></span> = <span class="hljs-string"><span class="hljs-string">"google_apis_playstore"</span></span>;
}
</pre><p>
      Additional flags may be applied to the Android SDK’s emulator through the runtime environment variable <code class="literal">$NIX_ANDROID_EMULATOR_FLAGS</code>.
     </p><p>
      It is also possible to specify an APK to deploy inside the emulator and the package and activity names to launch it:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

androidenv.emulateApp {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"emulate-MyAndroidApp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">platformVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"24"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">abiVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"armeabi-v7a"</span></span>; <span class="hljs-comment"><span class="hljs-comment"># mips, x86, x86_64</span></span>
  <span class="hljs-attr"><span class="hljs-attr">systemImageType</span></span> = <span class="hljs-string"><span class="hljs-string">"default"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">useGoogleAPIs</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">app</span></span> = ./MyApp.apk;
  <span class="hljs-attr"><span class="hljs-attr">package</span></span> = <span class="hljs-string"><span class="hljs-string">"MyApp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">activity</span></span> = <span class="hljs-string"><span class="hljs-string">"MainActivity"</span></span>;
}
</pre><p>
      In addition to prebuilt APKs, you can also bind the APK parameter to a <code class="literal">buildApp {}</code> function invocation shown in the previous example.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="querying-the-available-versions-of-each-plugin" class="title">15.2.5.&nbsp;Querying the available versions of each plugin<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#querying-the-available-versions-of-each-plugin" aria-label="Anchor link for: querying the available versions of each plugin" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      When using any of the previously shown functions, it may be a bit inconvenient to find out what options are supported, since the Android SDK provides many plugins.
     </p><p>
      A shell script in the <code class="literal">pkgs/development/mobile/androidenv/</code> sub directory can be used to retrieve all possible options:
     </p><pre class="programlisting hljs" xml:space="preserve">sh ./querypackages.sh packages build-tools
</pre><p>
      The above command-line instruction queries all build-tools versions in the generated <code class="literal">packages.nix</code> expression.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="updating-the-generated-expressions" class="title">15.2.6.&nbsp;Updating the generated expressions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#updating-the-generated-expressions" aria-label="Anchor link for: updating the generated expressions" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Most of the Nix expressions are generated from XML files that the Android package manager uses. To update the expressions run the <code class="literal">generate.sh</code> script that is stored in the <code class="literal">pkgs/development/mobile/androidenv/</code> sub directory:
     </p><pre class="programlisting hljs" xml:space="preserve">./generate.sh
</pre></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-beam" class="title" style="clear: both">15.3.&nbsp;BEAM Languages (Erlang, Elixir &amp; LFE)<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-beam" aria-label="Anchor link for: sec beam" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="beam-introduction" class="title">15.3.1.&nbsp;Introduction<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#beam-introduction" aria-label="Anchor link for: beam introduction" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      In this document and related Nix expressions, we use the term, <span class="emphasis"><em>BEAM</em></span>, to describe the environment. BEAM is the name of the Erlang Virtual Machine and, as far as we're concerned, from a packaging perspective, all languages that run on the BEAM are interchangeable. That which varies, like the build system, is transparent to users of any given BEAM package, so we make no distinction.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="beam-structure" class="title">15.3.2.&nbsp;Structure<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#beam-structure" aria-label="Anchor link for: beam structure" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      All BEAM-related expressions are available via the top-level <code class="literal">beam</code> attribute, which includes:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">interpreters</code>: a set of compilers running on the BEAM, including multiple Erlang/OTP versions (<code class="literal">beam.interpreters.erlangR19</code>, etc), Elixir (<code class="literal">beam.interpreters.elixir</code>) and LFE (<code class="literal">beam.interpreters.lfe</code>).
       </p></li><li class="listitem"><p>
        <code class="literal">packages</code>: a set of package builders (Mix and rebar3), each compiled with a specific Erlang/OTP version, e.g. <code class="literal">beam.packages.erlangR19</code>.
       </p></li></ul></div><p>
      The default Erlang compiler, defined by <code class="literal">beam.interpreters.erlang</code>, is aliased as <code class="literal">erlang</code>. The default BEAM package set is defined by <code class="literal">beam.packages.erlang</code> and aliased at the top level as <code class="literal">beamPackages</code>.
     </p><p>
      To create a package builder built with a custom Erlang version, use the lambda, <code class="literal">beam.packagesWith</code>, which accepts an Erlang/OTP derivation and produces a package builder similar to <code class="literal">beam.packages.erlang</code>.
     </p><p>
      Many Erlang/OTP distributions available in <code class="literal">beam.interpreters</code> have versions with ODBC and/or Java enabled or without wx (no observer support). For example, there's <code class="literal">beam.interpreters.erlangR22_odbc_javac</code>, which corresponds to <code class="literal">beam.interpreters.erlangR22</code> and <code class="literal">beam.interpreters.erlangR22_nox</code>, which corresponds to <code class="literal">beam.interpreters.erlangR22</code>.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="build-tools" class="title">15.3.3.&nbsp;Build Tools<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#build-tools" aria-label="Anchor link for: build tools" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="build-tools-rebar3" shape="rect"></a>15.3.3.1.&nbsp;Rebar3</h4></div></div></div><p>
       We provide a version of Rebar3, under <code class="literal">rebar3</code>. We also provide a helper to fetch Rebar3 dependencies from a lockfile under <code class="literal">fetchRebar3Deps</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="build-tools-other" shape="rect"></a>15.3.3.2.&nbsp;Mix &amp; Erlang.mk</h4></div></div></div><p>
       Both Mix and Erlang.mk work exactly as expected. There is a bootstrap process that needs to be run for both, however, which is supported by the <code class="literal">buildMix</code> and <code class="literal">buildErlangMk</code> derivations, respectively.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="how-to-install-beam-packages" class="title">15.3.4.&nbsp;How to Install BEAM Packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#how-to-install-beam-packages" aria-label="Anchor link for: how to install beam packages" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      BEAM builders are not registered at the top level, simply because they are not relevant to the vast majority of Nix users. To install any of those builders into your profile, refer to them by their attribute path <code class="literal">beamPackages.rebar3</code>:
     </p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>nix-env -f <span class="hljs-string"><span class="hljs-string">"&lt;nixpkgs&gt;"</span></span> -iA beamPackages.rebar3
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="packaging-beam-applications" class="title">15.3.5.&nbsp;Packaging BEAM Applications<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#packaging-beam-applications" aria-label="Anchor link for: packaging beam applications" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="packaging-erlang-applications" shape="rect"></a>15.3.5.1.&nbsp;Erlang Applications</h4></div></div></div><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="rebar3-packages" shape="rect"></a>15.3.5.1.1.&nbsp;Rebar3 Packages</h5></div></div></div><p>
        The Nix function, <code class="literal">buildRebar3</code>, defined in <code class="literal">beam.packages.erlang.buildRebar3</code> and aliased at the top level, can be used to build a derivation that understands how to build a Rebar3 project.
       </p><p>
        If a package needs to compile native code via Rebar3's port compilation mechanism, add <code class="literal">compilePort = true;</code> to the derivation.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="erlang-mk-packages" shape="rect"></a>15.3.5.1.2.&nbsp;Erlang.mk Packages</h5></div></div></div><p>
        Erlang.mk functions similarly to Rebar3, except we use <code class="literal">buildErlangMk</code> instead of <code class="literal">buildRebar3</code>.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="mix-packages" shape="rect"></a>15.3.5.1.3.&nbsp;Mix Packages</h5></div></div></div><p>
        Mix functions similarly to Rebar3, except we use <code class="literal">buildMix</code> instead of <code class="literal">buildRebar3</code>.
       </p><p>
        Alternatively, we can use <code class="literal">buildHex</code> as a shortcut:
       </p></section></section></section><section class="section"><div class="titlepage"><div><div><h3 id="how-to-develop" class="title">15.3.6.&nbsp;How to Develop<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#how-to-develop" aria-label="Anchor link for: how to develop" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="creating-a-shell" shape="rect"></a>15.3.6.1.&nbsp;Creating a Shell</h4></div></div></div><p>
       Usually, we need to create a <code class="literal">shell.nix</code> file and do our development inside of the environment specified therein. Just install your version of erlang and other interpreter, and then user your normal build tools. As an example with elixir:
      </p><pre class="programlisting hljs nix" xml:space="preserve">{ pkgs ? <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;nixpkgs"</span></span>&gt; {} }:

<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs;

<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>

  <span class="hljs-attr"><span class="hljs-attr">elixir</span></span> = beam.packages.erlangR22.elixir_1_9;

<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
mkShell {
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ elixir ];

  <span class="hljs-attr"><span class="hljs-attr">ERL_INCLUDE_PATH="${erlang}/lib/erlang/usr/include";</span></span>
}
</pre><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="building-in-a-shell" shape="rect"></a>15.3.6.1.1.&nbsp;Building in a Shell (for Mix Projects)</h5></div></div></div><p>
        Using a <code class="literal">shell.nix</code> as described (see <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#creating-a-shell" title="15.3.6.1. Creating a Shell" shape="rect">Section&nbsp;15.3.6.1, “Creating a Shell”</a>) should just work.
       </p></section></section></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-bower" class="title" style="clear: both">15.4.&nbsp;Bower<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-bower" aria-label="Anchor link for: sec bower" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <a class="link" href="http://bower.io/" target="_top" shape="rect">Bower</a> is a package manager for web site front-end components. Bower packages (comprising of build artefacts and sometimes sources) are stored in <span class="command"><strong>git</strong></span> repositories, typically on Github. The package registry is run by the Bower team with package metadata coming from the <code class="filename">bower.json</code> file within each package.
    </p><p>
     The end result of running Bower is a <code class="filename">bower_components</code> directory which can be included in the web app's build process.
    </p><p>
     Bower can be run interactively, by installing <code class="varname">nodePackages.bower</code>. More interestingly, the Bower components can be declared in a Nix derivation, with the help of <code class="varname">nodePackages.bower2nix</code>.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="ssec-bower2nix-usage" class="title">15.4.1.&nbsp;<span class="command"><strong>bower2nix</strong></span> usage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-bower2nix-usage" aria-label="Anchor link for: ssec bower2nix usage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Suppose you have a <code class="filename">bower.json</code> with the following contents:
      </p><div class="example"><a id="ex-bowerJson" shape="rect"></a><p class="title"><strong>Example&nbsp;15.1.&nbsp;<code class="filename">bower.json</code></strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"my-web-app"</span></span>,
  <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: {
    <span class="hljs-string"><span class="hljs-string">"angular"</span></span>: <span class="hljs-string"><span class="hljs-string">"~1.5.0"</span></span>,
    <span class="hljs-string"><span class="hljs-string">"bootstrap"</span></span>: <span class="hljs-string"><span class="hljs-string">"~3.3.6"</span></span>
  }
}
</pre></div></div><p><br class="example-break" clear="none"><br>
     </p><p>
      Running <span class="command"><strong>bower2nix</strong></span> will produce something like the following output:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ fetchbower, buildEnv }:
buildEnv { <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"bower-env"</span></span>; <span class="hljs-attr"><span class="hljs-attr">ignoreCollisions</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-attr"><span class="hljs-attr">paths</span></span> = [
  (fetchbower <span class="hljs-string"><span class="hljs-string">"angular"</span></span> <span class="hljs-string"><span class="hljs-string">"1.5.3"</span></span> <span class="hljs-string"><span class="hljs-string">"~1.5.0"</span></span> <span class="hljs-string"><span class="hljs-string">"1749xb0firxdra4rzadm4q9x90v6pzkbd7xmcyjk6qfza09ykk9y"</span></span>)
  (fetchbower <span class="hljs-string"><span class="hljs-string">"bootstrap"</span></span> <span class="hljs-string"><span class="hljs-string">"3.3.6"</span></span> <span class="hljs-string"><span class="hljs-string">"~3.3.6"</span></span> <span class="hljs-string"><span class="hljs-string">"1vvqlpbfcy0k5pncfjaiskj3y6scwifxygfqnw393sjfxiviwmbv"</span></span>)
  (fetchbower <span class="hljs-string"><span class="hljs-string">"jquery"</span></span> <span class="hljs-string"><span class="hljs-string">"2.2.2"</span></span> <span class="hljs-string"><span class="hljs-string">"1.9.1 - 2"</span></span> <span class="hljs-string"><span class="hljs-string">"10sp5h98sqwk90y4k6hbdviwqzvzwqf47r3r51pakch5ii2y7js1"</span></span>)
]; }
</pre><p>
     </p><p>
      Using the <span class="command"><strong>bower2nix</strong></span> command line arguments, the output can be redirected to a file. A name like <code class="filename">bower-packages.nix</code> would be fine.
     </p><p>
      The resulting derivation is a union of all the downloaded Bower packages (and their dependencies). To use it, they still need to be linked together by Bower, which is where <code class="varname">buildBowerComponents</code> is useful.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-build-bower-components" class="title">15.4.2.&nbsp;<code class="varname">buildBowerComponents</code> function<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-build-bower-components" aria-label="Anchor link for: ssec build bower components" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The function is implemented in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/bower-modules/generic/default.nix" target="_top" shape="rect"> <code class="filename">pkgs/development/bower-modules/generic/default.nix</code></a>. Example usage:
      </p><div class="example"><a id="ex-buildBowerComponents" shape="rect"></a><p class="title"><strong>Example&nbsp;15.2.&nbsp;buildBowerComponents</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">bowerComponents</span></span> = buildBowerComponents {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-web-app"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">generated</span></span> = ./bower-packages.nix; <a id="ex-buildBowerComponents-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = myWebApp; <a id="ex-buildBowerComponents-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>
};
</pre></div></div><p><br class="example-break" clear="none"><br>
     </p><p>
      In <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponents" title="Example 15.2. buildBowerComponents" shape="rect">Example&nbsp;15.2, “buildBowerComponents”</a>, the following arguments are of special significance to the function:
      </p><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponents-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">generated</code> specifies the file which was created by <span class="command"><strong>bower2nix</strong></span>.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponents-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">src</code> is your project's sources. It needs to contain a <code class="filename">bower.json</code> file.
        </p></td></tr></tbody></table></div><p>
     </p><p>
      <code class="varname">buildBowerComponents</code> will run Bower to link together the output of <span class="command"><strong>bower2nix</strong></span>, resulting in a <code class="filename">bower_components</code> directory which can be used.
     </p><p>
      Here is an example of a web frontend build process using <span class="command"><strong>gulp</strong></span>. You might use <span class="command"><strong>grunt</strong></span>, or anything else.
     </p><div class="example"><a id="ex-bowerGulpFile" shape="rect"></a><p class="title"><strong>Example&nbsp;15.3.&nbsp;Example build script (<code class="filename">gulpfile.js</code>)</strong></p><div class="example-contents"><pre class="programlisting hljs bash" xml:space="preserve">var gulp = require(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>);

gulp.task(<span class="hljs-string"><span class="hljs-string">'default'</span></span>, [], <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span> () {
  gulp.start(<span class="hljs-string"><span class="hljs-string">'build'</span></span>);
});

gulp.task(<span class="hljs-string"><span class="hljs-string">'build'</span></span>, [], <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span> () {
  console.log(<span class="hljs-string"><span class="hljs-string">"Just a dummy gulp build"</span></span>);
  gulp
    .src([<span class="hljs-string"><span class="hljs-string">"./bower_components/**/*"</span></span>])
    .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">"./gulpdist/"</span></span>));
});
</pre></div></div><br class="example-break" clear="none"><br><div class="example"><a id="ex-buildBowerComponentsDefaultNix" shape="rect"></a><p class="title"><strong>Example&nbsp;15.4.&nbsp;Full example — <code class="filename">default.nix</code></strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">{ myWebApp ? { <span class="hljs-attr"><span class="hljs-attr">outPath</span></span> = ./.; <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"myWebApp"</span></span>; }
, pkgs ? <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {}
}:

pkgs.stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-web-app-frontend"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = myWebApp;

  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ pkgs.nodePackages.gulp ];

  <span class="hljs-attr"><span class="hljs-attr">bowerComponents</span></span> = pkgs.buildBowerComponents { <a id="ex-buildBowerComponentsDefault-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>
    <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-web-app"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">generated</span></span> = ./bower-packages.nix;
    <span class="hljs-attr"><span class="hljs-attr">src</span></span> = myWebApp;
  };

  <span class="hljs-attr"><span class="hljs-attr">buildPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
    cp --reflink=auto --no-preserve=mode -R $bowerComponents/bower_components . </span></span><a id="ex-buildBowerComponentsDefault-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span><span class="hljs-string"><span class="hljs-string">
    export HOME=$PWD </span></span><a id="ex-buildBowerComponentsDefault-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span><span class="hljs-string"><span class="hljs-string">
    </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.nodePackages.gulp}</span></span></span><span class="hljs-string">/bin/gulp build </span></span><a id="ex-buildBowerComponentsDefault-4" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span><span class="hljs-string"><span class="hljs-string">
  ''</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">installPhase</span></span> = <span class="hljs-string"><span class="hljs-string">"mv gulpdist $out"</span></span>;
}
</pre></div></div><br class="example-break" clear="none"><br><p>
      A few notes about <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponentsDefaultNix" title="Example 15.4. Full example — default.nix" shape="rect">Example&nbsp;15.4, “Full example — <code class="filename">default.nix</code>”</a>:
      </p><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponentsDefault-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         The result of <code class="varname">buildBowerComponents</code> is an input to the frontend build.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponentsDefault-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         Whether to symlink or copy the <code class="filename">bower_components</code> directory depends on the build tool in use. In this case a copy is used to avoid <span class="command"><strong>gulp</strong></span> silliness with permissions.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponentsDefault-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <span class="command"><strong>gulp</strong></span> requires <code class="varname">HOME</code> to refer to a writeable directory.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildBowerComponentsDefault-4" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         The actual build command. Other tools could be used.
        </p></td></tr></tbody></table></div><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-bower2nix-troubleshooting" class="title">15.4.3.&nbsp;Troubleshooting<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-bower2nix-troubleshooting" aria-label="Anchor link for: ssec bower2nix troubleshooting" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="literal">ENOCACHE</code> errors from <code class="varname">buildBowerComponents</code>
       </span></dt><dd><p>
         This means that Bower was looking for a package version which doesn't exist in the generated <code class="filename">bower-packages.nix</code>.
        </p><p>
         If <code class="filename">bower.json</code> has been updated, then run <span class="command"><strong>bower2nix</strong></span> again.
        </p><p>
         It could also be a bug in <span class="command"><strong>bower2nix</strong></span> or <span class="command"><strong>fetchbower</strong></span>. If possible, try reformulating the version specification in <code class="filename">bower.json</code>.
        </p></dd></dl></div></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-coq" class="title" style="clear: both">15.5.&nbsp;Coq<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-coq" aria-label="Anchor link for: sec language coq" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Coq libraries should be installed in <code class="literal">$(out)/lib/coq/${coq.coq-version}/user-contrib/</code>. Such directories are automatically added to the <code class="literal">$COQPATH</code> environment variable by the hook defined in the Coq derivation.
    </p><p>
     Some extensions (plugins) might require OCaml and sometimes other OCaml packages. The <code class="literal">coq.ocamlPackages</code> attribute can be used to depend on the same package set Coq was built against.
    </p><p>
     Coq libraries may be compatible with some specific versions of Coq only. The <code class="literal">compatibleCoqVersions</code> attribute is used to precisely select those versions of Coq that are compatible with this derivation.
    </p><p>
     Here is a simple package example. It is a pure Coq library, thus it depends on Coq. It builds on the Mathematical Components library, thus it also takes <code class="literal">mathcomp</code> as <code class="literal">buildInputs</code>. Its <code class="literal">Makefile</code> has been generated using <code class="literal">coq_makefile</code> so we only have to set the <code class="literal">$COQLIB</code> variable at install time.
    </p><pre class="programlisting hljs nix" xml:space="preserve">{ stdenv, fetchFromGitHub, coq, mathcomp }:

stdenv.mkDerivation <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"coq</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${coq.coq-version}</span></span></span><span class="hljs-string">-multinomials-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${version}</span></span></span><span class="hljs-string">"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
    <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"math-comp"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"multinomials"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1qmbxp1h81cy3imh627pznmng0kvv37k4hrwi2faa101s6bcx55m"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ coq ];
  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [ mathcomp ];

  <span class="hljs-attr"><span class="hljs-attr">installFlags</span></span> = <span class="hljs-string"><span class="hljs-string">"COQLIB=$(out)/lib/coq/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${coq.coq-version}</span></span></span><span class="hljs-string">/"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"A Coq/SSReflect Library for Monoidal Rings and Multinomials"</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (src.meta) homepage;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = stdenv.lib.licenses.cecill-b;
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (coq.meta) platforms;
  };

  <span class="hljs-attr"><span class="hljs-attr">passthru</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">compatibleCoqVersions</span></span> = v: <span class="hljs-built_in"><span class="hljs-built_in">builtins</span></span>.elem v [ <span class="hljs-string"><span class="hljs-string">"8.5"</span></span> <span class="hljs-string"><span class="hljs-string">"8.6"</span></span> <span class="hljs-string"><span class="hljs-string">"8.7"</span></span> ];
  };
}
</pre></section><section class="section"><div class="titlepage"><div><div><h2 id="crystal" class="title" style="clear: both">15.6.&nbsp;Crystal<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#crystal" aria-label="Anchor link for: crystal" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="building-a-crystal-package" class="title">15.6.1.&nbsp;Building a Crystal package<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#building-a-crystal-package" aria-label="Anchor link for: building a crystal package" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      This section uses <a class="link" href="https://github.com/mint-lang/mint" target="_top" shape="rect">Mint</a> as an example for how to build a Crystal package.
     </p><p>
      If the Crystal project has any dependencies, the first step is to get a <code class="literal">shards.nix</code> file encoding those. Get a copy of the project and go to its root directory such that its <code class="literal">shard.lock</code> file is in the current directory, then run <code class="literal">crystal2nix</code> in it
     </p><pre class="programlisting hljs bash" xml:space="preserve">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/mint-lang/mint
$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> mint
$ git checkout 0.5.0
$ nix-shell -p crystal2nix --run crystal2nix
</pre><p>
      This should have generated a <code class="literal">shards.nix</code> file.
     </p><p>
      Next create a Nix file for your derivation and use <code class="literal">pkgs.crystal.buildCrystalPackage</code> as follows:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
crystal.buildCrystalPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"mint"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.5.0"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
    <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"mint-lang"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"mint"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0vxbx38c390rd2ysvbwgh89v2232sh5rbsp3nk9wzb70jybpslvl"</span></span>;
  };

  <span class="hljs-comment"><span class="hljs-comment"># Insert the path to your shards.nix file here</span></span>
  <span class="hljs-attr"><span class="hljs-attr">shardsFile</span></span> = ./shards.nix;

  ...
}
</pre><p>
      This won’t build anything yet, because we haven’t told it what files build. We can specify a mapping from binary names to source files with the <code class="literal">crystalBinaries</code> attribute. The project’s compilation instructions should show this. For Mint, the binary is called <span class="quote">“<span class="quote">mint</span>”</span>, which is compiled from the source file <code class="literal">src/mint.cr</code>, so we’ll specify this as follows:
     </p><pre class="programlisting hljs nix" xml:space="preserve">  crystalBinaries.mint.<span class="hljs-attr"><span class="hljs-attr">src</span></span> = <span class="hljs-string"><span class="hljs-string">"src/mint.cr"</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
</pre><p>
      Additionally you can override the default <code class="literal">crystal build</code> options (which are currently <code class="literal">--release --progress --no-debug --verbose</code>) with
     </p><pre class="programlisting hljs nix" xml:space="preserve">  crystalBinaries.mint.<span class="hljs-attr"><span class="hljs-attr">options</span></span> = [ <span class="hljs-string"><span class="hljs-string">"--release"</span></span> <span class="hljs-string"><span class="hljs-string">"--verbose"</span></span> ];
</pre><p>
      Depending on the project, you might need additional steps to get it to compile successfully. In Mint’s case, we need to link against openssl, so in the end the Nix file looks as follows:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
crystal.buildCrystalPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.5.0"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"mint"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
    <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"mint-lang"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"mint"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0vxbx38c390rd2ysvbwgh89v2232sh5rbsp3nk9wzb70jybpslvl"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">shardsFile</span></span> = ./shards.nix;
  crystalBinaries.mint.<span class="hljs-attr"><span class="hljs-attr">src</span></span> = <span class="hljs-string"><span class="hljs-string">"src/mint.cr"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ openssl ];
}
</pre></section></section><section class="section"><div class="titlepage"><div><div><h2 id="emscripten" class="title" style="clear: both">15.7.&nbsp;Emscripten<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#emscripten" aria-label="Anchor link for: emscripten" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <a class="link" href="https://github.com/kripken/emscripten" target="_top" shape="rect">Emscripten</a>: An LLVM-to-JavaScript Compiler
    </p><p>
     This section of the manual covers how to use <code class="literal">emscripten</code> in nixpkgs.
    </p><p>
     Minimal requirements:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       nix
      </p></li><li class="listitem"><p>
       nixpkgs
      </p></li></ul></div><p>
     Modes of use of <code class="literal">emscripten</code>:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <span class="strong"><strong>Imperative usage</strong></span> (on the command line):
      </p><p>
       If you want to work with <code class="literal">emcc</code>, <code class="literal">emconfigure</code> and <code class="literal">emmake</code> as you are used to from Ubuntu and similar distributions you can use these commands:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
         <code class="literal">nix-env -i emscripten</code>
        </p></li><li class="listitem"><p>
         <code class="literal">nix-shell -p emscripten</code>
        </p></li></ul></div></li><li class="listitem"><p>
       <span class="strong"><strong>Declarative usage</strong></span>:
      </p><p>
       This mode is far more power full since this makes use of <code class="literal">nix</code> for dependency management of emscripten libraries and targets by using the <code class="literal">mkDerivation</code> which is implemented by <code class="literal">pkgs.emscriptenStdenv</code> and <code class="literal">pkgs.buildEmscriptenPackage</code>. The source for the packages is in <code class="literal">pkgs/top-level/emscripten-packages.nix</code> and the abstraction behind it in <code class="literal">pkgs/development/em-modules/generic/default.nix</code>.
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
         build and install all packages:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
           <code class="literal">nix-env -iA emscriptenPackages</code>
          </p></li></ul></div></li><li class="listitem"><p>
         dev-shell for zlib implementation hacking:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
           <code class="literal">nix-shell -A emscriptenPackages.zlib</code>
          </p></li></ul></div></li></ul></div></li></ul></div><section class="section"><div class="titlepage"><div><div><h3 id="imperative-usage" class="title">15.7.1.&nbsp;Imperative usage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#imperative-usage" aria-label="Anchor link for: imperative usage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      A few things to note:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">export EMCC_DEBUG=2</code> is nice for debugging
       </p></li><li class="listitem"><p>
        <code class="literal">~/.emscripten</code>, the build artifact cache sometimes creates issues and needs to be removed from time to time
       </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h3 id="declarative-usage" class="title">15.7.2.&nbsp;Declarative usage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#declarative-usage" aria-label="Anchor link for: declarative usage" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Let’s see two different examples from <code class="literal">pkgs/top-level/emscripten-packages.nix</code>:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">pkgs.zlib.override</code>
       </p></li><li class="listitem"><p>
        <code class="literal">pkgs.buildEmscriptenPackage</code>
       </p></li></ul></div><p>
      Both are interesting concepts.
     </p><p>
      A special requirement of the <code class="literal">pkgs.buildEmscriptenPackage</code> is the <code class="literal">doCheck = true</code> is a default meaning that each emscriptenPackage requires a <code class="literal">checkPhase</code> implemented.
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Use <code class="literal">export EMCC_DEBUG=2</code> from within a emscriptenPackage’s <code class="literal">phase</code> to get more detailed debug output what is going wrong.
       </p></li><li class="listitem"><p>
        ~/.emscripten cache is requiring us to set <code class="literal">HOME=$TMPDIR</code> in individual phases. This makes compilation slower but also makes it more deterministic.
       </p></li></ul></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-1-pkgs.zlib.override" shape="rect"></a>15.7.2.1.&nbsp;Usage 1: pkgs.zlib.override</h4></div></div></div><p>
       This example uses <code class="literal">zlib</code> from nixpkgs but instead of compiling <span class="strong"><strong>C</strong></span> to <span class="strong"><strong>ELF</strong></span> it compiles <span class="strong"><strong>C</strong></span> to <span class="strong"><strong>JS</strong></span> since we were using <code class="literal">pkgs.zlib.override</code> and changed stdenv to <code class="literal">pkgs.emscriptenStdenv</code>. A few adaptions and hacks were set in place to make it working. One advantage is that when <code class="literal">pkgs.zlib</code> is updated, it will automatically update this package as well. However, this can also be the downside…
      </p><p>
       See the <code class="literal">zlib</code> example:
      </p><pre class="programlisting hljs bash" xml:space="preserve">zlib = (pkgs.zlib.override {
  stdenv = pkgs.emscriptenStdenv;
}).overrideDerivation
(old: rec {
  buildInputs = old.buildInputs ++ [ pkgconfig ];
  <span class="hljs-comment"><span class="hljs-comment"># we need to reset this setting!</span></span>
  NIX_CFLAGS_COMPILE=<span class="hljs-string"><span class="hljs-string">""</span></span>;
  configurePhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">FIXME:</span></span></span><span class="hljs-comment"> Some tests require writing at $HOME</span></span>
    HOME=<span class="hljs-variable"><span class="hljs-variable">$TMPDIR</span></span>
    runHook preConfigure

    <span class="hljs-comment"><span class="hljs-comment">#export EMCC_DEBUG=2</span></span>
    emconfigure ./configure --prefix=<span class="hljs-variable"><span class="hljs-variable">$out</span></span> --shared

    runHook postConfigure
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
  dontStrip = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  outputs = [ <span class="hljs-string"><span class="hljs-string">"out"</span></span> ];
  buildPhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    emmake make
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
  installPhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    emmake make install
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
  checkPhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"================= testing zlib using node ================="</span></span>

    <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Compiling a custom test"</span></span>
    <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -x
    emcc -O2 -s EMULATE_FUNCTION_POINTER_CASTS=1 <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/example.c -DZ_SOLO \
    libz.so.<span class="hljs-variable"><span class="hljs-variable">${old.version}</span></span> -I . -o example.js

    <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Using node to execute the test"</span></span>
    <span class="hljs-variable"><span class="hljs-variable">${pkgs.nodejs}</span></span>/bin/node ./example.js

    <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> +x
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $? -ne 0 ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
      <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"test failed for some reason"</span></span>
      <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1;
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
      <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"it seems to work! very good."</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span>
    <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"================= /testing zlib using node ================="</span></span>
  <span class="hljs-string"><span class="hljs-string">''</span></span>;

  postPatch = pkgs.stdenv.lib.optionalString pkgs.stdenv.isDarwin <span class="hljs-string"><span class="hljs-string">''</span></span>
    substituteInPlace configure \
      --replace <span class="hljs-string"><span class="hljs-string">'/usr/bin/libtool'</span></span> <span class="hljs-string"><span class="hljs-string">'ar'</span></span> \
      --replace <span class="hljs-string"><span class="hljs-string">'AR="libtool"'</span></span> <span class="hljs-string"><span class="hljs-string">'AR="ar"'</span></span> \
      --replace <span class="hljs-string"><span class="hljs-string">'ARFLAGS="-o"'</span></span> <span class="hljs-string"><span class="hljs-string">'ARFLAGS="-r"'</span></span>
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
});
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-2-pkgs.buildemscriptenpackage" shape="rect"></a>15.7.2.2.&nbsp;Usage 2: pkgs.buildEmscriptenPackage</h4></div></div></div><p>
       This <code class="literal">xmlmirror</code> example features a emscriptenPackage which is defined completely from this context and no <code class="literal">pkgs.zlib.override</code> is used.
      </p><pre class="programlisting hljs bash" xml:space="preserve">xmlmirror = pkgs.buildEmscriptenPackage rec {
  name = <span class="hljs-string"><span class="hljs-string">"xmlmirror"</span></span>;

  buildInputs = [ pkgconfig autoconf automake libtool gnumake libxml2 nodejs openjdk json_c ];
  nativeBuildInputs = [ pkgconfig zlib ];

  src = pkgs.fetchgit {
    url = <span class="hljs-string"><span class="hljs-string">"https://gitlab.com/odfplugfest/xmlmirror.git"</span></span>;
    rev = <span class="hljs-string"><span class="hljs-string">"4fd7e86f7c9526b8f4c1733e5c8b45175860a8fd"</span></span>;
    sha256 = <span class="hljs-string"><span class="hljs-string">"1jasdqnbdnb83wbcnyrp32f36w3xwhwp0wq8lwwmhqagxrij1r4b"</span></span>;
  };

  configurePhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    rm -f fastXmlLint.js*
    <span class="hljs-comment"><span class="hljs-comment"># a fix for ERROR:root:For asm.js, TOTAL_MEMORY must be a multiple of 16MB, was 234217728</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># https://gitlab.com/odfplugfest/xmlmirror/issues/8</span></span>
    sed -e <span class="hljs-string"><span class="hljs-string">"s/TOTAL_MEMORY=234217728/TOTAL_MEMORY=268435456/g"</span></span> -i Makefile.emEnv
    <span class="hljs-comment"><span class="hljs-comment"># https://github.com/kripken/emscripten/issues/6344</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># https://gitlab.com/odfplugfest/xmlmirror/issues/9</span></span>
    sed -e <span class="hljs-string"><span class="hljs-string">"s/\$(JSONC_LDFLAGS) \$(ZLIB_LDFLAGS) \$(LIBXML20_LDFLAGS)/\$(JSONC_LDFLAGS) \$(LIBXML20_LDFLAGS) \$(ZLIB_LDFLAGS) /g"</span></span> -i Makefile.emEnv
    <span class="hljs-comment"><span class="hljs-comment"># https://gitlab.com/odfplugfest/xmlmirror/issues/11</span></span>
    sed -e <span class="hljs-string"><span class="hljs-string">"s/-o fastXmlLint.js/-s EXTRA_EXPORTED_RUNTIME_METHODS='[\"ccall\", \"cwrap\"]' -o fastXmlLint.js/g"</span></span> -i Makefile.emEnv
  <span class="hljs-string"><span class="hljs-string">''</span></span>;

  buildPhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    HOME=<span class="hljs-variable"><span class="hljs-variable">$TMPDIR</span></span>
    make -f Makefile.emEnv
  <span class="hljs-string"><span class="hljs-string">''</span></span>;

  outputs = [ <span class="hljs-string"><span class="hljs-string">"out"</span></span> <span class="hljs-string"><span class="hljs-string">"doc"</span></span> ];

  installPhase = <span class="hljs-string"><span class="hljs-string">''</span></span>
    mkdir -p <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    mkdir -p <span class="hljs-variable"><span class="hljs-variable">$doc</span></span>/share/<span class="hljs-variable"><span class="hljs-variable">${name}</span></span>

    cp Demo* <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp -R codemirror-5.12 <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp fastXmlLint.js* <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp *.xsd <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp *.js <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp *.xhtml <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp *.html <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp *.json <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp *.rng <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share
    cp README.md <span class="hljs-variable"><span class="hljs-variable">$doc</span></span>/share/<span class="hljs-variable"><span class="hljs-variable">${name}</span></span>
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
  checkPhase = <span class="hljs-string"><span class="hljs-string">''</span></span>

  <span class="hljs-string"><span class="hljs-string">''</span></span>;
};
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="declarative-debugging" shape="rect"></a>15.7.2.3.&nbsp;Declarative debugging</h4></div></div></div><p>
       Use <code class="literal">nix-shell -I nixpkgs=/some/dir/nixpkgs -A emscriptenPackages.libz</code> and from there you can go trough the individual steps. This makes it easy to build a good <code class="literal">unit test</code> or list the files of the project.
      </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
         <code class="literal">nix-shell -I nixpkgs=/some/dir/nixpkgs -A emscriptenPackages.libz</code>
        </p></li><li class="listitem"><p>
         <code class="literal">cd /tmp/</code>
        </p></li><li class="listitem"><p>
         <code class="literal">unpackPhase</code>
        </p></li><li class="listitem"><p>
         cd libz-1.2.3
        </p></li><li class="listitem"><p>
         <code class="literal">configurePhase</code>
        </p></li><li class="listitem"><p>
         <code class="literal">buildPhase</code>
        </p></li><li class="listitem"><p>
         … happy hacking…
        </p></li></ol></div></section></section><section class="section"><div class="titlepage"><div><div><h3 id="summary" class="title">15.7.3.&nbsp;Summary<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#summary" aria-label="Anchor link for: summary" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Using this toolchain makes it easy to leverage <code class="literal">nix</code> from NixOS, MacOSX or even Windows (WSL+ubuntu+nix). This toolchain is reproducible, behaves like the rest of the packages from nixpkgs and contains a set of well working examples to learn and adapt from.
     </p><p>
      If in trouble, ask the maintainers.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-gnome" class="title" style="clear: both">15.8.&nbsp;GNOME<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-gnome" aria-label="Anchor link for: sec language gnome" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="ssec-gnome-packaging" class="title">15.8.1.&nbsp;Packaging GNOME applications<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-packaging" aria-label="Anchor link for: ssec gnome packaging" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Programs in the GNOME universe are written in various languages but they all use GObject-based libraries like GLib, GTK or GStreamer. These libraries are often modular, relying on looking into certain directories to find their modules. However, due to Nix’s specific file system organization, this will fail without our intervention. Fortunately, the libraries usually allow overriding the directories through environment variables, either natively or thanks to a patch in nixpkgs. <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" shape="rect">Wrapping</a> the executables to ensure correct paths are available to the application constitutes a significant part of packaging a modern desktop application. In this section, we will describe various modules needed by such applications, environment variables needed to make the modules load, and finally a script that will do the work for us.
     </p><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-gnome-settings" shape="rect"></a>15.8.1.1.&nbsp;Settings</h4></div></div></div><p>
       <a class="link" href="https://developer.gnome.org/gio/stable/GSettings.html" target="_top" shape="rect">GSettings</a> API is often used for storing settings. GSettings schemas are required, to know the type and other metadata of the stored values. GLib looks for <code class="filename">glib-2.0/schemas/gschemas.compiled</code> files inside the directories of <code class="envar">XDG_DATA_DIRS</code>.
      </p><p>
       On Linux, GSettings API is implemented using <a class="link" href="https://wiki.gnome.org/Projects/dconf" target="_top" shape="rect">dconf</a> backend. You will need to add <code class="literal">dconf</code> GIO module to <code class="envar">GIO_EXTRA_MODULES</code> variable, otherwise the <code class="literal">memory</code> backend will be used and the saved settings will not be persistent.
      </p><p>
       Last you will need the dconf database D-Bus service itself. You can enable it using <code class="option">programs.dconf.enable</code>.
      </p><p>
       Some applications will also require <span class="package">gsettings-desktop-schemas</span> for things like reading proxy configuration or user interface customization. This dependency is often not mentioned by upstream, you should grep for <code class="literal">org.gnome.desktop</code> and <code class="literal">org.gnome.system</code> to see if the schemas are needed.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-gnome-icons" shape="rect"></a>15.8.1.2.&nbsp;Icons</h4></div></div></div><p>
       When an application uses icons, an icon theme should be available in <code class="envar">XDG_DATA_DIRS</code> during runtime. The package for the default, icon-less <a class="link" href="https://www.freedesktop.org/wiki/Software/icon-theme/" target="_top" shape="rect">hicolor-icon-theme</a> (should be propagated by every icon theme) contains <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-hicolor-icon-theme" shape="rect">a setup hook</a> that will pick up icon themes from <code class="literal">buildInputs</code> and pass it to our wrapper. Unfortunately, relying on that would mean every user has to download the theme included in the package expression no matter their preference. For that reason, we leave the installation of icon theme on the user. If you use one of the desktop environments, you probably already have an icon theme installed.
      </p><p>
       To avoid costly file system access when locating icons, GTK, <a class="link" href="https://woboq.com/blog/qicon-reads-gtk-icon-cache-in-qt57.html" target="_top" shape="rect">as well as Qt</a>, can rely on <code class="filename">icon-theme.cache</code> files from the themes’ top-level directories. These files are generated using <span class="command"><strong>gtk-update-icon-cache</strong></span>, which is expected to be run whenever an icon is added or removed to an icon theme (typically an application icon into <code class="literal">hicolor</code> theme) and some programs do indeed run this after icon installation. However, since packages are installed into their own prefix by Nix, this would lead to conflicts. For that reason, <span class="package">gtk3</span> provides a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-gtk-drop-icon-theme-cache" shape="rect">setup hook</a> that will clean the file from installation. Since most applications only ship their own icon that will be loaded on start-up, it should not affect them too much. On the other hand, icon themes are much larger and more widely used so we need to cache them. Because we recommend installing icon themes globally, we will generate the cache files from all packages in a profile using a NixOS module. You can enable the cache generation using <code class="option">gtk.iconCache.enable</code> option if your desktop environment does not already do that.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-icon-theme-packaging" shape="rect"></a>15.8.1.3.&nbsp;Packaging icon themes</h4></div></div></div><p>
       Icon themes may inherit from other icon themes. The inheritance is specified using the <code class="literal">Inherits</code> key in the <code class="filename">index.theme</code> file distributed with the icon theme. According to the <a class="link" href="https://specifications.freedesktop.org/icon-theme-spec/icon-theme-spec-latest.html" target="_top" shape="rect">icon theme specification</a>, icons not provided by the theme are looked for in its parent icon themes. Therefore the parent themes should be installed as dependencies for a more complete experience regarding the icon sets used.
      </p><p>
       The package <span class="package">hicolor-icon-theme</span> provides a setup hook which makes symbolic links for the parent themes into the directory <code class="filename">share/icons</code> of the current theme directory in the nix store, making sure they can be found at runtime. For that to work the packages providing parent icon themes should be listed as propagated build dependencies, together with <span class="package">hicolor-icon-theme</span>.
      </p><p>
       Also make sure that <code class="filename">icon-theme.cache</code> is installed for each theme provided by the package, and set <code class="code">dontDropIconThemeCache</code> to <code class="code">true</code> so that the cache file is not removed by the <span class="package">gtk3</span> setup hook.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-gnome-themes" shape="rect"></a>15.8.1.4.&nbsp;GTK Themes</h4></div></div></div><p>
       Previously, a GTK theme needed to be in <code class="envar">XDG_DATA_DIRS</code>. This is no longer necessary for most programs since GTK incorporated Adwaita theme. Some programs (for example, those designed for <a class="link" href="https://elementary.io/docs/human-interface-guidelines#human-interface-guidelines" target="_top" shape="rect">elementary HIG</a>) might require a special theme like <span class="package">pantheon.elementary-gtk-theme</span>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-gnome-typelibs" shape="rect"></a>15.8.1.5.&nbsp;GObject introspection typelibs</h4></div></div></div><p>
       <a class="link" href="https://wiki.gnome.org/Projects/GObjectIntrospection" target="_top" shape="rect">GObject introspection</a> allows applications to use C libraries in other languages easily. It does this through <code class="literal">typelib</code> files searched in <code class="envar">GI_TYPELIB_PATH</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-gnome-plugins" shape="rect"></a>15.8.1.6.&nbsp;Various plug-ins</h4></div></div></div><p>
       If your application uses <a class="link" href="https://gstreamer.freedesktop.org/" target="_top" shape="rect">GStreamer</a> or <a class="link" href="https://wiki.gnome.org/Projects/Grilo" target="_top" shape="rect">Grilo</a>, you should set <code class="envar">GST_PLUGIN_SYSTEM_PATH_1_0</code> and <code class="envar">GRL_PLUGIN_PATH</code>, respectively.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-gnome-hooks" class="title">15.8.2.&nbsp;Onto <span class="package">wrapGAppsHook</span><a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks" aria-label="Anchor link for: ssec gnome hooks" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Given the requirements above, the package expression would become messy quickly:
</p><pre class="programlisting hljs bash" xml:space="preserve">preFixup = <span class="hljs-string"><span class="hljs-string">''</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(find <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin/ <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/libexec/ -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -executable); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>
    wrapProgram <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">"</span></span> \
      --prefix GIO_EXTRA_MODULES : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${getLib dconf}</span></span></span><span class="hljs-string">/lib/gio/modules"</span></span> \
      --prefix XDG_DATA_DIRS : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$out</span></span></span><span class="hljs-string">/share"</span></span> \
      --prefix XDG_DATA_DIRS : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$out</span></span></span><span class="hljs-string">/share/gsettings-schemas/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${name}</span></span></span><span class="hljs-string">"</span></span> \
      --prefix XDG_DATA_DIRS : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${gsettings-desktop-schemas}</span></span></span><span class="hljs-string">/share/gsettings-schemas/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${gsettings-desktop-schemas.name}</span></span></span><span class="hljs-string">"</span></span> \
      --prefix XDG_DATA_DIRS : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${hicolor-icon-theme}</span></span></span><span class="hljs-string">/share"</span></span> \
      --prefix GI_TYPELIB_PATH : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${lib.makeSearchPath "lib/girepository-1.0" [ pango json-glib ]}</span></span></span><span class="hljs-string">"</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>
<span class="hljs-string"><span class="hljs-string">''</span></span>;
</pre><p>
      Fortunately, there is <span class="package">wrapGAppsHook</span>, that does the wrapping for us. In particular, it works in conjunction with other setup hooks that will populate the variable:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a id="ssec-gnome-hooks-wrapgappshook" shape="rect"></a>
         <span class="package">wrapGAppsHook</span> itself will add the package’s <code class="filename">share</code> directory to <code class="envar">XDG_DATA_DIRS</code>.
        </p></li><li class="listitem"><p><a id="ssec-gnome-hooks-glib" shape="rect"></a>
         <span class="package">glib</span> setup hook will populate <code class="envar">GSETTINGS_SCHEMAS_PATH</code> and then <span class="package">wrapGAppsHook</span> will prepend it to <code class="envar">XDG_DATA_DIRS</code>.
        </p></li><li class="listitem"><p><a id="ssec-gnome-hooks-gtk-drop-icon-theme-cache" shape="rect"></a>
         One of <span class="package">gtk3</span>’s setup hooks will remove <code class="filename">icon-theme.cache</code> files from package’s icon theme directories to avoid conflicts. Icon theme packages should prevent this with <code class="code">dontDropIconThemeCache = true;</code>.
        </p></li><li class="listitem"><p><a id="ssec-gnome-hooks-dconf" shape="rect"></a>
         <span class="package">dconf.lib</span> is a dependency of <span class="package">wrapGAppsHook</span>, which then also adds it to the <code class="envar">GIO_EXTRA_MODULES</code> variable.
        </p></li><li class="listitem"><p><a id="ssec-gnome-hooks-hicolor-icon-theme" shape="rect"></a>
         <span class="package">hicolor-icon-theme</span>’s setup hook will add icon themes to <code class="envar">XDG_ICON_DIRS</code> which is prepended to <code class="envar">XDG_DATA_DIRS</code> by <span class="package">wrapGAppsHook</span>.
        </p></li><li class="listitem"><p><a id="ssec-gnome-hooks-gobject-introspection" shape="rect"></a>
         <span class="package">gobject-introspection</span> setup hook populates <code class="envar">GI_TYPELIB_PATH</code> variable with <code class="filename">lib/girepository-1.0</code> directories of dependencies, which is then added to wrapper by <span class="package">wrapGAppsHook</span>. It also adds <code class="filename">share</code> directories of dependencies to <code class="envar">XDG_DATA_DIRS</code>, which is intended to promote GIR files but it also <a class="link" href="https://github.com/NixOS/nixpkgs/issues/32790" target="_top" shape="rect">pollutes the closures</a> of packages using <span class="package">wrapGAppsHook</span>.
        </p><div class="alert alert-warning"><strong>Warning:</strong> 
          The setup hook <a class="link" href="https://github.com/NixOS/nixpkgs/issues/56943" target="_top" shape="rect">currently</a> does not work in expressions with <code class="literal">strictDeps</code> enabled, like Python packages. In those cases, you will need to disable it with <code class="code">strictDeps = false;</code>.
         </div></li><li class="listitem"><p><a id="ssec-gnome-hooks-gst-grl-plugins" shape="rect"></a>
         Setup hooks of <span class="package">gst_all_1.gstreamer</span> and <span class="package">gnome3.grilo</span> will populate the <code class="envar">GST_PLUGIN_SYSTEM_PATH_1_0</code> and <code class="envar">GRL_PLUGIN_PATH</code> variables, respectively, which will then be added to the wrapper by <code class="literal">wrapGAppsHook</code>.
        </p></li></ul></div><p>
     </p><p>
      You can also pass additional arguments to <code class="literal">makeWrapper</code> using <code class="literal">gappsWrapperArgs</code> in <code class="literal">preFixup</code> hook:
</p><pre class="programlisting hljs bash" xml:space="preserve">preFixup = <span class="hljs-string"><span class="hljs-string">''</span></span>
  gappsWrapperArgs+=(
    <span class="hljs-comment"><span class="hljs-comment"># Thumbnailers</span></span>
    --prefix XDG_DATA_DIRS : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${gdk-pixbuf}</span></span></span><span class="hljs-string">/share"</span></span>
    --prefix XDG_DATA_DIRS : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${librsvg}</span></span></span><span class="hljs-string">/share"</span></span>
    --prefix XDG_DATA_DIRS : <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${shared-mime-info}</span></span></span><span class="hljs-string">/share"</span></span>
  )
<span class="hljs-string"><span class="hljs-string">''</span></span>;
</pre><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-gnome-updating" class="title">15.8.3.&nbsp;Updating GNOME packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-updating" aria-label="Anchor link for: ssec gnome updating" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Most GNOME package offer <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#var-passthru-updateScript" shape="rect"><code class="literal">updateScript</code></a>, it is therefore possible to update to latest source tarball by running <span class="command"><strong>nix-shell maintainers/scripts/update.nix --argstr package gnome3.nautilus</strong></span> or even en masse with <span class="command"><strong>nix-shell maintainers/scripts/update.nix --argstr path gnome3</strong></span>. Read the package’s <code class="filename">NEWS</code> file to see what changed.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-gnome-common-issues" class="title">15.8.4.&nbsp;Frequently encountered issues<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues" aria-label="Anchor link for: ssec gnome common issues" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><a id="ssec-gnome-common-issues-no-schemas" shape="rect"></a><span class="term">
        <code class="computeroutput">GLib-GIO-ERROR **: <em class="replaceable"><code>06:04:50.903</code></em>: No GSettings schemas are installed on the system</code>
       </span></dt><dd><p>
         There are no schemas avalable in <code class="envar">XDG_DATA_DIRS</code>. Temporarily add a random package containing schemas like <span class="package">gsettings-desktop-schemas</span> to <code class="literal">buildInputs</code>. <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-glib" shape="rect"><span class="package">glib</span></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-hooks-wrapgappshook" shape="rect"><span class="package">wrapGAppsHook</span></a> setup hooks will take care of making the schemas available to application and you will see the actual missing schemas with the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-missing-schema" shape="rect">next error</a>. Or you can try looking through the source code for the actual schemas used.
        </p></dd><dt><a id="ssec-gnome-common-issues-missing-schema" shape="rect"></a><span class="term">
        <code class="computeroutput">GLib-GIO-ERROR **: <em class="replaceable"><code>06:04:50.903</code></em>: Settings schema ‘<em class="replaceable"><code>org.gnome.foo</code></em>’ is not installed</code>
       </span></dt><dd><p>
         Package is missing some GSettings schemas. You can find out the package containing the schema with <span class="command"><strong>nix-locate <em class="replaceable"><code>org.gnome.foo</code></em>.gschema.xml</strong></span> and let the hooks handle the wrapping as <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#ssec-gnome-common-issues-no-schemas" shape="rect">above</a>.
        </p></dd><dt><a id="ssec-gnome-common-issues-double-wrapped" shape="rect"></a><span class="term">
        When using <span class="package">wrapGAppsHook</span> with special derivers you can end up with double wrapped binaries.
       </span></dt><dd><p>
         This is because derivers like <code class="function">python.pkgs.buildPythonApplication</code> or <code class="function">qt5.mkDerivation</code> have setup-hooks automatically added that produce wrappers with <span class="package">makeWrapper</span>. The simplest way to workaround that is to disable the <span class="package">wrapGAppsHook</span> automatic wrapping with <code class="code">dontWrapGApps = true;</code> and pass the arguments it intended to pass to <span class="package">makeWrapper</span> to another.
        </p><p>
         In the case of a Python application it could look like:
</p><pre class="programlisting hljs nix" xml:space="preserve">python3.pkgs.buildPythonApplication {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"gnome-music"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"3.32.2"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [
    wrapGAppsHook
    gobject-introspection
    ...
  ];

  <span class="hljs-attr"><span class="hljs-attr">dontWrapGApps</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># Arguments to be passed to `makeWrapper`, only used by buildPython*</span></span>
  <span class="hljs-attr"><span class="hljs-attr">preFixup</span></span> = <span class="hljs-string"><span class="hljs-string">''
    makeWrapperArgs+=("''</span></span>${gappsWrapperArgs[@]}<span class="hljs-string"><span class="hljs-string">")
  '';
}
</span></span></pre><p>
         And for a QT app like:
</p><pre class="programlisting hljs nix" xml:space="preserve">mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"calibre"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"3.47.0"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [
    wrapGAppsHook
    qmake
    ...
  ];

  <span class="hljs-attr"><span class="hljs-attr">dontWrapGApps</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># Arguments to be passed to `makeWrapper`, only used by qt5’s mkDerivation</span></span>
  <span class="hljs-attr"><span class="hljs-attr">preFixup</span></span> = <span class="hljs-string"><span class="hljs-string">''
    qtWrapperArgs+=("''</span></span>${gappsWrapperArgs[@]}<span class="hljs-string"><span class="hljs-string">")
  '';
}
</span></span></pre><p>
        </p></dd><dt><a id="ssec-gnome-common-issues-unwrappable-package" shape="rect"></a><span class="term">
        I am packaging a project that cannot be wrapped, like a library or GNOME Shell extension.
       </span></dt><dd><p>
         You can rely on applications depending on the library setting the necessary environment variables but that is often easy to miss. Instead we recommend to patch the paths in the source code whenever possible. Here are some examples:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a id="ssec-gnome-common-issues-unwrappable-package-gnome-shell-ext" shape="rect"></a>
            <a class="link" href="https://github.com/NixOS/nixpkgs/blob/7bb8f05f12ca3cff9da72b56caa2f7472d5732bc/pkgs/desktops/gnome-3/core/gnome-shell-extensions/default.nix#L21-L24" target="_top" shape="rect">Replacing a <code class="envar">GI_TYPELIB_PATH</code> in GNOME Shell extension</a> – we are using <code class="function">substituteAll</code> to include the path to a typelib into a patch.
           </p></li><li class="listitem"><p><a id="ssec-gnome-common-issues-unwrappable-package-gsettings" shape="rect"></a>
            The following examples are hardcoding GSettings schema paths. To get the schema paths we use the functions
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
               <code class="function">glib.getSchemaPath</code> Takes a nix package attribute as an argument.
              </p></li><li class="listitem"><p>
               <code class="function">glib.makeSchemaPath</code> Takes a package output like <code class="literal">$out</code> and a derivation name. You should use this if the schemas you need to hardcode are in the same derivation.
              </p></li></ul></div><p>
           </p><p><a id="ssec-gnome-common-issues-unwrappable-package-gsettings-vala" shape="rect"></a>
            <a class="link" href="https://github.com/NixOS/nixpkgs/blob/7bb8f05f12ca3cff9da72b56caa2f7472d5732bc/pkgs/desktops/pantheon/apps/elementary-files/default.nix#L78-L86" target="_top" shape="rect">Hard-coding GSettings schema path in Vala plug-in (dynamically loaded library)</a> – here, <code class="function">substituteAll</code> cannot be used since the schema comes from the same package preventing us from pass its path to the function, probably due to a <a class="link" href="https://github.com/NixOS/nix/issues/1846" target="_top" shape="rect">Nix bug</a>.
           </p><p><a id="ssec-gnome-common-issues-unwrappable-package-gsettings-c" shape="rect"></a>
            <a class="link" href="https://github.com/NixOS/nixpkgs/blob/29c120c065d03b000224872251bed93932d42412/pkgs/development/libraries/glib-networking/default.nix#L31-L34" target="_top" shape="rect">Hard-coding GSettings schema path in C library</a> – nothing special other than using <a class="link" href="https://github.com/NixOS/nixpkgs/pull/67957#issuecomment-527717467" target="_top" shape="rect">Coccinelle patch</a> to generate the patch itself.
           </p></li></ul></div><p>
        </p></dd><dt><a id="ssec-gnome-common-issues-weird-location" shape="rect"></a><span class="term">
        I need to wrap a binary outside <code class="filename">bin</code> and <code class="filename">libexec</code> directories.
       </span></dt><dd><p>
         You can manually trigger the wrapping with <code class="function">wrapGApp</code> in <code class="literal">preFixup</code> phase. It takes a path to a program as a first argument; the remaining arguments are passed directly to <code class="function"><a class="function" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" shape="rect">wrapProgram</a></code> function.
        </p></dd></dl></div></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-go" class="title" style="clear: both">15.9.&nbsp;Go<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-go" aria-label="Anchor link for: sec language go" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="ssec-go-modules" class="title">15.9.1.&nbsp;Go modules<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-go-modules" aria-label="Anchor link for: ssec go modules" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The function <code class="varname"> buildGoModule </code> builds Go programs managed with Go modules. It builds a <a class="link" href="https://github.com/golang/go/wiki/Modules" target="_top" shape="rect">Go modules</a> through a two phase build:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         An intermediate fetcher derivation. This derivation will be used to fetch all of the dependencies of the Go module.
        </p></li><li class="listitem"><p>
         A final derivation will use the output of the intermediate derivation to build the binaries and produce the final output.
        </p></li></ul></div><p>
     </p><div class="example"><a id="ex-buildGoModule" shape="rect"></a><p class="title"><strong>Example&nbsp;15.5.&nbsp;buildGoModule</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">pet</span></span> = buildGoModule <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"pet"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.3.4"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
    <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"knqyf263"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"pet"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"v</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${version}</span></span></span><span class="hljs-string">"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0m2fzpqxk7hrbxsgqplkg7h2p7gv6s1miymv3gvw0cz039skag0s"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">vendorSha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1879j77k96684wi554rkjxydrj8g3hpp0kvxz03sd8dmwr3lh83j"</span></span>; <a id="ex-buildGoModule-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">subPackages</span></span> = [ <span class="hljs-string"><span class="hljs-string">"."</span></span> ]; <a id="ex-buildGoModule-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">deleteVendor</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <a id="ex-buildGoModule-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">runVend</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <a id="ex-buildGoModule-4" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"Simple command-line snippet manager, written in Go"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/knqyf263/pet"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.mit;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ kalbasit ];
    <span class="hljs-attr"><span class="hljs-attr">platforms</span></span> = platforms.linux ++ platforms.darwin;
  };
}
</pre></div></div><br class="example-break" clear="none"><br><p>
      <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoModule" title="Example 15.5. buildGoModule" shape="rect">Example&nbsp;15.5, “buildGoModule”</a> is an example expression using buildGoModule, the following arguments are of special significance to the function:
      </p><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoModule-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">vendorSha256</code> is the hash of the output of the intermediate fetcher derivation.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoModule-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">subPackages</code> limits the builder from building child packages that have not been listed. If <code class="varname">subPackages</code> is not specified, all child packages will be built.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoModule-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">deleteVendor</code> removes the pre-existing vendor directory and fetches the dependencies. This should only be used if the dependencies included in the vendor folder are broken or incomplete.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoModule-4" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">runVend</code> runs the vend command to generate the vendor directory. This is useful if your code depends on c code and go mod tidy does not include the needed sources to build.
        </p></td></tr></tbody></table></div><p>
     </p><p>
      <code class="varname">vendorSha256</code> can also take <code class="varname">null</code> as an input. When `null` is used as a value, rather than fetching the dependencies and vendoring them, we use the vendoring included within the source repo. If you'd like to not have to update this field on dependency changes, run `go mod vendor` in your source repo and set 'vendorSha256 = null;'
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-go-legacy" class="title">15.9.2.&nbsp;Go legacy<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-go-legacy" aria-label="Anchor link for: ssec go legacy" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The function <code class="varname"> buildGoPackage </code> builds legacy Go programs, not supporting Go modules.
     </p><div class="example"><a id="ex-buildGoPackage" shape="rect"></a><p class="title"><strong>Example&nbsp;15.6.&nbsp;buildGoPackage</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">deis</span></span> = buildGoPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"deis"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"1.13.0"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">goPackagePath</span></span> = <span class="hljs-string"><span class="hljs-string">"github.com/deis/deis"</span></span>; <a id="ex-buildGoPackage-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">subPackages</span></span> = [ <span class="hljs-string"><span class="hljs-string">"client"</span></span> ]; <a id="ex-buildGoPackage-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
    <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"deis"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"deis"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"v</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${version}</span></span></span><span class="hljs-string">"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1qv9lxqx7m18029lj8cw3k7jngvxs4iciwrypdy0gd2nnghc68sw"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">goDeps</span></span> = ./deps.nix; <a id="ex-buildGoPackage-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>

  <span class="hljs-attr"><span class="hljs-attr">buildFlags</span></span> = [ <span class="hljs-string"><span class="hljs-string">"--tags"</span></span> <span class="hljs-string"><span class="hljs-string">"release"</span></span> ]; <a id="ex-buildGoPackage-4" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span>
}
</pre></div></div><br class="example-break" clear="none"><br><p>
      <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoPackage" title="Example 15.6. buildGoPackage" shape="rect">Example&nbsp;15.6, “buildGoPackage”</a> is an example expression using buildGoPackage, the following arguments are of special significance to the function:
      </p><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoPackage-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">goPackagePath</code> specifies the package's canonical Go import path.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoPackage-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">subPackages</code> limits the builder from building child packages that have not been listed. If <code class="varname">subPackages</code> is not specified, all child packages will be built.
        </p><p>
         In this example only <code class="literal">github.com/deis/deis/client</code> will be built.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoPackage-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">goDeps</code> is where the Go dependencies of a Go program are listed as a list of package source identified by Go import path. It could be imported as a separate <code class="varname">deps.nix</code> file for readability. The dependency data structure is described below.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-buildGoPackage-4" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/4.svg" alt="4" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">buildFlags</code> is a list of flags passed to the go build command.
        </p></td></tr></tbody></table></div><p>
     </p><p>
      The <code class="varname">goDeps</code> attribute can be imported from a separate <code class="varname">nix</code> file that defines which Go libraries are needed and should be included in <code class="varname">GOPATH</code> for <code class="varname">buildPhase</code>.
     </p><div class="example"><a id="ex-goDeps" shape="rect"></a><p class="title"><strong>Example&nbsp;15.7.&nbsp;deps.nix</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">[ <a id="ex-goDeps-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>
  {
    <span class="hljs-attr"><span class="hljs-attr">goPackagePath</span></span> = <span class="hljs-string"><span class="hljs-string">"gopkg.in/yaml.v2"</span></span>; <a id="ex-goDeps-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>
    <span class="hljs-attr"><span class="hljs-attr">fetch</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">type</span></span> = <span class="hljs-string"><span class="hljs-string">"git"</span></span>; <a id="ex-goDeps-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>
      <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://gopkg.in/yaml.v2"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"a83829b6f1293c91addabc89d0571c246397bbf4"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1m4dsmk90sbi17571h6pld44zxz7jc4lrnl4f27dpd1l8g5xvjhh"</span></span>;
    };
  }
  {
    <span class="hljs-attr"><span class="hljs-attr">goPackagePath</span></span> = <span class="hljs-string"><span class="hljs-string">"github.com/docopt/docopt-go"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">fetch</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">type</span></span> = <span class="hljs-string"><span class="hljs-string">"git"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/docopt/docopt-go"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"784ddc588536785e7299f7272f39101f7faccc3f"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0wwz48jl9fvl1iknvn9dqr4gfy1qs03gxaikrxxp9gry6773v3sj"</span></span>;
    };
  }
]
</pre></div></div><br class="example-break" clear="none"><br><p>
      </p><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-goDeps-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">goDeps</code> is a list of Go dependencies.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-goDeps-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">goPackagePath</code> specifies Go package import path.
        </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#ex-goDeps-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
         <code class="varname">fetch type</code> that needs to be used to get package source. If <code class="varname">git</code> is used there should be <code class="varname">url</code>, <code class="varname">rev</code> and <code class="varname">sha256</code> defined next to it.
        </p></td></tr></tbody></table></div><p>
     </p><p>
      To extract dependency information from a Go package in automated way use <a class="link" href="https://github.com/kamilchm/go2nix" target="_top" shape="rect">go2nix</a>. It can produce complete derivation and <code class="varname">goDeps</code> file for Go programs.
     </p><p>
      You may use Go packages installed into the active Nix profiles by adding the following to your ~/.bashrc:
</p><pre class="screen hljs bash" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$NIX_PROFILES</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>
    GOPATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$p</span></span></span><span class="hljs-string">/share/go:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$GOPATH</span></span></span><span class="hljs-string">"</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>
</pre><p>
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="haskell" class="title" style="clear: both">15.10.&nbsp;Haskell<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#haskell" aria-label="Anchor link for: haskell" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The documentation for the Haskell infrastructure is published at <a class="link" href="https://haskell4nix.readthedocs.io/" target="_top" shape="rect">https://haskell4nix.readthedocs.io/</a>. The source code for that site lives in the <code class="literal">doc/</code> sub-directory of the <a class="link" href="https://github.com/NixOS/cabal2nix" target="_top" shape="rect"><code class="literal">cabal2nix</code> Git repository</a> and changes can be submitted there.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="idris" class="title" style="clear: both">15.11.&nbsp;Idris<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#idris" aria-label="Anchor link for: idris" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="installing-idris" class="title">15.11.1.&nbsp;Installing Idris<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#installing-idris" aria-label="Anchor link for: installing idris" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The easiest way to get a working idris version is to install the <code class="literal">idris</code> attribute:
     </p><pre class="programlisting hljs nix" xml:space="preserve">$ <span class="hljs-comment"><span class="hljs-comment"># On NixOS</span></span>
$ nix-env -i nixos.idris
$ <span class="hljs-comment"><span class="hljs-comment"># On non-NixOS</span></span>
$ nix-env -i nixpkgs.idris
</pre><p>
      This however only provides the <code class="literal">prelude</code> and <code class="literal">base</code> libraries. To install idris with additional libraries, you can use the <code class="literal">idrisPackages.with-packages</code> function, e.g.&nbsp;in an overlay in <code class="literal">~/.config/nixpkgs/overlays/my-idris.nix</code>:
     </p><pre class="programlisting hljs nix" xml:space="preserve">self: super: {
  <span class="hljs-attr"><span class="hljs-attr">myIdris</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self.idrisPackages; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-packages [ contrib pruviloj ];
}
</pre><p>
      And then:
     </p><pre class="programlisting hljs nix" xml:space="preserve">$ <span class="hljs-comment"><span class="hljs-comment"># On NixOS</span></span>
$ nix-env -iA nixos.myIdris
$ <span class="hljs-comment"><span class="hljs-comment"># On non-NixOS</span></span>
$ nix-env -iA nixpkgs.myIdris
</pre><p>
      To see all available Idris packages:
     </p><pre class="programlisting hljs nix" xml:space="preserve">$ <span class="hljs-comment"><span class="hljs-comment"># On NixOS</span></span>
$ nix-env -qaPA nixos.idrisPackages
$ <span class="hljs-comment"><span class="hljs-comment"># On non-NixOS</span></span>
$ nix-env -qaPA nixpkgs.idrisPackages
</pre><p>
      Similarly, entering a <code class="literal">nix-shell</code>:
     </p><pre class="programlisting hljs nix" xml:space="preserve">$ nix-shell -p 'idrisPackages.<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-packages (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> idrisPackages; [ contrib pruviloj ])'
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="starting-idris-with-library-support" class="title">15.11.2.&nbsp;Starting Idris with library support<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#starting-idris-with-library-support" aria-label="Anchor link for: starting idris with library support" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      To have access to these libraries in idris, call it with an argument <code class="literal">-p &lt;library name&gt;</code> for each library:
     </p><pre class="programlisting hljs nix" xml:space="preserve">$ nix-shell -p 'idrisPackages.<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-packages (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> idrisPackages; [ contrib pruviloj ])'
[nix-shell:~]$ idris -p contrib -p pruviloj
</pre><p>
      A listing of all available packages the Idris binary has access to is available via <code class="literal">--listlibs</code>:
     </p><pre class="programlisting hljs" xml:space="preserve">$ idris --listlibs
00prelude-idx.ibc
pruviloj
base
contrib
prelude
00pruviloj-idx.ibc
00base-idx.ibc
00contrib-idx.ibc
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="building-an-idris-project-with-nix" class="title">15.11.3.&nbsp;Building an Idris project with Nix<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#building-an-idris-project-with-nix" aria-label="Anchor link for: building an idris project with nix" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      As an example of how a Nix expression for an Idris package can be created, here is the one for <code class="literal">idrisPackages.yaml</code>:
     </p><pre class="programlisting hljs nix" xml:space="preserve">{ build-idris-package
, fetchFromGitHub
, contrib
, lightyear
, lib
}:
build-idris-package  {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"yaml"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"2018-01-25"</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># This is the .ipkg file that should be built, defaults to the package name</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># In this case it should build `Yaml.ipkg` instead of `yaml.ipkg`</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># This is only necessary because the yaml packages ipkg file is</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># different from its package name here.</span></span>
  <span class="hljs-attr"><span class="hljs-attr">ipkgName</span></span> = <span class="hljs-string"><span class="hljs-string">"Yaml"</span></span>;
  <span class="hljs-comment"><span class="hljs-comment"># Idris dependencies to provide for the build</span></span>
  <span class="hljs-attr"><span class="hljs-attr">idrisDeps</span></span> = [ contrib lightyear ];

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
    <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"Heather"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"Idris.Yaml"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"5afa51ffc839844862b8316faba3bafa15656db4"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1g4pi0swmg214kndj85hj50ccmckni7piprsxfdzdfhg87s0avw7"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"Idris YAML lib"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/Heather/Idris.Yaml"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = lib.licenses.mit;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = [ lib.maintainers.brainrape ];
  };
}
</pre><p>
      Assuming this file is saved as <code class="literal">yaml.nix</code>, it’s buildable using
     </p><pre class="programlisting hljs nix" xml:space="preserve">$ nix-build -E '(<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {}).idrisPackages.callPackage ./yaml.nix {}'
</pre><p>
      Or it’s possible to use
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

{
  <span class="hljs-attr"><span class="hljs-attr">yaml</span></span> = idrisPackages.callPackage ./yaml.nix {};
}
</pre><p>
      in another file (say <code class="literal">default.nix</code>) to be able to build it with
     </p><pre class="programlisting hljs" xml:space="preserve">$ nix-build -A yaml
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="passing-options-to-idris-commands" class="title">15.11.4.&nbsp;Passing options to <code class="literal">idris</code> commands<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#passing-options-to-idris-commands" aria-label="Anchor link for: passing options to idris commands" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The <code class="literal">build-idris-package</code> function provides also optional input values to set additional options for the used <code class="literal">idris</code> commands.
     </p><p>
      Specifically, you can set <code class="literal">idrisBuildOptions</code>, <code class="literal">idrisTestOptions</code>, <code class="literal">idrisInstallOptions</code> and <code class="literal">idrisDocOptions</code> to provide additional options to the <code class="literal">idris</code> command respectively when building, testing, installing and generating docs for your package.
     </p><p>
      For example you could set
     </p><pre class="programlisting hljs nix" xml:space="preserve">build-idris-package {
  <span class="hljs-attr"><span class="hljs-attr">idrisBuildOptions</span></span> = [ <span class="hljs-string"><span class="hljs-string">"--log"</span></span> <span class="hljs-string"><span class="hljs-string">"1"</span></span> <span class="hljs-string"><span class="hljs-string">"--verbose"</span></span> ]

  ...
}
</pre><p>
      to require verbose output during <code class="literal">idris</code> build phase.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="ios" class="title" style="clear: both">15.12.&nbsp;iOS<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ios" aria-label="Anchor link for: ios" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     This component is basically a wrapper/workaround that makes it possible to expose an Xcode installation as a Nix package by means of symlinking to the relevant executables on the host system.
    </p><p>
     Since Xcode can’t be packaged with Nix, nor we can publish it as a Nix package (because of its license) this is basically the only integration strategy making it possible to do iOS application builds that integrate with other components of the Nix ecosystem
    </p><p>
     The primary objective of this project is to use the Nix expression language to specify how iOS apps can be built from source code, and to automatically spawn iOS simulator instances for testing.
    </p><p>
     This component also makes it possible to use <a class="link" href="https://nixos.org/hydra" target="_top" shape="rect">Hydra</a>, the Nix-based continuous integration server to regularly build iOS apps and to do wireless ad-hoc installations of enterprise IPAs on iOS devices through Hydra.
    </p><p>
     The Xcode build environment implements a number of features.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="deploying-a-proxy-component-wrapper-exposing-xcode" class="title">15.12.1.&nbsp;Deploying a proxy component wrapper exposing Xcode<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#deploying-a-proxy-component-wrapper-exposing-xcode" aria-label="Anchor link for: deploying a proxy component wrapper exposing xcode" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The first use case is deploying a Nix package that provides symlinks to the Xcode installation on the host system. This package can be used as a build input to any build function implemented in the Nix expression language that requires Xcode.
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

  <span class="hljs-attr"><span class="hljs-attr">xcodeenv</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> ./xcodeenv {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (pkgs) stdenv;
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
xcodeenv.composeXcodeWrapper {
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"9.2"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">xcodeBaseDir</span></span> = <span class="hljs-string"><span class="hljs-string">"/Applications/Xcode.app"</span></span>;
}
</pre><p>
      By deploying the above expression with <code class="literal">nix-build</code> and inspecting its content you will notice that several Xcode-related executables are exposed as a Nix package:
     </p><pre class="programlisting hljs" xml:space="preserve">$ ls result/bin
lrwxr-xr-x  1 sander  staff  94  1 jan  1970 Simulator -&gt; /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app/Contents/MacOS/Simulator
lrwxr-xr-x  1 sander  staff  17  1 jan  1970 codesign -&gt; /usr/bin/codesign
lrwxr-xr-x  1 sander  staff  17  1 jan  1970 security -&gt; /usr/bin/security
lrwxr-xr-x  1 sander  staff  21  1 jan  1970 xcode-select -&gt; /usr/bin/xcode-select
lrwxr-xr-x  1 sander  staff  61  1 jan  1970 xcodebuild -&gt; /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild
lrwxr-xr-x  1 sander  staff  14  1 jan  1970 xcrun -&gt; /usr/bin/xcrun
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="building-an-ios-application" class="title">15.12.2.&nbsp;Building an iOS application<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#building-an-ios-application" aria-label="Anchor link for: building an ios application" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      We can build an iOS app executable for the simulator, or an IPA/xcarchive file for release purposes, e.g.&nbsp;ad-hoc, enterprise or store installations, by executing the <code class="literal">xcodeenv.buildApp {}</code> function:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

  <span class="hljs-attr"><span class="hljs-attr">xcodeenv</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> ./xcodeenv {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (pkgs) stdenv;
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
xcodeenv.buildApp {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"MyApp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = ./myappsources;
  <span class="hljs-attr"><span class="hljs-attr">sdkVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"11.2"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">target</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment"># Corresponds to the name of the app by default</span></span>
  <span class="hljs-attr"><span class="hljs-attr">configuration</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment"># Release for release builds, Debug for debug builds</span></span>
  <span class="hljs-attr"><span class="hljs-attr">scheme</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment"># -scheme will correspond to the app name by default</span></span>
  <span class="hljs-attr"><span class="hljs-attr">sdk</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment"># null will set it to 'iphonesimulator` for simulator builds or `iphoneos` to real builds</span></span>
  <span class="hljs-attr"><span class="hljs-attr">xcodeFlags</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">release</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">certificateFile</span></span> = ./mycertificate.p12;
  <span class="hljs-attr"><span class="hljs-attr">certificatePassword</span></span> = <span class="hljs-string"><span class="hljs-string">"secret"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">provisioningProfile</span></span> = ./myprovisioning.profile;
  <span class="hljs-attr"><span class="hljs-attr">signMethod</span></span> = <span class="hljs-string"><span class="hljs-string">"ad-hoc"</span></span>; <span class="hljs-comment"><span class="hljs-comment"># 'enterprise' or 'store'</span></span>
  <span class="hljs-attr"><span class="hljs-attr">generateIPA</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">generateXCArchive</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">enableWirelessDistribution</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">installURL</span></span> = <span class="hljs-string"><span class="hljs-string">"/installipa.php"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">bundleId</span></span> = <span class="hljs-string"><span class="hljs-string">"mycompany.myapp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">appVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># Supports all xcodewrapper parameters as well</span></span>
  <span class="hljs-attr"><span class="hljs-attr">xcodeBaseDir</span></span> = <span class="hljs-string"><span class="hljs-string">"/Applications/Xcode.app"</span></span>;
}
</pre><p>
      The above function takes a variety of parameters: * The <code class="literal">name</code> and <code class="literal">src</code> parameters are mandatory and specify the name of the app and the location where the source code resides * <code class="literal">sdkVersion</code> specifies which version of the iOS SDK to use.
     </p><p>
      It also possile to adjust the <code class="literal">xcodebuild</code> parameters. This is only needed in rare circumstances. In most cases the default values should suffice:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Specifies which <code class="literal">xcodebuild</code> target to build. By default it takes the target that has the same name as the app.
       </p></li><li class="listitem"><p>
        The <code class="literal">configuration</code> parameter can be overridden if desired. By default, it will do a debug build for the simulator and a release build for real devices.
       </p></li><li class="listitem"><p>
        The <code class="literal">scheme</code> parameter specifies which <code class="literal">-scheme</code> parameter to propagate to <code class="literal">xcodebuild</code>. By default, it corresponds to the app name.
       </p></li><li class="listitem"><p>
        The <code class="literal">sdk</code> parameter specifies which SDK to use. By default, it picks <code class="literal">iphonesimulator</code> for simulator builds and <code class="literal">iphoneos</code> for release builds.
       </p></li><li class="listitem"><p>
        The <code class="literal">xcodeFlags</code> parameter specifies arbitrary command line parameters that should be propagated to <code class="literal">xcodebuild</code>.
       </p></li></ul></div><p>
      By default, builds are carried out for the iOS simulator. To do release builds (builds for real iOS devices), you must set the <code class="literal">release</code> parameter to <code class="literal">true</code>. In addition, you need to set the following parameters:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">certificateFile</code> refers to a P12 certificate file.
       </p></li><li class="listitem"><p>
        <code class="literal">certificatePassword</code> specifies the password of the P12 certificate.
       </p></li><li class="listitem"><p>
        <code class="literal">provisioningProfile</code> refers to the provision profile needed to sign the app
       </p></li><li class="listitem"><p>
        <code class="literal">signMethod</code> should refer to <code class="literal">ad-hoc</code> for signing the app with an ad-hoc certificate, <code class="literal">enterprise</code> for enterprise certificates and <code class="literal">app-store</code> for App store certificates.
       </p></li><li class="listitem"><p>
        <code class="literal">generateIPA</code> specifies that we want to produce an IPA file (this is probably what you want)
       </p></li><li class="listitem"><p>
        <code class="literal">generateXCArchive</code> specifies thet we want to produce an xcarchive file.
       </p></li></ul></div><p>
      When building IPA files on Hydra and when it is desired to allow iOS devices to install IPAs by browsing to the Hydra build products page, you can enable the <code class="literal">enableWirelessDistribution</code> parameter.
     </p><p>
      When enabled, you need to configure the following options:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        The <code class="literal">installURL</code> parameter refers to the URL of a PHP script that composes the <code class="literal">itms-services://</code> URL allowing iOS devices to install the IPA file.
       </p></li><li class="listitem"><p>
        <code class="literal">bundleId</code> refers to the bundle ID value of the app
       </p></li><li class="listitem"><p>
        <code class="literal">appVersion</code> refers to the app’s version number
       </p></li></ul></div><p>
      To use wireless adhoc distributions, you must also install the corresponding PHP script on a web server (see section: <span class="quote">“<span class="quote">Installing the PHP script for wireless ad hoc installations from Hydra</span>”</span> for more information).
     </p><p>
      In addition to the build parameters, you can also specify any parameters that the <code class="literal">xcodeenv.composeXcodeWrapper {}</code> function takes. For example, the <code class="literal">xcodeBaseDir</code> parameter can be overridden to refer to a different Xcode version.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="spawning-simulator-instances" class="title">15.12.3.&nbsp;Spawning simulator instances<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#spawning-simulator-instances" aria-label="Anchor link for: spawning simulator instances" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      In addition to building iOS apps, we can also automatically spawn simulator instances:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

  <span class="hljs-attr"><span class="hljs-attr">xcodeenv</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> ./xcodeenv {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (pkgs) stdenv;
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
xcode.simulateApp {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"simulate"</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># Supports all xcodewrapper parameters as well</span></span>
  <span class="hljs-attr"><span class="hljs-attr">xcodeBaseDir</span></span> = <span class="hljs-string"><span class="hljs-string">"/Applications/Xcode.app"</span></span>;
}
</pre><p>
      The above expression produces a script that starts the simulator from the provided Xcode installation. The script can be started as follows:
     </p><pre class="programlisting hljs" xml:space="preserve">./result/bin/run-test-simulator
</pre><p>
      By default, the script will show an overview of UDID for all available simulator instances and asks you to pick one. You can also provide a UDID as a command-line parameter to launch an instance automatically:
     </p><pre class="programlisting hljs" xml:space="preserve">./result/bin/run-test-simulator 5C93129D-CF39-4B1A-955F-15180C3BD4B8
</pre><p>
      You can also extend the simulator script to automatically deploy and launch an app in the requested simulator instance:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

  <span class="hljs-attr"><span class="hljs-attr">xcodeenv</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> ./xcodeenv {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (pkgs) stdenv;
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
xcode.simulateApp {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"simulate"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">bundleId</span></span> = <span class="hljs-string"><span class="hljs-string">"mycompany.myapp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">app</span></span> = xcode.buildApp {
    <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  };

  <span class="hljs-comment"><span class="hljs-comment"># Supports all xcodewrapper parameters as well</span></span>
  <span class="hljs-attr"><span class="hljs-attr">xcodeBaseDir</span></span> = <span class="hljs-string"><span class="hljs-string">"/Applications/Xcode.app"</span></span>;
}
</pre><p>
      By providing the result of an <code class="literal">xcode.buildApp {}</code> function and configuring the app bundle id, the app gets deployed automatically and started.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="troubleshooting" class="title">15.12.4.&nbsp;Troubleshooting<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#troubleshooting" aria-label="Anchor link for: troubleshooting" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      In some rare cases, it may happen that after a failure, changes are not picked up. Most likely, this is caused by a derived data cache that Xcode maintains. To wipe it you can run:
     </p><pre class="programlisting hljs" xml:space="preserve">$ rm -rf ~/Library/Developer/Xcode/DerivedData
</pre></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-java" class="title" style="clear: both">15.13.&nbsp;Java<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-java" aria-label="Anchor link for: sec language java" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Ant-based Java packages are typically built from source as follows:
</p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"..."</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl { ... };

  <span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [ jdk ant ];

  <span class="hljs-attr"><span class="hljs-attr">buildPhase</span></span> = <span class="hljs-string"><span class="hljs-string">"ant"</span></span>;
}
</pre><p>
     Note that <code class="varname">jdk</code> is an alias for the OpenJDK (self-built where available, or pre-built via Zulu). Platforms with OpenJDK not (yet) in Nixpkgs (<code class="literal">Aarch32</code>, <code class="literal">Aarch64</code>) point to the (unfree) <code class="literal">oraclejdk</code>.
    </p><p>
     JAR files that are intended to be used by other packages should be installed in <code class="filename">$out/share/java</code>. JDKs have a stdenv setup hook that add any JARs in the <code class="filename">share/java</code> directories of the build inputs to the <code class="envar">CLASSPATH</code> environment variable. For instance, if the package <code class="literal">libfoo</code> installs a JAR named <code class="filename">foo.jar</code> in its <code class="filename">share/java</code> directory, and another package declares the attribute
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ libfoo ];
<span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [ jdk ];
</pre><p>
     then <code class="envar">CLASSPATH</code> will be set to <code class="filename">/nix/store/...-libfoo/share/java/foo.jar</code>.
    </p><p>
     Private JARs should be installed in a location like <code class="filename">$out/share/<em class="replaceable"><code>package-name</code></em></code>.
    </p><p>
     If your Java package provides a program, you need to generate a wrapper script to run it using the OpenJRE. You can use <code class="literal">makeWrapper</code> for this:
</p><pre class="programlisting hljs bash" xml:space="preserve">nativeBuildInputs = [ makeWrapper ];

installPhase =
  <span class="hljs-string"><span class="hljs-string">''</span></span>
    mkdir -p <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin
    makeWrapper <span class="hljs-variable"><span class="hljs-variable">${jre}</span></span>/bin/java <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/bin/foo \
      --add-flags <span class="hljs-string"><span class="hljs-string">"-cp </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$out</span></span></span><span class="hljs-string">/share/java/foo.jar org.foo.Main"</span></span>
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
</pre><p>
     Note the use of <code class="literal">jre</code>, which is the part of the OpenJDK package that contains the Java Runtime Environment. By using <code class="literal">${jre}/bin/java</code> instead of <code class="literal">${jdk}/bin/java</code>, you prevent your package from depending on the JDK at runtime.
    </p><p>
     Note all JDKs passthru <code class="literal">home</code>, so if your application requires environment variables like <code class="envar">JAVA_HOME</code> being set, that can be done in a generic fashion with the <code class="literal">--set</code> argument of <code class="literal">makeWrapper</code>:
</p><pre class="programlisting hljs bash" xml:space="preserve">--<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> JAVA_HOME <span class="hljs-variable"><span class="hljs-variable">${jdk.home}</span></span>
</pre><p>
    </p><p>
     It is possible to use a different Java compiler than <span class="command"><strong>javac</strong></span> from the OpenJDK. For instance, to use the GNU Java Compiler:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [ gcj ant ];
</pre><p>
     Here, Ant will automatically use <span class="command"><strong>gij</strong></span> (the GNU Java Runtime) instead of the OpenJRE.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="users-guide-to-lua-infrastructure" class="title" style="clear: both">15.14.&nbsp;User’s Guide to Lua Infrastructure<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#users-guide-to-lua-infrastructure" aria-label="Anchor link for: users guide to lua infrastructure" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="using-lua" class="title">15.14.1.&nbsp;Using Lua<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#using-lua" aria-label="Anchor link for: using lua" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="overview-of-lua" shape="rect"></a>15.14.1.1.&nbsp;Overview of Lua</h4></div></div></div><p>
       Several versions of the Lua interpreter are available: luajit, lua 5.1, 5.2, 5.3. The attribute <code class="literal">lua</code> refers to the default interpreter, it is also possible to refer to specific versions, e.g.&nbsp;<code class="literal">lua5_2</code> refers to Lua 5.2.
      </p><p>
       Lua libraries are in separate sets, with one set per interpreter version.
      </p><p>
       The interpreters have several common attributes. One of these attributes is <code class="literal">pkgs</code>, which is a package set of Lua libraries for this specific interpreter. E.g., the <code class="literal">busted</code> package corresponding to the default interpreter is <code class="literal">lua.pkgs.busted</code>, and the lua 5.2 version is <code class="literal">lua5_2.pkgs.busted</code>. The main package set contains aliases to these package sets, e.g. <code class="literal">luaPackages</code> refers to <code class="literal">lua5_1.pkgs</code> and <code class="literal">lua52Packages</code> to <code class="literal">lua5_2.pkgs</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="installing-lua-and-packages" shape="rect"></a>15.14.1.2.&nbsp;Installing Lua and packages</h4></div></div></div><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="lua-environment-defined-in-separate-.nix-file" shape="rect"></a>15.14.1.2.1.&nbsp;Lua environment defined in separate <code class="literal">.nix</code> file</h5></div></div></div><p>
        Create a file, e.g.&nbsp;<code class="literal">build.nix</code>, with the following expression
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

lua5_2.withPackages (ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ busted luafilesystem ])
</pre><p>
        and install it in your profile with
       </p><pre class="programlisting hljs nix" xml:space="preserve">nix-env -<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> build.nix
</pre><p>
        Now you can use the Lua interpreter, as well as the extra packages (<code class="literal">busted</code>, <code class="literal">luafilesystem</code>) that you added to the environment.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="lua-environment-defined-in-.confignixpkgsconfig.nix" shape="rect"></a>15.14.1.2.2.&nbsp;Lua environment defined in <code class="literal">~/.config/nixpkgs/config.nix</code></h5></div></div></div><p>
        If you prefer to, you could also add the environment as a package override to the Nixpkgs set, e.g. using <code class="literal">config.nix</code>,
       </p><pre class="programlisting hljs nix" xml:space="preserve">{ <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; {
    <span class="hljs-attr"><span class="hljs-attr">myLuaEnv</span></span> = lua5_2.withPackages (ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ busted luafilesystem ]);
  };
}
</pre><p>
        and install it in your profile with
       </p><pre class="programlisting hljs" xml:space="preserve">nix-env -iA nixpkgs.myLuaEnv
</pre><p>
        The environment is is installed by referring to the attribute, and considering the <code class="literal">nixpkgs</code> channel was used.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="lua-environment-defined-in-etcnixosconfiguration.nix" shape="rect"></a>15.14.1.2.3.&nbsp;Lua environment defined in <code class="literal">/etc/nixos/configuration.nix</code></h5></div></div></div><p>
        For the sake of completeness, here’s another example how to install the environment system-wide.
       </p><pre class="programlisting hljs nix" xml:space="preserve">{ <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  environment.<span class="hljs-attr"><span class="hljs-attr">systemPackages</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; [
    (lua.withPackages(ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ busted luafilesystem ]))
  ];
}
</pre></section></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-a-lua-package-using-overlays" shape="rect"></a>15.14.1.3.&nbsp;How to override a Lua package using overlays?</h4></div></div></div><p>
       Use the following overlay template:
      </p><pre class="programlisting hljs nix" xml:space="preserve">final: prev:
{

  <span class="hljs-attr"><span class="hljs-attr">lua</span></span> = prev.lua.override {
    <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = luaself: luaprev: {

      <span class="hljs-attr"><span class="hljs-attr">luarocks-nix</span></span> = luaprev.luarocks-nix.overrideAttrs(oa: {
        <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"luarocks-nix"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">src</span></span> = /home/my_luarocks/repository;
      });
  };

  <span class="hljs-attr"><span class="hljs-attr">luaPackages</span></span> = lua.pkgs;
}
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="temporary-lua-environment-with-nix-shell" shape="rect"></a>15.14.1.4.&nbsp;Temporary Lua environment with <code class="literal">nix-shell</code></h4></div></div></div><p>
       There are two methods for loading a shell with Lua packages. The first and recommended method is to create an environment with <code class="literal">lua.buildEnv</code> or <code class="literal">lua.withPackages</code> and load that. E.g.
      </p><pre class="programlisting hljs nix" xml:space="preserve">$ nix-shell -p 'lua.withPackages(ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ busted luafilesystem ])'
</pre><p>
       opens a shell from which you can launch the interpreter
      </p><pre class="programlisting hljs" xml:space="preserve">[nix-shell:~] lua
</pre><p>
       The other method, which is not recommended, does not create an environment and requires you to list the packages directly,
      </p><pre class="programlisting hljs" xml:space="preserve">$ nix-shell -p lua.pkgs.busted lua.pkgs.luafilesystem
</pre><p>
       Again, it is possible to launch the interpreter from the shell. The Lua interpreter has the attribute <code class="literal">pkgs</code> which contains all Lua libraries for that specific interpreter.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="developing-with-lua" class="title">15.14.2.&nbsp;Developing with Lua<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#developing-with-lua" aria-label="Anchor link for: developing with lua" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Now that you know how to get a working Lua environment with Nix, it is time to go forward and start actually developing with Lua. There are two ways to package lua software, either it is on luarocks and most of it can be taken care of by the luarocks2nix converter or the packaging has to be done manually. Let’s present the luarocks way first and the manual one in a second time.
     </p><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="packaging-a-library-on-luarocks" shape="rect"></a>15.14.2.1.&nbsp;Packaging a library on luarocks</h4></div></div></div><p>
       <a class="link" href="https://nixos.org/manual/nixpkgs/stable/www.luarocks.org" target="_top" shape="rect">Luarocks.org</a> is the main repository of lua packages. The site proposes two types of packages, the rockspec and the src.rock (equivalent of a <a class="link" href="https://github.com/luarocks/luarocks/wiki/Rockspec-format" target="_top" shape="rect">rockspec</a> but with the source). These packages can have different build types such as <code class="literal">cmake</code>, <code class="literal">builtin</code> etc .
      </p><p>
       Luarocks-based packages are generated in pkgs/development/lua-modules/generated-packages.nix from the whitelist maintainers/scripts/luarocks-packages.csv and updated by running maintainers/scripts/update-luarocks-packages.
      </p><p>
       <a class="link" href="https://github.com/nix-community/luarocks" target="_top" shape="rect">luarocks2nix</a> is a tool capable of generating nix derivations from both rockspec and src.rock (and favors the src.rock). The automation only goes so far though and some packages need to be customized. These customizations go in <code class="literal">pkgs/development/lua-modules/overrides.nix</code>. For instance if the rockspec defines <code class="literal">external_dependencies</code>, these need to be manually added in in its rockspec file then it won’t work.
      </p><p>
       You can try converting luarocks packages to nix packages with the command <code class="literal">nix-shell -p luarocks-nix</code> and then <code class="literal">luarocks nix PKG_NAME</code>. Nix rely on luarocks to install lua packages, basically it runs: <code class="literal">luarocks make --deps-mode=none --tree $out</code>
      </p><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="packaging-a-library-manually" shape="rect"></a>15.14.2.1.1.&nbsp;Packaging a library manually</h5></div></div></div><p>
        You can develop your package as you usually would, just don’t forget to wrap it within a <code class="literal">toLuaModule</code> call, for instance
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">mynewlib</span></span> = toLuaModule ( stdenv.mkDerivation { ... });
</pre><p>
        There is also the <code class="literal">buildLuaPackage</code> function that can be used when lua modules are not packaged for luarocks. You can see a few examples at <code class="literal">pkgs/top-level/lua-packages.nix</code>.
       </p></section></section></section><section class="section"><div class="titlepage"><div><div><h3 id="lua-reference" class="title">15.14.3.&nbsp;Lua Reference<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#lua-reference" aria-label="Anchor link for: lua reference" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="lua-interpreters" shape="rect"></a>15.14.3.1.&nbsp;Lua interpreters</h4></div></div></div><p>
       Versions 5.1, 5.2 and 5.3 of the lua interpreter are available as respectively <code class="literal">lua5_1</code>, <code class="literal">lua5_2</code> and <code class="literal">lua5_3</code>. Luajit is available too. The Nix expressions for the interpreters can be found in <code class="literal">pkgs/development/interpreters/lua-5</code>.
      </p><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="attributes-on-lua-interpreters-packages" shape="rect"></a>15.14.3.1.1.&nbsp;Attributes on lua interpreters packages</h5></div></div></div><p>
        Each interpreter has the following attributes:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">interpreter</code>. Alias for <code class="literal">${pkgs.lua}/bin/lua</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">buildEnv</code>. Function to build lua interpreter environments with extra packages bundled together. See section <span class="emphasis"><em>lua.buildEnv function</em></span> for usage and documentation.
         </p></li><li class="listitem"><p>
          <code class="literal">withPackages</code>. Simpler interface to <code class="literal">buildEnv</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">pkgs</code>. Set of Lua packages for that specific interpreter. The package set can be modified by overriding the interpreter and passing <code class="literal">packageOverrides</code>.
         </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="buildluarockspackage-function" shape="rect"></a>15.14.3.1.2.&nbsp;<code class="literal">buildLuarocksPackage</code> function</h5></div></div></div><p>
        The <code class="literal">buildLuarocksPackage</code> function is implemented in <code class="literal">pkgs/development/interpreters/lua-5/build-lua-package.nix</code> The following is an example:
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">luaposix</span></span> = buildLuarocksPackage {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"luaposix"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"34.0.4-1"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span>    = <span class="hljs-string"><span class="hljs-string">"https://raw.githubusercontent.com/rocks-moonscript-org/moonrocks-mirror/master/luaposix-34.0.4-1.src.rock"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0yrm5cn2iyd0zjd4liyj27srphvy0gjrjx572swar6zqr4dwjqp2"</span></span>;
  };
  <span class="hljs-attr"><span class="hljs-attr">disabled</span></span> = (luaOlder <span class="hljs-string"><span class="hljs-string">"5.1"</span></span>) || (luaAtLeast <span class="hljs-string"><span class="hljs-string">"5.4"</span></span>);
  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [ bit32 lua std_normalize ];

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> stdenv.lib; {
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/luaposix/luaposix/"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"Lua bindings for POSIX"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ vyp lblasc ];
    license.<span class="hljs-attr"><span class="hljs-attr">fullName</span></span> = <span class="hljs-string"><span class="hljs-string">"MIT/X11"</span></span>;
  };
};
</pre><p>
        The <code class="literal">buildLuarocksPackage</code> delegates most tasks to luarocks:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          it adds <code class="literal">luarocks</code> as an unpacker for <code class="literal">src.rock</code> files (zip files really).
         </p></li><li class="listitem"><p>
          configurePhase<code class="literal">writes a temporary luarocks configuration file which location is exported via the environment variable</code>LUAROCKS_CONFIG`.
         </p></li><li class="listitem"><p>
          the <code class="literal">buildPhase</code> does nothing.
         </p></li><li class="listitem"><p>
          <code class="literal">installPhase</code> calls <code class="literal">luarocks make --deps-mode=none --tree $out</code> to build and install the package
         </p></li><li class="listitem"><p>
          In the <code class="literal">postFixup</code> phase, the <code class="literal">wrapLuaPrograms</code> bash function is called to wrap all programs in the <code class="literal">$out/bin/*</code> directory to include <code class="literal">$PATH</code> environment variable and add dependent libraries to script’s <code class="literal">LUA_PATH</code> and <code class="literal">LUA_CPATH</code>.
         </p></li></ul></div><p>
        By default <code class="literal">meta.platforms</code> is set to the same value as the interpreter unless overridden otherwise.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="buildluaapplication-function" shape="rect"></a>15.14.3.1.3.&nbsp;<code class="literal">buildLuaApplication</code> function</h5></div></div></div><p>
        The <code class="literal">buildLuaApplication</code> function is practically the same as <code class="literal">buildLuaPackage</code>. The difference is that <code class="literal">buildLuaPackage</code> by default prefixes the names of the packages with the version of the interpreter. Because with an application we’re not interested in multiple version the prefix is dropped.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="lua.withpackages-function" shape="rect"></a>15.14.3.1.4.&nbsp;lua.withPackages function</h5></div></div></div><p>
        The <code class="literal">lua.withPackages</code> takes a function as an argument that is passed the set of lua packages and returns the list of packages to be included in the environment. Using the <code class="literal">withPackages</code> function, the previous example for the luafilesystem environment can be written like this:
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

lua.withPackages (ps: [ps.luafilesystem])
</pre><p>
        <code class="literal">withPackages</code> passes the correct package set for the specific interpreter version as an argument to the function. In the above example, <code class="literal">ps</code> equals <code class="literal">luaPackages</code>. But you can also easily switch to using <code class="literal">lua5_2</code>:
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

lua5_2.withPackages (ps: [ps.lua])
</pre><p>
        Now, <code class="literal">ps</code> is set to <code class="literal">lua52Packages</code>, matching the version of the interpreter.
       </p></section></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="possible-todos" shape="rect"></a>15.14.3.2.&nbsp;Possible Todos</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         export/use version specific variables such as <code class="literal">LUA_PATH_5_2</code>/<code class="literal">LUAROCKS_CONFIG_5_2</code>
        </p></li><li class="listitem"><p>
         let luarocks check for dependencies via exporting the different rocktrees in temporary config
        </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="lua-contributing-guidelines" shape="rect"></a>15.14.3.3.&nbsp;Lua Contributing guidelines</h4></div></div></div><p>
       Following rules should be respected:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         Make sure libraries build for all Lua interpreters.
        </p></li><li class="listitem"><p>
         Commit names of Lua libraries should reflect that they are Lua libraries, so write for example <code class="literal">luaPackages.luafilesystem: 1.11 -&gt; 1.12</code>.
        </p></li></ul></div></section></section></section><section class="section"><div class="titlepage"><div><div><h2 id="node.js" class="title" style="clear: both">15.15.&nbsp;Node.js<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#node.js" aria-label="Anchor link for: node.js" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The <code class="literal">pkgs/development/node-packages</code> folder contains a generated collection of <a class="link" href="https://npmjs.com/" target="_top" shape="rect">NPM packages</a> that can be installed with the Nix package manager.
    </p><p>
     As a rule of thumb, the package set should only provide <span class="emphasis"><em>end user</em></span> software packages, such as command-line utilities. Libraries should only be added to the package set if there is a non-NPM package that requires it.
    </p><p>
     When it is desired to use NPM libraries in a development project, use the <code class="literal">node2nix</code> generator directly on the <code class="literal">package.json</code> configuration file of the project.
    </p><p>
     The package set provides support for the official stable Node.js versions. The latest stable LTS release in <code class="literal">nodePackages</code>, as well as the latest stable Current release in <code class="literal">nodePackages_latest</code>.
    </p><p>
     If your package uses native addons, you need to examine what kind of native build system it uses. Here are some examples:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">node-gyp</code>
      </p></li><li class="listitem"><p>
       <code class="literal">node-gyp-builder</code>
      </p></li><li class="listitem"><p>
       <code class="literal">node-pre-gyp</code>
      </p></li></ul></div><p>
     After you have identified the correct system, you need to override your package expression while adding in build system as a build input. For example, <code class="literal">dat</code> requires <code class="literal">node-gyp-build</code>, so <a class="link" href="https://github.com/NixOS/nixpkgs/blob/32f5e5da4a1b3f0595527f5195ac3a91451e9b56/pkgs/development/node-packages/default.nix#L37-L40" target="_top" shape="rect">we override</a> its expression in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/node-packages/default.nix" target="_top" shape="rect"><code class="literal">default.nix</code></a>:
    </p><pre class="programlisting hljs nix" xml:space="preserve">    <span class="hljs-attr"><span class="hljs-attr">dat</span></span> = super.dat.override {
      <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ self.node-gyp-build pkgs.libtool pkgs.autoconf pkgs.automake ];
      meta.<span class="hljs-attr"><span class="hljs-attr">broken</span></span> = since <span class="hljs-string"><span class="hljs-string">"12"</span></span>;
    };
</pre><p>
     To add a package from NPM to nixpkgs:
    </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
       Modify <code class="literal">pkgs/development/node-packages/node-packages.json</code> to add, update or remove package entries to have it included in <code class="literal">nodePackages</code> and <code class="literal">nodePackages_latest</code>.
      </p></li><li class="listitem"><p>
       Run the script: <code class="literal">(cd pkgs/development/node-packages &amp;&amp; ./generate.sh)</code>.
      </p></li><li class="listitem"><p>
       Build your new package to test your changes: <code class="literal">cd /path/to/nixpkgs &amp;&amp; nix-build -A nodePackages.&lt;new-or-updated-package&gt;</code>. To build against the latest stable Current Node.js version (e.g.&nbsp;14.x): <code class="literal">nix-build -A nodePackages_latest.&lt;new-or-updated-package&gt;</code>
      </p></li><li class="listitem"><p>
       Add and commit all modified and generated files.
      </p></li></ol></div><p>
     For more information about the generation process, consult the <a class="link" href="https://github.com/svanderburg/node2nix" target="_top" shape="rect">README.md</a> file of the <code class="literal">node2nix</code> tool.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-ocaml" class="title" style="clear: both">15.16.&nbsp;OCaml<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ocaml" aria-label="Anchor link for: sec language ocaml" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     OCaml libraries should be installed in <code class="literal">$(out)/lib/ocaml/${ocaml.version}/site-lib/</code>. Such directories are automatically added to the <code class="literal">$OCAMLPATH</code> environment variable when building another package that depends on them or when opening a <code class="literal">nix-shell</code>.
    </p><p>
     Given that most of the OCaml ecosystem is now built with dune, nixpkgs includes a convenience build support function called <code class="literal">buildDunePackage</code> that will build an OCaml package using dune, OCaml and findlib and any additional dependencies provided as <code class="literal">buildInputs</code> or <code class="literal">propagatedBuildInputs</code>.
    </p><p>
     Here is a simple package example. It defines an (optional) attribute <code class="literal">minimumOCamlVersion</code> that will be used to throw a descriptive evaluation error if building with an older OCaml is attempted. It uses the <code class="literal">fetchFromGitHub</code> fetcher to get its source. It sets the <code class="literal">doCheck</code> (optional) attribute to <code class="literal">true</code> which means that tests will be run with <code class="literal">dune runtest -p angstrom</code> after the build (<code class="literal">dune build -p angstrom</code>) is complete. It uses <code class="literal">alcotest</code> as a build input (because it is needed to run the tests) and <code class="literal">bigstringaf</code> and <code class="literal">result</code> as propagated build inputs (thus they will also be available to libraries depending on this library). The library will be installed using the <code class="literal">angstrom.install</code> file that dune generates.
    </p><pre class="programlisting hljs nix" xml:space="preserve">{ stdenv, fetchFromGitHub, buildDunePackage, alcotest, result, bigstringaf }:

buildDunePackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"angstrom"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.10.0"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">minimumOCamlVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"4.03"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
    <span class="hljs-attr"><span class="hljs-attr">owner</span></span>  = <span class="hljs-string"><span class="hljs-string">"inhabitedtype"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">repo</span></span>   = pname;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span>    = version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0lh6024yf9ds0nh9i93r9m6p5psi8nvrqxl5x7jwl13zb0r9xfpw"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ alcotest ];
  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [ bigstringaf result ];
  <span class="hljs-attr"><span class="hljs-attr">doCheck</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/inhabitedtype/angstrom"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"OCaml parser combinators built for speed and memory efficiency"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = stdenv.lib.licenses.bsd3;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> stdenv.lib.maintainers; [ sternenseemann ];
  };
}
</pre><p>
     Here is a second example, this time using a source archive generated with <code class="literal">dune-release</code>. It is a good idea to use this archive when it is available as it will usually contain substituted variables such as a <code class="literal">%%VERSION%%</code> field. This library does not depend on any other OCaml library and no tests are run after building it.
    </p><pre class="programlisting hljs nix" xml:space="preserve">{ stdenv, fetchurl, buildDunePackage }:

buildDunePackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"wtf8"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"1.0.1"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">minimumOCamlVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"4.01"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/flowtype/ocaml-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pname}</span></span></span><span class="hljs-string">/releases/download/v</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${version}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pname}</span></span></span><span class="hljs-string">-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${version}</span></span></span><span class="hljs-string">.tbz"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1msg3vycd3k8qqj61sc23qks541cxpb97vrnrvrhjnqxsqnh6ygq"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> stdenv.lib; {
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/flowtype/ocaml-wtf8"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"WTF-8 is a superset of UTF-8 that allows unpaired surrogates."</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.mit;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = [ maintainers.eqyiel ];
  };
}
</pre></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-perl" class="title" style="clear: both">15.17.&nbsp;Perl<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-perl" aria-label="Anchor link for: sec language perl" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="ssec-perl-running" class="title">15.17.1.&nbsp;Running perl programs on the shell<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-perl-running" aria-label="Anchor link for: ssec perl running" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      When executing a Perl script, it is possible you get an error such as <code class="literal">./myscript.pl: bad interpreter: /usr/bin/perl: no such file or directory</code>. This happens when the script expects Perl to be installed at <code class="filename">/usr/bin/perl</code>, which is not the case when using Perl from nixpkgs. You can fix the script by changing the first line to:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env perl</span></span>
</pre><p>
      to take the Perl installation from the <code class="literal">PATH</code> environment variable, or invoke Perl directly with:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>perl ./myscript.pl
</pre><p>
     </p><p>
      When the script is using a Perl library that is not installed globally, you might get an error such as <code class="literal">Can't locate DB_File.pm in @INC (you may need to install the DB_File module)</code>. In that case, you can use <span class="command"><strong>nix-shell</strong></span> to start an ad-hoc shell with that library installed, for instance:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-shell -p perl perlPackages.DBFile --run ./myscript.pl
</pre><p>
     </p><p>
      If you are always using the script in places where <span class="command"><strong>nix-shell</strong></span> is available, you can embed the <span class="command"><strong>nix-shell</strong></span> invocation in the shebang like this:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env nix-shell</span></span>
<span class="hljs-comment"><span class="hljs-comment">#! nix-shell -i perl -p perl perlPackages.DBFile</span></span>
</pre><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="ssec-perl-packaging" class="title">15.17.2.&nbsp;Packaging Perl programs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-perl-packaging" aria-label="Anchor link for: ssec perl packaging" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Nixpkgs provides a function <code class="varname">buildPerlPackage</code>, a generic package builder function for any Perl package that has a standard <code class="varname">Makefile.PL</code>. It’s implemented in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/perl-modules/generic" target="_top" shape="rect"><code class="filename">pkgs/development/perl-modules/generic</code></a>.
     </p><p>
      Perl packages from CPAN are defined in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/perl-packages.nix" target="_top" shape="rect"><code class="filename">pkgs/top-level/perl-packages.nix</code></a>, rather than <code class="filename">pkgs/all-packages.nix</code>. Most Perl packages are so straight-forward to build that they are defined here directly, rather than having a separate function for each package called from <code class="filename">perl-packages.nix</code>. However, more complicated packages should be put in a separate file, typically in <code class="filename">pkgs/development/perl-modules</code>. Here is an example of the former:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">ClassC3</span></span> = buildPerlPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"Class-C3-0.21"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"mirror://cpan/authors/id/F/FL/FLORA/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">.tar.gz"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1bl8z095y4js66pwxnm7s853pi9czala4sqc743fdlnk27kq94gz"</span></span>;
  };
};
</pre><p>
      Note the use of <code class="literal">mirror://cpan/</code>, and the <code class="literal">${name}</code> in the URL definition to ensure that the name attribute is consistent with the source that we’re actually downloading. Perl packages are made available in <code class="filename">all-packages.nix</code> through the variable <code class="varname">perlPackages</code>. For instance, if you have a package that needs <code class="varname">ClassC3</code>, you would typically write
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">foo</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> ../path/to/foo.nix {
  <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> stdenv fetchurl ...;
  <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (perlPackages) ClassC3;
};
</pre><p>
      in <code class="filename">all-packages.nix</code>. You can test building a Perl package as follows:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-build -A perlPackages.ClassC3
</pre><p>
      <code class="varname">buildPerlPackage</code> adds <code class="literal">perl-</code> to the start of the name attribute, so the package above is actually called <code class="literal">perl-Class-C3-0.21</code>. So to install it, you can say:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-env -i perl-Class-C3
</pre><p>
      (Of course you can also install using the attribute name: <code class="literal">nix-env -i -A perlPackages.ClassC3</code>.)
     </p><p>
      So what does <code class="varname">buildPerlPackage</code> do? It does the following:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
         In the configure phase, it calls <code class="literal">perl Makefile.PL</code> to generate a Makefile. You can set the variable <code class="varname">makeMakerFlags</code> to pass flags to <code class="filename">Makefile.PL</code>
        </p></li><li class="listitem"><p>
         It adds the contents of the <code class="envar">PERL5LIB</code> environment variable to <code class="literal">#! .../bin/perl</code> line of Perl scripts as <code class="literal">-I<em class="replaceable"><code>dir</code></em></code> flags. This ensures that a script can find its dependencies. (This can cause this shebang line to become too long for Darwin to handle; see the note below.)
        </p></li><li class="listitem"><p>
         In the fixup phase, it writes the propagated build inputs (<code class="varname">propagatedBuildInputs</code>) to the file <code class="filename">$out/nix-support/propagated-user-env-packages</code>. <span class="command"><strong>nix-env</strong></span> recursively installs all packages listed in this file when you install a package that has it. This ensures that a Perl package can find its dependencies.
        </p></li></ol></div><p>
     </p><p>
      <code class="varname">buildPerlPackage</code> is built on top of <code class="varname">stdenv</code>, so everything can be customised in the usual way. For instance, the <code class="literal">BerkeleyDB</code> module has a <code class="varname">preConfigure</code> hook to generate a configuration file used by <code class="filename">Makefile.PL</code>:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ buildPerlPackage, fetchurl, db }:

buildPerlPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"BerkeleyDB-0.36"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"mirror://cpan/authors/id/P/PM/PMQS/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">.tar.gz"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"07xf50riarb60l1h6m2dqmql8q5dij619712fsgw7ach04d8g3z1"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">preConfigure</span></span> = <span class="hljs-string"><span class="hljs-string">''
    echo "LIB = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${db.out}</span></span></span><span class="hljs-string">/lib" &gt; config.in
    echo "INCLUDE = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${db.dev}</span></span></span><span class="hljs-string">/include" &gt;&gt; config.in
  ''</span></span>;
}
</pre><p>
     </p><p>
      Dependencies on other Perl packages can be specified in the <code class="varname">buildInputs</code> and <code class="varname">propagatedBuildInputs</code> attributes. If something is exclusively a build-time dependency, use <code class="varname">buildInputs</code>; if it’s (also) a runtime dependency, use <code class="varname">propagatedBuildInputs</code>. For instance, this builds a Perl module that has runtime dependencies on a bunch of other modules:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">ClassC3Componentised</span></span> = buildPerlPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"Class-C3-Componentised-1.0004"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"mirror://cpan/authors/id/A/AS/ASH/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">.tar.gz"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0xql73jkcdbq4q9m0b0rnca6nrlvf5hyzy8is0crdk65bynvs8q1"</span></span>;
  };
  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [
    ClassC3 ClassInspector TestException MROCompat
  ];
};
</pre><p>
     </p><p>
      On Darwin, if a script has too many <code class="literal">-I<em class="replaceable"><code>dir</code></em></code> flags in its first line (its “shebang line”), it will not run. This can be worked around by calling the <code class="literal">shortenPerlShebang</code> function from the <code class="literal">postInstall</code> phase:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ stdenv, buildPerlPackage, fetchurl, shortenPerlShebang }:

<span class="hljs-attr"><span class="hljs-attr">ImageExifTool</span></span> = buildPerlPackage {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"Image-ExifTool"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"11.50"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://www.sno.phy.queensu.ca/~phil/exiftool/Image-ExifTool-11.50.tar.gz"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0d8v48y94z8maxkmw1rv7v9m0jg2dc8xbp581njb6yhr7abwqdv3"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = stdenv.lib.optional stdenv.isDarwin shortenPerlShebang;
  <span class="hljs-attr"><span class="hljs-attr">postInstall</span></span> = stdenv.lib.optional stdenv.isDarwin <span class="hljs-string"><span class="hljs-string">''
    shortenPerlShebang $out/bin/exiftool
  ''</span></span>;
};
</pre><p>
      This will remove the <code class="literal">-I</code> flags from the shebang line, rewrite them in the <code class="literal">use lib</code> form, and put them on the next line instead. This function can be given any number of Perl scripts as arguments; it will modify them in-place.
     </p><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-generation-from-CPAN" shape="rect"></a>15.17.2.1.&nbsp;Generation from CPAN</h4></div></div></div><p>
       Nix expressions for Perl packages can be generated (almost) automatically from CPAN. This is done by the program <span class="command"><strong>nix-generate-from-cpan</strong></span>, which can be installed as follows:
      </p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-env -i nix-generate-from-cpan
</pre><p>
       This program takes a Perl module name, looks it up on CPAN, fetches and unpacks the corresponding package, and prints a Nix expression on standard output. For example:
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>nix-generate-from-cpan XML::Simple
  <span class="hljs-attr"><span class="hljs-attr">XMLSimple</span></span> = buildPerlPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
    <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"XML-Simple-2.22"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
      <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"mirror://cpan/authors/id/G/GR/GRANTM/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">.tar.gz"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"b9450ef22ea9644ae5d6ada086dc4300fa105be050a2030ebd4efd28c198eb49"</span></span>;
    };
    <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [ XMLNamespaceSupport XMLSAX XMLSAXExpat ];
    <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"An API for simple XML files"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">license</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> stdenv.lib.licenses; [ artistic1 gpl1Plus ];
    };
  };
</pre><p>
       The output can be pasted into <code class="filename">pkgs/top-level/perl-packages.nix</code> or wherever else you need it.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-perl-cross-compilation" shape="rect"></a>15.17.2.2.&nbsp;Cross-compiling modules</h4></div></div></div><p>
       Nixpkgs has experimental support for cross-compiling Perl modules. In many cases, it will just work out of the box, even for modules with native extensions. Sometimes, however, the Makefile.PL for a module may (indirectly) import a native module. In that case, you will need to make a stub for that module that will satisfy the Makefile.PL and install it into <code class="filename">lib/perl5/site_perl/cross_perl/${perl.version}</code>. See the <code class="varname">postInstall</code> for <code class="varname">DBI</code> for an example.
      </p></section></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-php" class="title" style="clear: both">15.18.&nbsp;PHP<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-php" aria-label="Anchor link for: sec php" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="ssec-php-user-guide" class="title">15.18.1.&nbsp;User Guide<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#ssec-php-user-guide" aria-label="Anchor link for: ssec php user guide" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-php-user-guide-overview" shape="rect"></a>15.18.1.1.&nbsp;Overview</h4></div></div></div><p>
       Several versions of PHP are available on Nix, each of which having a wide variety of extensions and libraries available.
      </p><p>
       The different versions of PHP that nixpkgs provides are located under attributes named based on major and minor version number; e.g., <code class="literal">php74</code> is PHP 7.4.
      </p><p>
       Only versions of PHP that are supported by upstream for the entirety of a given NixOS release will be included in that release of NixOS. See <a class="link" href="https://www.php.net/supported-versions.php" target="_top" shape="rect">PHP Supported Versions</a>.
      </p><p>
       The attribute <code class="literal">php</code> refers to the version of PHP considered most stable and thoroughly tested in nixpkgs for any given release of NixOS - not necessarily the latest major release from upstream.
      </p><p>
       All available PHP attributes are wrappers around their respective binary PHP package and provide commonly used extensions this way. The real PHP 7.4 package, i.e.&nbsp;the unwrapped one, is available as <code class="literal">php74.unwrapped</code>; see the next section for more details.
      </p><p>
       Interactive tools built on PHP are put in <code class="literal">php.packages</code>; composer is for example available at <code class="literal">php.packages.composer</code>.
      </p><p>
       Most extensions that come with PHP, as well as some popular third-party ones, are available in <code class="literal">php.extensions</code>; for example, the opcache extension shipped with PHP is available at <code class="literal">php.extensions.opcache</code> and the third-party ImageMagick extension at <code class="literal">php.extensions.imagick</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-php-user-guide-installing-with-extensions" shape="rect"></a>15.18.1.2.&nbsp;Installing PHP with extensions</h4></div></div></div><p>
       A PHP package with specific extensions enabled can be built using <code class="literal">php.withExtensions</code>. This is a function which accepts an anonymous function as its only argument; the function should accept two named parameters: <code class="literal">enabled</code> - a list of currently enabled extensions and <code class="literal">all</code> - the set of all extensions, and return a list of wanted extensions. For example, a PHP package with all default extensions and ImageMagick enabled:
      </p><pre class="programlisting hljs" xml:space="preserve">php.withExtensions ({ enabled, all }:
  enabled ++ [ all.imagick ])
</pre><p>
       To exclude some, but not all, of the default extensions, you can filter the <code class="literal">enabled</code> list like this:
      </p><pre class="programlisting hljs" xml:space="preserve">php.withExtensions ({ enabled, all }:
  (lib.filter (e: e != php.extensions.opcache) enabled)
  ++ [ all.imagick ])
</pre><p>
       To build your list of extensions from the ground up, you can simply ignore <code class="literal">enabled</code>:
      </p><pre class="programlisting hljs nix" xml:space="preserve">php.withExtensions ({ all, ... }: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> all; [ imagick opcache ])
</pre><p>
       <code class="literal">php.withExtensions</code> provides extensions by wrapping a minimal php base package, providing a <code class="literal">php.ini</code> file listing all extensions to be loaded. You can access this package through the <code class="literal">php.unwrapped</code> attribute; useful if you, for example, need access to the <code class="literal">dev</code> output. The generated <code class="literal">php.ini</code> file can be accessed through the <code class="literal">php.phpIni</code> attribute.
      </p><p>
       If you want a PHP build with extra configuration in the <code class="literal">php.ini</code> file, you can use <code class="literal">php.buildEnv</code>. This function takes two named and optional parameters: <code class="literal">extensions</code> and <code class="literal">extraConfig</code>. <code class="literal">extensions</code> takes an extension specification equivalent to that of <code class="literal">php.withExtensions</code>, <code class="literal">extraConfig</code> a string of additional <code class="literal">php.ini</code> configuration parameters. For example, a PHP package with the opcache and ImageMagick extensions enabled, and <code class="literal">memory_limit</code> set to <code class="literal">256M</code>:
      </p><pre class="programlisting hljs nix" xml:space="preserve">php.buildEnv {
  <span class="hljs-attr"><span class="hljs-attr">extensions</span></span> = { all, ... }: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> all; [ imagick opcache ];
  <span class="hljs-attr"><span class="hljs-attr">extraConfig</span></span> = <span class="hljs-string"><span class="hljs-string">"memory_limit=256M"</span></span>;
}
</pre><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="ssec-php-user-guide-installing-with-extensions-phpfpm" shape="rect"></a>15.18.1.2.1.&nbsp;Example setup for <code class="literal">phpfpm</code></h5></div></div></div><p>
        You can use the previous examples in a <code class="literal">phpfpm</code> pool called <code class="literal">foo</code> as follows:
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">myPhp</span></span> = php.withExtensions ({ all, ... }: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> all; [ imagick opcache ]);
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {
  services.phpfpm.pools.<span class="hljs-string"><span class="hljs-string">"foo"</span></span>.<span class="hljs-attr"><span class="hljs-attr">phpPackage</span></span> = myPhp;
};
</pre><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">myPhp</span></span> = php.buildEnv {
    <span class="hljs-attr"><span class="hljs-attr">extensions</span></span> = { all, ... }: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> all; [ imagick opcache ];
    <span class="hljs-attr"><span class="hljs-attr">extraConfig</span></span> = <span class="hljs-string"><span class="hljs-string">"memory_limit=256M"</span></span>;
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {
  services.phpfpm.pools.<span class="hljs-string"><span class="hljs-string">"foo"</span></span>.<span class="hljs-attr"><span class="hljs-attr">phpPackage</span></span> = myPhp;
};
</pre></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="ssec-php-user-guide-installing-with-extensions-nix-shell" shape="rect"></a>15.18.1.2.2.&nbsp;Example usage with <code class="literal">nix-shell</code></h5></div></div></div><p>
        This brings up a temporary environment that contains a PHP interpreter with the extensions <code class="literal">imagick</code> and <code class="literal">opcache</code> enabled:
       </p><pre class="programlisting hljs nix" xml:space="preserve">nix-shell -p 'php.withExtensions ({ all, ... }: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> all; [ imagick opcache ])'
</pre></section></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ssec-php-user-guide-installing-packages-with-extensions" shape="rect"></a>15.18.1.3.&nbsp;Installing PHP packages with extensions</h4></div></div></div><p>
       All interactive tools use the PHP package you get them from, so all packages at <code class="literal">php.packages.*</code> use the <code class="literal">php</code> package with its default extensions. Sometimes this default set of extensions isn’t enough and you may want to extend it. A common case of this is the <code class="literal">composer</code> package: a project may depend on certain extensions and <code class="literal">composer</code> won’t work with that project unless those extensions are loaded.
      </p><p>
       Example of building <code class="literal">composer</code> with additional extensions:
      </p><pre class="programlisting hljs nix" xml:space="preserve">(php.withExtensions ({ all, enabled }:
  enabled ++ (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> all; [ imagick redis ]))
).packages.composer
</pre></section></section></section><section class="section"><div class="titlepage"><div><div><h2 id="python" class="title" style="clear: both">15.19.&nbsp;Python<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#python" aria-label="Anchor link for: python" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="user-guide" class="title">15.19.1.&nbsp;User Guide<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#user-guide" aria-label="Anchor link for: user guide" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="using-python" shape="rect"></a>15.19.1.1.&nbsp;Using Python</h4></div></div></div><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="overview" shape="rect"></a>15.19.1.1.1.&nbsp;Overview</h5></div></div></div><p>
        Several versions of the Python interpreter are available on Nix, as well as a high amount of packages. The attribute <code class="literal">python</code> refers to the default interpreter, which is currently CPython 2.7. It is also possible to refer to specific versions, e.g.&nbsp;<code class="literal">python38</code> refers to CPython 3.8, and <code class="literal">pypy</code> refers to the default PyPy interpreter.
       </p><p>
        Python is used a lot, and in different ways. This affects also how it is packaged. In the case of Python on Nix, an important distinction is made between whether the package is considered primarily an application, or whether it should be used as a library, i.e., of primary interest are the modules in <code class="literal">site-packages</code> that should be importable.
       </p><p>
        In the Nixpkgs tree Python applications can be found throughout, depending on what they do, and are called from the main package set. Python libraries, however, are in separate sets, with one set per interpreter version.
       </p><p>
        The interpreters have several common attributes. One of these attributes is <code class="literal">pkgs</code>, which is a package set of Python libraries for this specific interpreter. E.g., the <code class="literal">toolz</code> package corresponding to the default interpreter is <code class="literal">python.pkgs.toolz</code>, and the CPython 3.8 version is <code class="literal">python38.pkgs.toolz</code>. The main package set contains aliases to these package sets, e.g. <code class="literal">pythonPackages</code> refers to <code class="literal">python.pkgs</code> and <code class="literal">python38Packages</code> to <code class="literal">python38.pkgs</code>.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="installing-python-and-packages" shape="rect"></a>15.19.1.1.2.&nbsp;Installing Python and packages</h5></div></div></div><p>
        The Nix and NixOS manuals explain how packages are generally installed. In the case of Python and Nix, it is important to make a distinction between whether the package is considered an application or a library.
       </p><p>
        Applications on Nix are typically installed into your user profile imperatively using <code class="literal">nix-env -i</code>, and on NixOS declaratively by adding the package name to <code class="literal">environment.systemPackages</code> in <code class="literal">/etc/nixos/configuration.nix</code>. Dependencies such as libraries are automatically installed and should not be installed explicitly.
       </p><p>
        The same goes for Python applications. Python applications can be installed in your profile, and will be wrapped to find their exact library dependencies, without impacting other applications or polluting your user environment.
       </p><p>
        But Python libraries you would like to use for development cannot be installed, at least not individually, because they won’t be able to find each other resulting in import errors. Instead, it is possible to create an environment with <code class="literal">python.buildEnv</code> or <code class="literal">python.withPackages</code> where the interpreter and other executables are wrapped to be able to find each other and all of the modules.
       </p><p>
        In the following examples we will start by creating a simple, ad-hoc environment with a nix-shell that has <code class="literal">numpy</code> and <code class="literal">toolz</code> in Python 3.8; then we will create a re-usable environment in a single-file Python script; then we will create a full Python environment for development with this same environment.
       </p><p>
        Philosphically, this should be familiar to users who are used to a <code class="literal">venv</code> style of development: individual projects create their own Python environments without impacting the global environment or each other.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="ad-hoc-temporary-python-environment-with-nix-shell" shape="rect"></a>15.19.1.1.3.&nbsp;Ad-hoc temporary Python environment with <code class="literal">nix-shell</code></h5></div></div></div><p>
        The simplest way to start playing with the way nix wraps and sets up Python environments is with <code class="literal">nix-shell</code> at the cmdline. These environments create a temporary shell session with a Python and a <span class="emphasis"><em>precise</em></span> list of packages (plus their runtime dependencies), with no other Python packages in the Python interpreter’s scope.
       </p><p>
        To create a Python 3.8 session with <code class="literal">numpy</code> and <code class="literal">toolz</code> available, run:
       </p><pre class="programlisting hljs nix" xml:space="preserve">$ nix-shell -p 'python38.withPackages(ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ numpy toolz ])'
</pre><p>
        By default <code class="literal">nix-shell</code> will start a <code class="literal">bash</code> session with this interpreter in our <code class="literal">PATH</code>, so if we then run:
       </p><pre class="programlisting hljs nix" xml:space="preserve">[nix-shell:~/src/nixpkgs]$ python3
Python <span class="hljs-number"><span class="hljs-number">3.8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> (default, Dec <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>)
[GCC <span class="hljs-number"><span class="hljs-number">9.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>] on linux
Type <span class="hljs-string"><span class="hljs-string">"help"</span></span>, <span class="hljs-string"><span class="hljs-string">"copyright"</span></span>, <span class="hljs-string"><span class="hljs-string">"credits"</span></span> <span class="hljs-literal"><span class="hljs-literal">or</span></span> <span class="hljs-string"><span class="hljs-string">"license"</span></span> for more information.
&gt;&gt;&gt; <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> numpy; <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> toolz
</pre><p>
        Note that no other modules are in scope, even if they were imperatively installed into our user environment as a dependency of a Python application:
       </p><pre class="programlisting hljs nix" xml:space="preserve">&gt;&gt;&gt; <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> requests
Traceback (most recent call last):
  File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt;
ModuleNotFoundError: No module named 'requests'
</pre><p>
        We can add as many additional modules onto the <code class="literal">nix-shell</code> as we need, and we will still get 1 wrapped Python interpreter. We can start the interpreter directly like so:
       </p><pre class="programlisting hljs nix" xml:space="preserve">$ nix-shell -p 'python38.withPackages(ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ numpy toolz requests ])' --run python3
these derivations will be built:
  /nix/store/xbdsrqrsfa1yva5s7pzsra8k08gxlbz1-python3-<span class="hljs-number"><span class="hljs-number">3.8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-env.drv
building '/nix/store/xbdsrqrsfa1yva5s7pzsra8k08gxlbz1-python3-<span class="hljs-number"><span class="hljs-number">3.8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-env.drv'...
created <span class="hljs-number"><span class="hljs-number">277</span></span> symlinks <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> user environment
Python <span class="hljs-number"><span class="hljs-number">3.8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> (default, Dec <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>)
[GCC <span class="hljs-number"><span class="hljs-number">9.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>] on linux
Type <span class="hljs-string"><span class="hljs-string">"help"</span></span>, <span class="hljs-string"><span class="hljs-string">"copyright"</span></span>, <span class="hljs-string"><span class="hljs-string">"credits"</span></span> <span class="hljs-literal"><span class="hljs-literal">or</span></span> <span class="hljs-string"><span class="hljs-string">"license"</span></span> for more information.
&gt;&gt;&gt; <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> requests
&gt;&gt;&gt;
</pre><p>
        Notice that this time it built a new Python environment, which now includes <code class="literal">requests</code>. Building an environment just creates wrapper scripts that expose the selected dependencies to the interpreter while re-using the actual modules. This means if any other env has installed <code class="literal">requests</code> or <code class="literal">numpy</code> in a different context, we don’t need to recompile them – we just recompile the wrapper script that sets up an interpreter pointing to them. This matters much more for <span class="quote">“<span class="quote">big</span>”</span> modules like <code class="literal">pytorch</code> or <code class="literal">tensorflow</code>.
       </p><p>
        Module names usually match their names on <a class="link" href="https://pypi.org/" target="_top" shape="rect">pypi.org</a>, but you can use the <a class="link" href="https://nixos.org/nixos/packages.html" target="_top" shape="rect">Nixpkgs search website</a> to find them as well (along with non-python packages).
       </p><p>
        At this point we can create throwaway experimental Python environments with arbitrary dependencies. This is a good way to get a feel for how the Python interpreter and dependencies work in Nix and NixOS, but to do some actual development, we’ll want to make it a bit more persistent.
       </p><section class="section"><div class="titlepage"><div><div><h6 class="title"><a id="running-python-scripts-and-using-nix-shell-as-shebang" shape="rect"></a>15.19.1.1.3.1.&nbsp;Running Python scripts and using <code class="literal">nix-shell</code> as shebang</h6></div></div></div><p>
         Sometimes, we have a script whose header looks like this:
        </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3</span></span>
<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> numpy as np
<span class="hljs-attr"><span class="hljs-attr">a</span></span> = np.array([<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>])
<span class="hljs-attr"><span class="hljs-attr">b</span></span> = np.array([<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>])
print(f<span class="hljs-string"><span class="hljs-string">"The dot product of {a} and {b} is: {np.dot(a, b)}"</span></span>)
</pre><p>
         Executing this script requires a <code class="literal">python3</code> that has <code class="literal">numpy</code>. Using what we learned in the previous section, we could startup a shell and just run it like so:
        </p><pre class="programlisting hljs nix" xml:space="preserve">nix-shell -p 'python38.withPackages(ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ numpy ])' --run 'python3 foo.py'
The dot product of [<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-literal"><span class="hljs-literal">and</span></span> [<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>] is: <span class="hljs-number"><span class="hljs-number">11</span></span>
</pre><p>
         But if we maintain the script ourselves, and if there are more dependencies, it may be nice to encode those dependencies in source to make the script re-usable without that bit of knowledge. That can be done by using <code class="literal">nix-shell</code> as a [shebang](https://en.wikipedia.org/wiki/Shebang_(Unix), like so:
        </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env nix-shell</span></span>
<span class="hljs-comment"><span class="hljs-comment">#!nix-shell -i python3 -p "python3.withPackages(ps: [ ps.numpy ])"</span></span>
<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> numpy as np
<span class="hljs-attr"><span class="hljs-attr">a</span></span> = np.array([<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>])
<span class="hljs-attr"><span class="hljs-attr">b</span></span> = np.array([<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>])
print(f<span class="hljs-string"><span class="hljs-string">"The dot product of {a} and {b} is: {np.dot(a, b)}"</span></span>)
</pre><p>
         Then we simply execute it, without requiring any environment setup at all!
        </p><pre class="programlisting hljs nix" xml:space="preserve">$ ./foo.py
The dot product of [<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-literal"><span class="hljs-literal">and</span></span> [<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>] is: <span class="hljs-number"><span class="hljs-number">11</span></span>
</pre><p>
         If the dependencies are not available on the host where <code class="literal">foo.py</code> is executed, it will build or download them from a Nix binary cache prior to starting up, prior that it is executed on a machine with a multi-user nix installation.
        </p><p>
         This provides a way to ship a self bootstrapping Python script, akin to a statically linked binary, where it can be run on any machine (provided nix is installed) without having to assume that <code class="literal">numpy</code> is installed globally on the system.
        </p><p>
         By default it is pulling the import checkout of Nixpkgs itself from our nix channel, which is nice as it cache aligns with our other package builds, but we can make it fully reproducible by pinning the <code class="literal">nixpkgs</code> import:
        </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env nix-shell</span></span>
<span class="hljs-comment"><span class="hljs-comment">#!nix-shell -i python3 -p "python3.withPackages(ps: [ ps.numpy ])"</span></span>
<span class="hljs-comment"><span class="hljs-comment">#!nix-shell -I nixpkgs=https://github.com/NixOS/nixpkgs/archive/d373d80b1207d52621961b16aa4a3438e4f98167.tar.gz</span></span>
<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> numpy as np
<span class="hljs-attr"><span class="hljs-attr">a</span></span> = np.array([<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>])
<span class="hljs-attr"><span class="hljs-attr">b</span></span> = np.array([<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>])
print(f<span class="hljs-string"><span class="hljs-string">"The dot product of {a} and {b} is: {np.dot(a, b)}"</span></span>)
</pre><p>
         This will execute with the exact same versions of Python 3.8, numpy, and system dependencies a year from now as it does today, because it will always use exactly git commit <code class="literal">d373d80b1207d52621961b16aa4a3438e4f98167</code> of Nixpkgs for all of the package versions.
        </p><p>
         This is also a great way to ensure the script executes identically on different servers.
        </p></section><section class="section"><div class="titlepage"><div><div><h6 class="title"><a id="load-environment-from-.nix-expression" shape="rect"></a>15.19.1.1.3.2.&nbsp;Load environment from <code class="literal">.nix</code> expression</h6></div></div></div><p>
         We’ve now seen how to create an ad-hoc temporary shell session, and how to create a single script with Python dependencies, but in the course of normal development we’re usually working in an entire package repository.
        </p><p>
         As explained in the Nix manual, <code class="literal">nix-shell</code> can also load an expression from a <code class="literal">.nix</code> file. Say we want to have Python 3.8, <code class="literal">numpy</code> and <code class="literal">toolz</code>, like before, in an environment. We can add a <code class="literal">shell.nix</code> file describing our dependencies:
        </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
(python38.withPackages (ps: [ps.numpy ps.toolz])).env
</pre><p>
         And then at the command line, just typing <code class="literal">nix-shell</code> produces the same environment as before. In a normal project, we’ll likely have many more dependencies; this can provide a way for developers to share the environments with each other and with CI builders.
        </p><p>
         What’s happening here?
        </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
           We begin with importing the Nix Packages collections. <code class="literal">import &lt;nixpkgs&gt;</code> imports the <code class="literal">&lt;nixpkgs&gt;</code> function, <code class="literal">{}</code> calls it and the <code class="literal">with</code> statement brings all attributes of <code class="literal">nixpkgs</code> in the local scope. These attributes form the main package set.
          </p></li><li class="listitem"><p>
           Then we create a Python 3.8 environment with the <code class="literal">withPackages</code> function, as before.
          </p></li><li class="listitem"><p>
           The <code class="literal">withPackages</code> function expects us to provide a function as an argument that takes the set of all Python packages and returns a list of packages to include in the environment. Here, we select the packages <code class="literal">numpy</code> and <code class="literal">toolz</code> from the package set.
          </p></li></ol></div><p>
         To combine this with <code class="literal">mkShell</code> you can:
        </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pythonEnv</span></span> = python38.withPackages (ps: [
    ps.numpy
    ps.toolz
  ]);
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mkShell {
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [
    pythonEnv

    black
    mypy

    libffi
    openssl
  ];
}
</pre><p>
         This will create a unified environment that has not just our Python interpreter and its Python dependencies, but also tools like <code class="literal">black</code> or <code class="literal">mypy</code> and libraries like <code class="literal">libffi</code> the <code class="literal">openssl</code> in scope. This is generic and can span any number of tools or languages across the Nixpkgs ecosystem.
        </p></section><section class="section"><div class="titlepage"><div><div><h6 class="title"><a id="installing-environments-globally-on-the-system" shape="rect"></a>15.19.1.1.3.3.&nbsp;Installing environments globally on the system</h6></div></div></div><p>
         Up to now, we’ve been creating environments scoped to an ad-hoc shell session, or a single script, or a single project. This is generally advisable, as it avoids pollution across contexts.
        </p><p>
         However, sometimes we know we will often want a Python with some basic packages, and want this available without having to enter into a shell or build context. This can be useful to have things like vim/emacs editors and plugins or shell tools <span class="quote">“<span class="quote">just work</span>”</span> without having to set them up, or when running other software that expects packages to be installed globally.
        </p><p>
         To create your own custom environment, create a file in <code class="literal">~/.config/nixpkgs/overlays/</code> that looks like this:
        </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment"># ~/.config/nixpkgs/overlays/myEnv.nix</span></span>
self: super: {
  <span class="hljs-attr"><span class="hljs-attr">myEnv</span></span> = super.buildEnv {
    <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"myEnv"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">paths</span></span> = [
      <span class="hljs-comment"><span class="hljs-comment"># A Python 3 interpreter with some packages</span></span>
      (self.python3.withPackages (
        ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [
          pyflakes
          pytest
          python-language-server
        ]
      ))

      <span class="hljs-comment"><span class="hljs-comment"># Some other packages we'd like as part of this env</span></span>
      self.mypy
      self.black
      self.ripgrep
      self.tmux
    ];
  };
}
</pre><p>
         You can then build and install this to your profile with:
        </p><pre class="programlisting hljs" xml:space="preserve">nix-env -iA myEnv
</pre><p>
         One limitation of this is that you can only have 1 Python env installed globally, since they conflict on the <code class="literal">python</code> to load out of your <code class="literal">PATH</code>.
        </p><p>
         If you get a conflict or prefer to keep the setup clean, you can have <code class="literal">nix-env</code> atomically <span class="emphasis"><em>uninstall</em></span> all other imperatively installed packages and replace your profile with just <code class="literal">myEnv</code> by using the <code class="literal">--replace</code> flag.
        </p></section><section class="section"><div class="titlepage"><div><div><h6 class="title"><a id="environment-defined-in-etcnixosconfiguration.nix" shape="rect"></a>15.19.1.1.3.4.&nbsp;Environment defined in <code class="literal">/etc/nixos/configuration.nix</code></h6></div></div></div><p>
         For the sake of completeness, here’s how to install the environment system-wide on NixOS.
        </p><pre class="programlisting hljs nix" xml:space="preserve">{ <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  environment.<span class="hljs-attr"><span class="hljs-attr">systemPackages</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; [
    (python38.withPackages(ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ numpy toolz ]))
  ];
}
</pre></section></section></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="developing-with-python" shape="rect"></a>15.19.1.2.&nbsp;Developing with Python</h4></div></div></div><p>
       Above, we were mostly just focused on use cases and what to do to get started creating working Python environments in nix.
      </p><p>
       Now that you know the basics to be up and running, it is time to take a step back and take a deeper look at at how Python packages are packaged on Nix. Then, we will look at how you can use development mode with your code.
      </p><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="python-library-packages-in-nixpkgs" shape="rect"></a>15.19.1.2.1.&nbsp;Python library packages in Nixpkgs</h5></div></div></div><p>
        With Nix all packages are built by functions. The main function in Nix for building Python libraries is <code class="literal">buildPythonPackage</code>. Let’s see how we can build the <code class="literal">toolz</code> package.
       </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, buildPythonPackage, fetchPypi }:

buildPythonPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"toolz"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.10.0"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchPypi {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> pname version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"08fdd5ef7c96480ad11c12d472de21acd32359996f69a5259299b540feba4560"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">doCheck</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/pytoolz/toolz"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"List processing tools and functional utilities"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.bsd3;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ fridh ];
  };
}
</pre><p>
        What happens here? The function <code class="literal">buildPythonPackage</code> is called and as argument it accepts a set. In this case the set is a recursive set, <code class="literal">rec</code>. One of the arguments is the name of the package, which consists of a basename (generally following the name on PyPi) and a version. Another argument, <code class="literal">src</code> specifies the source, which in this case is fetched from PyPI using the helper function <code class="literal">fetchPypi</code>. The argument <code class="literal">doCheck</code> is used to set whether tests should be run when building the package. Furthermore, we specify some (optional) meta information. The output of the function is a derivation.
       </p><p>
        An expression for <code class="literal">toolz</code> can be found in the Nixpkgs repository. As explained in the introduction of this Python section, a derivation of <code class="literal">toolz</code> is available for each interpreter version, e.g.&nbsp;<code class="literal">python38.pkgs.toolz</code> refers to the <code class="literal">toolz</code> derivation corresponding to the CPython 3.8 interpreter.
       </p><p>
        The above example works when you’re directly working on <code class="literal">pkgs/top-level/python-packages.nix</code> in the Nixpkgs repository. Often though, you will want to test a Nix expression outside of the Nixpkgs tree.
       </p><p>
        The following expression creates a derivation for the <code class="literal">toolz</code> package, and adds it along with a <code class="literal">numpy</code> package to a Python environment.
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

( <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
    <span class="hljs-attr"><span class="hljs-attr">my_toolz</span></span> = python38.pkgs.buildPythonPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
      <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"toolz"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.10.0"</span></span>;

      <span class="hljs-attr"><span class="hljs-attr">src</span></span> = python38.pkgs.fetchPypi {
        <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> pname version;
        <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"08fdd5ef7c96480ad11c12d472de21acd32359996f69a5259299b540feba4560"</span></span>;
      };

      <span class="hljs-attr"><span class="hljs-attr">doCheck</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;

      <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = {
        <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/pytoolz/toolz/"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"List processing tools and functional utilities"</span></span>;
      };
    };

  <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> python38.withPackages (ps: [ps.numpy my_toolz])
).env
</pre><p>
        Executing <code class="literal">nix-shell</code> will result in an environment in which you can use Python 3.8 and the <code class="literal">toolz</code> package. As you can see we had to explicitly mention for which Python version we want to build a package.
       </p><p>
        So, what did we do here? Well, we took the Nix expression that we used earlier to build a Python environment, and said that we wanted to include our own version of <code class="literal">toolz</code>, named <code class="literal">my_toolz</code>. To introduce our own package in the scope of <code class="literal">withPackages</code> we used a <code class="literal">let</code> expression. You can see that we used <code class="literal">ps.numpy</code> to select numpy from the nixpkgs package set (<code class="literal">ps</code>). We did not take <code class="literal">toolz</code> from the Nixpkgs package set this time, but instead took our own version that we introduced with the <code class="literal">let</code> expression.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="handling-dependencies" shape="rect"></a>15.19.1.2.2.&nbsp;Handling dependencies</h5></div></div></div><p>
        Our example, <code class="literal">toolz</code>, does not have any dependencies on other Python packages or system libraries. According to the manual, <code class="literal">buildPythonPackage</code> uses the arguments <code class="literal">buildInputs</code> and <code class="literal">propagatedBuildInputs</code> to specify dependencies. If something is exclusively a build-time dependency, then the dependency should be included in <code class="literal">buildInputs</code>, but if it is (also) a runtime dependency, then it should be added to <code class="literal">propagatedBuildInputs</code>. Test dependencies are considered build-time dependencies and passed to <code class="literal">checkInputs</code>.
       </p><p>
        The following example shows which arguments are given to <code class="literal">buildPythonPackage</code> in order to build <a class="link" href="https://github.com/blaze/datashape" target="_top" shape="rect"><code class="literal">datashape</code></a>.
       </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, buildPythonPackage, fetchPypi, numpy, multipledispatch, dateutil, pytest }:

buildPythonPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"datashape"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.4.7"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchPypi {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> pname version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"14b2ef766d4c9652ab813182e866f493475e65e558bed0822e38bf07bba1a278"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">checkInputs</span></span> = [ pytest ];
  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [ numpy multipledispatch dateutil ];

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/ContinuumIO/datashape"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"A data description language"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.bsd2;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ fridh ];
  };
}
</pre><p>
        We can see several runtime dependencies, <code class="literal">numpy</code>, <code class="literal">multipledispatch</code>, and <code class="literal">dateutil</code>. Furthermore, we have one <code class="literal">checkInputs</code>, i.e.&nbsp;<code class="literal">pytest</code>. <code class="literal">pytest</code> is a test runner and is only used during the <code class="literal">checkPhase</code> and is therefore not added to <code class="literal">propagatedBuildInputs</code>.
       </p><p>
        In the previous case we had only dependencies on other Python packages to consider. Occasionally you have also system libraries to consider. E.g., <code class="literal">lxml</code> provides Python bindings to <code class="literal">libxml2</code> and <code class="literal">libxslt</code>. These libraries are only required when building the bindings and are therefore added as <code class="literal">buildInputs</code>.
       </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, pkgs, buildPythonPackage, fetchPypi }:

buildPythonPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"lxml"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"3.4.4"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchPypi {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> pname version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"16a0fa97hym9ysdk3rmqz32xdjqmy4w34ld3rm3jf5viqjx65lxk"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ pkgs.libxml2 pkgs.libxslt ];

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"Pythonic binding for the libxml2 and libxslt libraries"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://lxml.de"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.bsd3;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ sjourdois ];
  };
}
</pre><p>
        In this example <code class="literal">lxml</code> and Nix are able to work out exactly where the relevant files of the dependencies are. This is not always the case.
       </p><p>
        The example below shows bindings to The Fastest Fourier Transform in the West, commonly known as FFTW. On Nix we have separate packages of FFTW for the different types of floats (<code class="literal">"single"</code>, <code class="literal">"double"</code>, <code class="literal">"long-double"</code>). The bindings need all three types, and therefore we add all three as <code class="literal">buildInputs</code>. The bindings don’t expect to find each of them in a different folder, and therefore we have to set <code class="literal">LDFLAGS</code> and <code class="literal">CFLAGS</code>.
       </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, pkgs, buildPythonPackage, fetchPypi, numpy, scipy }:

buildPythonPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"pyFFTW"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.9.2"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchPypi {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> pname version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"f6bbb6afa93085409ab24885a1a3cdb8909f095a142f4d49e346f2bd1b789074"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ pkgs.fftw pkgs.fftwFloat pkgs.fftwLongDouble];

  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [ numpy scipy ];

  <span class="hljs-comment"><span class="hljs-comment"># Tests cannot import pyfftw. pyfftw works fine though.</span></span>
  <span class="hljs-attr"><span class="hljs-attr">doCheck</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">preConfigure</span></span> = <span class="hljs-string"><span class="hljs-string">''
    export LDFLAGS="-L</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.fftw.dev}</span></span></span><span class="hljs-string">/lib -L</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.fftwFloat.out}</span></span></span><span class="hljs-string">/lib -L</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.fftwLongDouble.out}</span></span></span><span class="hljs-string">/lib"
    export CFLAGS="-I</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.fftw.dev}</span></span></span><span class="hljs-string">/include -I</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.fftwFloat.dev}</span></span></span><span class="hljs-string">/include -I</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pkgs.fftwLongDouble.dev}</span></span></span><span class="hljs-string">/include"
  ''</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"A pythonic wrapper around FFTW, the FFT library, presenting a unified interface for all the supported transforms"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"http://hgomersall.github.com/pyFFTW"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> licenses; [ bsd2 bsd3 ];
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ fridh ];
  };
}
</pre><p>
        Note also the line <code class="literal">doCheck = false;</code>, we explicitly disabled running the test-suite.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="testing-python-packages" shape="rect"></a>15.19.1.2.3.&nbsp;Testing Python Packages</h5></div></div></div><p>
        It is highly encouraged to have testing as part of the package build. This helps to avoid situations where the package was able to build and install, but is not usable at runtime. Currently, all packages will use the <code class="literal">test</code> command provided by the setup.py (i.e.&nbsp;<code class="literal">python setup.py test</code>). However, this is currently deprecated https://github.com/pypa/setuptools/pull/1878 and your package should provide its own checkPhase.
       </p><p>
        <span class="emphasis"><em>NOTE:</em></span> The <code class="literal">checkPhase</code> for python maps to the <code class="literal">installCheckPhase</code> on a normal derivation. This is due to many python packages not behaving well to the pre-installed version of the package. Version info, and natively compiled extensions generally only exist in the install directory, and thus can cause issues when a test suite asserts on that behavior.
       </p><p>
        <span class="emphasis"><em>NOTE:</em></span> Tests should only be disabled if they don’t agree with nix (e.g.&nbsp;external dependencies, network access, flakey tests), however, as many tests should be enabled as possible. Failing tests can still be a good indication that the package is not in a valid state.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="using-pytest" shape="rect"></a>15.19.1.2.4.&nbsp;Using pytest</h5></div></div></div><p>
        Pytest is the most common test runner for python repositories. A trivial test run would be:
       </p><pre class="programlisting hljs nix" xml:space="preserve">  <span class="hljs-attr"><span class="hljs-attr">checkInputs</span></span> = [ pytest ];
  <span class="hljs-attr"><span class="hljs-attr">checkPhase</span></span> = <span class="hljs-string"><span class="hljs-string">"pytest"</span></span>;
</pre><p>
        However, many repositories’ test suites do not translate well to nix’s build sandbox, and will generally need many tests to be disabled.
       </p><p>
        To filter tests using pytest, one can do the following:
       </p><pre class="programlisting hljs nix" xml:space="preserve">  <span class="hljs-attr"><span class="hljs-attr">checkInputs</span></span> = [ pytest ];
  <span class="hljs-comment"><span class="hljs-comment"># avoid tests which need additional data or touch network</span></span>
  <span class="hljs-attr"><span class="hljs-attr">checkPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
    pytest tests/ --ignore=tests/integration -k 'not download and not update'
  ''</span></span>;
</pre><p>
        <code class="literal">--ignore</code> will tell pytest to ignore that file or directory from being collected as part of a test run. This is useful is a file uses a package which is not available in nixpkgs, thus skipping that test file is much easier than having to create a new package.
       </p><p>
        <code class="literal">-k</code> is used to define a predicate for test names. In this example, we are filtering out tests which contain <code class="literal">download</code> or <code class="literal">update</code> in their test case name. Only one <code class="literal">-k</code> argument is allows, and thus a long predicate should be concatenated with "" and wrapped to the next line.
       </p><p>
        <span class="emphasis"><em>NOTE:</em></span> In pytest==6.0.1, the use of "" to continue a line (e.g.&nbsp;<code class="literal">-k 'not download \'</code>) has been removed, in this case, it’s recommended to use <code class="literal">pytestCheckHook</code>.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="using-pytestcheckhook" shape="rect"></a>15.19.1.2.5.&nbsp;Using pytestCheckHook</h5></div></div></div><p>
        <code class="literal">pytestCheckHook</code> is a convenient hook which will substitute the setuptools <code class="literal">test</code> command for a checkPhase which runs <code class="literal">pytest</code>. This is also beneficial when a package may need many items disabled to run the test suite.
       </p><p>
        Using the example above, the analagous pytestCheckHook usage would be:
       </p><pre class="programlisting hljs nix" xml:space="preserve">  <span class="hljs-attr"><span class="hljs-attr">checkInputs</span></span> = [ pytestCheckHook ];

  <span class="hljs-comment"><span class="hljs-comment"># requires additional data</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pytestFlagsArray</span></span> = [ <span class="hljs-string"><span class="hljs-string">"tests/"</span></span> <span class="hljs-string"><span class="hljs-string">"--ignore=tests/integration"</span></span> ];

  <span class="hljs-attr"><span class="hljs-attr">disabledTests</span></span> = [
    <span class="hljs-comment"><span class="hljs-comment"># touches network</span></span>
    <span class="hljs-string"><span class="hljs-string">"download"</span></span>
    <span class="hljs-string"><span class="hljs-string">"update"</span></span>
  ];
</pre><p>
        This is expecially useful when tests need to be conditionallydisabled, for example:
       </p><pre class="programlisting hljs nix" xml:space="preserve">  <span class="hljs-attr"><span class="hljs-attr">disabledTests</span></span> = [
    <span class="hljs-comment"><span class="hljs-comment"># touches network</span></span>
    <span class="hljs-string"><span class="hljs-string">"download"</span></span>
    <span class="hljs-string"><span class="hljs-string">"update"</span></span>
  ] ++ lib.optionals (pythonAtLeast <span class="hljs-string"><span class="hljs-string">"3.8"</span></span>) [
    <span class="hljs-comment"><span class="hljs-comment"># broken due to python3.8 async changes</span></span>
    <span class="hljs-string"><span class="hljs-string">"async"</span></span>
  ] ++ lib.optionals stdenv.isDarwin [
    <span class="hljs-comment"><span class="hljs-comment"># can fail when building with other packages</span></span>
    <span class="hljs-string"><span class="hljs-string">"socket"</span></span>
  ];
</pre><p>
        Trying to concatenate the related strings to disable tests in a regular checkPhase would be much harder to read. This also enables us to comment on why specific tests are disabled.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="using-pythonimportscheck" shape="rect"></a>15.19.1.2.6.&nbsp;Using pythonImportsCheck</h5></div></div></div><p>
        Although unit tests are highly prefered to valid correctness of a package. Not all packages have test suites that can be ran easily, and some have none at all. To help ensure the package still works, <code class="literal">pythonImportsCheck</code> can attempt to import the listed modules.
       </p><pre class="programlisting hljs nix" xml:space="preserve">  <span class="hljs-attr"><span class="hljs-attr">pythonImportsCheck</span></span> = [ <span class="hljs-string"><span class="hljs-string">"requests"</span></span> <span class="hljs-string"><span class="hljs-string">"urllib"</span></span> ];
</pre><p>
        roughly translates to:
       </p><pre class="programlisting hljs bash" xml:space="preserve">  postCheck = <span class="hljs-string"><span class="hljs-string">''</span></span>
    PYTHONPATH=<span class="hljs-variable"><span class="hljs-variable">$out</span></span>/<span class="hljs-variable"><span class="hljs-variable">${python.sitePackages}</span></span>:<span class="hljs-variable"><span class="hljs-variable">$PYTHONPATH</span></span>
    python -c <span class="hljs-string"><span class="hljs-string">"import requests; import urllib"</span></span>
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
</pre><p>
        However, this is done in it’s own phase, and not dependent on whether <code class="literal">doCheck = true;</code>
       </p><p>
        This can also be useful in verifying that the package doesn’t assume commonly present packages (e.g.&nbsp;<code class="literal">setuptools</code>)
       </p></section></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="develop-local-package" shape="rect"></a>15.19.1.3.&nbsp;Develop local package</h4></div></div></div><p>
       As a Python developer you’re likely aware of <a class="link" href="http://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode" target="_top" shape="rect">development mode</a> (<code class="literal">python setup.py develop</code>); instead of installing the package this command creates a special link to the project code. That way, you can run updated code without having to reinstall after each and every change you make. Development mode is also available. Let’s see how you can use it.
      </p><p>
       In the previous Nix expression the source was fetched from an url. We can also refer to a local source instead using <code class="literal">src = ./path/to/source/tree;</code>
      </p><p>
       If we create a <code class="literal">shell.nix</code> file which calls <code class="literal">buildPythonPackage</code>, and if <code class="literal">src</code> is a local source, and if the local source has a <code class="literal">setup.py</code>, then development mode is activated.
      </p><p>
       In the following example we create a simple environment that has a Python 3.8 version of our package in it, as well as its dependencies and other packages we like to have in the environment, all specified with <code class="literal">propagatedBuildInputs</code>. Indeed, we can just add any package we like to have in our environment to <code class="literal">propagatedBuildInputs</code>.
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> python38Packages;

buildPythonPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"mypackage"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = ./path/to/package/source;
  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [ pytest numpy pkgs.libsndfile ];
}
</pre><p>
       It is important to note that due to how development mode is implemented on Nix it is not possible to have multiple packages simultaneously in development mode.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="organising-your-packages" shape="rect"></a>15.19.1.4.&nbsp;Organising your packages</h4></div></div></div><p>
       So far we discussed how you can use Python on Nix, and how you can develop with it. We’ve looked at how you write expressions to package Python packages, and we looked at how you can create environments in which specified packages are available.
      </p><p>
       At some point you’ll likely have multiple packages which you would like to be able to use in different projects. In order to minimise unnecessary duplication we now look at how you can maintain a repository with your own packages. The important functions here are <code class="literal">import</code> and <code class="literal">callPackage</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="including-a-derivation-using-callpackage" shape="rect"></a>15.19.1.5.&nbsp;Including a derivation using <code class="literal">callPackage</code></h4></div></div></div><p>
       Earlier we created a Python environment using <code class="literal">withPackages</code>, and included the <code class="literal">toolz</code> package via a <code class="literal">let</code> expression. Let’s split the package definition from the environment definition.
      </p><p>
       We first create a function that builds <code class="literal">toolz</code> in <code class="literal">~/path/to/toolz/release.nix</code>
      </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, buildPythonPackage }:

buildPythonPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"toolz"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.10.0"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchPypi {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> pname version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"08fdd5ef7c96480ad11c12d472de21acd32359996f69a5259299b540feba4560"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/pytoolz/toolz/"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"List processing tools and functional utilities"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.bsd3;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ fridh ];
  };
}
</pre><p>
       It takes an argument <code class="literal">buildPythonPackage</code>. We now call this function using <code class="literal">callPackage</code> in the definition of our environment
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

( <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
    <span class="hljs-attr"><span class="hljs-attr">toolz</span></span> = callPackage /path/to/toolz/release.nix {
      <span class="hljs-attr"><span class="hljs-attr">buildPythonPackage</span></span> = python38Packages.buildPythonPackage;
    };
  <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> python38.withPackages (ps: [ ps.numpy toolz ])
).env
</pre><p>
       Important to remember is that the Python version for which the package is made depends on the <code class="literal">python</code> derivation that is passed to <code class="literal">buildPythonPackage</code>. Nix tries to automatically pass arguments when possible, which is why generally you don’t explicitly define which <code class="literal">python</code> derivation should be used. In the above example we use <code class="literal">buildPythonPackage</code> that is part of the set <code class="literal">python38Packages</code>, and in this case the <code class="literal">python38</code> interpreter is automatically used.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="reference" class="title">15.19.2.&nbsp;Reference<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#reference" aria-label="Anchor link for: reference" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="interpreters" shape="rect"></a>15.19.2.1.&nbsp;Interpreters</h4></div></div></div><p>
       Versions 2.7, 3.6, 3.7, 3.8 and 3.9 of the CPython interpreter are available as respectively <code class="literal">python27</code>, <code class="literal">python36</code>, <code class="literal">python37</code>, <code class="literal">python38</code> and <code class="literal">python39</code>. The aliases <code class="literal">python2</code> and <code class="literal">python3</code> correspond to respectively <code class="literal">python27</code> and <code class="literal">python38</code>. The default interpreter, <code class="literal">python</code>, maps to <code class="literal">python2</code>. The PyPy interpreters compatible with Python 2.7 and 3 are available as <code class="literal">pypy27</code> and <code class="literal">pypy3</code>, with aliases <code class="literal">pypy2</code> mapping to <code class="literal">pypy27</code> and <code class="literal">pypy</code> mapping to <code class="literal">pypy2</code>. The Nix expressions for the interpreters can be found in <code class="literal">pkgs/development/interpreters/python</code>.
      </p><p>
       All packages depending on any Python interpreter get appended <code class="literal">out/{python.sitePackages}</code> to <code class="literal">$PYTHONPATH</code> if such directory exists.
      </p><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="missing-tkinter-module-standard-library" shape="rect"></a>15.19.2.1.1.&nbsp;Missing <code class="literal">tkinter</code> module standard library</h5></div></div></div><p>
        To reduce closure size the <code class="literal">Tkinter</code>/<code class="literal">tkinter</code> is available as a separate package, <code class="literal">pythonPackages.tkinter</code>.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="attributes-on-interpreters-packages" shape="rect"></a>15.19.2.1.2.&nbsp;Attributes on interpreters packages</h5></div></div></div><p>
        Each interpreter has the following attributes:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">libPrefix</code>. Name of the folder in <code class="literal">${python}/lib/</code> for corresponding interpreter.
         </p></li><li class="listitem"><p>
          <code class="literal">interpreter</code>. Alias for <code class="literal">${python}/bin/${executable}</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">buildEnv</code>. Function to build python interpreter environments with extra packages bundled together. See section <span class="emphasis"><em>python.buildEnv function</em></span> for usage and documentation.
         </p></li><li class="listitem"><p>
          <code class="literal">withPackages</code>. Simpler interface to <code class="literal">buildEnv</code>. See section <span class="emphasis"><em>python.withPackages function</em></span> for usage and documentation.
         </p></li><li class="listitem"><p>
          <code class="literal">sitePackages</code>. Alias for <code class="literal">lib/${libPrefix}/site-packages</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">executable</code>. Name of the interpreter executable, e.g.&nbsp;<code class="literal">python3.8</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">pkgs</code>. Set of Python packages for that specific interpreter. The package set can be modified by overriding the interpreter and passing <code class="literal">packageOverrides</code>.
         </p></li></ul></div></section></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="building-packages-and-applications" shape="rect"></a>15.19.2.2.&nbsp;Building packages and applications</h4></div></div></div><p>
       Python libraries and applications that use <code class="literal">setuptools</code> or <code class="literal">distutils</code> are typically built with respectively the <code class="literal">buildPythonPackage</code> and <code class="literal">buildPythonApplication</code> functions. These two functions also support installing a <code class="literal">wheel</code>.
      </p><p>
       All Python packages reside in <code class="literal">pkgs/top-level/python-packages.nix</code> and all applications elsewhere. In case a package is used as both a library and an application, then the package should be in <code class="literal">pkgs/top-level/python-packages.nix</code> since only those packages are made available for all interpreter versions. The preferred location for library expressions is in <code class="literal">pkgs/development/python-modules</code>. It is important that these packages are called from <code class="literal">pkgs/top-level/python-packages.nix</code> and not elsewhere, to guarantee the right version of the package is built.
      </p><p>
       Based on the packages defined in <code class="literal">pkgs/top-level/python-packages.nix</code> an attribute set is created for each available Python interpreter. The available sets are
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="literal">pkgs.python27Packages</code>
        </p></li><li class="listitem"><p>
         <code class="literal">pkgs.python36Packages</code>
        </p></li><li class="listitem"><p>
         <code class="literal">pkgs.python37Packages</code>
        </p></li><li class="listitem"><p>
         <code class="literal">pkgs.python38Packages</code>
        </p></li><li class="listitem"><p>
         <code class="literal">pkgs.python39Packages</code>
        </p></li><li class="listitem"><p>
         <code class="literal">pkgs.pypyPackages</code>
        </p></li></ul></div><p>
       and the aliases
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="literal">pkgs.python2Packages</code> pointing to <code class="literal">pkgs.python27Packages</code>
        </p></li><li class="listitem"><p>
         <code class="literal">pkgs.python3Packages</code> pointing to <code class="literal">pkgs.python38Packages</code>
        </p></li><li class="listitem"><p>
         <code class="literal">pkgs.pythonPackages</code> pointing to <code class="literal">pkgs.python2Packages</code>
        </p></li></ul></div><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="buildpythonpackage-function" shape="rect"></a>15.19.2.2.1.&nbsp;<code class="literal">buildPythonPackage</code> function</h5></div></div></div><p>
        The <code class="literal">buildPythonPackage</code> function is implemented in <code class="literal">pkgs/development/interpreters/python/mk-python-derivation</code> using setup hooks.
       </p><p>
        The following is an example:
       </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, buildPythonPackage, fetchPypi, hypothesis, setuptools_scm, attrs, py, setuptools, six, pluggy }:

buildPythonPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"pytest"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"3.3.1"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchPypi {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> pname version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"cf8436dc59d8695346fcd3ab296de46425ecab00d64096cebe79fb51ecb2eb93"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">postPatch</span></span> = <span class="hljs-string"><span class="hljs-string">''
    # don't test bash builtins
    rm testing/test_argcomplete.py
  ''</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">checkInputs</span></span> = [ hypothesis ];
  <span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [ setuptools_scm ];
  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = [ attrs py setuptools six pluggy ];

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ domenkozar lovek323 madjar lsix ];
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"Framework for writing tests"</span></span>;
  };
}
</pre><p>
        The <code class="literal">buildPythonPackage</code> mainly does four things:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          In the <code class="literal">buildPhase</code>, it calls <code class="literal">${python.interpreter} setup.py bdist_wheel</code> to build a wheel binary zipfile.
         </p></li><li class="listitem"><p>
          In the <code class="literal">installPhase</code>, it installs the wheel file using <code class="literal">pip install *.whl</code>.
         </p></li><li class="listitem"><p>
          In the <code class="literal">postFixup</code> phase, the <code class="literal">wrapPythonPrograms</code> bash function is called to wrap all programs in the <code class="literal">$out/bin/*</code> directory to include <code class="literal">$PATH</code> environment variable and add dependent libraries to script’s <code class="literal">sys.path</code>.
         </p></li><li class="listitem"><p>
          In the <code class="literal">installCheck</code> phase, <code class="literal">${python.interpreter} setup.py test</code> is ran.
         </p></li></ul></div><p>
        By default tests are run because <code class="literal">doCheck = true</code>. Test dependencies, like e.g.&nbsp;the test runner, should be added to <code class="literal">checkInputs</code>.
       </p><p>
        By default <code class="literal">meta.platforms</code> is set to the same value as the interpreter unless overridden otherwise.
       </p><section class="section"><div class="titlepage"><div><div><h6 class="title"><a id="buildpythonpackage-parameters" shape="rect"></a>15.19.2.2.1.1.&nbsp;<code class="literal">buildPythonPackage</code> parameters</h6></div></div></div><p>
         All parameters from <code class="literal">stdenv.mkDerivation</code> function are still supported. The following are specific to <code class="literal">buildPythonPackage</code>:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
           <code class="literal">catchConflicts ? true</code>: If <code class="literal">true</code>, abort package build if a package name appears more than once in dependency tree. Default is <code class="literal">true</code>.
          </p></li><li class="listitem"><p>
           <code class="literal">disabled</code> ? false: If <code class="literal">true</code>, package is not built for the particular Python interpreter version.
          </p></li><li class="listitem"><p>
           <code class="literal">dontWrapPythonPrograms ? false</code>: Skip wrapping of Python programs.
          </p></li><li class="listitem"><p>
           <code class="literal">permitUserSite ? false</code>: Skip setting the <code class="literal">PYTHONNOUSERSITE</code> environment variable in wrapped programs.
          </p></li><li class="listitem"><p>
           <code class="literal">format ? "setuptools"</code>: Format of the source. Valid options are <code class="literal">"setuptools"</code>, <code class="literal">"pyproject"</code>, <code class="literal">"flit"</code>, <code class="literal">"wheel"</code>, and <code class="literal">"other"</code>. <code class="literal">"setuptools"</code> is for when the source has a <code class="literal">setup.py</code> and <code class="literal">setuptools</code> is used to build a wheel, <code class="literal">flit</code>, in case <code class="literal">flit</code> should be used to build a wheel, and <code class="literal">wheel</code> in case a wheel is provided. Use <code class="literal">other</code> when a custom <code class="literal">buildPhase</code> and/or <code class="literal">installPhase</code> is needed.
          </p></li><li class="listitem"><p>
           <code class="literal">makeWrapperArgs ? []</code>: A list of strings. Arguments to be passed to <code class="literal">makeWrapper</code>, which wraps generated binaries. By default, the arguments to <code class="literal">makeWrapper</code> set <code class="literal">PATH</code> and <code class="literal">PYTHONPATH</code> environment variables before calling the binary. Additional arguments here can allow a developer to set environment variables which will be available when the binary is run. For example, <code class="literal">makeWrapperArgs = ["--set FOO BAR" "--set BAZ QUX"]</code>.
          </p></li><li class="listitem"><p>
           <code class="literal">namePrefix</code>: Prepends text to <code class="literal">${name}</code> parameter. In case of libraries, this defaults to <code class="literal">"python3.8-"</code> for Python 3.8, etc., and in case of applications to <code class="literal">""</code>.
          </p></li><li class="listitem"><p>
           <code class="literal">pipInstallFlags ? []</code>: A list of strings. Arguments to be passed to <code class="literal">pip install</code>. To pass options to <code class="literal">python setup.py install</code>, use <code class="literal">--install-option</code>. E.g., <code class="literal">pipInstallFlags=["--install-option='--cpp_implementation'"]</code>.
          </p></li><li class="listitem"><p>
           <code class="literal">pythonPath ? []</code>: List of packages to be added into <code class="literal">$PYTHONPATH</code>. Packages in <code class="literal">pythonPath</code> are not propagated (contrary to <code class="literal">propagatedBuildInputs</code>).
          </p></li><li class="listitem"><p>
           <code class="literal">preShellHook</code>: Hook to execute commands before <code class="literal">shellHook</code>.
          </p></li><li class="listitem"><p>
           <code class="literal">postShellHook</code>: Hook to execute commands after <code class="literal">shellHook</code>.
          </p></li><li class="listitem"><p>
           <code class="literal">removeBinByteCode ? true</code>: Remove bytecode from <code class="literal">/bin</code>. Bytecode is only created when the filenames end with <code class="literal">.py</code>.
          </p></li><li class="listitem"><p>
           <code class="literal">setupPyGlobalFlags ? []</code>: List of flags passed to <code class="literal">setup.py</code> command.
          </p></li><li class="listitem"><p>
           <code class="literal">setupPyBuildFlags ? []</code>: List of flags passed to <code class="literal">setup.py build_ext</code> command.
          </p></li></ul></div><p>
         The <code class="literal">stdenv.mkDerivation</code> function accepts various parameters for describing build inputs (see <span class="quote">“<span class="quote">Specifying dependencies</span>”</span>). The following are of special interest for Python packages, either because these are primarily used, or because their behaviour is different:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
           <code class="literal">nativeBuildInputs ? []</code>: Build-time only dependencies. Typically executables as well as the items listed in <code class="literal">setup_requires</code>.
          </p></li><li class="listitem"><p>
           <code class="literal">buildInputs ? []</code>: Build and/or run-time dependencies that need to be be compiled for the host machine. Typically non-Python libraries which are being linked.
          </p></li><li class="listitem"><p>
           <code class="literal">checkInputs ? []</code>: Dependencies needed for running the <code class="literal">checkPhase</code>. These are added to <code class="literal">nativeBuildInputs</code> when <code class="literal">doCheck = true</code>. Items listed in <code class="literal">tests_require</code> go here.
          </p></li><li class="listitem"><p>
           <code class="literal">propagatedBuildInputs ? []</code>: Aside from propagating dependencies, <code class="literal">buildPythonPackage</code> also injects code into and wraps executables with the paths included in this list. Items listed in <code class="literal">install_requires</code> go here.
          </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h6 class="title"><a id="overriding-python-packages" shape="rect"></a>15.19.2.2.1.2.&nbsp;Overriding Python packages</h6></div></div></div><p>
         The <code class="literal">buildPythonPackage</code> function has a <code class="literal">overridePythonAttrs</code> method that can be used to override the package. In the following example we create an environment where we have the <code class="literal">blaze</code> package using an older version of <code class="literal">pandas</code>. We override first the Python interpreter and pass <code class="literal">packageOverrides</code> which contains the overrides for packages in the package set.
        </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">python</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
    <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = self: super: {
      <span class="hljs-attr"><span class="hljs-attr">pandas</span></span> = super.pandas.overridePythonAttrs(old: <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
        <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.19.1"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">src</span></span> =  super.fetchPypi {
          <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"pandas"</span></span>;
          <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> version;
          <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"08blshqj9zj1wyjhhw3kl2vas75vhhicvv72flvf1z3jvapgw295"</span></span>;
        };
      });
    };
  <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> pkgs.python3.override {<span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> packageOverrides; <span class="hljs-attr"><span class="hljs-attr">self</span></span> = python;};

<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> python.withPackages(ps: [ps.blaze])).env
</pre></section></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="buildpythonapplication-function" shape="rect"></a>15.19.2.2.2.&nbsp;<code class="literal">buildPythonApplication</code> function</h5></div></div></div><p>
        The <code class="literal">buildPythonApplication</code> function is practically the same as <code class="literal">buildPythonPackage</code>. The main purpose of this function is to build a Python package where one is interested only in the executables, and not importable modules. For that reason, when adding this package to a <code class="literal">python.buildEnv</code>, the modules won’t be made available.
       </p><p>
        Another difference is that <code class="literal">buildPythonPackage</code> by default prefixes the names of the packages with the version of the interpreter. Because this is irrelevant for applications, the prefix is omitted.
       </p><p>
        When packaging a Python application with <code class="literal">buildPythonApplication</code>, it should be called with <code class="literal">callPackage</code> and passed <code class="literal">python</code> or <code class="literal">pythonPackages</code> (possibly specifying an interpreter version), like this:
       </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, python3Packages }:

python3Packages.buildPythonApplication <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"luigi"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"2.7.9"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = python3Packages.fetchPypi {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> pname version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"035w8gqql36zlan0xjrzz9j4lh9hs0qrsgnbyw07qs7lnkvbdv9x"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">propagatedBuildInputs</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> python3Packages; [ tornado_4 python-daemon ];

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    ...
  };
}
</pre><p>
        This is then added to <code class="literal">all-packages.nix</code> just as any other application would be.
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">luigi</span></span> = callPackage ../applications/networking/cluster/luigi { };
</pre><p>
        Since the package is an application, a consumer doesn’t need to care about Python versions or modules, which is why they don’t go in <code class="literal">pythonPackages</code>.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="topythonapplication-function" shape="rect"></a>15.19.2.2.3.&nbsp;<code class="literal">toPythonApplication</code> function</h5></div></div></div><p>
        A distinction is made between applications and libraries, however, sometimes a package is used as both. In this case the package is added as a library to <code class="literal">python-packages.nix</code> and as an application to <code class="literal">all-packages.nix</code>. To reduce duplication the <code class="literal">toPythonApplication</code> can be used to convert a library to an application.
       </p><p>
        The Nix expression shall use <code class="literal">buildPythonPackage</code> and be called from <code class="literal">python-packages.nix</code>. A reference shall be created from <code class="literal">all-packages.nix</code> to the attribute in <code class="literal">python-packages.nix</code>, and the <code class="literal">toPythonApplication</code> shall be applied to the reference:
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">youtube-dl</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pythonPackages; toPythonApplication youtube-dl;
</pre></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="topythonmodule-function" shape="rect"></a>15.19.2.2.4.&nbsp;<code class="literal">toPythonModule</code> function</h5></div></div></div><p>
        In some cases, such as bindings, a package is created using <code class="literal">stdenv.mkDerivation</code> and added as attribute in <code class="literal">all-packages.nix</code>. The Python bindings should be made available from <code class="literal">python-packages.nix</code>. The <code class="literal">toPythonModule</code> function takes a derivation and makes certain Python-specific modifications.
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">opencv</span></span> = toPythonModule (pkgs.opencv.override {
  <span class="hljs-attr"><span class="hljs-attr">enablePython</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">pythonPackages</span></span> = self;
});
</pre><p>
        Do pay attention to passing in the right Python version!
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="python.buildenv-function" shape="rect"></a>15.19.2.2.5.&nbsp;<code class="literal">python.buildEnv</code> function</h5></div></div></div><p>
        Python environments can be created using the low-level <code class="literal">pkgs.buildEnv</code> function. This example shows how to create an environment that has the Pyramid Web Framework. Saving the following as <code class="literal">default.nix</code>
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

python.buildEnv.override {
  <span class="hljs-attr"><span class="hljs-attr">extraLibs</span></span> = [ pythonPackages.pyramid ];
  <span class="hljs-attr"><span class="hljs-attr">ignoreCollisions</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}
</pre><p>
        and running <code class="literal">nix-build</code> will create
       </p><pre class="programlisting hljs" xml:space="preserve">/nix/store/cf1xhjwzmdki7fasgr4kz6di72ykicl5-python-2.7.8-env
</pre><p>
        with wrapped binaries in <code class="literal">bin/</code>.
       </p><p>
        You can also use the <code class="literal">env</code> attribute to create local environments with needed packages installed. This is somewhat comparable to <code class="literal">virtualenv</code>. For example, running <code class="literal">nix-shell</code> with the following <code class="literal">shell.nix</code>
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

(python3.buildEnv.override {
  <span class="hljs-attr"><span class="hljs-attr">extraLibs</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> python3Packages; [ numpy requests ];
}).env
</pre><p>
        will drop you into a shell where Python will have the specified packages in its path.
       </p><section class="section"><div class="titlepage"><div><div><h6 class="title"><a id="python.buildenv-arguments" shape="rect"></a>15.19.2.2.5.1.&nbsp;<code class="literal">python.buildEnv</code> arguments</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
           <code class="literal">extraLibs</code>: List of packages installed inside the environment.
          </p></li><li class="listitem"><p>
           <code class="literal">postBuild</code>: Shell command executed after the build of environment.
          </p></li><li class="listitem"><p>
           <code class="literal">ignoreCollisions</code>: Ignore file collisions inside the environment (default is <code class="literal">false</code>).
          </p></li><li class="listitem"><p>
           <code class="literal">permitUserSite</code>: Skip setting the <code class="literal">PYTHONNOUSERSITE</code> environment variable in wrapped binaries in the environment.
          </p></li></ul></div></section></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="python.withpackages-function" shape="rect"></a>15.19.2.2.6.&nbsp;<code class="literal">python.withPackages</code> function</h5></div></div></div><p>
        The <code class="literal">python.withPackages</code> function provides a simpler interface to the <code class="literal">python.buildEnv</code> functionality. It takes a function as an argument that is passed the set of python packages and returns the list of the packages to be included in the environment. Using the <code class="literal">withPackages</code> function, the previous example for the Pyramid Web Framework environment can be written like this:
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

python.withPackages (ps: [ps.pyramid])
</pre><p>
        <code class="literal">withPackages</code> passes the correct package set for the specific interpreter version as an argument to the function. In the above example, <code class="literal">ps</code> equals <code class="literal">pythonPackages</code>. But you can also easily switch to using python3:
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

python3.withPackages (ps: [ps.pyramid])
</pre><p>
        Now, <code class="literal">ps</code> is set to <code class="literal">python3Packages</code>, matching the version of the interpreter.
       </p><p>
        As <code class="literal">python.withPackages</code> simply uses <code class="literal">python.buildEnv</code> under the hood, it also supports the <code class="literal">env</code> attribute. The <code class="literal">shell.nix</code> file from the previous section can thus be also written like this:
       </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

(python38.withPackages (ps: [ps.numpy ps.requests])).env
</pre><p>
        In contrast to <code class="literal">python.buildEnv</code>, <code class="literal">python.withPackages</code> does not support the more advanced options such as <code class="literal">ignoreCollisions = true</code> or <code class="literal">postBuild</code>. If you need them, you have to use <code class="literal">python.buildEnv</code>.
       </p><p>
        Python 2 namespace packages may provide <code class="literal">__init__.py</code> that collide. In that case <code class="literal">python.buildEnv</code> should be used with <code class="literal">ignoreCollisions = true</code>.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="setup-hooks" shape="rect"></a>15.19.2.2.7.&nbsp;Setup hooks</h5></div></div></div><p>
        The following are setup hooks specifically for Python packages. Most of these are used in <code class="literal">buildPythonPackage</code>.
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">eggUnpackhook</code> to move an egg to the correct folder so it can be installed with the <code class="literal">eggInstallHook</code>
         </p></li><li class="listitem"><p>
          <code class="literal">eggBuildHook</code> to skip building for eggs.
         </p></li><li class="listitem"><p>
          <code class="literal">eggInstallHook</code> to install eggs.
         </p></li><li class="listitem"><p>
          <code class="literal">flitBuildHook</code> to build a wheel using <code class="literal">flit</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">pipBuildHook</code> to build a wheel using <code class="literal">pip</code> and PEP 517. Note a build system (e.g.&nbsp;<code class="literal">setuptools</code> or <code class="literal">flit</code>) should still be added as <code class="literal">nativeBuildInput</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">pipInstallHook</code> to install wheels.
         </p></li><li class="listitem"><p>
          <code class="literal">pytestCheckHook</code> to run tests with <code class="literal">pytest</code>. See <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#using-pytestcheckhook" title="15.19.1.2.5. Using pytestCheckHook" shape="rect">example usage</a>.
         </p></li><li class="listitem"><p>
          <code class="literal">pythonCatchConflictsHook</code> to check whether a Python package is not already existing.
         </p></li><li class="listitem"><p>
          <code class="literal">pythonImportsCheckHook</code> to check whether importing the listed modules works.
         </p></li><li class="listitem"><p>
          <code class="literal">pythonRemoveBinBytecode</code> to remove bytecode from the <code class="literal">/bin</code> folder.
         </p></li><li class="listitem"><p>
          <code class="literal">setuptoolsBuildHook</code> to build a wheel using <code class="literal">setuptools</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">setuptoolsCheckHook</code> to run tests with <code class="literal">python setup.py test</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">venvShellHook</code> to source a Python 3 <code class="literal">venv</code> at the <code class="literal">venvDir</code> location. A <code class="literal">venv</code> is created if it does not yet exist. <code class="literal">postVenvCreation</code> can be used to to run commands only after venv is first created.
         </p></li><li class="listitem"><p>
          <code class="literal">wheelUnpackHook</code> to move a wheel to the correct folder so it can be installed with the <code class="literal">pipInstallHook</code>.
         </p></li></ul></div></section></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="development-mode" shape="rect"></a>15.19.2.3.&nbsp;Development mode</h4></div></div></div><p>
       Development or editable mode is supported. To develop Python packages <code class="literal">buildPythonPackage</code> has additional logic inside <code class="literal">shellPhase</code> to run <code class="literal">pip install -e . --prefix $TMPDIR/</code>for the package.
      </p><p>
       Warning: <code class="literal">shellPhase</code> is executed only if <code class="literal">setup.py</code> exists.
      </p><p>
       Given a <code class="literal">default.nix</code>:
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

pythonPackages.buildPythonPackage {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"myproject"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pythonPackages; [ pyramid ];

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = ./.;
}
</pre><p>
       Running <code class="literal">nix-shell</code> with no arguments should give you the environment in which the package would be built with <code class="literal">nix-build</code>.
      </p><p>
       Shortcut to setup environments with C headers/libraries and Python packages:
      </p><pre class="programlisting hljs" xml:space="preserve">nix-shell -p pythonPackages.pyramid zlib libjpeg git
</pre><p>
       Note: There is a boolean value <code class="literal">lib.inNixShell</code> set to <code class="literal">true</code> if nix-shell is invoked.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="tools" shape="rect"></a>15.19.2.4.&nbsp;Tools</h4></div></div></div><p>
       Packages inside nixpkgs are written by hand. However many tools exist in community to help save time. No tool is preferred at the moment.
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         <a class="link" href="https://github.com/nix-community/pypi2nix" target="_top" shape="rect">pypi2nix</a>: Generate Nix expressions for your Python project. Note that <a class="link" href="https://github.com/nix-community/pypi2nix/issues/222#issuecomment-443497376" target="_top" shape="rect">sharing derivations from pypi2nix with nixpkgs is possible but not encouraged</a>.
        </p></li><li class="listitem"><p>
         <a class="link" href="https://github.com/proger/python2nix" target="_top" shape="rect">python2nix</a> by Vladimir Kirillov.
        </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="deterministic-builds" shape="rect"></a>15.19.2.5.&nbsp;Deterministic builds</h4></div></div></div><p>
       The Python interpreters are now built deterministically. Minor modifications had to be made to the interpreters in order to generate deterministic bytecode. This has security implications and is relevant for those using Python in a <code class="literal">nix-shell</code>.
      </p><p>
       When the environment variable <code class="literal">DETERMINISTIC_BUILD</code> is set, all bytecode will have timestamp 1. The <code class="literal">buildPythonPackage</code> function sets <code class="literal">DETERMINISTIC_BUILD=1</code> and <a class="link" href="https://docs.python.org/3.8/using/cmdline.html#envvar-PYTHONHASHSEED" target="_top" shape="rect">PYTHONHASHSEED=0</a>. Both are also exported in <code class="literal">nix-shell</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="automatic-tests" shape="rect"></a>15.19.2.6.&nbsp;Automatic tests</h4></div></div></div><p>
       It is recommended to test packages as part of the build process. Source distributions (<code class="literal">sdist</code>) often include test files, but not always.
      </p><p>
       By default the command <code class="literal">python setup.py test</code> is run as part of the <code class="literal">checkPhase</code>, but often it is necessary to pass a custom <code class="literal">checkPhase</code>. An example of such a situation is when <code class="literal">py.test</code> is used.
      </p><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="common-issues" shape="rect"></a>15.19.2.6.1.&nbsp;Common issues</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Non-working tests can often be deselected. By default <code class="literal">buildPythonPackage</code> runs <code class="literal">python setup.py test</code>. Most Python modules follows the standard test protocol where the pytest runner can be used instead. <code class="literal">py.test</code> supports a <code class="literal">-k</code> parameter to ignore test methods or classes:
         </p><pre class="programlisting hljs nix" xml:space="preserve">buildPythonPackage {
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># assumes the tests are located in tests</span></span>
  <span class="hljs-attr"><span class="hljs-attr">checkInputs</span></span> = [ pytest ];
  <span class="hljs-attr"><span class="hljs-attr">checkPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
    py.test -k 'not function_name and not other_function' tests
  ''</span></span>;
}
</pre></li><li class="listitem"><p>
          Tests that attempt to access <code class="literal">$HOME</code> can be fixed by using the following work-around before running tests (e.g.&nbsp;<code class="literal">preCheck</code>): <code class="literal">export HOME=$(mktemp -d)</code>
         </p></li></ul></div></section></section></section><section class="section"><div class="titlepage"><div><div><h3 id="faq" class="title">15.19.3.&nbsp;FAQ<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#faq" aria-label="Anchor link for: faq" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-solve-circular-dependencies" shape="rect"></a>15.19.3.1.&nbsp;How to solve circular dependencies?</h4></div></div></div><p>
       Consider the packages <code class="literal">A</code> and <code class="literal">B</code> that depend on each other. When packaging <code class="literal">B</code>, a solution is to override package <code class="literal">A</code> not to depend on <code class="literal">B</code> as an input. The same should also be done when packaging <code class="literal">A</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-a-python-package" shape="rect"></a>15.19.3.2.&nbsp;How to override a Python package?</h4></div></div></div><p>
       We can override the interpreter and pass <code class="literal">packageOverrides</code>. In the following example we rename the <code class="literal">pandas</code> package and build it.
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">python</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
    <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = self: super: {
      <span class="hljs-attr"><span class="hljs-attr">pandas</span></span> = super.pandas.overridePythonAttrs(old: {<span class="hljs-attr"><span class="hljs-attr">name="foo";});</span></span>
    };
  <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> pkgs.python38.override {<span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> packageOverrides;};

<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> python.withPackages(ps: [ps.pandas])).env
</pre><p>
       Using <code class="literal">nix-build</code> on this expression will build an environment that contains the package <code class="literal">pandas</code> but with the new name <code class="literal">foo</code>.
      </p><p>
       All packages in the package set will use the renamed package. A typical use case is to switch to another version of a certain package. For example, in the Nixpkgs repository we have multiple versions of <code class="literal">django</code> and <code class="literal">scipy</code>. In the following example we use a different version of <code class="literal">scipy</code> and create an environment that uses it. All packages in the Python package set will now use the updated <code class="literal">scipy</code> version.
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

( <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
    <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = self: super: {
      <span class="hljs-attr"><span class="hljs-attr">scipy</span></span> = super.scipy_0_17;
    };
  <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (pkgs.python38.override {<span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> packageOverrides;}).withPackages (ps: [ps.blaze])
).env
</pre><p>
       The requested package <code class="literal">blaze</code> depends on <code class="literal">pandas</code> which itself depends on <code class="literal">scipy</code>.
      </p><p>
       If you want the whole of Nixpkgs to use your modifications, then you can use <code class="literal">overlays</code> as explained in this manual. In the following example we build a <code class="literal">inkscape</code> using a different version of <code class="literal">numpy</code>.
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
  <span class="hljs-attr"><span class="hljs-attr">newpkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> pkgs.path { <span class="hljs-attr"><span class="hljs-attr">overlays</span></span> = [ (self: super: {
    <span class="hljs-attr"><span class="hljs-attr">python38</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
      <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = python-self: python-super: {
        <span class="hljs-attr"><span class="hljs-attr">numpy</span></span> = python-super.numpy_1_18;
      };
    <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> super.python38.override {<span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> packageOverrides;};
  } ) ]; };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> newpkgs.inkscape
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="python-setup.py-bdist_wheel-cannot-create-.whl" shape="rect"></a>15.19.3.3.&nbsp;<code class="literal">python setup.py bdist_wheel</code> cannot create .whl</h4></div></div></div><p>
       Executing <code class="literal">python setup.py bdist_wheel</code> in a <code class="literal">nix-shell</code>fails with
      </p><pre class="programlisting hljs" xml:space="preserve">ValueError: ZIP does not support timestamps before 1980
</pre><p>
       This is because files from the Nix store (which have a timestamp of the UNIX epoch of January 1, 1970) are included in the .ZIP, but .ZIP archives follow the DOS convention of counting timestamps from 1980.
      </p><p>
       The command <code class="literal">bdist_wheel</code> reads the <code class="literal">SOURCE_DATE_EPOCH</code> environment variable, which <code class="literal">nix-shell</code> sets to 1. Unsetting this variable or giving it a value corresponding to 1980 or later enables building wheels.
      </p><p>
       Use 1980 as timestamp:
      </p><pre class="programlisting hljs nix" xml:space="preserve">nix-shell --run <span class="hljs-string"><span class="hljs-string">"SOURCE_DATE_EPOCH=315532800 python3 setup.py bdist_wheel"</span></span>
</pre><p>
       or the current time:
      </p><pre class="programlisting hljs bash" xml:space="preserve">nix-shell --run <span class="hljs-string"><span class="hljs-string">"SOURCE_DATE_EPOCH=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(date +%s)</span></span></span><span class="hljs-string"> python3 setup.py bdist_wheel"</span></span>
</pre><p>
       or unset <code class="literal">SOURCE_DATE_EPOCH</code>:
      </p><pre class="programlisting hljs nix" xml:space="preserve">nix-shell --run <span class="hljs-string"><span class="hljs-string">"unset SOURCE_DATE_EPOCH; python3 setup.py bdist_wheel"</span></span>
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="install_data-data_files-problems" shape="rect"></a>15.19.3.4.&nbsp;<code class="literal">install_data</code> / <code class="literal">data_files</code> problems</h4></div></div></div><p>
       If you get the following error:
      </p><pre class="programlisting hljs bash" xml:space="preserve">could not create <span class="hljs-string"><span class="hljs-string">'/nix/store/6l1bvljpy8gazlsw2aw9skwwp4pmvyxw-python-2.7.8/etc'</span></span>:
Permission denied
</pre><p>
       This is a <a class="link" href="https://github.com/pypa/setuptools/issues/130" target="_top" shape="rect">known bug</a> in <code class="literal">setuptools</code>. Setuptools <code class="literal">install_data</code> does not respect <code class="literal">--prefix</code>. An example of such package using the feature is <code class="literal">pkgs/tools/X11/xpra/default.nix</code>.
      </p><p>
       As workaround install it as an extra <code class="literal">preInstall</code> step:
      </p><pre class="programlisting hljs bash" xml:space="preserve"><span class="hljs-variable"><span class="hljs-variable">${python.interpreter}</span></span> setup.py install_data --install-dir=<span class="hljs-variable"><span class="hljs-variable">$out</span></span> --root=<span class="hljs-variable"><span class="hljs-variable">$out</span></span>
sed -i <span class="hljs-string"><span class="hljs-string">'/ = data\_files/d'</span></span> setup.py
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="rationale-of-non-existent-global-site-packages" shape="rect"></a>15.19.3.5.&nbsp;Rationale of non-existent global site-packages</h4></div></div></div><p>
       On most operating systems a global <code class="literal">site-packages</code> is maintained. This however becomes problematic if you want to run multiple Python versions or have multiple versions of certain libraries for your projects. Generally, you would solve such issues by creating virtual environments using <code class="literal">virtualenv</code>.
      </p><p>
       On Nix each package has an isolated dependency tree which, in the case of Python, guarantees the right versions of the interpreter and libraries or packages are available. There is therefore no need to maintain a global <code class="literal">site-packages</code>.
      </p><p>
       If you want to create a Python environment for development, then the recommended method is to use <code class="literal">nix-shell</code>, either with or without the <code class="literal">python.buildEnv</code> function.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-consume-python-modules-using-pip-in-a-virtual-environment-like-i-am-used-to-on-other-operating-systems" shape="rect"></a>15.19.3.6.&nbsp;How to consume Python modules using pip in a virtual environment like I am used to on other Operating Systems?</h4></div></div></div><p>
       While this approach is not very idiomatic from Nix perspective, it can still be useful when dealing with pre-existing projects or in situations where it’s not feasible or desired to write derivations for all required dependencies.
      </p><p>
       This is an example of a <code class="literal">default.nix</code> for a <code class="literal">nix-shell</code>, which allows to consume a virtual environment created by <code class="literal">venv</code>, and install Python modules through <code class="literal">pip</code> the traditional way.
      </p><p>
       Create this <code class="literal">default.nix</code> file, together with a <code class="literal">requirements.txt</code> and simply execute <code class="literal">nix-shell</code>.
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; { };

<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pythonPackages</span></span> = python3Packages;
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> pkgs.mkShell <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"impurePythonEnv"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">venvDir</span></span> = <span class="hljs-string"><span class="hljs-string">"./.venv"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [
    <span class="hljs-comment"><span class="hljs-comment"># A Python interpreter including the 'venv' module is required to bootstrap</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># the environment.</span></span>
    pythonPackages.python

    <span class="hljs-comment"><span class="hljs-comment"># This execute some shell code to initialize a venv in $venvDir before</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># dropping into the shell</span></span>
    pythonPackages.venvShellHook

    <span class="hljs-comment"><span class="hljs-comment"># Those are dependencies that we would like to use from nixpkgs, which will</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># add them to PYTHONPATH and thus make them accessible from within the venv.</span></span>
    pythonPackages.numpy
    pythonPackages.requests

    <span class="hljs-comment"><span class="hljs-comment"># In this particular example, in order to compile any binary extensions they may</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># require, the Python modules listed in the hypothetical requirements.txt need</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># the following packages to be installed locally:</span></span>
    taglib
    openssl
    git
    libxml2
    libxslt
    libzip
    zlib
  ];

  <span class="hljs-comment"><span class="hljs-comment"># Run this command, only after creating the virtual environment</span></span>
  <span class="hljs-attr"><span class="hljs-attr">postVenvCreation</span></span> = <span class="hljs-string"><span class="hljs-string">''
    unset SOURCE_DATE_EPOCH
    pip install -r requirements.txt
  ''</span></span>;

  <span class="hljs-comment"><span class="hljs-comment"># Now we can execute any commands within the virtual environment.</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># This is optional and can be left out to run pip manually.</span></span>
  <span class="hljs-attr"><span class="hljs-attr">postShellHook</span></span> = <span class="hljs-string"><span class="hljs-string">''
    # allow pip to install wheels
    unset SOURCE_DATE_EPOCH
  ''</span></span>;

}
</pre><p>
       In case the supplied venvShellHook is insufficient, or when Python 2 support is needed, you can define your own shell hook and adapt to your needs like in the following example:
      </p><pre class="programlisting hljs bash" xml:space="preserve">with import &lt;nixpkgs&gt; { };

<span class="hljs-built_in"><span class="hljs-built_in">let</span></span>
  venvDir = <span class="hljs-string"><span class="hljs-string">"./.venv"</span></span>;
  pythonPackages = python3Packages;
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> pkgs.mkShell rec {
  name = <span class="hljs-string"><span class="hljs-string">"impurePythonEnv"</span></span>;
  buildInputs = [
    pythonPackages.python
    <span class="hljs-comment"><span class="hljs-comment"># Needed when using python 2.7</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># pythonPackages.virtualenv</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
  ];

  <span class="hljs-comment"><span class="hljs-comment"># This is very close to how venvShellHook is implemented, but</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># adapted to use 'virtualenv'</span></span>
  shellHook = <span class="hljs-string"><span class="hljs-string">''</span></span>
    SOURCE_DATE_EPOCH=$(date +%s)

    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -d <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${venvDir}</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
      <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Skipping venv creation, '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${venvDir}</span></span></span><span class="hljs-string">' already exists"</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
      <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Creating new venv environment in path: '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${venvDir}</span></span></span><span class="hljs-string">'"</span></span>
      <span class="hljs-comment"><span class="hljs-comment"># Note that the module venv was only introduced in python 3, so for 2.7</span></span>
      <span class="hljs-comment"><span class="hljs-comment"># this needs to be replaced with a call to virtualenv</span></span>
      <span class="hljs-variable"><span class="hljs-variable">${pythonPackages.python.interpreter}</span></span> -m venv <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${venvDir}</span></span></span><span class="hljs-string">"</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span>

    <span class="hljs-comment"><span class="hljs-comment"># Under some circumstances it might be necessary to add your virtual</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># environment to PYTHONPATH, which you can do here too;</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># PYTHONPATH=$PWD/${venvDir}/${pythonPackages.python.sitePackages}/:$PYTHONPATH</span></span>

    <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${venvDir}</span></span></span><span class="hljs-string">/bin/activate"</span></span>

    <span class="hljs-comment"><span class="hljs-comment"># As in the previous example, this is optional.</span></span>
    pip install -r requirements.txt
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
}
</pre><p>
       Note that the <code class="literal">pip install</code> is an imperative action. So every time <code class="literal">nix-shell</code> is executed it will attempt to download the Python modules listed in requirements.txt. However these will be cached locally within the <code class="literal">virtualenv</code> folder and not downloaded again.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-a-python-package-from-configuration.nix" shape="rect"></a>15.19.3.7.&nbsp;How to override a Python package from <code class="literal">configuration.nix</code>?</h4></div></div></div><p>
       If you need to change a package’s attribute(s) from <code class="literal">configuration.nix</code> you could do:
      </p><pre class="programlisting hljs nix" xml:space="preserve">  nixpkgs.config.<span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = super: {
    <span class="hljs-attr"><span class="hljs-attr">python</span></span> = super.python.override {
      <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = python-self: python-super: {
        <span class="hljs-attr"><span class="hljs-attr">zerobin</span></span> = python-super.zerobin.overrideAttrs (oldAttrs: {
          <span class="hljs-attr"><span class="hljs-attr">src</span></span> = super.fetchgit {
            <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/sametmax/0bin"</span></span>;
            <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"a344dbb18fe7a855d0742b9a1cede7ce423b34ec"</span></span>;
            <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"16d769kmnrpbdr0ph0whyf4yff5df6zi4kmwx7sz1d3r6c8p6xji"</span></span>;
          };
        });
      };
    };
  };
</pre><p>
       <code class="literal">pythonPackages.zerobin</code> is now globally overridden. All packages and also the <code class="literal">zerobin</code> NixOS service use the new definition. Note that <code class="literal">python-super</code> refers to the old package set and <code class="literal">python-self</code> to the new, overridden version.
      </p><p>
       To modify only a Python package set instead of a whole Python derivation, use this snippet:
      </p><pre class="programlisting hljs nix" xml:space="preserve">  <span class="hljs-attr"><span class="hljs-attr">myPythonPackages</span></span> = pythonPackages.override {
    <span class="hljs-attr"><span class="hljs-attr">overrides</span></span> = self: super: {
      <span class="hljs-attr"><span class="hljs-attr">zerobin</span></span> = ...;
    };
  }
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-a-python-package-using-overlays" shape="rect"></a>15.19.3.8.&nbsp;How to override a Python package using overlays?</h4></div></div></div><p>
       Use the following overlay template:
      </p><pre class="programlisting hljs nix" xml:space="preserve">self: super: {
  <span class="hljs-attr"><span class="hljs-attr">python</span></span> = super.python.override {
    <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = python-self: python-super: {
      <span class="hljs-attr"><span class="hljs-attr">zerobin</span></span> = python-super.zerobin.overrideAttrs (oldAttrs: {
        <span class="hljs-attr"><span class="hljs-attr">src</span></span> = super.fetchgit {
          <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/sametmax/0bin"</span></span>;
          <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"a344dbb18fe7a855d0742b9a1cede7ce423b34ec"</span></span>;
          <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"16d769kmnrpbdr0ph0whyf4yff5df6zi4kmwx7sz1d3r6c8p6xji"</span></span>;
        };
      });
    };
  };
}
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-use-intels-mkl-with-numpy-and-scipy" shape="rect"></a>15.19.3.9.&nbsp;How to use Intel’s MKL with numpy and scipy?</h4></div></div></div><p>
       MKL can be configured using an overlay. See the section <span class="quote">“<span class="quote"><a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-overlays-alternatives-blas-lapack" title="3.3.1. BLAS/LAPACK" shape="rect">Using overlays to configure alternatives</a></span>”</span>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="what-inputs-do-setup_requires-install_requires-and-tests_require-map-to" shape="rect"></a>15.19.3.10.&nbsp;What inputs do <code class="literal">setup_requires</code>, <code class="literal">install_requires</code> and <code class="literal">tests_require</code> map to?</h4></div></div></div><p>
       In a <code class="literal">setup.py</code> or <code class="literal">setup.cfg</code> it is common to declare dependencies:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="literal">setup_requires</code> corresponds to <code class="literal">nativeBuildInputs</code>
        </p></li><li class="listitem"><p>
         <code class="literal">install_requires</code> corresponds to <code class="literal">propagatedBuildInputs</code>
        </p></li><li class="listitem"><p>
         <code class="literal">tests_require</code> corresponds to <code class="literal">checkInputs</code>
        </p></li></ul></div></section></section><section class="section"><div class="titlepage"><div><div><h3 id="contributing" class="title">15.19.4.&nbsp;Contributing<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#contributing" aria-label="Anchor link for: contributing" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="contributing-guidelines" shape="rect"></a>15.19.4.1.&nbsp;Contributing guidelines</h4></div></div></div><p>
       Following rules are desired to be respected:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         Python libraries are called from <code class="literal">python-packages.nix</code> and packaged with <code class="literal">buildPythonPackage</code>. The expression of a library should be in <code class="literal">pkgs/development/python-modules/&lt;name&gt;/default.nix</code>. Libraries in <code class="literal">pkgs/top-level/python-packages.nix</code> are sorted quasi-alphabetically to avoid merge conflicts.
        </p></li><li class="listitem"><p>
         Python applications live outside of <code class="literal">python-packages.nix</code> and are packaged with <code class="literal">buildPythonApplication</code>.
        </p></li><li class="listitem"><p>
         Make sure libraries build for all Python interpreters.
        </p></li><li class="listitem"><p>
         By default we enable tests. Make sure the tests are found and, in the case of libraries, are passing for all interpreters. If certain tests fail they can be disabled individually. Try to avoid disabling the tests altogether. In any case, when you disable tests, leave a comment explaining why.
        </p></li><li class="listitem"><p>
         Commit names of Python libraries should reflect that they are Python libraries, so write for example <code class="literal">pythonPackages.numpy: 1.11 -&gt; 1.12</code>.
        </p></li><li class="listitem"><p>
         Attribute names in <code class="literal">python-packages.nix</code> should be normalized according to <a class="link" href="https://www.python.org/dev/peps/pep-0503/#normalized-names" target="_top" shape="rect">PEP 0503</a>. This means that characters should be converted to lowercase and <code class="literal">.</code> and <code class="literal">_</code> should be replaced by a single <code class="literal">-</code> (foo-bar-baz instead of Foo__Bar.baz )
        </p></li></ul></div></section></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-qt" class="title" style="clear: both">15.20.&nbsp;Qt<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-qt" aria-label="Anchor link for: sec language qt" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     This section describes the differences between Nix expressions for Qt libraries and applications and Nix expressions for other C++ software. Some knowledge of the latter is assumed. There are primarily two problems which the Qt infrastructure is designed to address: ensuring consistent versioning of all dependencies and finding dependencies at runtime.
    </p><div class="example"><a id="qt-default-nix" shape="rect"></a><p class="title"><strong>Example&nbsp;15.8.&nbsp;Nix expression for a Qt package (<code class="filename">default.nix</code>)</strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">{ mkDerivation, lib, qtbase }: <a id="qt-default-nix-co-1" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>

mkDerivation { <a id="qt-default-nix-co-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"myapp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ qtbase ]; <a id="qt-default-nix-co-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>
}
</pre></div></div><br class="example-break" clear="none"><br><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#qt-default-nix-co-1" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
       Import <code class="literal">mkDerivation</code> and Qt (such as <code class="literal">qtbase</code> modules directly. <span class="emphasis"><em>Do not</em></span> import Qt package sets; the Qt versions of dependencies may not be coherent, causing build and runtime failures.
      </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#qt-default-nix-co-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
       Use <code class="literal">mkDerivation</code> instead of <code class="literal">stdenv.mkDerivation</code>. <code class="literal">mkDerivation</code> is a wrapper around <code class="literal">stdenv.mkDerivation</code> which applies some Qt-specific settings. This deriver accepts the same arguments as <code class="literal">stdenv.mkDerivation</code>; refer to <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" title="Chapter 6. The Standard Environment" shape="rect">Chapter&nbsp;6, <em>The Standard Environment</em></a> for details.
      </p><p>
       To use another deriver instead of <code class="literal">stdenv.mkDerivation</code>, use <code class="literal">mkDerivationWith</code>:
</p><pre class="programlisting hljs nix" xml:space="preserve">mkDerivationWith myDeriver {
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
}
</pre><p>
       If you cannot use <code class="literal">mkDerivationWith</code>, please refer to <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#qt-runtime-dependencies" title="Locating runtime dependencies" shape="rect">Locating runtime dependencies</a>.
      </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#qt-default-nix-co-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
       <code class="literal">mkDerivation</code> accepts the same arguments as <code class="literal">stdenv.mkDerivation</code>, such as <code class="literal">buildInputs</code>.
      </p></td></tr></tbody></table></div><p><a id="qt-runtime-dependencies" shape="rect"></a><strong>Locating runtime dependencies.&nbsp;</strong>
      Qt applications need to be wrapped to find runtime dependencies. If you cannot use <code class="literal">mkDerivation</code> or <code class="literal">mkDerivationWith</code> above, include <code class="literal">wrapQtAppsHook</code> in <code class="literal">nativeBuildInputs</code>:
</p><pre class="programlisting hljs nix" xml:space="preserve">stdenv.mkDerivation {
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  <span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [ wrapQtAppsHook ];
}
</pre><p>
     </p><p>
     Entries added to <code class="literal">qtWrapperArgs</code> are used to modify the wrappers created by <code class="literal">wrapQtAppsHook</code>. The entries are passed as arguments to <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" shape="rect">
       <code class="function">wrapProgram</code> <em class="replaceable"><code>executable</code></em> <em class="replaceable"><code>makeWrapperArgs</code></em>
      </a>.
</p><pre class="programlisting hljs nix" xml:space="preserve">mkDerivation {
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  <span class="hljs-attr"><span class="hljs-attr">qtWrapperArgs</span></span> = [ <span class="hljs-string"><span class="hljs-string">''--prefix PATH : /path/to/bin''</span></span> ];
}
</pre><p>
    </p><p>
     Set <code class="literal">dontWrapQtApps</code> to stop applications from being wrapped automatically. It is required to wrap applications manually with <code class="literal">wrapQtApp</code>, using the syntax of <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#fun-wrapProgram" shape="rect">
       <code class="function">wrapProgram</code> <em class="replaceable"><code>executable</code></em> <em class="replaceable"><code>makeWrapperArgs</code></em>
      </a>:
</p><pre class="programlisting hljs bash" xml:space="preserve">mkDerivation {
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  dontWrapQtApps = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  preFixup = <span class="hljs-string"><span class="hljs-string">''</span></span>
      wrapQtApp <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$out</span></span></span><span class="hljs-string">/bin/myapp"</span></span> --prefix PATH : /path/to/bin
  <span class="hljs-string"><span class="hljs-string">''</span></span>;
}
</pre><p>
    </p><div class="alert alert-info"><strong>Note:</strong> 
      <code class="literal">wrapQtAppsHook</code> ignores files that are non-ELF executables. This means that scripts won't be automatically wrapped so you'll need to manually wrap them as previously mentioned. An example of when you'd always need to do this is with Python applications that use PyQT.
     </div><p>
     Libraries are built with every available version of Qt. Use the <code class="literal">meta.broken</code> attribute to disable the package for unsupported Qt versions:
</p><pre class="programlisting hljs nix" xml:space="preserve">mkDerivation {
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  <span class="hljs-comment"><span class="hljs-comment"># Disable this library with Qt &lt; 5.9.0</span></span>
  meta.<span class="hljs-attr"><span class="hljs-attr">broken</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">builtins</span></span>.compareVersions qtbase.version <span class="hljs-string"><span class="hljs-string">"5.9.0"</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>;
}
</pre><p>
    </p><p><strong>Adding a library to Nixpkgs.&nbsp;</strong>
      Add a Qt library to <code class="filename">all-packages.nix</code> by adding it to the collection inside <code class="literal">mkLibsForQt5</code>. This ensures that the library is built with every available version of Qt as needed.
      </p><div class="example"><a id="qt-library-all-packages-nix" shape="rect"></a><p class="title"><strong>Example&nbsp;15.9.&nbsp;Adding a Qt library to <code class="filename">all-packages.nix</code></strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  <span class="hljs-attr"><span class="hljs-attr">mkLibsForQt5</span></span> = self: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self; {
    <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

    <span class="hljs-attr"><span class="hljs-attr">mylib</span></span> = callPackage ../path/to/mylib {};
  };

  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
}
</pre></div></div><p><br class="example-break" clear="none"><br>
     </p><p><strong>Adding an application to Nixpkgs.&nbsp;</strong>
      Add a Qt application to <code class="filename">all-packages.nix</code> using <code class="literal">libsForQt5.callPackage</code> instead of the usual <code class="literal">callPackage</code>. The former ensures that all dependencies are built with the same version of Qt.
      </p><div class="example"><a id="qt-application-all-packages-nix" shape="rect"></a><p class="title"><strong>Example&nbsp;15.10.&nbsp;Adding a Qt application to <code class="filename">all-packages.nix</code></strong></p><div class="example-contents"><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>

  <span class="hljs-attr"><span class="hljs-attr">myapp</span></span> = libsForQt5.callPackage ../path/to/myapp/ {};

  <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
}
</pre></div></div><p><br class="example-break" clear="none"><br>
     </p></section><section class="section"><div class="titlepage"><div><div><h2 id="r" class="title" style="clear: both">15.21.&nbsp;R<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#r" aria-label="Anchor link for: r" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="installation" class="title">15.21.1.&nbsp;Installation<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#installation" aria-label="Anchor link for: installation" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Define an environment for R that contains all the libraries that you’d like to use by adding the following snippet to your $HOME/.config/nixpkgs/config.nix file:
     </p><pre class="programlisting hljs nix" xml:space="preserve">{
    <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = super: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">self</span></span> = super.pkgs; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
    {

        <span class="hljs-attr"><span class="hljs-attr">rEnv</span></span> = super.rWrapper.override {
            <span class="hljs-attr"><span class="hljs-attr">packages</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self.rPackages; [
                devtools
                ggplot2
                reshape2
                yaml
                optparse
                ];
        };
    };
}
</pre><p>
      Then you can use <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -iA rEnv</code> to install it into your user profile. The set of available libraries can be discovered by running the command <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -qaP -A rPackages</code>. The first column from that output is the name that has to be passed to rWrapper in the code snipped above.
     </p><p>
      However, if you’d like to add a file to your project source to make the environment available for other contributors, you can create a <code class="literal">default.nix</code> file like so:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
  <span class="hljs-attr"><span class="hljs-attr">stdenv</span></span> = pkgs.stdenv;
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; {
  <span class="hljs-attr"><span class="hljs-attr">myProject</span></span> = stdenv.mkDerivation {
    <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"myProject"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"1"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">src</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pkgs.lib.inNixShell <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nix;

    <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> rPackages; [
      R
      ggplot2
      knitr
    ];
  };
}
</pre><p>
      and then run <code class="literal">nix-shell .</code> to be dropped into a shell with those packages available.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="rstudio" class="title">15.21.2.&nbsp;RStudio<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#rstudio" aria-label="Anchor link for: rstudio" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      RStudio uses a standard set of packages and ignores any custom R environments or installed packages you may have. To create a custom environment, see <code class="literal">rstudioWrapper</code>, which functions similarly to <code class="literal">rWrapper</code>:
     </p><pre class="programlisting hljs nix" xml:space="preserve">{
    <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = super: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">self</span></span> = super.pkgs; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
    {

        <span class="hljs-attr"><span class="hljs-attr">rstudioEnv</span></span> = super.rstudioWrapper.override {
            <span class="hljs-attr"><span class="hljs-attr">packages</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self.rPackages; [
                dplyr
                ggplot2
                reshape2
                ];
        };
    };
}
</pre><p>
      Then like above, <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -iA rstudioEnv</code> will install this into your user profile.
     </p><p>
      Alternatively, you can create a self-contained <code class="literal">shell.nix</code> without the need to modify any configuration files:
     </p><pre class="programlisting hljs nix" xml:space="preserve">{ pkgs ? <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {}
}:

pkgs.rstudioWrapper.override {
  <span class="hljs-attr"><span class="hljs-attr">packages</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.rPackages; [ dplyr ggplot2 reshape2 ];
}
</pre><p>
      Executing <code class="literal">nix-shell</code> will then drop you into an environment equivalent to the one above. If you need additional packages just add them to the list and re-enter the shell.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="updating-the-package-set" class="title">15.21.3.&nbsp;Updating the package set<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#updating-the-package-set" aria-label="Anchor link for: updating the package set" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><pre class="programlisting hljs" xml:space="preserve">nix-shell generate-shell.nix

Rscript generate-r-packages.R cran  &gt; cran-packages.nix.new
mv cran-packages.nix.new cran-packages.nix

Rscript generate-r-packages.R bioc  &gt; bioc-packages.nix.new
mv bioc-packages.nix.new bioc-packages.nix
</pre><p>
      <code class="literal">generate-r-packages.R &lt;repo&gt;</code> reads <code class="literal">&lt;repo&gt;-packages.nix</code>, therefor the renaming.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="testing-if-the-nix-expression-could-be-evaluated" class="title">15.21.4.&nbsp;Testing if the Nix-expression could be evaluated<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#testing-if-the-nix-expression-could-be-evaluated" aria-label="Anchor link for: testing if the nix expression could be evaluated" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><pre class="programlisting hljs bash" xml:space="preserve">nix-build <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-evaluation.nix --dry-run
</pre><p>
      If this exits fine, the expression is ok. If not, you have to edit <code class="literal">default.nix</code>
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-ruby" class="title" style="clear: both">15.22.&nbsp;Ruby<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-ruby" aria-label="Anchor link for: sec language ruby" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     There currently is support to bundle applications that are packaged as Ruby gems. The utility "bundix" allows you to write a <code class="filename">Gemfile</code>, let bundler create a <code class="filename">Gemfile.lock</code>, and then convert this into a nix expression that contains all Gem dependencies automatically.
    </p><p>
     For example, to package sensu, we did:
    </p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>cd pkgs/servers/monitoring
<code class="prompt">$ </code>mkdir sensu
<code class="prompt">$ </code>cd sensu
<code class="prompt">$ </code>cat &gt; Gemfile
source 'https://rubygems.org'
gem 'sensu'
<code class="prompt">$ </code>$(nix-build '&lt;nixpkgs&gt;' -A bundix --no-out-link)/bin/bundix --magic
<code class="prompt">$ </code>cat &gt; default.nix
{ lib, bundlerEnv, ruby }:

bundlerEnv <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"sensu-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${version}</span></span></span><span class="hljs-string">"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = (<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> gemset).sensu.version;
  <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> ruby;
  <span class="hljs-comment"><span class="hljs-comment"># expects Gemfile, Gemfile.lock and gemset.nix in the same directory</span></span>
  <span class="hljs-attr"><span class="hljs-attr">gemdir</span></span> = ./.;

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"A monitoring framework that aims to be simple, malleable, and scalable"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span>    = <span class="hljs-string"><span class="hljs-string">"http://sensuapp.org/"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span>     = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> licenses; mit;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ theuni ];
    <span class="hljs-attr"><span class="hljs-attr">platforms</span></span>   = platforms.unix;
  };
}
</pre><p>
     Please check in the <code class="filename">Gemfile</code>, <code class="filename">Gemfile.lock</code> and the <code class="filename">gemset.nix</code> so future updates can be run easily.
    </p><p>
     Updating Ruby packages can then be done like this:
    </p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> pkgs/servers/monitoring/sensu
<code class="prompt">$ </code>nix-shell -p bundler --run <span class="hljs-string"><span class="hljs-string">'bundle lock --update'</span></span>
<code class="prompt">$ </code>nix-shell -p bundix --run <span class="hljs-string"><span class="hljs-string">'bundix'</span></span>
</pre><p>
     For tools written in Ruby - i.e. where the desire is to install a package and then execute e.g. <span class="command"><strong>rake</strong></span> at the command line, there is an alternative builder called <code class="literal">bundlerApp</code>. Set up the <code class="filename">gemset.nix</code> the same way, and then, for example:
    </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, bundlerApp }:

bundlerApp {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"corundum"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">gemdir</span></span> = ./.;
  <span class="hljs-attr"><span class="hljs-attr">exes</span></span> = [ <span class="hljs-string"><span class="hljs-string">"corundum-skel"</span></span> ];

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"Tool and libraries for maintaining Ruby gems."</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span>    = <span class="hljs-string"><span class="hljs-string">"https://github.com/nyarly/corundum"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span>     = licenses.mit;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = [ maintainers.nyarly ];
    <span class="hljs-attr"><span class="hljs-attr">platforms</span></span>   = platforms.unix;
  };
}
</pre><p>
     The chief advantage of <code class="literal">bundlerApp</code> over <code class="literal">bundlerEnv</code> is the executables introduced in the environment are precisely those selected in the <code class="literal">exes</code> list, as opposed to <code class="literal">bundlerEnv</code> which adds all the executables made available by gems in the gemset, which can mean e.g. <span class="command"><strong>rspec</strong></span> or <span class="command"><strong>rake</strong></span> in unpredictable versions available from various packages.
    </p><p>
     Resulting derivations for both builders also have two helpful attributes, <code class="literal">env</code> and <code class="literal">wrappedRuby</code>. The first one allows one to quickly drop into <span class="command"><strong>nix-shell</strong></span> with the specified environment present. E.g. <span class="command"><strong>nix-shell -A sensu.env</strong></span> would give you an environment with Ruby preset so it has all the libraries necessary for <code class="literal">sensu</code> in its paths. The second one can be used to make derivations from custom Ruby scripts which have <code class="filename">Gemfile</code>s with their dependencies specified. It is a derivation with <span class="command"><strong>ruby</strong></span> wrapped so it can find all the needed dependencies. For example, to make a derivation <code class="literal">my-script</code> for a <code class="filename">my-script.rb</code> (which should be placed in <code class="filename">bin</code>) you should run <span class="command"><strong>bundix</strong></span> as specified above and then use <code class="literal">bundlerEnv</code> like this:
    </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">env</span></span> = bundlerEnv {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-script-env"</span></span>;

  <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> ruby;
  <span class="hljs-attr"><span class="hljs-attr">gemfile</span></span> = ./Gemfile;
  <span class="hljs-attr"><span class="hljs-attr">lockfile</span></span> = ./Gemfile.lock;
  <span class="hljs-attr"><span class="hljs-attr">gemset</span></span> = ./gemset.nix;
};

<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"my-script"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ env.wrappedRuby ];
  <span class="hljs-attr"><span class="hljs-attr">script</span></span> = ./my-script.rb;
  <span class="hljs-attr"><span class="hljs-attr">buildCommand</span></span> = <span class="hljs-string"><span class="hljs-string">''
    install -D -m755 $script $out/bin/my-script
    patchShebangs $out/bin/my-script
  ''</span></span>;
}
</pre></section><section class="section"><div class="titlepage"><div><div><h2 id="rust" class="title" style="clear: both">15.23.&nbsp;Rust<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#rust" aria-label="Anchor link for: rust" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     To install the rust compiler and cargo put
    </p><pre class="programlisting hljs" xml:space="preserve">rustc
cargo
</pre><p>
     into the <code class="literal">environment.systemPackages</code> or bring them into scope with <code class="literal">nix-shell -p rustc cargo</code>.
    </p><p>
     For daily builds (beta and nightly) use either rustup from nixpkgs or use the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#using-the-rust-nightlies-overlay" title="15.23.4. Using the Rust nightlies overlay" shape="rect">Rust nightlies overlay</a>.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="compiling-rust-applications-with-cargo" class="title">15.23.1.&nbsp;Compiling Rust applications with Cargo<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#compiling-rust-applications-with-cargo" aria-label="Anchor link for: compiling rust applications with cargo" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Rust applications are packaged by using the <code class="literal">buildRustPackage</code> helper from <code class="literal">rustPlatform</code>:
     </p><pre class="programlisting hljs nix" xml:space="preserve">rustPlatform.buildRustPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"ripgrep"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"11.0.2"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
    <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"BurntSushi"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = pname;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = version;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1iga3320mgi7m853la55xip514a3chqsdi1a1rwv25lr9b1p7vd3"</span></span>;
  };

  <span class="hljs-attr"><span class="hljs-attr">cargoSha256</span></span> = <span class="hljs-string"><span class="hljs-string">"17ldqr3asrdcsh4l29m3b5r37r5d0b3npq1lrgjmxb6vlx6a36qh"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> stdenv.lib; {
    <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"A fast line-oriented regex search tool, similar to ag and ack"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">homepage</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/BurntSushi/ripgrep"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.unlicense;
    <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = [ maintainers.tailhook ];
  };
}
</pre><p>
      <code class="literal">buildRustPackage</code> requires a <code class="literal">cargoSha256</code> attribute which is computed over all crate sources of this package. Currently it is obtained by inserting a fake checksum into the expression and building the package once. The correct checksum can be then take from the failed build.
     </p><p>
      Per the instructions in the <a class="link" href="https://doc.rust-lang.org/cargo/guide/cargo-toml-vs-cargo-lock.html" target="_top" shape="rect">Cargo Book</a> best practices guide, Rust applications should always commit the <code class="literal">Cargo.lock</code> file in git to ensure a reproducible build. However, a few packages do not, and Nix depends on this file, so if it missing you can use <code class="literal">cargoPatches</code> to apply it in the <code class="literal">patchPhase</code>. Consider sending a PR upstream with a note to the maintainer describing why it’s important to include in the application.
     </p><p>
      The fetcher will verify that the <code class="literal">Cargo.lock</code> file is in sync with the <code class="literal">src</code> attribute, and fail the build if not. It will also will compress the vendor directory into a tar.gz archive.
     </p><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="building-a-crate-for-a-different-target" shape="rect"></a>15.23.1.1.&nbsp;Building a crate for a different target</h4></div></div></div><p>
       To build your crate with a different cargo <code class="literal">--target</code> simply specify the <code class="literal">target</code> attribute:
      </p><pre class="programlisting hljs nix" xml:space="preserve">pkgs.rustPlatform.buildRustPackage {
  (...)
  <span class="hljs-attr"><span class="hljs-attr">target</span></span> = <span class="hljs-string"><span class="hljs-string">"x86_64-fortanix-unknown-sgx"</span></span>;
}
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="running-package-tests" shape="rect"></a>15.23.1.2.&nbsp;Running package tests</h4></div></div></div><p>
       When using <code class="literal">buildRustPackage</code>, the <code class="literal">checkPhase</code> is enabled by default and runs <code class="literal">cargo test</code> on the package to build. To make sure that we don’t compile the sources twice and to actually test the artifacts that will be used at runtime, the tests will be ran in the <code class="literal">release</code> mode by default.
      </p><p>
       However, in some cases the test-suite of a package doesn’t work properly in the <code class="literal">release</code> mode. For these situations, the mode for <code class="literal">checkPhase</code> can be changed like so:
      </p><pre class="programlisting hljs nix" xml:space="preserve">rustPlatform.buildRustPackage {
  <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>
  <span class="hljs-attr"><span class="hljs-attr">checkType</span></span> = <span class="hljs-string"><span class="hljs-string">"debug"</span></span>;
}
</pre><p>
       Please note that the code will be compiled twice here: once in <code class="literal">release</code> mode for the <code class="literal">buildPhase</code>, and again in <code class="literal">debug</code> mode for the <code class="literal">checkPhase</code>.
      </p><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="tests-relying-on-the-structure-of-the-target-directory" shape="rect"></a>15.23.1.2.1.&nbsp;Tests relying on the structure of the <code class="literal">target/</code> directory</h5></div></div></div><p>
        Some tests may rely on the structure of the <code class="literal">target/</code> directory. Those tests are likely to fail because we use <code class="literal">cargo --target</code> during the build. This means that the artifacts <a class="link" href="https://doc.rust-lang.org/cargo/guide/build-cache.html" target="_top" shape="rect">are stored in <code class="literal">target/&lt;architecture&gt;/release/</code></a>, rather than in <code class="literal">target/release/</code>.
       </p><p>
        This can only be worked around by patching the affected tests accordingly.
       </p></section><section class="section"><div class="titlepage"><div><div><h5 class="title"><a id="disabling-package-tests" shape="rect"></a>15.23.1.2.2.&nbsp;Disabling package-tests</h5></div></div></div><p>
        In some instances, it may be necessary to disable testing altogether (with <code class="literal">doCheck = false;</code>):
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          If no tests exist – the <code class="literal">checkPhase</code> should be explicitly disabled to skip unnecessary build steps to speed up the build.
         </p></li><li class="listitem"><p>
          If tests are highly impure (e.g.&nbsp;due to network usage).
         </p></li></ul></div><p>
        There will obviously be some corner-cases not listed above where it’s sensible to disable tests. The above are just guidelines, and exceptions may be granted on a case-by-case basis.
       </p><p>
        However, please check if it’s possible to disable a problematic subset of the test suite and leave a comment explaining your reasoning.
       </p></section></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="building-a-package-in-debug-mode" shape="rect"></a>15.23.1.3.&nbsp;Building a package in <code class="literal">debug</code> mode</h4></div></div></div><p>
       By default, <code class="literal">buildRustPackage</code> will use <code class="literal">release</code> mode for builds. If a package should be built in <code class="literal">debug</code> mode, it can be configured like so:
      </p><pre class="programlisting hljs nix" xml:space="preserve">rustPlatform.buildRustPackage {
  <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>
  <span class="hljs-attr"><span class="hljs-attr">buildType</span></span> = <span class="hljs-string"><span class="hljs-string">"debug"</span></span>;
}
</pre><p>
       In this scenario, the <code class="literal">checkPhase</code> will be ran in <code class="literal">debug</code> mode as well.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="custom-buildinstall-procedures" shape="rect"></a>15.23.1.4.&nbsp;Custom <code class="literal">build</code>/<code class="literal">install</code>-procedures</h4></div></div></div><p>
       Some packages may use custom scripts for building/installing, e.g.&nbsp;with a <code class="literal">Makefile</code>. In these cases, it’s recommended to override the <code class="literal">buildPhase</code>/<code class="literal">installPhase</code>/<code class="literal">checkPhase</code>.
      </p><p>
       Otherwise, some steps may fail because of the modified directory structure of <code class="literal">target/</code>.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="building-a-crate-with-an-absent-or-out-of-date-cargo.lock-file" shape="rect"></a>15.23.1.5.&nbsp;Building a crate with an absent or out-of-date Cargo.lock file</h4></div></div></div><p>
       <code class="literal">buildRustPackage</code> needs a <code class="literal">Cargo.lock</code> file to get all dependencies in the source code in a reproducible way. If it is missing or out-of-date one can use the <code class="literal">cargoPatches</code> attribute to update or add it.
      </p><pre class="programlisting hljs nix" xml:space="preserve">{ lib, rustPlatform, fetchFromGitHub }:

rustPlatform.buildRustPackage <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  (...)
  <span class="hljs-attr"><span class="hljs-attr">cargoPatches</span></span> = [
    <span class="hljs-comment"><span class="hljs-comment"># a patch file to add/update Cargo.lock in the source code</span></span>
    ./add-Cargo.lock.patch
  ];
}
</pre></section></section><section class="section"><div class="titlepage"><div><div><h3 id="compiling-rust-crates-using-nix-instead-of-cargo" class="title">15.23.2.&nbsp;Compiling Rust crates using Nix instead of Cargo<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#compiling-rust-crates-using-nix-instead-of-cargo" aria-label="Anchor link for: compiling rust crates using nix instead of cargo" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="simple-operation" shape="rect"></a>15.23.2.1.&nbsp;Simple operation</h4></div></div></div><p>
       When run, <code class="literal">cargo build</code> produces a file called <code class="literal">Cargo.lock</code>, containing pinned versions of all dependencies. Nixpkgs contains a tool called <code class="literal">carnix</code> (<code class="literal">nix-env -iA nixos.carnix</code>), which can be used to turn a <code class="literal">Cargo.lock</code> into a Nix expression.
      </p><p>
       That Nix expression calls <code class="literal">rustc</code> directly (hence bypassing Cargo), and can be used to compile a crate and all its dependencies. Here is an example for a minimal <code class="literal">hello</code> crate:
      </p><pre class="programlisting hljs bash" xml:space="preserve">$ cargo new hello
$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> hello
$ cargo build
 Compiling hello v0.1.0 (file:///tmp/hello)
  Finished dev [unoptimized + debuginfo] target(s) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.20 secs
$ carnix -o hello.nix --src ./. Cargo.lock --standalone
$ nix-build hello.nix -A hello_0_1_0
</pre><p>
       Now, the file produced by the call to <code class="literal">carnix</code>, called <code class="literal">hello.nix</code>, looks like:
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment"># Generated by carnix 0.6.5: carnix -o hello.nix --src ./. Cargo.lock --standalone</span></span>
{ lib, stdenv, buildRustCrate, fetchgit }:
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">kernel</span></span> = stdenv.buildPlatform.parsed.kernel.name;
    <span class="hljs-comment"><span class="hljs-comment"># ... (content skipped)</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">hello</span></span> = f: hello_0_1_0 { <span class="hljs-attr"><span class="hljs-attr">features</span></span> = hello_0_1_0_features { <span class="hljs-attr"><span class="hljs-attr">hello_0_1_0</span></span> = f; }; };
  <span class="hljs-attr"><span class="hljs-attr">hello_0_1_0_</span></span> = { dependencies?[], buildDependencies?[], features?[] }: buildRustCrate {
    <span class="hljs-attr"><span class="hljs-attr">crateName</span></span> = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">authors</span></span> = [ <span class="hljs-string"><span class="hljs-string">"pe@pijul.org &lt;pe@pijul.org&gt;"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">src</span></span> = ./.;
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> dependencies buildDependencies features;
  };
  <span class="hljs-attr"><span class="hljs-attr">hello_0_1_0</span></span> = { features?(hello_0_1_0_features {}) }: hello_0_1_0_ {};
  <span class="hljs-attr"><span class="hljs-attr">hello_0_1_0_features</span></span> = f: updateFeatures f (<span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
        hello_0_1_0.<span class="hljs-attr"><span class="hljs-attr">default</span></span> = (f.hello_0_1_0.default <span class="hljs-literal"><span class="hljs-literal">or</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
    }) [ ];
}
</pre><p>
       In particular, note that the argument given as <code class="literal">--src</code> is copied verbatim to the source. If we look at a more complicated dependencies, for instance by adding a single line <code class="literal">libc="*"</code> to our <code class="literal">Cargo.toml</code>, we first need to run <code class="literal">cargo build</code> to update the <code class="literal">Cargo.lock</code>. Then, <code class="literal">carnix</code> needs to be run again, and produces the following nix file:
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment"># Generated by carnix 0.6.5: carnix -o hello.nix --src ./. Cargo.lock --standalone</span></span>
{ lib, stdenv, buildRustCrate, fetchgit }:
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">kernel</span></span> = stdenv.buildPlatform.parsed.kernel.name;
    <span class="hljs-comment"><span class="hljs-comment"># ... (content skipped)</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">hello</span></span> = f: hello_0_1_0 { <span class="hljs-attr"><span class="hljs-attr">features</span></span> = hello_0_1_0_features { <span class="hljs-attr"><span class="hljs-attr">hello_0_1_0</span></span> = f; }; };
  <span class="hljs-attr"><span class="hljs-attr">hello_0_1_0_</span></span> = { dependencies?[], buildDependencies?[], features?[] }: buildRustCrate {
    <span class="hljs-attr"><span class="hljs-attr">crateName</span></span> = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">authors</span></span> = [ <span class="hljs-string"><span class="hljs-string">"pe@pijul.org &lt;pe@pijul.org&gt;"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">src</span></span> = ./.;
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> dependencies buildDependencies features;
  };
  <span class="hljs-attr"><span class="hljs-attr">libc_0_2_36_</span></span> = { dependencies?[], buildDependencies?[], features?[] }: buildRustCrate {
    <span class="hljs-attr"><span class="hljs-attr">crateName</span></span> = <span class="hljs-string"><span class="hljs-string">"libc"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.2.36"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">authors</span></span> = [ <span class="hljs-string"><span class="hljs-string">"The Rust Project Developers"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"01633h4yfqm0s302fm0dlba469bx8y6cs4nqc8bqrmjqxfxn515l"</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> dependencies buildDependencies features;
  };
  <span class="hljs-attr"><span class="hljs-attr">hello_0_1_0</span></span> = { features?(hello_0_1_0_features {}) }: hello_0_1_0_ {
    <span class="hljs-attr"><span class="hljs-attr">dependencies</span></span> = mapFeatures features ([ libc_0_2_36 ]);
  };
  <span class="hljs-attr"><span class="hljs-attr">hello_0_1_0_features</span></span> = f: updateFeatures f (<span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
    hello_0_1_0.<span class="hljs-attr"><span class="hljs-attr">default</span></span> = (f.hello_0_1_0.default <span class="hljs-literal"><span class="hljs-literal">or</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
    libc_0_2_36.<span class="hljs-attr"><span class="hljs-attr">default</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  }) [ libc_0_2_36_features ];
  <span class="hljs-attr"><span class="hljs-attr">libc_0_2_36</span></span> = { features?(libc_0_2_36_features {}) }: libc_0_2_36_ {
    <span class="hljs-attr"><span class="hljs-attr">features</span></span> = mkFeatures (features.libc_0_2_36 <span class="hljs-literal"><span class="hljs-literal">or</span></span> {});
  };
  <span class="hljs-attr"><span class="hljs-attr">libc_0_2_36_features</span></span> = f: updateFeatures f (<span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
    libc_0_2_36.<span class="hljs-attr"><span class="hljs-attr">default</span></span> = (f.libc_0_2_36.default <span class="hljs-literal"><span class="hljs-literal">or</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
    libc_0_2_36.<span class="hljs-attr"><span class="hljs-attr">use_std</span></span> =
      (f.libc_0_2_36.use_std <span class="hljs-literal"><span class="hljs-literal">or</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>) ||
      (f.libc_0_2_36.default <span class="hljs-literal"><span class="hljs-literal">or</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>) ||
      (libc_0_2_36.default <span class="hljs-literal"><span class="hljs-literal">or</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>);
  }) [];
}
</pre><p>
       Here, the <code class="literal">libc</code> crate has no <code class="literal">src</code> attribute, so <code class="literal">buildRustCrate</code> will fetch it from <a class="link" href="https://crates.io/" target="_top" shape="rect">crates.io</a>. A <code class="literal">sha256</code> attribute is still needed for Nix purity.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="handling-external-dependencies" shape="rect"></a>15.23.2.2.&nbsp;Handling external dependencies</h4></div></div></div><p>
       Some crates require external libraries. For crates from <a class="link" href="https://crates.io/" target="_top" shape="rect">crates.io</a>, such libraries can be specified in <code class="literal">defaultCrateOverrides</code> package in nixpkgs itself.
      </p><p>
       Starting from that file, one can add more overrides, to add features or build inputs by overriding the hello crate in a seperate file.
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
((<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> ./hello.nix).hello {}).override {
  <span class="hljs-attr"><span class="hljs-attr">crateOverrides</span></span> = defaultCrateOverrides // {
    <span class="hljs-attr"><span class="hljs-attr">hello</span></span> = attrs: { <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [ openssl ]; };
  };
}
</pre><p>
       Here, <code class="literal">crateOverrides</code> is expected to be a attribute set, where the key is the crate name without version number and the value a function. The function gets all attributes passed to <code class="literal">buildRustCrate</code> as first argument and returns a set that contains all attribute that should be overwritten.
      </p><p>
       For more complicated cases, such as when parts of the crate’s derivation depend on the crate’s version, the <code class="literal">attrs</code> argument of the override above can be read, as in the following example, which patches the derivation:
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
((<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> ./hello.nix).hello {}).override {
  <span class="hljs-attr"><span class="hljs-attr">crateOverrides</span></span> = defaultCrateOverrides // {
    <span class="hljs-attr"><span class="hljs-attr">hello</span></span> = attrs: lib.optionalAttrs (lib.versionAtLeast attrs.version <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>)  {
      <span class="hljs-attr"><span class="hljs-attr">postPatch</span></span> = <span class="hljs-string"><span class="hljs-string">''
        substituteInPlace lib/zoneinfo.rs \
          --replace "/usr/share/zoneinfo" "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${tzdata}</span></span></span><span class="hljs-string">/share/zoneinfo"
      ''</span></span>;
    };
  };
}
</pre><p>
       Another situation is when we want to override a nested dependency. This actually works in the exact same way, since the <code class="literal">crateOverrides</code> parameter is forwarded to the crate’s dependencies. For instance, to override the build inputs for crate <code class="literal">libc</code> in the example above, where <code class="literal">libc</code> is a dependency of the main crate, we could do:
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
((<span class="hljs-built_in"><span class="hljs-built_in">import</span></span> hello.nix).hello {}).override {
  <span class="hljs-attr"><span class="hljs-attr">crateOverrides</span></span> = defaultCrateOverrides // {
    <span class="hljs-attr"><span class="hljs-attr">libc</span></span> = attrs: { <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = []; };
  };
}
</pre></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="options-and-phases-configuration" shape="rect"></a>15.23.2.3.&nbsp;Options and phases configuration</h4></div></div></div><p>
       Actually, the overrides introduced in the previous section are more general. A number of other parameters can be overridden:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         The version of rustc used to compile the crate:
        </p><pre class="programlisting hljs nix" xml:space="preserve">(hello {}).override { <span class="hljs-attr"><span class="hljs-attr">rust</span></span> = pkgs.rust; };
</pre></li><li class="listitem"><p>
         Whether to build in release mode or debug mode (release mode by default):
        </p><pre class="programlisting hljs nix" xml:space="preserve">(hello {}).override { <span class="hljs-attr"><span class="hljs-attr">release</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; };
</pre></li><li class="listitem"><p>
         Whether to print the commands sent to rustc when building (equivalent to <code class="literal">--verbose</code> in cargo:
        </p><pre class="programlisting hljs nix" xml:space="preserve">(hello {}).override { <span class="hljs-attr"><span class="hljs-attr">verbose</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; };
</pre></li><li class="listitem"><p>
         Extra arguments to be passed to <code class="literal">rustc</code>:
        </p><pre class="programlisting hljs nix" xml:space="preserve">(hello {}).override { <span class="hljs-attr"><span class="hljs-attr">extraRustcOpts</span></span> = <span class="hljs-string"><span class="hljs-string">"-Z debuginfo=2"</span></span>; };
</pre></li><li class="listitem"><p>
         Phases, just like in any other derivation, can be specified using the following attributes: <code class="literal">preUnpack</code>, <code class="literal">postUnpack</code>, <code class="literal">prePatch</code>, <code class="literal">patches</code>, <code class="literal">postPatch</code>, <code class="literal">preConfigure</code> (in the case of a Rust crate, this is run before calling the <span class="quote">“<span class="quote">build</span>”</span> script), <code class="literal">postConfigure</code> (after the <span class="quote">“<span class="quote">build</span>”</span> script),<code class="literal">preBuild</code>, <code class="literal">postBuild</code>, <code class="literal">preInstall</code> and <code class="literal">postInstall</code>. As an example, here is how to create a new module before running the build script:
        </p><pre class="programlisting hljs bash" xml:space="preserve">(hello {}).override {
  preConfigure = <span class="hljs-string"><span class="hljs-string">''</span></span>
     <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"pub const PATH=\"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${hi.out}</span></span></span><span class="hljs-string">\";"</span></span> &gt;&gt; src/path.rs<span class="hljs-string"><span class="hljs-string">"
  '';
};
</span></span></pre></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="features" shape="rect"></a>15.23.2.4.&nbsp;Features</h4></div></div></div><p>
       One can also supply features switches. For example, if we want to compile <code class="literal">diesel_cli</code> only with the <code class="literal">postgres</code> feature, and no default features, we would write:
      </p><pre class="programlisting hljs nix" xml:space="preserve">(callPackage ./diesel.nix {}).diesel {
  <span class="hljs-attr"><span class="hljs-attr">default</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">postgres</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}
</pre><p>
       Where <code class="literal">diesel.nix</code> is the file generated by Carnix, as explained above.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="setting-up-nix-shell" class="title">15.23.3.&nbsp;Setting Up <code class="literal">nix-shell</code><a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#setting-up-nix-shell" aria-label="Anchor link for: setting up nix shell" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Oftentimes you want to develop code from within <code class="literal">nix-shell</code>. Unfortunately <code class="literal">buildRustCrate</code> does not support common <code class="literal">nix-shell</code> operations directly (see <a class="link" href="https://github.com/NixOS/nixpkgs/issues/37945" target="_top" shape="rect">this issue</a>) so we will use <code class="literal">stdenv.mkDerivation</code> instead.
     </p><p>
      Using the example <code class="literal">hello</code> project above, we want to do the following: - Have access to <code class="literal">cargo</code> and <code class="literal">rustc</code> - Have the <code class="literal">openssl</code> library available to a crate through it’s <span class="emphasis"><em>normal</em></span> compilation mechanism (<code class="literal">pkg-config</code>).
     </p><p>
      A typical <code class="literal">shell.nix</code> might look like:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"rust-env"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [
    rustc cargo

    <span class="hljs-comment"><span class="hljs-comment"># Example Build-time Additional Dependencies</span></span>
    pkgconfig
  ];
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [
    <span class="hljs-comment"><span class="hljs-comment"># Example Run-time Additional Dependencies</span></span>
    openssl
  ];

  <span class="hljs-comment"><span class="hljs-comment"># Set Environment Variables</span></span>
  <span class="hljs-attr"><span class="hljs-attr">RUST_BACKTRACE</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>;
}
</pre><p>
      You should now be able to run the following:
     </p><pre class="programlisting hljs bash" xml:space="preserve">$ nix-shell --pure
$ cargo build
$ cargo <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>
</pre><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="controlling-rust-version-inside-nix-shell" shape="rect"></a>15.23.3.1.&nbsp;Controlling Rust Version Inside <code class="literal">nix-shell</code></h4></div></div></div><p>
       To control your rust version (i.e.&nbsp;use nightly) from within <code class="literal">shell.nix</code> (or other nix expressions) you can use the following <code class="literal">shell.nix</code>
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment"># Latest Nightly</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
      <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"mozilla"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"nixpkgs-mozilla"</span></span>;
      <span class="hljs-comment"><span class="hljs-comment"># commit from: 2019-05-15</span></span>
      <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"9f35c4b09fd44a77227e79ff0c1b4b6a69dff533"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"18h0nvh55b5an4gmlgfbvwbyqj91bklf1zymis6lbdh75571qaz0"</span></span>;
   };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${src.out}</span></span></span><span class="hljs-string">/rust-overlay.nix"</span></span> pkgs pkgs;
stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"rust-env"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">buildInputs</span></span> = [
    <span class="hljs-comment"><span class="hljs-comment"># Note: to use use stable, just replace `nightly` with `stable`</span></span>
    latest.rustChannels.nightly.rust

    <span class="hljs-comment"><span class="hljs-comment"># Add some extra dependencies from `pkgs`</span></span>
    pkgconfig openssl
  ];

  <span class="hljs-comment"><span class="hljs-comment"># Set Environment Variables</span></span>
  <span class="hljs-attr"><span class="hljs-attr">RUST_BACKTRACE</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>;
}
</pre><p>
       Now run:
      </p><pre class="programlisting hljs" xml:space="preserve">$ rustc --version
rustc 1.26.0-nightly (188e693b3 2018-03-26)
</pre><p>
       To see that you are using nightly.
      </p></section></section><section class="section"><div class="titlepage"><div><div><h3 id="using-the-rust-nightlies-overlay" class="title">15.23.4.&nbsp;Using the Rust nightlies overlay<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#using-the-rust-nightlies-overlay" aria-label="Anchor link for: using the rust nightlies overlay" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Mozilla provides an overlay for nixpkgs to bring a nightly version of Rust into scope. This overlay can <span class="emphasis"><em>also</em></span> be used to install recent unstable or stable versions of Rust, if desired.
     </p><p>
      To use this overlay, clone <a class="link" href="https://github.com/mozilla/nixpkgs-mozilla" target="_top" shape="rect">nixpkgs-mozilla</a>, and create a symbolic link to the file <a class="link" href="https://github.com/mozilla/nixpkgs-mozilla/blob/master/rust-overlay.nix" target="_top" shape="rect">rust-overlay.nix</a> in the <code class="literal">~/.config/nixpkgs/overlays</code> directory.
     </p><pre class="programlisting hljs bash" xml:space="preserve">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/mozilla/nixpkgs-mozilla.git
$ mkdir -p ~/.config/nixpkgs/overlays
$ ln -s $(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>)/nixpkgs-mozilla/rust-overlay.nix ~/.config/nixpkgs/overlays/rust-overlay.nix
</pre><p>
      The latest version can be installed with the following command:
     </p><pre class="programlisting hljs" xml:space="preserve">$ nix-env -Ai nixos.latest.rustChannels.stable.rust
</pre><p>
      Or using the attribute with nix-shell:
     </p><pre class="programlisting hljs" xml:space="preserve">$ nix-shell -p nixos.latest.rustChannels.stable.rust
</pre><p>
      To install the beta or nightly channel, <span class="quote">“<span class="quote">stable</span>”</span> should be substituted by <span class="quote">“<span class="quote">nightly</span>”</span> or <span class="quote">“<span class="quote">beta</span>”</span>, or use the function provided by this overlay to pull a version based on a build date.
     </p><p>
      The overlay automatically updates itself as it uses the same source as <a class="link" href="https://www.rustup.rs/" target="_top" shape="rect">rustup</a>.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-language-texlive" class="title" style="clear: both">15.24.&nbsp;TeX Live<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive" aria-label="Anchor link for: sec language texlive" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Since release 15.09 there is a new TeX Live packaging that lives entirely under attribute <code class="varname">texlive</code>.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-language-texlive-users-guide" class="title">15.24.1.&nbsp;User's guide<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-users-guide" aria-label="Anchor link for: sec language texlive users guide" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        For basic usage just pull <code class="varname">texlive.combined.scheme-basic</code> for an environment with basic LaTeX support.
       </p></li><li class="listitem"><p>
        It typically won't work to use separately installed packages together. Instead, you can build a custom set of packages like this:
</p><pre class="programlisting hljs nix" xml:space="preserve">texlive.combine {
  <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (texlive) scheme-small collection-langkorean algorithms cm-super;
}
</pre><p>
        There are all the schemes, collections and a few thousand packages, as defined upstream (perhaps with tiny differences).
       </p></li><li class="listitem"><p>
        By default you only get executables and files needed during runtime, and a little documentation for the core packages. To change that, you need to add <code class="varname">pkgFilter</code> function to <code class="varname">combine</code>.
</p><pre class="programlisting hljs nix" xml:space="preserve">texlive.combine {
  <span class="hljs-comment"><span class="hljs-comment"># inherit (texlive) whatever-you-want;</span></span>
  <span class="hljs-attr"><span class="hljs-attr">pkgFilter</span></span> = pkg:
    pkg.<span class="hljs-attr"><span class="hljs-attr">tlType</span></span> == <span class="hljs-string"><span class="hljs-string">"run"</span></span> || pkg.<span class="hljs-attr"><span class="hljs-attr">tlType</span></span> == <span class="hljs-string"><span class="hljs-string">"bin"</span></span> || pkg.<span class="hljs-attr"><span class="hljs-attr">pname</span></span> == <span class="hljs-string"><span class="hljs-string">"cm-super"</span></span>;
  <span class="hljs-comment"><span class="hljs-comment"># elem tlType [ "run" "bin" "doc" "source" ]</span></span>
  <span class="hljs-comment"><span class="hljs-comment"># there are also other attributes: version, name</span></span>
}
</pre><p>
       </p></li><li class="listitem"><p>
        You can list packages e.g. by <span class="command"><strong>nix repl</strong></span>.
</p><pre class="programlisting hljs" xml:space="preserve"><code class="prompt">$ </code>nix repl
<code class="prompt">nix-repl&gt; </code>:l &lt;nixpkgs&gt;
<code class="prompt">nix-repl&gt; </code>texlive.collection-<span class="keycap"><strong>→|</strong></span>
</pre><p>
       </p></li><li class="listitem"><p>
        Note that the wrapper assumes that the result has a chance to be useful. For example, the core executables should be present, as well as some core data files. The supported way of ensuring this is by including some scheme, for example <code class="varname">scheme-basic</code>, into the combination.
       </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-language-texlive-custom-packages" class="title">15.24.2.&nbsp;Custom packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-custom-packages" aria-label="Anchor link for: sec language texlive custom packages" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      You may find that you need to use an external TeX package. A derivation for such package has to provide contents of the "texmf" directory in its output and provide the <code class="varname">tlType</code> attribute. Here is a (very verbose) example:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {};

<span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">foiltex_run</span></span> = stdenvNoCC.mkDerivation {
    <span class="hljs-attr"><span class="hljs-attr">pname</span></span> = <span class="hljs-string"><span class="hljs-string">"latex-foiltex"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"2.1.4b"</span></span>;
    passthru.<span class="hljs-attr"><span class="hljs-attr">tlType</span></span> = <span class="hljs-string"><span class="hljs-string">"run"</span></span>;

    <span class="hljs-attr"><span class="hljs-attr">srcs</span></span> = [
      (fetchurl {
        <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://mirrors.ctan.org/macros/latex/contrib/foiltex/foiltex.dtx"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"07frz0krpz7kkcwlayrwrj2a2pixmv0icbngyw92srp9fp23cqpz"</span></span>;
      })
      (fetchurl {
        <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://mirrors.ctan.org/macros/latex/contrib/foiltex/foiltex.ins"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"09wkyidxk3n3zvqxfs61wlypmbhi1pxmjdi1kns9n2ky8ykbff99"</span></span>;
      })
    ];

    <span class="hljs-attr"><span class="hljs-attr">unpackPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
      runHook preUnpack

      for _src in $srcs; do
        cp "$_src" $(stripHash "$_src")
      done

      runHook postUnpack
    ''</span></span>;

    <span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [ texlive.combined.scheme-small ];

    <span class="hljs-attr"><span class="hljs-attr">dontConfigure</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;

    <span class="hljs-attr"><span class="hljs-attr">buildPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
      runHook preBuild

      # Generate the style files
      latex foiltex.ins

      runHook postBuild
    ''</span></span>;

    <span class="hljs-attr"><span class="hljs-attr">installPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
      runHook preInstall

      path="$out/tex/latex/foiltex"
      mkdir -p "$path"
      cp *.{cls,def,clo} "$path/"

      runHook postInstall
    ''</span></span>;

    <span class="hljs-attr"><span class="hljs-attr">meta</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lib; {
      <span class="hljs-attr"><span class="hljs-attr">description</span></span> = <span class="hljs-string"><span class="hljs-string">"A LaTeX2e class for overhead transparencies"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">license</span></span> = licenses.unfreeRedistributable;
      <span class="hljs-attr"><span class="hljs-attr">maintainers</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> maintainers; [ veprbl ];
      <span class="hljs-attr"><span class="hljs-attr">platforms</span></span> = platforms.all;
    };
  };
  <span class="hljs-attr"><span class="hljs-attr">foiltex</span></span> = { <span class="hljs-attr"><span class="hljs-attr">pkgs</span></span> = [ foiltex_run ]; };

  <span class="hljs-attr"><span class="hljs-attr">latex_with_foiltex</span></span> = texlive.combine {
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (texlive) scheme-small;
    <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> foiltex;
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
  runCommand <span class="hljs-string"><span class="hljs-string">"test.pdf"</span></span> {
    <span class="hljs-attr"><span class="hljs-attr">nativeBuildInputs</span></span> = [ latex_with_foiltex ];
  } <span class="hljs-string"><span class="hljs-string">''
cat &gt;test.tex &lt;&lt;EOF
\documentclass{foils}

\title{Presentation title}
\date{}

\begin{document}
\maketitle
\end{document}
EOF
  pdflatex test.tex
  cp test.pdf $out
''</span></span>
</pre><p>
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="titanium" class="title" style="clear: both">15.25.&nbsp;Titanium<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#titanium" aria-label="Anchor link for: titanium" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The Nixpkgs repository contains facilities to deploy a variety of versions of the <a class="link" href="https://www.appcelerator.com/" target="_top" shape="rect">Titanium SDK</a> versions, a cross-platform mobile app development framework using JavaScript as an implementation language, and includes a function abstraction making it possible to build Titanium applications for Android and iOS devices from source code.
    </p><p>
     Not all Titanium features supported – currently, it can only be used to build Android and iOS apps.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="building-a-titanium-app" class="title">15.25.1.&nbsp;Building a Titanium app<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#building-a-titanium-app" aria-label="Anchor link for: building a titanium app" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      We can build a Titanium app from source for Android or iOS and for debugging or release purposes by invoking the <code class="literal">titaniumenv.buildApp {}</code> function:
     </p><pre class="programlisting hljs nix" xml:space="preserve">titaniumenv.buildApp {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"myapp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = ./myappsource;

  <span class="hljs-attr"><span class="hljs-attr">preBuild</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">target</span></span> = <span class="hljs-string"><span class="hljs-string">"android"</span></span>; <span class="hljs-comment"><span class="hljs-comment"># or 'iphone'</span></span>
  <span class="hljs-attr"><span class="hljs-attr">tiVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"7.1.0.GA"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">release</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">androidsdkArgs</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">platformVersions</span></span> = [ <span class="hljs-string"><span class="hljs-string">"25"</span></span> <span class="hljs-string"><span class="hljs-string">"26"</span></span> ];
  };
  <span class="hljs-attr"><span class="hljs-attr">androidKeyStore</span></span> = ./keystore;
  <span class="hljs-attr"><span class="hljs-attr">androidKeyAlias</span></span> = <span class="hljs-string"><span class="hljs-string">"myfirstapp"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">androidKeyStorePassword</span></span> = <span class="hljs-string"><span class="hljs-string">"secret"</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">xcodeBaseDir</span></span> = <span class="hljs-string"><span class="hljs-string">"/Applications/Xcode.app"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">xcodewrapperArgs</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"9.3"</span></span>;
  };
  <span class="hljs-attr"><span class="hljs-attr">iosMobileProvisioningProfile</span></span> = ./myprovisioning.profile;
  <span class="hljs-attr"><span class="hljs-attr">iosCertificateName</span></span> = <span class="hljs-string"><span class="hljs-string">"My Company"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">iosCertificate</span></span> = ./mycertificate.p12;
  <span class="hljs-attr"><span class="hljs-attr">iosCertificatePassword</span></span> = <span class="hljs-string"><span class="hljs-string">"secret"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">iosVersion</span></span> = <span class="hljs-string"><span class="hljs-string">"11.3"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">iosBuildStore</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;

  <span class="hljs-attr"><span class="hljs-attr">enableWirelessDistribution</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">installURL</span></span> = <span class="hljs-string"><span class="hljs-string">"/installipa.php"</span></span>;
}
</pre><p>
      The <code class="literal">titaniumenv.buildApp {}</code> function takes the following parameters:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        The <code class="literal">name</code> parameter refers to the name in the Nix store.
       </p></li><li class="listitem"><p>
        The <code class="literal">src</code> parameter refers to the source code location of the app that needs to be built.
       </p></li><li class="listitem"><p>
        <code class="literal">preRebuild</code> contains optional build instructions that are carried out before the build starts.
       </p></li><li class="listitem"><p>
        <code class="literal">target</code> indicates for which device the app must be built. Currently only <span class="quote">“<span class="quote">android</span>”</span> and <span class="quote">“<span class="quote">iphone</span>”</span> (for iOS) are supported.
       </p></li><li class="listitem"><p>
        <code class="literal">tiVersion</code> can be used to optionally override the requested Titanium version in <code class="literal">tiapp.xml</code>. If not specified, it will use the version in <code class="literal">tiapp.xml</code>.
       </p></li><li class="listitem"><p>
        <code class="literal">release</code> should be set to true when building an app for submission to the Google Playstore or Apple Appstore. Otherwise, it should be false.
       </p></li></ul></div><p>
      When the <code class="literal">target</code> has been set to <code class="literal">android</code>, we can configure the following parameters:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        The <code class="literal">androidSdkArgs</code> parameter refers to an attribute set that propagates all parameters to the <code class="literal">androidenv.composeAndroidPackages {}</code> function. This can be used to install all relevant Android plugins that may be needed to perform the Android build. If no parameters are given, it will deploy the platform SDKs for API-levels 25 and 26 by default.
       </p></li></ul></div><p>
      When the <code class="literal">release</code> parameter has been set to true, you need to provide parameters to sign the app:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">androidKeyStore</code> is the path to the keystore file
       </p></li><li class="listitem"><p>
        <code class="literal">androidKeyAlias</code> is the key alias
       </p></li><li class="listitem"><p>
        <code class="literal">androidKeyStorePassword</code> refers to the password to open the keystore file.
       </p></li></ul></div><p>
      When the <code class="literal">target</code> has been set to <code class="literal">iphone</code>, we can configure the following parameters:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        The <code class="literal">xcodeBaseDir</code> parameter refers to the location where Xcode has been installed. When none value is given, the above value is the default.
       </p></li><li class="listitem"><p>
        The <code class="literal">xcodewrapperArgs</code> parameter passes arbitrary parameters to the <code class="literal">xcodeenv.composeXcodeWrapper {}</code> function. This can, for example, be used to adjust the default version of Xcode.
       </p></li></ul></div><p>
      When <code class="literal">release</code> has been set to true, you also need to provide the following parameters:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">iosMobileProvisioningProfile</code> refers to a mobile provisioning profile needed for signing.
       </p></li><li class="listitem"><p>
        <code class="literal">iosCertificateName</code> refers to the company name in the P12 certificate.
       </p></li><li class="listitem"><p>
        <code class="literal">iosCertificate</code> refers to the path to the P12 file.
       </p></li><li class="listitem"><p>
        <code class="literal">iosCertificatePassword</code> contains the password to open the P12 file.
       </p></li><li class="listitem"><p>
        <code class="literal">iosVersion</code> refers to the iOS SDK version to use. It defaults to the latest version.
       </p></li><li class="listitem"><p>
        <code class="literal">iosBuildStore</code> should be set to <code class="literal">true</code> when building for the Apple Appstore submission. For enterprise or ad-hoc builds it should be set to <code class="literal">false</code>.
       </p></li></ul></div><p>
      When <code class="literal">enableWirelessDistribution</code> has been enabled, you must also provide the path of the PHP script (<code class="literal">installURL</code>) (that is included with the iOS build environment) to enable wireless ad-hoc installations.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="emulating-or-simulating-the-app" class="title">15.25.2.&nbsp;Emulating or simulating the app<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#emulating-or-simulating-the-app" aria-label="Anchor link for: emulating or simulating the app" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      It is also possible to simulate the correspond iOS simulator build by using <code class="literal">xcodeenv.simulateApp {}</code> and emulate an Android APK by using <code class="literal">androidenv.emulateApp {}</code>.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="vim" class="title" style="clear: both">15.26.&nbsp;Vim<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#vim" aria-label="Anchor link for: vim" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Both Neovim and Vim can be configured to include your favorite plugins and additional libraries.
    </p><p>
     Loading can be deferred; see examples.
    </p><p>
     At the moment we support three different methods for managing plugins:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       Vim packages (<span class="emphasis"><em>recommend</em></span>)
      </p></li><li class="listitem"><p>
       VAM (=vim-addon-manager)
      </p></li><li class="listitem"><p>
       Pathogen
      </p></li><li class="listitem"><p>
       vim-plug
      </p></li></ul></div><section class="section"><div class="titlepage"><div><div><h3 id="custom-configuration" class="title">15.26.1.&nbsp;Custom configuration<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#custom-configuration" aria-label="Anchor link for: custom configuration" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Adding custom .vimrc lines can be done using the following code:
     </p><pre class="programlisting hljs nix" xml:space="preserve">vim_configurable.customize {
  <span class="hljs-comment"><span class="hljs-comment"># `name` specifies the name of the executable and package</span></span>
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"vim-with-plugins"</span></span>;

  vimrcConfig.<span class="hljs-attr"><span class="hljs-attr">customRC</span></span> = <span class="hljs-string"><span class="hljs-string">''
    set hidden
  ''</span></span>;
}
</pre><p>
      This configuration is used when Vim is invoked with the command specified as name, in this case <code class="literal">vim-with-plugins</code>.
     </p><p>
      For Neovim the <code class="literal">configure</code> argument can be overridden to achieve the same:
     </p><pre class="programlisting hljs bash" xml:space="preserve">neovim.override {
  configure = {
    customRC = <span class="hljs-string"><span class="hljs-string">''</span></span>
      <span class="hljs-comment"><span class="hljs-comment"># here your custom configuration goes!</span></span>
    <span class="hljs-string"><span class="hljs-string">''</span></span>;
  };
}
</pre><p>
      If you want to use <code class="literal">neovim-qt</code> as a graphical editor, you can configure it by overriding Neovim in an overlay or passing it an overridden Neovimn:
     </p><pre class="programlisting hljs nix" xml:space="preserve">neovim-qt.override {
  <span class="hljs-attr"><span class="hljs-attr">neovim</span></span> = neovim.override {
    <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = {
      <span class="hljs-attr"><span class="hljs-attr">customRC</span></span> = <span class="hljs-string"><span class="hljs-string">''
        # your custom configuration
      ''</span></span>;
    };
  };
}
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="managing-plugins-with-vim-packages" class="title">15.26.2.&nbsp;Managing plugins with Vim packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#managing-plugins-with-vim-packages" aria-label="Anchor link for: managing plugins with vim packages" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      To store you plugins in Vim packages (the native Vim plugin manager, see <code class="literal">:help packages</code>) the following example can be used:
     </p><pre class="programlisting hljs nix" xml:space="preserve">vim_configurable.customize {
  vimrcConfig.packages.<span class="hljs-attr"><span class="hljs-attr">myVimPackage</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.vimPlugins; {
    <span class="hljs-comment"><span class="hljs-comment"># loaded on launch</span></span>
    <span class="hljs-attr"><span class="hljs-attr">start</span></span> = [ youcompleteme fugitive ];
    <span class="hljs-comment"><span class="hljs-comment"># manually loadable by calling `:packadd $plugin-name`</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># however, if a Vim plugin has a dependency that is not explicitly listed in</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># opt that dependency will always be added to start to avoid confusion.</span></span>
    <span class="hljs-attr"><span class="hljs-attr">opt</span></span> = [ phpCompletion elm-vim ];
    <span class="hljs-comment"><span class="hljs-comment"># To automatically load a plugin when opening a filetype, add vimrc lines like:</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># autocmd FileType php :packadd phpCompletion</span></span>
  };
}
</pre><p>
      <code class="literal">myVimPackage</code> is an arbitrary name for the generated package. You can choose any name you like. For Neovim the syntax is:
     </p><pre class="programlisting hljs nix" xml:space="preserve">neovim.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">customRC</span></span> = <span class="hljs-string"><span class="hljs-string">''
      # here your custom configuration goes!
    ''</span></span>;
    packages.<span class="hljs-attr"><span class="hljs-attr">myVimPackage</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.vimPlugins; {
      <span class="hljs-comment"><span class="hljs-comment"># see examples below how to use custom packages</span></span>
      <span class="hljs-attr"><span class="hljs-attr">start</span></span> = [ ];
      <span class="hljs-comment"><span class="hljs-comment"># If a Vim plugin has a dependency that is not explicitly listed in</span></span>
      <span class="hljs-comment"><span class="hljs-comment"># opt that dependency will always be added to start to avoid confusion.</span></span>
      <span class="hljs-attr"><span class="hljs-attr">opt</span></span> = [ ];
    };
  };
}
</pre><p>
      The resulting package can be added to <code class="literal">packageOverrides</code> in <code class="literal">~/.nixpkgs/config.nix</code> to make it installable:
     </p><pre class="programlisting hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; {
    <span class="hljs-attr"><span class="hljs-attr">myVim</span></span> = vim_configurable.customize {
      <span class="hljs-comment"><span class="hljs-comment"># `name` specifies the name of the executable and package</span></span>
      <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"vim-with-plugins"</span></span>;
      <span class="hljs-comment"><span class="hljs-comment"># add here code from the example section</span></span>
    };
    <span class="hljs-attr"><span class="hljs-attr">myNeovim</span></span> = neovim.override {
      <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = {
      <span class="hljs-comment"><span class="hljs-comment"># add here code from the example section</span></span>
      };
    };
  };
}
</pre><p>
      After that you can install your special grafted <code class="literal">myVim</code> or <code class="literal">myNeovim</code> packages.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="managing-plugins-with-vim-plug" class="title">15.26.3.&nbsp;Managing plugins with vim-plug<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#managing-plugins-with-vim-plug" aria-label="Anchor link for: managing plugins with vim plug" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      To use <a class="link" href="https://github.com/junegunn/vim-plug" target="_top" shape="rect">vim-plug</a> to manage your Vim plugins the following example can be used:
     </p><pre class="programlisting hljs nix" xml:space="preserve">vim_configurable.customize {
  vimrcConfig.packages.<span class="hljs-attr"><span class="hljs-attr">myVimPackage</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.vimPlugins; {
    <span class="hljs-comment"><span class="hljs-comment"># loaded on launch</span></span>
    plug.<span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = [ youcompleteme fugitive phpCompletion elm-vim ];
  };
}
</pre><p>
      For Neovim the syntax is:
     </p><pre class="programlisting hljs nix" xml:space="preserve">neovim.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">customRC</span></span> = <span class="hljs-string"><span class="hljs-string">''
      # here your custom configuration goes!
    ''</span></span>;
    plug.<span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.vimPlugins; [
      vim-go
    ];
  };
}
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="managing-plugins-with-vam" class="title">15.26.4.&nbsp;Managing plugins with VAM<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#managing-plugins-with-vam" aria-label="Anchor link for: managing plugins with vam" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="handling-dependencies-of-vim-plugins" shape="rect"></a>15.26.4.1.&nbsp;Handling dependencies of Vim plugins</h4></div></div></div><p>
       VAM introduced .json files supporting dependencies without versioning assuming that <span class="quote">“<span class="quote">using latest version</span>”</span> is ok most of the time.
      </p></section><section class="section"><div class="titlepage"><div><div><h4 class="title"><a id="example" shape="rect"></a>15.26.4.2.&nbsp;Example</h4></div></div></div><p>
       First create a vim-scripts file having one plugin name per line. Example:
      </p><pre class="programlisting hljs bash" xml:space="preserve"><span class="hljs-string"><span class="hljs-string">"tlib"</span></span>
{<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'vim-addon-sql'</span></span>}
{<span class="hljs-string"><span class="hljs-string">'filetype_regex'</span></span>: <span class="hljs-string"><span class="hljs-string">'\%(vim)$'</span></span>, <span class="hljs-string"><span class="hljs-string">'names'</span></span>: [<span class="hljs-string"><span class="hljs-string">'reload'</span></span>, <span class="hljs-string"><span class="hljs-string">'vim-dev-plugin'</span></span>]}
</pre><p>
       Such vim-scripts file can be read by VAM as well like this:
      </p><pre class="programlisting hljs nix" xml:space="preserve">call vam<span class="hljs-comment"><span class="hljs-comment">#Scripts(expand('~/.vim-scripts'), {})</span></span>
</pre><p>
       Create a default.nix file:
      </p><pre class="programlisting hljs nix" xml:space="preserve">{ nixpkgs ? <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; {}, compiler ? <span class="hljs-string"><span class="hljs-string">"ghc7102"</span></span> }:
nixpkgs.vim_configurable.customize { <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"vim"</span></span>; vimrcConfig.vam.<span class="hljs-attr"><span class="hljs-attr">pluginDictionaries</span></span> = [ <span class="hljs-string"><span class="hljs-string">"vim-addon-vim2nix"</span></span> ]; }
</pre><p>
       Create a generate.vim file:
      </p><pre class="programlisting hljs bash" xml:space="preserve">ActivateAddons vim-addon-vim2nix
<span class="hljs-built_in"><span class="hljs-built_in">let</span></span> vim_scripts = <span class="hljs-string"><span class="hljs-string">"vim-scripts"</span></span>
call nix<span class="hljs-comment"><span class="hljs-comment">#ExportPluginsForNix({</span></span>
\  <span class="hljs-string"><span class="hljs-string">'path_to_nixpkgs'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(<span class="hljs-string"><span class="hljs-string">'{"'</span></span>.substitute(substitute(substitute(<span class="hljs-variable"><span class="hljs-variable">$NIX_PATH</span></span>, <span class="hljs-string"><span class="hljs-string">':'</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-string"><span class="hljs-string">'g'</span></span>), <span class="hljs-string"><span class="hljs-string">'='</span></span>,<span class="hljs-string"><span class="hljs-string">':'</span></span>, <span class="hljs-string"><span class="hljs-string">'g'</span></span>), <span class="hljs-string"><span class="hljs-string">'\([:,]\)'</span></span>, <span class="hljs-string"><span class="hljs-string">'"\1"'</span></span>,<span class="hljs-string"><span class="hljs-string">"g"</span></span>).<span class="hljs-string"><span class="hljs-string">'"}'</span></span>)[<span class="hljs-string"><span class="hljs-string">"nixpkgs"</span></span>],
\  <span class="hljs-string"><span class="hljs-string">'cache_file'</span></span>: <span class="hljs-string"><span class="hljs-string">'/tmp/vim2nix-cache'</span></span>,
\  <span class="hljs-string"><span class="hljs-string">'try_catch'</span></span>: 0,
\  <span class="hljs-string"><span class="hljs-string">'plugin_dictionaries'</span></span>: [<span class="hljs-string"><span class="hljs-string">"vim-addon-manager"</span></span>]+map(readfile(vim_scripts), <span class="hljs-string"><span class="hljs-string">'eval(v:val)'</span></span>)
\ })
</pre><p>
       Then run
      </p><pre class="programlisting hljs bash" xml:space="preserve">nix-shell -p vimUtils.vim_with_vim2nix --<span class="hljs-built_in"><span class="hljs-built_in">command</span></span> <span class="hljs-string"><span class="hljs-string">"vim -c 'source generate.vim'"</span></span>
</pre><p>
       You should get a Vim buffer with the nix derivations (output1) and vam.pluginDictionaries (output2). You can add your Vim to your system’s configuration file like this and start it by <span class="quote">“<span class="quote">vim-my</span>”</span>:
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">my-vim</span></span> =
  <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> (vimUtils) buildVimPluginFrom2Nix; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {
    copy paste output1 here
  }; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vim_configurable.customize {
    <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"vim-my"</span></span>;

    vimrcConfig.vam.<span class="hljs-attr"><span class="hljs-attr">knownPlugins</span></span> = plugins; <span class="hljs-comment"><span class="hljs-comment"># optional</span></span>
    vimrcConfig.vam.<span class="hljs-attr"><span class="hljs-attr">pluginDictionaries</span></span> = [
       copy paste output2 here
    ];

    <span class="hljs-comment"><span class="hljs-comment"># Pathogen would be</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># vimrcConfig.pathogen.knownPlugins = plugins; # plugins</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># vimrcConfig.pathogen.pluginNames = ["tlib"];</span></span>
  };
</pre><p>
       Sample output1:
      </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-string"><span class="hljs-string">"reload"</span></span> = buildVimPluginFrom2Nix { <span class="hljs-comment"><span class="hljs-comment"># created by nix#NixDerivation</span></span>
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"reload"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchgit {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"git://github.com/xolox/vim-reload"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"0a601a668727f5b675cb1ddc19f6861f3f7ab9e1"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0vb832l9yxj919f5hfg6qj6bn9ni57gnjd3bj7zpq7d4iv2s4wdh"</span></span>;
  };
  <span class="hljs-attr"><span class="hljs-attr">dependencies</span></span> = [<span class="hljs-string"><span class="hljs-string">"nim-misc"</span></span>];

};
[...]
</pre><p>
       Sample output2:
      </p><pre class="programlisting hljs bash" xml:space="preserve">[
  <span class="hljs-string"><span class="hljs-string">''</span></span>vim-addon-manager<span class="hljs-string"><span class="hljs-string">''</span></span>
  <span class="hljs-string"><span class="hljs-string">''</span></span>tlib<span class="hljs-string"><span class="hljs-string">''</span></span>
  { <span class="hljs-string"><span class="hljs-string">"name"</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>vim-addon-sql<span class="hljs-string"><span class="hljs-string">''</span></span>; }
  { <span class="hljs-string"><span class="hljs-string">"filetype_regex"</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>\%(vim)$$<span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-string"><span class="hljs-string">"names"</span></span> = [ <span class="hljs-string"><span class="hljs-string">''</span></span>reload<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>vim-dev-plugin<span class="hljs-string"><span class="hljs-string">''</span></span> ]; }
]
</pre></section></section><section class="section"><div class="titlepage"><div><div><h3 id="adding-new-plugins-to-nixpkgs" class="title">15.26.5.&nbsp;Adding new plugins to nixpkgs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#adding-new-plugins-to-nixpkgs" aria-label="Anchor link for: adding new plugins to nixpkgs" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Nix expressions for Vim plugins are stored in <a class="link" href="https://nixos.org/pkgs/misc/vim-plugins" target="_top" shape="rect">pkgs/misc/vim-plugins</a>. For the vast majority of plugins, Nix expressions are automatically generated by running <a class="link" href="https://nixos.org/pkgs/misc/vim-plugins/update.py" target="_top" shape="rect"><code class="literal">./update.py</code></a>. This creates a <a class="link" href="https://nixos.org/pkgs/misc/vim-plugins/generated.nix" target="_top" shape="rect">generated.nix</a> file based on the plugins listed in <a class="link" href="https://nixos.org/pkgs/misc/vim-plugins/vim-plugin-names" target="_top" shape="rect">vim-plugin-names</a>. Plugins are listed in alphabetical order in <code class="literal">vim-plugin-names</code> using the format <code class="literal">[github username]/[repository]</code>. For example https://github.com/scrooloose/nerdtree becomes <code class="literal">scrooloose/nerdtree</code>.
     </p><p>
      Some plugins require overrides in order to function properly. Overrides are placed in <a class="link" href="https://nixos.org/pkgs/misc/vim-plugins/overrides.nix" target="_top" shape="rect">overrides.nix</a>. Overrides are most often required when a plugin requires some dependencies, or extra steps are required during the build process. For example <code class="literal">deoplete-fish</code> requires both <code class="literal">deoplete-nvim</code> and <code class="literal">vim-fish</code>, and so the following override was added:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">deoplete-fish</span></span> = super.deoplete-fish.overrideAttrs(old: {
  <span class="hljs-attr"><span class="hljs-attr">dependencies</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> super; [ deoplete-nvim vim-fish ];
});
</pre><p>
      Sometimes plugins require an override that must be changed when the plugin is updated. This can cause issues when Vim plugins are auto-updated but the associated override isn’t updated. For these plugins, the override should be written so that it specifies all information required to install the plugin, and running <code class="literal">./update.py</code> doesn’t change the derivation for the plugin. Manually updating the override is required to update these types of plugins. An example of such a plugin is <code class="literal">LanguageClient-neovim</code>.
     </p><p>
      To add a new plugin, run <code class="literal">./update.py --add "[owner]/[name]"</code>. <span class="strong"><strong>NOTE</strong></span>: This script automatically commits to your git repository. Be sure to check out a fresh branch before running.
     </p><p>
      Finally, there are some plugins that are also packaged in nodePackages because they have Javascript-related build steps, such as running webpack. Those plugins are not listed in <code class="literal">vim-plugin-names</code> or managed by <code class="literal">update.py</code> at all, and are included separately in <code class="literal">overrides.nix</code>. Currently, all these plugins are related to the <code class="literal">coc.nvim</code> ecosystem of Language Server Protocol integration with vim/neovim.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="important-repositories" class="title">15.26.6.&nbsp;Important repositories<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#important-repositories" aria-label="Anchor link for: important repositories" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="https://bitbucket.org/vimcommunity/vim-pi" target="_top" shape="rect">vim-pi</a> is a plugin repository from VAM plugin manager meant to be used by others as well used by
       </p></li><li class="listitem"><p>
        <a class="link" href="https://github.com/MarcWeber/vim-addon-vim2nix" target="_top" shape="rect">vim2nix</a> which generates the .nix code
       </p></li></ul></div></section></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-packages" class="title">Chapter&nbsp;16.&nbsp;Packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-packages" aria-label="Anchor link for: chap packages" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix" shape="rect">16.1. Citrix Workspace</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#dlib" shape="rect">16.2. DLib</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-eclipse" shape="rect">16.3. Eclipse</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-elm" shape="rect">16.4. Elm</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-emacs" shape="rect">16.5. Emacs</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster" shape="rect">16.6. ibus-engines.typing-booster</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-kakoune" shape="rect">16.7. Kakoune</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-linux-kernel" shape="rect">16.8. Linux kernel</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#locales" shape="rect">16.9. Locales</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-nginx" shape="rect">16.10. Nginx</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-opengl" shape="rect">16.11. OpenGL</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-shell-helpers" shape="rect">16.12. Interactive shell helpers</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-steam" shape="rect">16.13. Steam</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#cataclysm-dark-days-ahead" shape="rect">16.14. Cataclysm: Dark Days Ahead</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt" shape="rect">16.15. Urxvt</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-weechat" shape="rect">16.16. Weechat</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-xorg" shape="rect">16.17. X.org</a></span></dt></dl></div><p>
    This chapter contains information about how to use and maintain the Nix expressions for a number of specific packages, such as the Linux kernel or X.org.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="sec-citrix" class="title" style="clear: both">16.1.&nbsp;Citrix Workspace<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix" aria-label="Anchor link for: sec citrix" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The <a class="link" href="https://www.citrix.com/products/workspace-app/" target="_top" shape="rect">Citrix Workspace App</a> is a remote desktop viewer which provides access to <a class="link" href="https://www.citrix.com/products/xenapp-xendesktop/" target="_top" shape="rect">XenDesktop</a> installations.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-citrix-base" class="title">16.1.1.&nbsp;Basic usage<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-base" aria-label="Anchor link for: sec citrix base" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The tarball archive needs to be downloaded manually as the license agreements of the vendor for <a class="link" href="https://www.citrix.de/downloads/workspace-app/linux/workspace-app-for-linux-latest.html" target="_top" shape="rect">Citrix Workspace</a> needs to be accepted first. Then run <span class="command"><strong>nix-prefetch-url file://$PWD/linuxx64-$version.tar.gz</strong></span>. With the archive available in the store the package can be built and installed with Nix.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-citrix-selfservice" class="title">16.1.2.&nbsp;Citrix Selfservice<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-selfservice" aria-label="Anchor link for: sec citrix selfservice" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The <a class="link" href="https://support.citrix.com/article/CTX200337" target="_top" shape="rect">selfservice</a> is an application managing Citrix desktops and applications. Please note that this feature only works with at least <span class="package">citrix_workspace_20_06_0</span> and later versions.
     </p><p>
      In order to set this up, you first have to <a class="link" href="https://its.uiowa.edu/support/article/102186" target="_top" shape="rect">download the <code class="literal">.cr</code> file from the Netscaler Gateway</a>. After that you can configure the <span class="command"><strong>selfservice</strong></span> like this:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>storebrowse -C ~/Downloads/receiverconfig.cr
<code class="prompt">$ </code>selfservice
</pre><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-citrix-custom-certs" class="title">16.1.3.&nbsp;Custom certificates<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-citrix-custom-certs" aria-label="Anchor link for: sec citrix custom certs" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The <code class="literal">Citrix Workspace App</code> in <code class="literal">nixpkgs</code> trusts several certificates <a class="link" href="https://curl.haxx.se/docs/caextract.html" target="_top" shape="rect">from the Mozilla database</a> by default. However several companies using Citrix might require their own corporate certificate. On distros with imperative packaging these certs can be stored easily in <a class="link" href="https://developer-docs.citrix.com/projects/receiver-for-linux-command-reference/en/13.7/" target="_top" shape="rect"><code class="literal">$ICAROOT</code></a>, however this directory is a store path in <code class="literal">nixpkgs</code>. In order to work around this issue the package provides a simple mechanism to add custom certificates without rebuilding the entire package using <code class="literal">symlinkJoin</code>:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> &lt;nixpkgs&gt; { config.<span class="hljs-attr"><span class="hljs-attr">allowUnfree</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; };
<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">extraCerts</span></span> = [ ./custom-cert-<span class="hljs-number"><span class="hljs-number">1</span></span>.pem ./custom-cert-<span class="hljs-number"><span class="hljs-number">2</span></span>.pem <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
citrix_workspace.override {
  <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> extraCerts;
}
</pre><p>
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="dlib" class="title" style="clear: both">16.2.&nbsp;DLib<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#dlib" aria-label="Anchor link for: dlib" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <a class="link" href="http://dlib.net/" target="_top" shape="rect">DLib</a> is a modern, C++-based toolkit which provides several machine learning algorithms.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="compiling-without-avx-support" class="title">16.2.1.&nbsp;Compiling without AVX support<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#compiling-without-avx-support" aria-label="Anchor link for: compiling without avx support" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Especially older CPUs don't support <a class="link" href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions" target="_top" shape="rect">AVX</a> (<abbr class="abbrev">Advanced Vector Extensions</abbr>) instructions that are used by DLib to optimize their algorithms.
     </p><p>
      On the affected hardware errors like <code class="literal">Illegal instruction</code> will occur. In those cases AVX support needs to be disabled:
</p><pre class="programlisting hljs nix" xml:space="preserve">self: super: {
  <span class="hljs-attr"><span class="hljs-attr">dlib</span></span> = super.dlib.override { <span class="hljs-attr"><span class="hljs-attr">avxSupport</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; };
}</pre><p>
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-eclipse" class="title" style="clear: both">16.3.&nbsp;Eclipse<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-eclipse" aria-label="Anchor link for: sec eclipse" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The Nix expressions related to the Eclipse platform and IDE are in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/eclipse" target="_top" shape="rect"><code class="filename">pkgs/applications/editors/eclipse</code></a>.
    </p><p>
     Nixpkgs provides a number of packages that will install Eclipse in its various forms. These range from the bare-bones Eclipse Platform to the more fully featured Eclipse SDK or Scala-IDE packages and multiple version are often available. It is possible to list available Eclipse packages by issuing the command:
</p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code>nix-env -f <span class="hljs-string"><span class="hljs-string">'&lt;nixpkgs&gt;'</span></span> -qaP -A eclipses --description
</pre><p>
     Once an Eclipse variant is installed it can be run using the <span class="command"><strong>eclipse</strong></span> command, as expected. From within Eclipse it is then possible to install plugins in the usual manner by either manually specifying an Eclipse update site or by installing the Marketplace Client plugin and using it to discover and install other plugins. This installation method provides an Eclipse installation that closely resemble a manually installed Eclipse.
    </p><p>
     If you prefer to install plugins in a more declarative manner then Nixpkgs also offer a number of Eclipse plugins that can be installed in an <span class="emphasis"><em>Eclipse environment</em></span>. This type of environment is created using the function <code class="varname">eclipseWithPlugins</code> found inside the <code class="varname">nixpkgs.eclipses</code> attribute set. This function takes as argument <code class="literal">{ eclipse, plugins ? [], jvmArgs ? [] }</code> where <code class="varname">eclipse</code> is a one of the Eclipse packages described above, <code class="varname">plugins</code> is a list of plugin derivations, and <code class="varname">jvmArgs</code> is a list of arguments given to the JVM running the Eclipse. For example, say you wish to install the latest Eclipse Platform with the popular Eclipse Color Theme plugin and also allow Eclipse to use more RAM. You could then add
</p><pre class="screen hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: {
  <span class="hljs-attr"><span class="hljs-attr">myEclipse</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.eclipses; eclipseWithPlugins {
    <span class="hljs-attr"><span class="hljs-attr">eclipse</span></span> = eclipse-platform;
    <span class="hljs-attr"><span class="hljs-attr">jvmArgs</span></span> = [ <span class="hljs-string"><span class="hljs-string">"-Xmx2048m"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = [ plugins.color-theme ];
  };
}
</pre><p>
     to your Nixpkgs configuration (<code class="filename">~/.config/nixpkgs/config.nix</code>) and install it by running <span class="command"><strong>nix-env -f '&lt;nixpkgs&gt;' -iA myEclipse</strong></span> and afterward run Eclipse as usual. It is possible to find out which plugins are available for installation using <code class="varname">eclipseWithPlugins</code> by running
</p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code>nix-env -f <span class="hljs-string"><span class="hljs-string">'&lt;nixpkgs&gt;'</span></span> -qaP -A eclipses.plugins --description
</pre><p>
    </p><p>
     If there is a need to install plugins that are not available in Nixpkgs then it may be possible to define these plugins outside Nixpkgs using the <code class="varname">buildEclipseUpdateSite</code> and <code class="varname">buildEclipsePlugin</code> functions found in the <code class="varname">nixpkgs.eclipses.plugins</code> attribute set. Use the <code class="varname">buildEclipseUpdateSite</code> function to install a plugin distributed as an Eclipse update site. This function takes <code class="literal">{ name, src }</code> as argument where <code class="literal">src</code> indicates the Eclipse update site archive. All Eclipse features and plugins within the downloaded update site will be installed. When an update site archive is not available then the <code class="varname">buildEclipsePlugin</code> function can be used to install a plugin that consists of a pair of feature and plugin JARs. This function takes an argument <code class="literal">{ name, srcFeature, srcPlugin }</code> where <code class="literal">srcFeature</code> and <code class="literal">srcPlugin</code> are the feature and plugin JARs, respectively.
    </p><p>
     Expanding the previous example with two plugins using the above functions we have
</p><pre class="screen hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: {
  <span class="hljs-attr"><span class="hljs-attr">myEclipse</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.eclipses; eclipseWithPlugins {
    <span class="hljs-attr"><span class="hljs-attr">eclipse</span></span> = eclipse-platform;
    <span class="hljs-attr"><span class="hljs-attr">jvmArgs</span></span> = [ <span class="hljs-string"><span class="hljs-string">"-Xmx2048m"</span></span> ];
    <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = [
      plugins.color-theme
      (plugins.buildEclipsePlugin {
        <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"myplugin1-1.0"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">srcFeature</span></span> = fetchurl {
          <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://…/features/myplugin1.jar"</span></span>;
          <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"123…"</span></span>;
        };
        <span class="hljs-attr"><span class="hljs-attr">srcPlugin</span></span> = fetchurl {
          <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://…/plugins/myplugin1.jar"</span></span>;
          <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"123…"</span></span>;
        };
      });
      (plugins.buildEclipseUpdateSite {
        <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"myplugin2-1.0"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
          <span class="hljs-attr"><span class="hljs-attr">stripRoot</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
          <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://…/myplugin2.zip"</span></span>;
          <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"123…"</span></span>;
        };
      });
    ];
  };
}
</pre><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-elm" class="title" style="clear: both">16.4.&nbsp;Elm<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-elm" aria-label="Anchor link for: sec elm" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     To start a development environment do <span class="command"><strong>nix-shell -p elmPackages.elm elmPackages.elm-format</strong></span>
    </p><p>
     To update Elm compiler, see <code class="filename">nixpkgs/pkgs/development/compilers/elm/README.md</code>.
    </p><p>
     To package Elm applications, <a class="link" href="https://github.com/hercules-ci/elm2nix#elm2nix" target="_top" shape="rect">read about elm2nix</a>.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-emacs" class="title" style="clear: both">16.5.&nbsp;Emacs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-emacs" aria-label="Anchor link for: sec emacs" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="sec-emacs-config" class="title">16.5.1.&nbsp;Configuring Emacs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-emacs-config" aria-label="Anchor link for: sec emacs config" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The Emacs package comes with some extra helpers to make it easier to configure. <code class="varname">emacsWithPackages</code> allows you to manage packages from ELPA. This means that you will not have to install that packages from within Emacs. For instance, if you wanted to use <code class="literal">company</code>, <code class="literal">counsel</code>, <code class="literal">flycheck</code>, <code class="literal">ivy</code>, <code class="literal">magit</code>, <code class="literal">projectile</code>, and <code class="literal">use-package</code> you could use this as a <code class="filename">~/.config/nixpkgs/config.nix</code> override:
     </p><pre class="screen hljs nix" xml:space="preserve">{
  <span class="hljs-attr"><span class="hljs-attr">packageOverrides</span></span> = pkgs: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; {
    <span class="hljs-attr"><span class="hljs-attr">myEmacs</span></span> = emacsWithPackages (epkgs: (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> epkgs.melpaStablePackages; [
      company
      counsel
      flycheck
      ivy
      magit
      projectile
      use-package
    ]));
  }
}
</pre><p>
      You can install it like any other packages via <span class="command"><strong>nix-env -iA myEmacs</strong></span>. However, this will only install those packages. It will not <code class="literal">configure</code> them for us. To do this, we need to provide a configuration file. Luckily, it is possible to do this from within Nix! By modifying the above example, we can make Emacs load a custom config file. The key is to create a package that provide a <code class="filename">default.el</code> file in <code class="filename">/share/emacs/site-start/</code>. Emacs knows to load this file automatically when it starts.
     </p><pre class="screen hljs bash" xml:space="preserve">{
  packageOverrides = pkgs: with pkgs; rec {
    myEmacsConfig = writeText <span class="hljs-string"><span class="hljs-string">"default.el"</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>
;; initialize package

(require <span class="hljs-string"><span class="hljs-string">'package)
(package-initialize '</span></span>noactivate)
(<span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>-when-compile
  (require <span class="hljs-string"><span class="hljs-string">'use-package))

;; load some packages

(use-package company
  :bind ("&lt;C-tab&gt;" . company-complete)
  :diminish company-mode
  :commands (company-mode global-company-mode)
  :defer 1
  :config
  (global-company-mode))

(use-package counsel
  :commands (counsel-descbinds)
  :bind (([remap execute-extended-command] . counsel-M-x)
         ("C-x C-f" . counsel-find-file)
         ("C-c g" . counsel-git)
         ("C-c j" . counsel-git-grep)
         ("C-c k" . counsel-ag)
         ("C-x l" . counsel-locate)
         ("M-y" . counsel-yank-pop)))

(use-package flycheck
  :defer 2
  :config (global-flycheck-mode))

(use-package ivy
  :defer 1
  :bind (("C-c C-r" . ivy-resume)
         ("C-x C-b" . ivy-switch-buffer)
         :map ivy-minibuffer-map
         ("C-j" . ivy-call))
  :diminish ivy-mode
  :commands ivy-mode
  :config
  (ivy-mode 1))

(use-package magit
  :defer
  :if (executable-find "git")
  :bind (("C-x g" . magit-status)
         ("C-x G" . magit-dispatch-popup))
  :init
  (setq magit-completing-read-function '</span></span>ivy-completing-read))

(use-package projectile
  :commands projectile-mode
  :<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-keymap (<span class="hljs-string"><span class="hljs-string">"C-c p"</span></span> . projectile-command-map)
  :defer 5
  :config
  (projectile-global-mode))
    <span class="hljs-string"><span class="hljs-string">''</span></span>;
    myEmacs = emacsWithPackages (epkgs: (with epkgs.melpaStablePackages; [
      (runCommand <span class="hljs-string"><span class="hljs-string">"default.el"</span></span> {} <span class="hljs-string"><span class="hljs-string">''</span></span>
mkdir -p <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share/emacs/site-lisp
cp <span class="hljs-variable"><span class="hljs-variable">${myEmacsConfig}</span></span> <span class="hljs-variable"><span class="hljs-variable">$out</span></span>/share/emacs/site-lisp/default.el
<span class="hljs-string"><span class="hljs-string">''</span></span>)
      company
      counsel
      flycheck
      ivy
      magit
      projectile
      use-package
    ]));
  };
}
</pre><p>
      This provides a fairly full Emacs start file. It will load in addition to the user's presonal config. You can always disable it by passing <span class="command"><strong>-q</strong></span> to the Emacs command.
     </p><p>
      Sometimes <code class="varname">emacsWithPackages</code> is not enough, as this package set has some priorities imposed on packages (with the lowest priority assigned to Melpa Unstable, and the highest for packages manually defined in <code class="filename">pkgs/top-level/emacs-packages.nix</code>). But you can't control this priorities when some package is installed as a dependency. You can override it on per-package-basis, providing all the required dependencies manually - but it's tedious and there is always a possibility that an unwanted dependency will sneak in through some other package. To completely override such a package you can use <code class="varname">overrideScope'</code>.
     </p><pre class="screen hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">overrides</span></span> = self: super: <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> {
  <span class="hljs-attr"><span class="hljs-attr">haskell-mode</span></span> = self.melpaPackages.haskell-mode;
  ...
};
((emacsPackagesGen emacs).overrideScope' overrides).emacsWithPackages (p: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> p; [
  <span class="hljs-comment"><span class="hljs-comment"># here both these package will use haskell-mode of our own choice</span></span>
  ghc-mod
  dante
])
</pre></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-ibus-typing-booster" class="title" style="clear: both">16.6.&nbsp;ibus-engines.typing-booster<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster" aria-label="Anchor link for: sec ibus typing booster" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     This package is an ibus-based completion method to speed up typing.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-ibus-typing-booster-activate" class="title">16.6.1.&nbsp;Activating the engine<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-activate" aria-label="Anchor link for: sec ibus typing booster activate" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      IBus needs to be configured accordingly to activate <code class="literal">typing-booster</code>. The configuration depends on the desktop manager in use. For detailed instructions, please refer to the <a class="link" href="https://mike-fabian.github.io/ibus-typing-booster/documentation.html" target="_top" shape="rect">upstream docs</a>.
     </p><p>
      On NixOS you need to explicitly enable <code class="literal">ibus</code> with given engines before customizing your desktop to use <code class="literal">typing-booster</code>. This can be achieved using the <code class="literal">ibus</code> module:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ pkgs, ... }: {
  i18n.<span class="hljs-attr"><span class="hljs-attr">inputMethod</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">enabled</span></span> = <span class="hljs-string"><span class="hljs-string">"ibus"</span></span>;
    ibus.<span class="hljs-attr"><span class="hljs-attr">engines</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.ibus-engines; [ typing-booster ];
  };
}</pre><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-ibus-typing-booster-customize-hunspell" class="title">16.6.2.&nbsp;Using custom hunspell dictionaries<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-customize-hunspell" aria-label="Anchor link for: sec ibus typing booster customize hunspell" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The IBus engine is based on <code class="literal">hunspell</code> to support completion in many languages. By default the dictionaries <code class="literal">de-de</code>, <code class="literal">en-us</code>, <code class="literal">fr-moderne</code> <code class="literal">es-es</code>, <code class="literal">it-it</code>, <code class="literal">sv-se</code> and <code class="literal">sv-fi</code> are in use. To add another dictionary, the package can be overridden like this:
</p><pre class="programlisting hljs nix" xml:space="preserve">ibus-engines.typing-booster.override {
  <span class="hljs-attr"><span class="hljs-attr">langs</span></span> = [ <span class="hljs-string"><span class="hljs-string">"de-at"</span></span> <span class="hljs-string"><span class="hljs-string">"en-gb"</span></span> ];
}</pre><p>
     </p><p>
      <span class="emphasis"><em>Note: each language passed to <code class="literal">langs</code> must be an attribute name in <code class="literal">pkgs.hunspellDicts</code>.</em></span>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-ibus-typing-booster-emoji-picker" class="title">16.6.3.&nbsp;Built-in emoji picker<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-ibus-typing-booster-emoji-picker" aria-label="Anchor link for: sec ibus typing booster emoji picker" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The <code class="literal">ibus-engines.typing-booster</code> package contains a program named <code class="literal">emoji-picker</code>. To display all emojis correctly, a special font such as <code class="literal">noto-fonts-emoji</code> is needed:
     </p><p>
      On NixOS it can be installed using the following expression:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ pkgs, ... }: {
  fonts.<span class="hljs-attr"><span class="hljs-attr">fonts</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs; [ noto-fonts-emoji ];
}</pre><p>
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-kakoune" class="title" style="clear: both">16.7.&nbsp;Kakoune<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-kakoune" aria-label="Anchor link for: sec kakoune" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Kakoune can be built to autoload plugins:
</p><pre class="programlisting hljs nix" xml:space="preserve">(kakoune.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = {
    <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.kakounePlugins; [ parinfer-rust ];
  };
})</pre><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-linux-kernel" class="title" style="clear: both">16.8.&nbsp;Linux kernel<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-linux-kernel" aria-label="Anchor link for: sec linux kernel" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The Nix expressions to build the Linux kernel are in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/os-specific/linux/kernel" target="_top" shape="rect"><code class="filename">pkgs/os-specific/linux/kernel</code></a>.
    </p><p>
     The function that builds the kernel has an argument <code class="varname">kernelPatches</code> which should be a list of <code class="literal">{name, patch, extraConfig}</code> attribute sets, where <code class="varname">name</code> is the name of the patch (which is included in the kernel’s <code class="varname">meta.description</code> attribute), <code class="varname">patch</code> is the patch itself (possibly compressed), and <code class="varname">extraConfig</code> (optional) is a string specifying extra options to be concatenated to the kernel configuration file (<code class="filename">.config</code>).
    </p><p>
     The kernel derivation exports an attribute <code class="varname">features</code> specifying whether optional functionality is or isn’t enabled. This is used in NixOS to implement kernel-specific behaviour. For instance, if the kernel has the <code class="varname">iwlwifi</code> feature (i.e. has built-in support for Intel wireless chipsets), then NixOS doesn’t have to build the external <code class="varname">iwlwifi</code> package:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">modulesTree</span></span> = [kernel]
  ++ pkgs.lib.optional (!kernel.features ? iwlwifi) kernelPackages.iwlwifi
  ++ ...;
</pre><p>
    </p><p>
     How to add a new (major) version of the Linux kernel to Nixpkgs:
     </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
        Copy the old Nix expression (e.g. <code class="filename">linux-2.6.21.nix</code>) to the new one (e.g. <code class="filename">linux-2.6.22.nix</code>) and update it.
       </p></li><li class="listitem"><p>
        Add the new kernel to <code class="filename">all-packages.nix</code> (e.g., create an attribute <code class="varname">kernel_2_6_22</code>).
       </p></li><li class="listitem"><p>
        Now we’re going to update the kernel configuration. First unpack the kernel. Then for each supported platform (<code class="literal">i686</code>, <code class="literal">x86_64</code>, <code class="literal">uml</code>) do the following:
        </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
           Make an copy from the old config (e.g. <code class="filename">config-2.6.21-i686-smp</code>) to the new one (e.g. <code class="filename">config-2.6.22-i686-smp</code>).
          </p></li><li class="listitem"><p>
           Copy the config file for this platform (e.g. <code class="filename">config-2.6.22-i686-smp</code>) to <code class="filename">.config</code> in the kernel source tree.
          </p></li><li class="listitem"><p>
           Run <code class="literal">make oldconfig ARCH=<em class="replaceable"><code>{i386,x86_64,um}</code></em></code> and answer all questions. (For the uml configuration, also add <code class="literal">SHELL=bash</code>.) Make sure to keep the configuration consistent between platforms (i.e. don’t enable some feature on <code class="literal">i686</code> and disable it on <code class="literal">x86_64</code>).
          </p></li><li class="listitem"><p>
           If needed you can also run <code class="literal">make menuconfig</code>:
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>nix-env -i ncurses
<code class="prompt">$ </code>export <span class="hljs-attr"><span class="hljs-attr">NIX_CFLAGS_LINK=-lncurses</span></span>
<code class="prompt">$ </code>make menuconfig <span class="hljs-attr"><span class="hljs-attr">ARCH=</span></span><em class="replaceable"><code><span class="hljs-attr"><span class="hljs-attr">arch</span></span></code></em></pre><p>
          </p></li><li class="listitem"><p>
           Copy <code class="filename">.config</code> over the new config file (e.g. <code class="filename">config-2.6.22-i686-smp</code>).
          </p></li></ol></div><p>
       </p></li><li class="listitem"><p>
        Test building the kernel: <code class="literal">nix-build -A kernel_2_6_22</code>. If it compiles, ship it! For extra credit, try booting NixOS with it.
       </p></li><li class="listitem"><p>
        It may be that the new kernel requires updating the external kernel modules and kernel-dependent packages listed in the <code class="varname">linuxPackagesFor</code> function in <code class="filename">all-packages.nix</code> (such as the NVIDIA drivers, AUFS, etc.). If the updated packages aren’t backwards compatible with older kernels, you may need to keep the older versions around.
       </p></li></ol></div><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="locales" class="title" style="clear: both">16.9.&nbsp;Locales<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#locales" aria-label="Anchor link for: locales" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     To allow simultaneous use of packages linked against different versions of <code class="literal">glibc</code> with different locale archive formats Nixpkgs patches <code class="literal">glibc</code> to rely on <code class="literal">LOCALE_ARCHIVE</code> environment variable.
    </p><p>
     On non-NixOS distributions this variable is obviously not set. This can cause regressions in language support or even crashes in some Nixpkgs-provided programs. The simplest way to mitigate this problem is exporting the <code class="literal">LOCALE_ARCHIVE</code> variable pointing to <code class="literal">${glibcLocales}/lib/locale/locale-archive</code>. The drawback (and the reason this is not the default) is the relatively large (a hundred MiB) size of the full set of locales. It is possible to build a custom set of locales by overriding parameters <code class="literal">allLocales</code> and <code class="literal">locales</code> of the package.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-nginx" class="title" style="clear: both">16.10.&nbsp;Nginx<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-nginx" aria-label="Anchor link for: sec nginx" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     <a class="link" href="https://nginx.org/" target="_top" shape="rect">Nginx</a> is a reverse proxy and lightweight webserver.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-nginx-etag" class="title">16.10.1.&nbsp;ETags on static files served from the Nix store<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-nginx-etag" aria-label="Anchor link for: sec nginx etag" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      HTTP has a couple different mechanisms for caching to prevent clients from having to download the same content repeatedly if a resource has not changed since the last time it was requested. When nginx is used as a server for static files, it implements the caching mechanism based on the <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Last-Modified" target="_top" shape="rect"><code class="literal">Last-Modified</code></a> response header automatically; unfortunately, it works by using filesystem timestamps to determine the value of the <code class="literal">Last-Modified</code> header. This doesn't give the desired behavior when the file is in the Nix store, because all file timestamps are set to 0 (for reasons related to build reproducibility).
     </p><p>
      Fortunately, HTTP supports an alternative (and more effective) caching mechanism: the <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag" target="_top" shape="rect"><code class="literal">ETag</code></a> response header. The value of the <code class="literal">ETag</code> header specifies some identifier for the particular content that the server is sending (e.g. a hash). When a client makes a second request for the same resource, it sends that value back in an <code class="literal">If-None-Match</code> header. If the ETag value is unchanged, then the server does not need to resend the content.
     </p><p>
      As of NixOS 19.09, the nginx package in Nixpkgs is patched such that when nginx serves a file out of <code class="filename">/nix/store</code>, the hash in the store path is used as the <code class="literal">ETag</code> header in the HTTP response, thus providing proper caching functionality. This happens automatically; you do not need to do modify any configuration to get this behavior.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-opengl" class="title" style="clear: both">16.11.&nbsp;OpenGL<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-opengl" aria-label="Anchor link for: sec opengl" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Packages that use OpenGL have NixOS desktop as their primary target. The current solution for loading the GPU-specific drivers is based on <code class="literal">libglvnd</code> and looks for the driver implementation in <code class="literal">LD_LIBRARY_PATH</code>. If you are using a non-NixOS GNU/Linux/X11 desktop with free software video drivers, consider launching OpenGL-dependent programs from Nixpkgs with Nixpkgs versions of <code class="literal">libglvnd</code> and <code class="literal">mesa_drivers</code> in <code class="literal">LD_LIBRARY_PATH</code>. For proprietary video drivers you might have luck with also adding the corresponding video driver package.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-shell-helpers" class="title" style="clear: both">16.12.&nbsp;Interactive shell helpers<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-shell-helpers" aria-label="Anchor link for: sec shell helpers" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Some packages provide the shell integration to be more useful. But unlike other systems, nix doesn't have a standard share directory location. This is why a bunch <span class="command"><strong>PACKAGE-share</strong></span> scripts are shipped that print the location of the corresponding shared folder. Current list of such packages is as following:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">autojump</code>: <span class="command"><strong>autojump-share</strong></span>
       </p></li><li class="listitem"><p>
        <code class="literal">fzf</code>: <span class="command"><strong>fzf-share</strong></span>
       </p></li></ul></div><p>
     E.g. <code class="literal">autojump</code> can then used in the .bashrc like this:
</p><pre class="screen hljs bash" xml:space="preserve">  <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(autojump-share)</span></span></span><span class="hljs-string">/autojump.bash"</span></span>
</pre><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-steam" class="title" style="clear: both">16.13.&nbsp;Steam<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-steam" aria-label="Anchor link for: sec steam" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="sec-steam-nix" class="title">16.13.1.&nbsp;Steam in Nix<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-nix" aria-label="Anchor link for: sec steam nix" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Steam is distributed as a <code class="filename">.deb</code> file, for now only as an i686 package (the amd64 package only has documentation). When unpacked, it has a script called <code class="filename">steam</code> that in Ubuntu (their target distro) would go to <code class="filename">/usr/bin </code>. When run for the first time, this script copies some files to the user's home, which include another script that is the ultimate responsible for launching the steam binary, which is also in $HOME.
     </p><p>
      Nix problems and constraints:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         We don't have <code class="filename">/bin/bash</code> and many scripts point there. Similarly for <code class="filename">/usr/bin/python</code> .
        </p></li><li class="listitem"><p>
         We don't have the dynamic loader in <code class="filename">/lib </code>.
        </p></li><li class="listitem"><p>
         The <code class="filename">steam.sh</code> script in $HOME can not be patched, as it is checked and rewritten by steam.
        </p></li><li class="listitem"><p>
         The steam binary cannot be patched, it's also checked.
        </p></li></ul></div><p>
     </p><p>
      The current approach to deploy Steam in NixOS is composing a FHS-compatible chroot environment, as documented <a class="link" href="http://sandervanderburg.blogspot.nl/2013/09/composing-fhs-compatible-chroot.html" target="_top" shape="rect">here</a>. This allows us to have binaries in the expected paths without disrupting the system, and to avoid patching them to work in a non FHS environment.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-steam-play" class="title">16.13.2.&nbsp;How to play<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-play" aria-label="Anchor link for: sec steam play" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Use
</p><pre class="programlisting hljs nix" xml:space="preserve">programs.steam.<span class="hljs-attr"><span class="hljs-attr">enable</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</pre><p>
      if you want to add steam to systemPackages and also enable a few workarrounds aswell as Steam controller support or other Steam supported controllers such as the DualShock 4 or Nintendo Switch Pr.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-steam-troub" class="title">16.13.3.&nbsp;Troubleshooting<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-troub" aria-label="Anchor link for: sec steam troub" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         Steam fails to start. What do I do?
        </span></dt><dd><p>
          Try to run
</p><pre class="programlisting hljs" xml:space="preserve">strace steam</pre><p>
          to see what is causing steam to fail.
         </p></dd><dt><span class="term">
         Using the FOSS Radeon or nouveau (nvidia) drivers
        </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">newStdcpp</code> parameter was removed since NixOS 17.09 and should not be needed anymore.
           </p></li><li class="listitem"><p>
            Steam ships statically linked with a version of libcrypto that conflics with the one dynamically loaded by radeonsi_dri.so. If you get the error
</p><pre class="programlisting hljs" xml:space="preserve">steam.sh: line 713: 7842 Segmentation fault (core dumped)</pre><p>
            have a look at <a class="link" href="https://github.com/NixOS/nixpkgs/pull/20269" target="_top" shape="rect">this pull request</a>.
           </p></li></ul></div></dd><dt><span class="term">
         Java
        </span></dt><dd><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            There is no java in steam chrootenv by default. If you get a message like
</p><pre class="programlisting hljs bash" xml:space="preserve">/home/foo/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/Steam/SteamApps/common/towns/towns.sh: line 1: java: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> not found</pre><p>
            You need to add
</p><pre class="programlisting hljs nix" xml:space="preserve"> steam.override { <span class="hljs-attr"><span class="hljs-attr">withJava</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; };</pre><p>
            to your configuration.
           </p></li></ol></div></dd></dl></div><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-steam-run" class="title">16.13.4.&nbsp;steam-run<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-steam-run" aria-label="Anchor link for: sec steam run" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The FHS-compatible chroot used for steam can also be used to run other linux games that expect a FHS environment. To do it, add
</p><pre class="programlisting hljs nix" xml:space="preserve">pkgs.(steam.override {
          <span class="hljs-attr"><span class="hljs-attr">nativeOnly</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
          <span class="hljs-attr"><span class="hljs-attr">newStdcpp</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
        }).run</pre><p>
      to your configuration, rebuild, and run the game with
</p><pre class="programlisting hljs" xml:space="preserve">steam-run ./foo</pre><p>
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="cataclysm-dark-days-ahead" class="title" style="clear: both">16.14.&nbsp;Cataclysm: Dark Days Ahead<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#cataclysm-dark-days-ahead" aria-label="Anchor link for: cataclysm dark days ahead" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><section class="section"><div class="titlepage"><div><div><h3 id="how-to-install-cataclysm-dda" class="title">16.14.1.&nbsp;How to install Cataclysm DDA<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#how-to-install-cataclysm-dda" aria-label="Anchor link for: how to install cataclysm dda" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      To install the latest stable release of Cataclysm DDA to your profile, execute <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -iA cataclysm-dda</code>. For the curses build (build without tiles), install <code class="literal">cataclysmDDA.stable.curses</code>. Note: <code class="literal">cataclysm-dda</code> is an alias to <code class="literal">cataclysmDDA.stable.tiles</code>.
     </p><p>
      If you like access to a development build of your favorite git revision, override <code class="literal">cataclysm-dda-git</code> (or <code class="literal">cataclysmDDA.git.curses</code> if you like curses build):
     </p><pre class="programlisting hljs nix" xml:space="preserve">cataclysm-dda-git.override {
  <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"YYYY-MM-DD"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"YOUR_FAVORITE_REVISION"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"CHECKSUM_OF_THE_REVISION"</span></span>;
}
</pre><p>
      The sha256 checksum can be obtained by
     </p><pre class="programlisting hljs nix" xml:space="preserve">nix-prefetch-url --unpack <span class="hljs-string"><span class="hljs-string">"https://github.com/CleverRaven/Cataclysm-DDA/archive/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${YOUR_FAVORITE_REVISION}</span></span></span><span class="hljs-string">.tar.gz"</span></span>
</pre><p>
      The default configuration directory is <code class="literal">~/.cataclysm-dda</code>. If you prefer <code class="literal">$XDG_CONFIG_HOME/cataclysm-dda</code>, override the derivation:
     </p><pre class="programlisting hljs nix" xml:space="preserve">cataclysm-dda.override {
  <span class="hljs-attr"><span class="hljs-attr">useXdgDir</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}
</pre></section><section class="section"><div class="titlepage"><div><div><h3 id="customizing-with-mods" class="title">16.14.2.&nbsp;Customizing with mods<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#customizing-with-mods" aria-label="Anchor link for: customizing with mods" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      To install Cataclysm DDA with mods of your choice, you can use <code class="literal">withMods</code> attribute:
     </p><pre class="programlisting hljs nix" xml:space="preserve">cataclysm-dda.withMods (mods: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> mods; [
  tileset.UndeadPeople
])
</pre><p>
      All mods, soundpacks, and tilesets available in nixpkgs are found in <code class="literal">cataclysmDDA.pkgs</code>.
     </p><p>
      Here is an example to modify existing mods and/or add more mods not available in nixpkgs:
     </p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span>
  <span class="hljs-attr"><span class="hljs-attr">customMods</span></span> = self: super: lib.recursiveUpdate super {
    <span class="hljs-comment"><span class="hljs-comment"># Modify existing mod</span></span>
    tileset.<span class="hljs-attr"><span class="hljs-attr">UndeadPeople</span></span> = super.tileset.UndeadPeople.overrideAttrs (old: {
      <span class="hljs-comment"><span class="hljs-comment"># If you like to apply a patch to the tileset for example</span></span>
      <span class="hljs-attr"><span class="hljs-attr">patches</span></span> = [ ./path/to/your.patch ];
    });

    <span class="hljs-comment"><span class="hljs-comment"># Add another mod</span></span>
    mod.<span class="hljs-attr"><span class="hljs-attr">Awesome</span></span> = cataclysmDDA.buildMod {
      <span class="hljs-attr"><span class="hljs-attr">modName</span></span> = <span class="hljs-string"><span class="hljs-string">"Awesome"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">version</span></span> = <span class="hljs-string"><span class="hljs-string">"0.x"</span></span>;
      <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
        <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"Someone"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"AwesomeMod"</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"..."</span></span>;
        <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"..."</span></span>;
      };
      <span class="hljs-comment"><span class="hljs-comment"># Path to be installed in the unpacked source (default: ".")</span></span>
      <span class="hljs-attr"><span class="hljs-attr">modRoot</span></span> = <span class="hljs-string"><span class="hljs-string">"contents/under/this/path/will/be/installed"</span></span>;
    };

    <span class="hljs-comment"><span class="hljs-comment"># Add another soundpack</span></span>
    soundpack.<span class="hljs-attr"><span class="hljs-attr">Fantastic</span></span> = cataclysmDDA.buildSoundPack {
      <span class="hljs-comment"><span class="hljs-comment"># ditto</span></span>
    };

    <span class="hljs-comment"><span class="hljs-comment"># Add another tileset</span></span>
    tileset.<span class="hljs-attr"><span class="hljs-attr">SuperDuper</span></span> = cataclysmDDA.buildTileSet {
      <span class="hljs-comment"><span class="hljs-comment"># ditto</span></span>
    };
  };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>
cataclysm-dda.withMods (mods: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> mods.extend customMods; [
  tileset.UndeadPeople
  mod.Awesome
  soundpack.Fantastic
  tileset.SuperDuper
])
</pre></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-urxvt" class="title" style="clear: both">16.15.&nbsp;Urxvt<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt" aria-label="Anchor link for: sec urxvt" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Urxvt, also known as rxvt-unicode, is a highly customizable terminal emulator.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-urxvt-conf" class="title">16.15.1.&nbsp;Configuring urxvt<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt-conf" aria-label="Anchor link for: sec urxvt conf" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      In <code class="literal">nixpkgs</code>, urxvt is provided by the package <code class="literal">rxvt-unicode</code>. It can be configured to include your choice of plugins, reducing its closure size from the default configuration which includes all available plugins. To make use of this functionality, use an overlay or directly install an expression that overrides its configuration, such as
</p><pre class="programlisting hljs nix" xml:space="preserve">rxvt-unicode.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = { availablePlugins, ... }: {
    <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> availablePlugins; [ perls resize-font vtwheel ];
  };
}
</pre><p>
      If the <code class="literal">configure</code> function returns an attrset without the <code class="literal">plugins</code> attribute, <code class="literal">availablePlugins</code> will be used automatically.
     </p><p>
      In order to add plugins but also keep all default plugins installed, it is possible to use the following method:
</p><pre class="programlisting hljs nix" xml:space="preserve">rxvt-unicode.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = { availablePlugins, ... }: {
    <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = (<span class="hljs-built_in"><span class="hljs-built_in">builtins</span></span>.attrValues availablePlugins) ++ [ custom-plugin ];
  };
}
</pre><p>
     </p><p>
      To get a list of all the plugins available, open the Nix REPL and run
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>nix repl
:l &lt;nixpkgs&gt;
<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> (p: p.name) pkgs.rxvt-unicode.plugins
</pre><p>
      Alternatively, if your shell is bash or zsh and have completion enabled, simply type <code class="literal">nixpkgs.rxvt-unicode.plugins.&lt;tab&gt;</code>.
     </p><p>
      In addition to <code class="literal">plugins</code> the options <code class="literal">extraDeps</code> and <code class="literal">perlDeps</code> can be used to install extra packages. <code class="literal">extraDeps</code> can be used, for example, to provide <code class="literal">xsel</code> (a clipboard manager) to the clipboard plugin, without installing it globally:
</p><pre class="programlisting hljs nix" xml:space="preserve">rxvt-unicode.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = { availablePlugins, ... }: {
    <span class="hljs-attr"><span class="hljs-attr">pluginsDeps</span></span> = [ xsel ];
  };
}
</pre><p>
      <code class="literal">perlDeps</code> is a handy way to provide Perl packages to your custom plugins (in <code class="literal">$HOME/.urxvt/ext</code>). For example, if you need <code class="literal">AnyEvent</code> you can do:
</p><pre class="programlisting hljs nix" xml:space="preserve">rxvt-unicode.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = { availablePlugins, ... }: {
    <span class="hljs-attr"><span class="hljs-attr">perlDeps</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> perlPackages; [ AnyEvent ];
  };
}
</pre><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-urxvt-pkg" class="title">16.15.2.&nbsp;Packaging urxvt plugins<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-urxvt-pkg" aria-label="Anchor link for: sec urxvt pkg" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Urxvt plugins resides in <code class="literal">pkgs/applications/misc/rxvt-unicode-plugins</code>. To add a new plugin create an expression in a subdirectory and add the package to the set in <code class="literal">pkgs/applications/misc/rxvt-unicode-plugins/default.nix</code>.
     </p><p>
      A plugin can be any kind of derivation, the only requirement is that it should always install perl scripts in <code class="literal">$out/lib/urxvt/perl</code>. Look for existing plugins for examples.
     </p><p>
      If the plugin is itself a perl package that needs to be imported from other plugins or scripts, add the following passthrough:
</p><pre class="programlisting hljs nix" xml:space="preserve">passthru.<span class="hljs-attr"><span class="hljs-attr">perlPackages</span></span> = [ <span class="hljs-string"><span class="hljs-string">"self"</span></span> ];
</pre><p>
      This will make the urxvt wrapper pick up the dependency and set up the perl path accordingly.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-weechat" class="title" style="clear: both">16.16.&nbsp;Weechat<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-weechat" aria-label="Anchor link for: sec weechat" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Weechat can be configured to include your choice of plugins, reducing its closure size from the default configuration which includes all available plugins. To make use of this functionality, install an expression that overrides its configuration such as
</p><pre class="programlisting hljs nix" xml:space="preserve">weechat.override {<span class="hljs-attr"><span class="hljs-attr">configure</span></span> = {availablePlugins, ...}: {
    <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> availablePlugins; [ python perl ];
  }
}</pre><p>
     If the <code class="literal">configure</code> function returns an attrset without the <code class="literal">plugins</code> attribute, <code class="literal">availablePlugins</code> will be used automatically.
    </p><p>
     The plugins currently available are <code class="literal">python</code>, <code class="literal">perl</code>, <code class="literal">ruby</code>, <code class="literal">guile</code>, <code class="literal">tcl</code> and <code class="literal">lua</code>.
    </p><p>
     The python and perl plugins allows the addition of extra libraries. For instance, the <code class="literal">inotify.py</code> script in weechat-scripts requires D-Bus or libnotify, and the <code class="literal">fish.py</code> script requires pycrypto. To use these scripts, use the plugin's <code class="literal">withPackages</code> attribute:
</p><pre class="programlisting hljs nix" xml:space="preserve">weechat.override { <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = {availablePlugins, ...}: {
    <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> availablePlugins; [
            (python.withPackages (ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ pycrypto python-dbus ]))
        ];
    };
}
</pre><p>
    </p><p>
     In order to also keep all default plugins installed, it is possible to use the following method:
</p><pre class="programlisting hljs nix" xml:space="preserve">weechat.override { <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = { availablePlugins, ... }: {
  <span class="hljs-attr"><span class="hljs-attr">plugins</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">builtins</span></span>.attrValues (availablePlugins // {
    <span class="hljs-attr"><span class="hljs-attr">python</span></span> = availablePlugins.python.withPackages (ps: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ps; [ pycrypto python-dbus ]);
  });
}; }
</pre><p>
    </p><p>
     WeeChat allows to set defaults on startup using the <code class="literal">--run-command</code>. The <code class="literal">configure</code> method can be used to pass commands to the program:
</p><pre class="programlisting hljs nix" xml:space="preserve">weechat.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = { availablePlugins, ... }: {
    <span class="hljs-attr"><span class="hljs-attr">init</span></span> = <span class="hljs-string"><span class="hljs-string">''
      /set foo bar
      /server add freenode chat.freenode.org
    ''</span></span>;
  };
}</pre><p>
     Further values can be added to the list of commands when running <code class="literal">weechat --run-command "your-commands"</code>.
    </p><p>
     Additionally it's possible to specify scripts to be loaded when starting <code class="literal">weechat</code>. These will be loaded before the commands from <code class="literal">init</code>:
</p><pre class="programlisting hljs nix" xml:space="preserve">weechat.override {
  <span class="hljs-attr"><span class="hljs-attr">configure</span></span> = { availablePlugins, ... }: {
    <span class="hljs-attr"><span class="hljs-attr">scripts</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pkgs.weechatScripts; [
      weechat-xmpp weechat-matrix-bridge wee-slack
    ];
    <span class="hljs-attr"><span class="hljs-attr">init</span></span> = <span class="hljs-string"><span class="hljs-string">''
      /set plugins.var.python.jabber.key "val"
    ''</span></span>:
  };
}</pre><p>
    </p><p>
     In <code class="literal">nixpkgs</code> there's a subpackage which contains derivations for WeeChat scripts. Such derivations expect a <code class="literal">passthru.scripts</code> attribute which contains a list of all scripts inside the store path. Furthermore all scripts have to live in <code class="literal">$out/share</code>. An exemplary derivation looks like this:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ stdenv, fetchurl }:

stdenv.mkDerivation {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"exemplary-weechat-script"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchurl {
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://scripts.tld/your-scripts.tar.gz"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"..."</span></span>;
  };
  passthru.<span class="hljs-attr"><span class="hljs-attr">scripts</span></span> = [ <span class="hljs-string"><span class="hljs-string">"foo.py"</span></span> <span class="hljs-string"><span class="hljs-string">"bar.lua"</span></span> ];
  <span class="hljs-attr"><span class="hljs-attr">installPhase</span></span> = <span class="hljs-string"><span class="hljs-string">''
    mkdir $out/share
    cp foo.py $out/share
    cp bar.lua $out/share
  ''</span></span>;
}</pre><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-xorg" class="title" style="clear: both">16.17.&nbsp;X.org<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-xorg" aria-label="Anchor link for: sec xorg" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The Nix expressions for the X.org packages reside in <code class="filename">pkgs/servers/x11/xorg/default.nix</code>. This file is automatically generated from lists of tarballs in an X.org release. As such it should not be modified directly; rather, you should modify the lists, the generator script or the file <code class="filename">pkgs/servers/x11/xorg/overrides.nix</code>, in which you can override or add to the derivations produced by the generator.
    </p><p>
     The generator is invoked as follows:
</p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> pkgs/servers/x11/xorg
<code class="prompt">$ </code>cat tarballs-7.5.list extra.list old.list \
  | perl ./generate-expr-from-tarballs.pl
</pre><p>
     For each of the tarballs in the <code class="filename">.list</code> files, the script downloads it, unpacks it, and searches its <code class="filename">configure.ac</code> and <code class="filename">*.pc.in</code> files for dependencies. This information is used to generate <code class="filename">default.nix</code>. The generator caches downloaded tarballs between runs. Pay close attention to the <code class="literal">NOT FOUND: <em class="replaceable"><code>name</code></em></code> messages at the end of the run, since they may indicate missing dependencies. (Some might be optional dependencies, however.)
    </p><p>
     A file like <code class="filename">tarballs-7.5.list</code> contains all tarballs in a X.org release. It can be generated like this:
</p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>export <span class="hljs-attr"><span class="hljs-attr">i="mirror://xorg/X11R7.4/src/everything/"</span></span>
<code class="prompt">$ </code>cat $(<span class="hljs-attr"><span class="hljs-attr">PRINT_PATH=1</span></span> nix-prefetch-url $i | tail -n <span class="hljs-number"><span class="hljs-number">1</span></span>) \
  | perl -e 'while (&lt;&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (/(href|HREF)=<span class="hljs-string"><span class="hljs-string">"([^"</span></span>]*.bz2)<span class="hljs-string"><span class="hljs-string">"/) { print "</span></span>$ENV{'i'}$<span class="hljs-number"><span class="hljs-number">2</span></span>\n<span class="hljs-string"><span class="hljs-string">"; }; }' \
  | sort &gt; tarballs-7.4.list
</span></span></pre><p>
     <code class="filename">extra.list</code> contains libraries that aren’t part of X.org proper, but are closely related to it, such as <code class="literal">libxcb</code>. <code class="filename">old.list</code> contains some packages that were removed from X.org, but are still needed by some people or by other packages (such as <code class="varname">imake</code>).
    </p><p>
     If the expression for a package requires derivation attributes that the generator cannot figure out automatically (say, <code class="varname">patches</code> or a <code class="varname">postInstall</code> hook), you should modify <code class="filename">pkgs/servers/x11/xorg/overrides.nix</code>.
    </p></section></section></div><div class="part"><div class="titlepage"><div><div><div class="page-header"><h1 id="idm140737317098448" class="title">Part&nbsp;IV.&nbsp;Contributing to Nixpkgs<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#idm140737317098448" aria-label="Anchor link for: idm140737317098448" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h1></div></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-quick-start" shape="rect">17. Quick Start to Adding a Package</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-conventions" shape="rect">18. Coding conventions</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-submitting-changes" shape="rect">19. Submitting changes</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-reviewing-contributions" shape="rect">20. Reviewing contributions</a></span></dt><dt><span class="chapter"><a href="https://nixos.org/manual/nixpkgs/stable/#chap-contributing" shape="rect">21. Contributing to this documentation</a></span></dt></dl></div><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-quick-start" class="title">Chapter&nbsp;17.&nbsp;Quick Start to Adding a Package<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-quick-start" aria-label="Anchor link for: chap quick start" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
    To add a package to Nixpkgs:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Checkout the Nixpkgs source tree:
</p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code>git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/NixOS/nixpkgs
<code class="prompt">$ </code><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> nixpkgs</pre><p>
      </p></li><li class="listitem"><p>
       Find a good place in the Nixpkgs tree to add the Nix expression for your package. For instance, a library package typically goes into <code class="filename">pkgs/development/libraries/<em class="replaceable"><code>pkgname</code></em></code>, while a web browser goes into <code class="filename">pkgs/applications/networking/browsers/<em class="replaceable"><code>pkgname</code></em></code>. See <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-organisation" title="18.3. File naming and organisation" shape="rect">Section&nbsp;18.3, “File naming and organisation”</a> for some hints on the tree organisation. Create a directory for your package, e.g.
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>mkdir pkgs/development/libraries/libfoo</pre><p>
      </p></li><li class="listitem"><p>
       In the package directory, create a Nix expression — a piece of code that describes how to build the package. In this case, it should be a <span class="emphasis"><em>function</em></span> that is called with the package dependencies as arguments, and returns a build of the package in the Nix store. The expression should usually be called <code class="filename">default.nix</code>.
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>emacs pkgs/development/libraries/libfoo/default.nix
<code class="prompt">$ </code>git add pkgs/development/libraries/libfoo/default.nix</pre><p>
      </p><p>
       You can have a look at the existing Nix expressions under <code class="filename">pkgs/</code> to see how it’s done. Here are some good ones:
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          GNU Hello: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/misc/hello/default.nix" target="_top" shape="rect"><code class="filename">pkgs/applications/misc/hello/default.nix</code></a>. Trivial package, which specifies some <code class="varname">meta</code> attributes which is good practice.
         </p></li><li class="listitem"><p>
          GNU cpio: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/tools/archivers/cpio/default.nix" target="_top" shape="rect"><code class="filename">pkgs/tools/archivers/cpio/default.nix</code></a>. Also a simple package. The generic builder in <code class="varname">stdenv</code> does everything for you. It has no dependencies beyond <code class="varname">stdenv</code>.
         </p></li><li class="listitem"><p>
          GNU Multiple Precision arithmetic library (GMP): <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/libraries/gmp/5.1.x.nix" target="_top" shape="rect"><code class="filename">pkgs/development/libraries/gmp/5.1.x.nix</code></a>. Also done by the generic builder, but has a dependency on <code class="varname">m4</code>.
         </p></li><li class="listitem"><p>
          Pan, a GTK-based newsreader: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/networking/newsreaders/pan/default.nix" target="_top" shape="rect"><code class="filename">pkgs/applications/networking/newsreaders/pan/default.nix</code></a>. Has an optional dependency on <code class="varname">gtkspell</code>, which is only built if <code class="varname">spellCheck</code> is <code class="literal">true</code>.
         </p></li><li class="listitem"><p>
          Apache HTTPD: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/servers/http/apache-httpd/2.4.nix" target="_top" shape="rect"><code class="filename">pkgs/servers/http/apache-httpd/2.4.nix</code></a>. A bunch of optional features, variable substitutions in the configure flags, a post-install hook, and miscellaneous hackery.
         </p></li><li class="listitem"><p>
          Thunderbird: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/networking/mailreaders/thunderbird/default.nix" target="_top" shape="rect"><code class="filename">pkgs/applications/networking/mailreaders/thunderbird/default.nix</code></a>. Lots of dependencies.
         </p></li><li class="listitem"><p>
          JDiskReport, a Java utility: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/tools/misc/jdiskreport/default.nix" target="_top" shape="rect"><code class="filename">pkgs/tools/misc/jdiskreport/default.nix</code></a>. Nixpkgs doesn’t have a decent <code class="varname">stdenv</code> for Java yet so this is pretty ad-hoc.
         </p></li><li class="listitem"><p>
          XML::Simple, a Perl module: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/perl-packages.nix" target="_top" shape="rect"><code class="filename">pkgs/top-level/perl-packages.nix</code></a> (search for the <code class="varname">XMLSimple</code> attribute). Most Perl modules are so simple to build that they are defined directly in <code class="filename">perl-packages.nix</code>; no need to make a separate file for them.
         </p></li><li class="listitem"><p>
          Adobe Reader: <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/misc/adobe-reader/default.nix" target="_top" shape="rect"><code class="filename">pkgs/applications/misc/adobe-reader/default.nix</code></a>. Shows how binary-only packages can be supported. In particular the <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/misc/adobe-reader/builder.sh" target="_top" shape="rect">builder</a> uses <span class="command"><strong>patchelf</strong></span> to set the RUNPATH and ELF interpreter of the executables so that the right libraries are found at runtime.
         </p></li></ul></div><p>
      </p><p>
       Some notes:
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          All <code class="varname"><a class="varname" href="https://nixos.org/manual/nixpkgs/stable/#chap-meta" title="Chapter 7. Meta-attributes" shape="rect">meta</a></code> attributes are optional, but it’s still a good idea to provide at least the <code class="varname">description</code>, <code class="varname">homepage</code> and <code class="varname"><a class="varname" href="https://nixos.org/manual/nixpkgs/stable/#sec-meta-license" title="7.2. Licenses" shape="rect">license</a></code>.
         </p></li><li class="listitem"><p>
          You can use <span class="command"><strong>nix-prefetch-url</strong></span> <em class="replaceable"><code>url</code></em> to get the SHA-256 hash of source distributions. There are similar commands as <span class="command"><strong>nix-prefetch-git</strong></span> and <span class="command"><strong>nix-prefetch-hg</strong></span> available in <code class="literal">nix-prefetch-scripts</code> package.
         </p></li><li class="listitem"><p>
          A list of schemes for <code class="literal">mirror://</code> URLs can be found in <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/build-support/fetchurl/mirrors.nix" target="_top" shape="rect"><code class="filename">pkgs/build-support/fetchurl/mirrors.nix</code></a>.
         </p></li></ul></div><p>
      </p><p>
       The exact syntax and semantics of the Nix expression language, including the built-in function, are described in the Nix manual in the <a class="link" href="https://hydra.nixos.org/job/nix/trunk/tarball/latest/download-by-type/doc/manual/#chap-writing-nix-expressions" target="_top" shape="rect">chapter on writing Nix expressions</a>.
      </p></li><li class="listitem"><p>
       Add a call to the function defined in the previous step to <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/all-packages.nix" target="_top" shape="rect"><code class="filename">pkgs/top-level/all-packages.nix</code></a> with some descriptive name for the variable, e.g. <code class="varname">libfoo</code>.
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>emacs pkgs/top-level/all-packages.nix</pre><p>
      </p><p>
       The attributes in that file are sorted by category (like “Development / Libraries”) that more-or-less correspond to the directory structure of Nixpkgs, and then by attribute name.
      </p></li><li class="listitem"><p>
       To test whether the package builds, run the following command from the root of the nixpkgs source tree:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-build -A libfoo</pre><p>
       where <code class="varname">libfoo</code> should be the variable name defined in the previous step. You may want to add the flag <code class="option">-K</code> to keep the temporary build directory in case something fails. If the build succeeds, a symlink <code class="filename">./result</code> to the package in the Nix store is created.
      </p></li><li class="listitem"><p>
       If you want to install the package into your profile (optional), do
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>nix-env -f . -iA libfoo</pre><p>
      </p></li><li class="listitem"><p>
       Optionally commit the new package and open a pull request <a class="link" href="https://github.com/NixOS/nixpkgs/pulls" target="_top" shape="rect">to nixpkgs</a>, or use <a class="link" href="https://discourse.nixos.org/t/about-the-patches-category/477" target="_top" shape="rect"> the Patches category</a> on Discourse for sending a patch without a GitHub account.
      </p></li></ol></div><p>
   </p></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-conventions" class="title">Chapter&nbsp;18.&nbsp;Coding conventions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-conventions" aria-label="Anchor link for: chap conventions" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-syntax" shape="rect">18.1. Syntax</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-package-naming" shape="rect">18.2. Package naming</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-organisation" shape="rect">18.3. File naming and organisation</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-sources" shape="rect">18.4. Fetching Sources</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes" shape="rect">18.5. Obtaining source hash</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#sec-patches" shape="rect">18.6. Patches</a></span></dt></dl></div><section class="section"><div class="titlepage"><div><div><h2 id="sec-syntax" class="title" style="clear: both">18.1.&nbsp;Syntax<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-syntax" aria-label="Anchor link for: sec syntax" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Use 2 spaces of indentation per indentation level in Nix expressions, 4 spaces in shell scripts.
      </p></li><li class="listitem"><p>
       Do not use tab characters, i.e. configure your editor to use soft tabs. For instance, use <code class="literal">(setq-default indent-tabs-mode nil)</code> in Emacs. Everybody has different tab settings so it’s asking for trouble.
      </p></li><li class="listitem"><p>
       Use <code class="literal">lowerCamelCase</code> for variable names, not <code class="literal">UpperCamelCase</code>. Note, this rule does not apply to package attribute names, which instead follow the rules in <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-package-naming" title="18.2. Package naming" shape="rect">Section&nbsp;18.2, “Package naming”</a>.
      </p></li><li class="listitem"><p>
       Function calls with attribute set arguments are written as
</p><pre class="programlisting hljs nix" xml:space="preserve">foo {
  <span class="hljs-attr"><span class="hljs-attr">arg</span></span> = ...;
}
</pre><p>
       not
</p><pre class="programlisting hljs nix" xml:space="preserve">foo
{
  <span class="hljs-attr"><span class="hljs-attr">arg</span></span> = ...;
}
</pre><p>
       Also fine is
</p><pre class="programlisting hljs nix" xml:space="preserve">foo { <span class="hljs-attr"><span class="hljs-attr">arg</span></span> = ...; }
</pre><p>
       if it's a short call.
      </p></li><li class="listitem"><p>
       In attribute sets or lists that span multiple lines, the attribute names or list elements should be aligned:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment"># A long list.</span></span>
<span class="hljs-attr"><span class="hljs-attr">list</span></span> = [
  elem1
  elem2
  elem3
];

<span class="hljs-comment"><span class="hljs-comment"># A long attribute set.</span></span>
<span class="hljs-attr"><span class="hljs-attr">attrs</span></span> = {
  <span class="hljs-attr"><span class="hljs-attr">attr1</span></span> = short_expr;
  <span class="hljs-attr"><span class="hljs-attr">attr2</span></span> =
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> big_expr <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> big_expr;
};

<span class="hljs-comment"><span class="hljs-comment"># Combined</span></span>
<span class="hljs-attr"><span class="hljs-attr">listOfAttrs</span></span> = [
  {
    <span class="hljs-attr"><span class="hljs-attr">attr1</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">attr2</span></span> = <span class="hljs-string"><span class="hljs-string">"fff"</span></span>;
  }
  {
    <span class="hljs-attr"><span class="hljs-attr">attr1</span></span> = <span class="hljs-number"><span class="hljs-number">5</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">attr2</span></span> = <span class="hljs-string"><span class="hljs-string">"ggg"</span></span>;
  }
];
</pre><p>
      </p></li><li class="listitem"><p>
       Short lists or attribute sets can be written on one line:
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment"># A short list.</span></span>
<span class="hljs-attr"><span class="hljs-attr">list</span></span> = [ elem1 elem2 elem3 ];

<span class="hljs-comment"><span class="hljs-comment"># A short set.</span></span>
<span class="hljs-attr"><span class="hljs-attr">attrs</span></span> = { <span class="hljs-attr"><span class="hljs-attr">x</span></span> = <span class="hljs-number"><span class="hljs-number">1280</span></span>; <span class="hljs-attr"><span class="hljs-attr">y</span></span> = <span class="hljs-number"><span class="hljs-number">1024</span></span>; };
</pre><p>
      </p></li><li class="listitem"><p>
       Breaking in the middle of a function argument can give hard-to-read code, like
</p><pre class="programlisting hljs nix" xml:space="preserve">someFunction { <span class="hljs-attr"><span class="hljs-attr">x</span></span> = <span class="hljs-number"><span class="hljs-number">1280</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">y</span></span> = <span class="hljs-number"><span class="hljs-number">1024</span></span>; } otherArg
  yetAnotherArg
</pre><p>
       (especially if the argument is very large, spanning multiple lines).
      </p><p>
       Better:
</p><pre class="programlisting hljs nix" xml:space="preserve">someFunction
  { <span class="hljs-attr"><span class="hljs-attr">x</span></span> = <span class="hljs-number"><span class="hljs-number">1280</span></span>; <span class="hljs-attr"><span class="hljs-attr">y</span></span> = <span class="hljs-number"><span class="hljs-number">1024</span></span>; }
  otherArg
  yetAnotherArg
</pre><p>
       or
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-attr"><span class="hljs-attr">res</span></span> = { <span class="hljs-attr"><span class="hljs-attr">x</span></span> = <span class="hljs-number"><span class="hljs-number">1280</span></span>; <span class="hljs-attr"><span class="hljs-attr">y</span></span> = <span class="hljs-number"><span class="hljs-number">1024</span></span>; };
<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> someFunction res otherArg yetAnotherArg
</pre><p>
      </p></li><li class="listitem"><p>
       The bodies of functions, asserts, and withs are not indented to prevent a lot of superfluous indentation levels, i.e.
</p><pre class="programlisting hljs nix" xml:space="preserve">{ arg1, arg2 }:
<span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-attr"><span class="hljs-attr">system</span></span> == <span class="hljs-string"><span class="hljs-string">"i686-linux"</span></span>;
stdenv.mkDerivation { ...
</pre><p>
       not
</p><pre class="programlisting hljs nix" xml:space="preserve">{ arg1, arg2 }:
  <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-attr"><span class="hljs-attr">system</span></span> == <span class="hljs-string"><span class="hljs-string">"i686-linux"</span></span>;
    stdenv.mkDerivation { ...
</pre><p>
      </p></li><li class="listitem"><p>
       Function formal arguments are written as:
</p><pre class="programlisting hljs" xml:space="preserve">{ arg1, arg2, arg3 }:
</pre><p>
       but if they don't fit on one line they're written as:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ arg1, arg2, arg3
, arg4, ...
, <span class="hljs-comment"><span class="hljs-comment"># Some comment...</span></span>
  argN
}:
</pre><p>
      </p></li><li class="listitem"><p>
       Functions should list their expected arguments as precisely as possible. That is, write
</p><pre class="programlisting hljs" xml:space="preserve">{ stdenv, fetchurl, perl }: <em class="replaceable"><code>...</code></em>
</pre><p>
       instead of
</p><pre class="programlisting hljs nix" xml:space="preserve">args: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> args; <em class="replaceable"><code>...</code></em>
</pre><p>
       or
</p><pre class="programlisting hljs" xml:space="preserve">{ stdenv, fetchurl, perl, ... }: <em class="replaceable"><code>...</code></em>
</pre><p>
      </p><p>
       For functions that are truly generic in the number of arguments (such as wrappers around <code class="varname">mkDerivation</code>) that have some required arguments, you should write them using an <code class="literal">@</code>-pattern:
</p><pre class="programlisting hljs nix" xml:space="preserve">{ stdenv, doCoverageAnalysis ? <span class="hljs-literal"><span class="hljs-literal">false</span></span>, ... } @ args:

stdenv.mkDerivation (args // {
  <em class="replaceable"><code>...</code></em> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> doCoverageAnalysis <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">"bla"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <em class="replaceable"><code>...</code></em>
})
</pre><p>
       instead of
</p><pre class="programlisting hljs nix" xml:space="preserve">args:

args.stdenv.mkDerivation (args // {
  <em class="replaceable"><code>...</code></em> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> args ? doCoverageAnalysis &amp;&amp; args.doCoverageAnalysis <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">"bla"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <em class="replaceable"><code>...</code></em>
})
</pre><p>
      </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-package-naming" class="title" style="clear: both">18.2.&nbsp;Package naming<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-package-naming" aria-label="Anchor link for: sec package naming" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The key words <span class="emphasis"><em>must</em></span>, <span class="emphasis"><em>must not</em></span>, <span class="emphasis"><em>required</em></span>, <span class="emphasis"><em>shall</em></span>, <span class="emphasis"><em>shall not</em></span>, <span class="emphasis"><em>should</em></span>, <span class="emphasis"><em>should not</em></span>, <span class="emphasis"><em>recommended</em></span>, <span class="emphasis"><em>may</em></span>, and <span class="emphasis"><em>optional</em></span> in this section are to be interpreted as described in <a class="link" href="https://tools.ietf.org/html/rfc2119" target="_top" shape="rect">RFC 2119</a>. Only <span class="emphasis"><em>emphasized</em></span> words are to be interpreted in this way.
    </p><p>
     In Nixpkgs, there are generally three different names associated with a package:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The <code class="varname">name</code> attribute of the derivation (excluding the version part). This is what most users see, in particular when using <span class="command"><strong>nix-env</strong></span>.
       </p></li><li class="listitem"><p>
        The variable name used for the instantiated package in <code class="filename">all-packages.nix</code>, and when passing it as a dependency to other functions. Typically this is called the <span class="emphasis"><em>package attribute name</em></span>. This is what Nix expression authors see. It can also be used when installing using <span class="command"><strong>nix-env -iA</strong></span>.
       </p></li><li class="listitem"><p>
        The filename for (the directory containing) the Nix expression.
       </p></li></ul></div><p>
     Most of the time, these are the same. For instance, the package <code class="literal">e2fsprogs</code> has a <code class="varname">name</code> attribute <code class="literal">"e2fsprogs-<em class="replaceable"><code>version</code></em>"</code>, is bound to the variable name <code class="varname">e2fsprogs</code> in <code class="filename">all-packages.nix</code>, and the Nix expression is in <code class="filename">pkgs/os-specific/linux/e2fsprogs/default.nix</code>.
    </p><p>
     There are a few naming guidelines:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The <code class="literal">name</code> attribute <span class="emphasis"><em>should</em></span> be identical to the upstream package name.
       </p></li><li class="listitem"><p>
        The <code class="literal">name</code> attribute <span class="emphasis"><em>must not</em></span> contain uppercase letters — e.g., <code class="literal">"mplayer-1.0rc2"</code> instead of <code class="literal">"MPlayer-1.0rc2"</code>.
       </p></li><li class="listitem"><p>
        The version part of the <code class="literal">name</code> attribute <span class="emphasis"><em>must</em></span> start with a digit (following a dash) — e.g., <code class="literal">"hello-0.3.1rc2"</code>.
       </p></li><li class="listitem"><p>
        If a package is not a release but a commit from a repository, then the version part of the name <span class="emphasis"><em>must</em></span> be the date of that (fetched) commit. The date <span class="emphasis"><em>must</em></span> be in <code class="literal">"YYYY-MM-DD"</code> format. Also append <code class="literal">"unstable"</code> to the name - e.g., <code class="literal">"pkgname-unstable-2014-09-23"</code>.
       </p></li><li class="listitem"><p>
        Dashes in the package name <span class="emphasis"><em>should</em></span> be preserved in new variable names, rather than converted to underscores or camel cased — e.g., <code class="varname">http-parser</code> instead of <code class="varname">http_parser</code> or <code class="varname">httpParser</code>. The hyphenated style is preferred in all three package names.
       </p></li><li class="listitem"><p>
        If there are multiple versions of a package, this <span class="emphasis"><em>should</em></span> be reflected in the variable names in <code class="filename">all-packages.nix</code>, e.g. <code class="varname">json-c-0-9</code> and <code class="varname">json-c-0-11</code>. If there is an obvious “default” version, make an attribute like <code class="literal">json-c = json-c-0-9;</code>. See also <a class="xref" href="https://nixos.org/manual/nixpkgs/stable/#sec-versioning" title="18.3.2. Versioning" shape="rect">Section&nbsp;18.3.2, “Versioning”</a>
       </p></li></ul></div><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-organisation" class="title" style="clear: both">18.3.&nbsp;File naming and organisation<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-organisation" aria-label="Anchor link for: sec organisation" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Names of files and directories should be in lowercase, with dashes between words — not in camel case. For instance, it should be <code class="filename">all-packages.nix</code>, not <code class="filename">allPackages.nix</code> or <code class="filename">AllPackages.nix</code>.
    </p><section class="section"><div class="titlepage"><div><div><h3 id="sec-hierarchy" class="title">18.3.1.&nbsp;Hierarchy<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-hierarchy" aria-label="Anchor link for: sec hierarchy" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Each package should be stored in its own directory somewhere in the <code class="filename">pkgs/</code> tree, i.e. in <code class="filename">pkgs/<em class="replaceable"><code>category</code></em>/<em class="replaceable"><code>subcategory</code></em>/<em class="replaceable"><code>...</code></em>/<em class="replaceable"><code>pkgname</code></em></code>. Below are some rules for picking the right category for a package. Many packages fall under several categories; what matters is the <span class="emphasis"><em>primary</em></span> purpose of a package. For example, the <code class="literal">libxml2</code> package builds both a library and some tools; but it’s a library foremost, so it goes under <code class="filename">pkgs/development/libraries</code>.
     </p><p>
      When in doubt, consider refactoring the <code class="filename">pkgs/</code> tree, e.g. creating new categories or splitting up an existing category.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        If it’s used to support <span class="emphasis"><em>software development</em></span>:
       </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           If it’s a <span class="emphasis"><em>library</em></span> used by other packages:
          </span></dt><dd><p>
            <code class="filename">development/libraries</code> (e.g. <code class="filename">libxml2</code>)
           </p></dd><dt><span class="term">
           If it’s a <span class="emphasis"><em>compiler</em></span>:
          </span></dt><dd><p>
            <code class="filename">development/compilers</code> (e.g. <code class="filename">gcc</code>)
           </p></dd><dt><span class="term">
           If it’s an <span class="emphasis"><em>interpreter</em></span>:
          </span></dt><dd><p>
            <code class="filename">development/interpreters</code> (e.g. <code class="filename">guile</code>)
           </p></dd><dt><span class="term">
           If it’s a (set of) development <span class="emphasis"><em>tool(s)</em></span>:
          </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              If it’s a <span class="emphasis"><em>parser generator</em></span> (including lexers):
             </span></dt><dd><p>
               <code class="filename">development/tools/parsing</code> (e.g. <code class="filename">bison</code>, <code class="filename">flex</code>)
              </p></dd><dt><span class="term">
              If it’s a <span class="emphasis"><em>build manager</em></span>:
             </span></dt><dd><p>
               <code class="filename">development/tools/build-managers</code> (e.g. <code class="filename">gnumake</code>)
              </p></dd><dt><span class="term">
              Else:
             </span></dt><dd><p>
               <code class="filename">development/tools/misc</code> (e.g. <code class="filename">binutils</code>)
              </p></dd></dl></div></dd><dt><span class="term">
           Else:
          </span></dt><dd><p>
            <code class="filename">development/misc</code>
           </p></dd></dl></div></dd><dt><span class="term">
        If it’s a (set of) <span class="emphasis"><em>tool(s)</em></span>:
       </span></dt><dd><p>
         (A tool is a relatively small program, especially one intended to be used non-interactively.)
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           If it’s for <span class="emphasis"><em>networking</em></span>:
          </span></dt><dd><p>
            <code class="filename">tools/networking</code> (e.g. <code class="filename">wget</code>)
           </p></dd><dt><span class="term">
           If it’s for <span class="emphasis"><em>text processing</em></span>:
          </span></dt><dd><p>
            <code class="filename">tools/text</code> (e.g. <code class="filename">diffutils</code>)
           </p></dd><dt><span class="term">
           If it’s a <span class="emphasis"><em>system utility</em></span>, i.e., something related or essential to the operation of a system:
          </span></dt><dd><p>
            <code class="filename">tools/system</code> (e.g. <code class="filename">cron</code>)
           </p></dd><dt><span class="term">
           If it’s an <span class="emphasis"><em>archiver</em></span> (which may include a compression function):
          </span></dt><dd><p>
            <code class="filename">tools/archivers</code> (e.g. <code class="filename">zip</code>, <code class="filename">tar</code>)
           </p></dd><dt><span class="term">
           If it’s a <span class="emphasis"><em>compression</em></span> program:
          </span></dt><dd><p>
            <code class="filename">tools/compression</code> (e.g. <code class="filename">gzip</code>, <code class="filename">bzip2</code>)
           </p></dd><dt><span class="term">
           If it’s a <span class="emphasis"><em>security</em></span>-related program:
          </span></dt><dd><p>
            <code class="filename">tools/security</code> (e.g. <code class="filename">nmap</code>, <code class="filename">gnupg</code>)
           </p></dd><dt><span class="term">
           Else:
          </span></dt><dd><p>
            <code class="filename">tools/misc</code>
           </p></dd></dl></div></dd><dt><span class="term">
        If it’s a <span class="emphasis"><em>shell</em></span>:
       </span></dt><dd><p>
         <code class="filename">shells</code> (e.g. <code class="filename">bash</code>)
        </p></dd><dt><span class="term">
        If it’s a <span class="emphasis"><em>server</em></span>:
       </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           If it’s a web server:
          </span></dt><dd><p>
            <code class="filename">servers/http</code> (e.g. <code class="filename">apache-httpd</code>)
           </p></dd><dt><span class="term">
           If it’s an implementation of the X Windowing System:
          </span></dt><dd><p>
            <code class="filename">servers/x11</code> (e.g. <code class="filename">xorg</code> — this includes the client libraries and programs)
           </p></dd><dt><span class="term">
           Else:
          </span></dt><dd><p>
            <code class="filename">servers/misc</code>
           </p></dd></dl></div></dd><dt><span class="term">
        If it’s a <span class="emphasis"><em>desktop environment</em></span>:
       </span></dt><dd><p>
         <code class="filename">desktops</code> (e.g. <code class="filename">kde</code>, <code class="filename">gnome</code>, <code class="filename">enlightenment</code>)
        </p></dd><dt><span class="term">
        If it’s a <span class="emphasis"><em>window manager</em></span>:
       </span></dt><dd><p>
         <code class="filename">applications/window-managers</code> (e.g. <code class="filename">awesome</code>, <code class="filename">stumpwm</code>)
        </p></dd><dt><span class="term">
        If it’s an <span class="emphasis"><em>application</em></span>:
       </span></dt><dd><p>
         A (typically large) program with a distinct user interface, primarily used interactively.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           If it’s a <span class="emphasis"><em>version management system</em></span>:
          </span></dt><dd><p>
            <code class="filename">applications/version-management</code> (e.g. <code class="filename">subversion</code>)
           </p></dd><dt><span class="term">
           If it’s for <span class="emphasis"><em>video playback / editing</em></span>:
          </span></dt><dd><p>
            <code class="filename">applications/video</code> (e.g. <code class="filename">vlc</code>)
           </p></dd><dt><span class="term">
           If it’s for <span class="emphasis"><em>graphics viewing / editing</em></span>:
          </span></dt><dd><p>
            <code class="filename">applications/graphics</code> (e.g. <code class="filename">gimp</code>)
           </p></dd><dt><span class="term">
           If it’s for <span class="emphasis"><em>networking</em></span>:
          </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              If it’s a <span class="emphasis"><em>mailreader</em></span>:
             </span></dt><dd><p>
               <code class="filename">applications/networking/mailreaders</code> (e.g. <code class="filename">thunderbird</code>)
              </p></dd><dt><span class="term">
              If it’s a <span class="emphasis"><em>newsreader</em></span>:
             </span></dt><dd><p>
               <code class="filename">applications/networking/newsreaders</code> (e.g. <code class="filename">pan</code>)
              </p></dd><dt><span class="term">
              If it’s a <span class="emphasis"><em>web browser</em></span>:
             </span></dt><dd><p>
               <code class="filename">applications/networking/browsers</code> (e.g. <code class="filename">firefox</code>)
              </p></dd><dt><span class="term">
              Else:
             </span></dt><dd><p>
               <code class="filename">applications/networking/misc</code>
              </p></dd></dl></div></dd><dt><span class="term">
           Else:
          </span></dt><dd><p>
            <code class="filename">applications/misc</code>
           </p></dd></dl></div></dd><dt><span class="term">
        If it’s <span class="emphasis"><em>data</em></span> (i.e., does not have a straight-forward executable semantics):
       </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           If it’s a <span class="emphasis"><em>font</em></span>:
          </span></dt><dd><p>
            <code class="filename">data/fonts</code>
           </p></dd><dt><span class="term">
           If it’s an <span class="emphasis"><em>icon theme</em></span>:
          </span></dt><dd><p>
            <code class="filename">data/icons</code>
           </p></dd><dt><span class="term">
           If it’s related to <span class="emphasis"><em>SGML/XML processing</em></span>:
          </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              If it’s an <span class="emphasis"><em>XML DTD</em></span>:
             </span></dt><dd><p>
               <code class="filename">data/sgml+xml/schemas/xml-dtd</code> (e.g. <code class="filename">docbook</code>)
              </p></dd><dt><span class="term">
              If it’s an <span class="emphasis"><em>XSLT stylesheet</em></span>:
             </span></dt><dd><p>
               (Okay, these are executable...)
              </p><p>
               <code class="filename">data/sgml+xml/stylesheets/xslt</code> (e.g. <code class="filename">docbook-xsl</code>)
              </p></dd></dl></div></dd><dt><span class="term">
           If it’s a <span class="emphasis"><em>theme</em></span> for a <span class="emphasis"><em>desktop environment</em></span>, a <span class="emphasis"><em>window manager</em></span> or a <span class="emphasis"><em>display manager</em></span>:
          </span></dt><dd><p>
            <code class="filename">data/themes</code>
           </p></dd></dl></div></dd><dt><span class="term">
        If it’s a <span class="emphasis"><em>game</em></span>:
       </span></dt><dd><p>
         <code class="filename">games</code>
        </p></dd><dt><span class="term">
        Else:
       </span></dt><dd><p>
         <code class="filename">misc</code>
        </p></dd></dl></div></section><section class="section"><div class="titlepage"><div><div><h3 id="sec-versioning" class="title">18.3.2.&nbsp;Versioning<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-versioning" aria-label="Anchor link for: sec versioning" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Because every version of a package in Nixpkgs creates a potential maintenance burden, old versions of a package should not be kept unless there is a good reason to do so. For instance, Nixpkgs contains several versions of GCC because other packages don’t build with the latest version of GCC. Other examples are having both the latest stable and latest pre-release version of a package, or to keep several major releases of an application that differ significantly in functionality.
     </p><p>
      If there is only one version of a package, its Nix expression should be named <code class="filename">e2fsprogs/default.nix</code>. If there are multiple versions, this should be reflected in the filename, e.g. <code class="filename">e2fsprogs/1.41.8.nix</code> and <code class="filename">e2fsprogs/1.41.9.nix</code>. The version in the filename should leave out unnecessary detail. For instance, if we keep the latest Firefox 2.0.x and 3.5.x versions in Nixpkgs, they should be named <code class="filename">firefox/2.0.nix</code> and <code class="filename">firefox/3.5.nix</code>, respectively (which, at a given point, might contain versions <code class="literal">2.0.0.20</code> and <code class="literal">3.5.4</code>). If a version requires many auxiliary files, you can use a subdirectory for each version, e.g. <code class="filename">firefox/2.0/default.nix</code> and <code class="filename">firefox/3.5/default.nix</code>.
     </p><p>
      All versions of a package <span class="emphasis"><em>must</em></span> be included in <code class="filename">all-packages.nix</code> to make sure that they evaluate correctly.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-sources" class="title" style="clear: both">18.4.&nbsp;Fetching Sources<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-sources" aria-label="Anchor link for: sec sources" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     There are multiple ways to fetch a package source in nixpkgs. The general guideline is that you should package reproducible sources with a high degree of availability. Right now there is only one fetcher which has mirroring support and that is <code class="literal">fetchurl</code>. Note that you should also prefer protocols which have a corresponding proxy environment variable.
    </p><p>
     You can find many source fetch helpers in <code class="literal">pkgs/build-support/fetch*</code>.
    </p><p>
     In the file <code class="literal">pkgs/top-level/all-packages.nix</code> you can find fetch helpers, these have names on the form <code class="literal">fetchFrom*</code>. The intention of these are to provide snapshot fetches but using the same api as some of the version controlled fetchers from <code class="literal">pkgs/build-support/</code>. As an example going from bad to good:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Bad: Uses <code class="literal">git://</code> which won't be proxied.
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchgit {
  <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"git://github.com/NixOS/nix.git"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"1f795f9f44607cc5bec70d1300150bfefcef2aae"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1cw5fszffl5pkpa6s6wjnkiv6lm5k618s32sp60kvmvpy7a2v9kg"</span></span>;
}
</pre><p>
       </p></li><li class="listitem"><p>
        Better: This is ok, but an archive fetch will still be faster.
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchgit {
  <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://github.com/NixOS/nix.git"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"1f795f9f44607cc5bec70d1300150bfefcef2aae"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1cw5fszffl5pkpa6s6wjnkiv6lm5k618s32sp60kvmvpy7a2v9kg"</span></span>;
}
</pre><p>
       </p></li><li class="listitem"><p>
        Best: Fetches a snapshot archive and you get the rev you want.
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">src</span></span> = fetchFromGitHub {
  <span class="hljs-attr"><span class="hljs-attr">owner</span></span> = <span class="hljs-string"><span class="hljs-string">"NixOS"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">repo</span></span> = <span class="hljs-string"><span class="hljs-string">"nix"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">rev</span></span> = <span class="hljs-string"><span class="hljs-string">"1f795f9f44607cc5bec70d1300150bfefcef2aae"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1i2yxndxb6yc9l6c99pypbd92lfq5aac4klq7y2v93c9qvx2cgpc"</span></span>;
}
</pre><p>
        Find the value to put as <code class="literal">sha256</code> by running <code class="literal">nix run -f '&lt;nixpkgs&gt;' nix-prefetch-github -c nix-prefetch-github --rev 1f795f9f44607cc5bec70d1300150bfefcef2aae NixOS nix</code> or <code class="literal">nix-prefetch-url --unpack https://github.com/NixOS/nix/archive/1f795f9f44607cc5bec70d1300150bfefcef2aae.tar.gz</code>.
       </p></li></ul></div><p>
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-source-hashes" class="title" style="clear: both">18.5.&nbsp;Obtaining source hash<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes" aria-label="Anchor link for: sec source hashes" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Preferred source hash type is sha256. There are several ways to get it.
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Prefetch URL (with <code class="literal">nix-prefetch-<em class="replaceable"><code>XXX</code></em> <em class="replaceable"><code>URL</code></em></code>, where <em class="replaceable"><code>XXX</code></em> is one of <code class="literal">url</code>, <code class="literal">git</code>, <code class="literal">hg</code>, <code class="literal">cvs</code>, <code class="literal">bzr</code>, <code class="literal">svn</code>). Hash is printed to stdout.
      </p></li><li class="listitem"><p>
       Prefetch by package source (with <code class="literal">nix-prefetch-url '&lt;nixpkgs&gt;' -A <em class="replaceable"><code>PACKAGE</code></em>.src</code>, where <em class="replaceable"><code>PACKAGE</code></em> is package attribute name). Hash is printed to stdout.
      </p><p>
       This works well when you've upgraded existing package version and want to find out new hash, but is useless if package can't be accessed by attribute or package has multiple sources (<code class="literal">.srcs</code>, architecture-dependent sources, etc).
      </p></li><li class="listitem"><p>
       Upstream provided hash: use it when upstream provides <code class="literal">sha256</code> or <code class="literal">sha512</code> (when upstream provides <code class="literal">md5</code>, don't use it, compute <code class="literal">sha256</code> instead).
      </p><p>
       A little nuance is that <code class="literal">nix-prefetch-*</code> tools produce hash encoded with <code class="literal">base32</code>, but upstream usually provides hexadecimal (<code class="literal">base16</code>) encoding. Fetchers understand both formats. Nixpkgs does not standardize on any one format.
      </p><p>
       You can convert between formats with nix-hash, for example:
</p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code>nix-hash --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> sha256 --to-base32 <em class="replaceable"><code>HASH</code></em>
</pre><p>
      </p></li><li class="listitem"><p>
       Extracting hash from local source tarball can be done with <code class="literal">sha256sum</code>. Use <code class="literal">nix-prefetch-url file:///path/to/tarball </code> if you want base32 hash.
      </p></li><li class="listitem"><p>
       Fake hash: set fake hash in package expression, perform build and extract correct hash from error Nix prints.
      </p><p>
       For package updates it is enough to change one symbol to make hash fake. For new packages, you can use <code class="literal">lib.fakeSha256</code>, <code class="literal">lib.fakeSha512</code> or any other fake hash.
      </p><p>
       This is last resort method when reconstructing source URL is non-trivial and <code class="literal">nix-prefetch-url -A</code> isn't applicable (for example, <a class="link" href="https://github.com/NixOS/nixpkgs/blob/d2ab091dd308b99e4912b805a5eb088dd536adb9/pkgs/applications/video/kodi/default.nix#L73" target="_top" shape="rect"> one of <code class="literal">kodi</code> dependencies</a>). The easiest way then would be replace hash with a fake one and rebuild. Nix build will fail and error message will contain desired hash.
      </p><div class="alert alert-warning"><strong>Warning:</strong> 
        This method has security problems. Check below for details.
       </div></li></ol></div><section class="section"><div class="titlepage"><div><div><h3 id="sec-source-hashes-security" class="title">18.5.1.&nbsp;Obtaining hashes securely<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-source-hashes-security" aria-label="Anchor link for: sec source hashes security" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Let's say Man-in-the-Middle (MITM) sits close to your network. Then instead of fetching source you can fetch malware, and instead of source hash you get hash of malware. Here are security considerations for this scenario:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">http://</code> URLs are not secure to prefetch hash from;
       </p></li><li class="listitem"><p>
        hashes from upstream (in method 3) should be obtained via secure protocol;
       </p></li><li class="listitem"><p>
        <code class="literal">https://</code> URLs are secure in methods 1, 2, 3;
       </p></li><li class="listitem"><p>
        <code class="literal">https://</code> URLs are not secure in method 5. When obtaining hashes with fake hash method, TLS checks are disabled. So refetch source hash from several different networks to exclude MITM scenario. Alternatively, use fake hash method to make Nix error, but instead of extracting hash from error, extract <code class="literal">https://</code> URL and prefetch it with method 1.
       </p></li></ul></div></section></section><section class="section"><div class="titlepage"><div><div><h2 id="sec-patches" class="title" style="clear: both">18.6.&nbsp;Patches<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#sec-patches" aria-label="Anchor link for: sec patches" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Patches available online should be retrieved using <code class="literal">fetchpatch</code>.
    </p><p>
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">patches</span></span> = [
  (fetchpatch {
    <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"fix-check-for-using-shared-freetype-lib.patch"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"http://git.ghostscript.com/?p=ghostpdl.git;a=patch;h=8f5d285"</span></span>;
    <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"1f0k043rng7f0rfl9hhb89qzvvksqmkrikmm38p61yfx51l325xr"</span></span>;
  })
];
</pre><p>
    </p><p>
     Otherwise, you can add a <code class="literal">.patch</code> file to the <code class="literal">nixpkgs</code> repository. In the interest of keeping our maintenance burden to a minimum, only patches that are unique to <code class="literal">nixpkgs</code> should be added in this way.
    </p><p>
</p><pre class="programlisting hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">patches</span></span> = [ ./<span class="hljs-number"><span class="hljs-number">0001</span></span>-changes.patch ];
</pre><p>
    </p><p>
     If you do need to do create this sort of patch file, one way to do so is with git:
     </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
        Move to the root directory of the source code you're patching.
</p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> the/program/<span class="hljs-built_in"><span class="hljs-built_in">source</span></span></pre><p>
       </p></li><li class="listitem"><p>
        If a git repository is not already present, create one and stage all of the source files.
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>git init
<code class="prompt">$ </code>git add .</pre><p>
       </p></li><li class="listitem"><p>
        Edit some files to make whatever changes need to be included in the patch.
       </p></li><li class="listitem"><p>
        Use git to create a diff, and pipe the output to a patch file:
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>git diff &gt; nixpkgs/pkgs/the/package/0001-changes.patch</pre><p>
       </p></li></ol></div><p>
    </p></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-submitting-changes" class="title">Chapter&nbsp;19.&nbsp;Submitting changes<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-submitting-changes" aria-label="Anchor link for: chap submitting changes" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-making-patches" shape="rect">19.1. Making patches</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-submitting-changes" shape="rect">19.2. Submitting changes</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-submitting-security-fixes" shape="rect">19.3. Submitting security fixes</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-pull-request-template" shape="rect">19.4. Pull Request Template</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-hotfixing-pull-requests" shape="rect">19.5. Hotfixing pull requests</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-commit-policy" shape="rect">19.6. Commit policy</a></span></dt></dl></div><section class="section"><div class="titlepage"><div><div><h2 id="submitting-changes-making-patches" class="title" style="clear: both">19.1.&nbsp;Making patches<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-making-patches" aria-label="Anchor link for: submitting changes making patches" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Read <a class="link" href="https://nixos.org/nixpkgs/manual/" target="_top" shape="rect">Manual (How to write packages for Nix)</a>.
      </p></li><li class="listitem"><p>
       Fork <a class="link" href="https://github.com/nixos/nixpkgs/" target="_top" shape="rect">the Nixpkgs repository</a> on GitHub.
      </p></li><li class="listitem"><p>
       Create a branch for your future fix.
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          You can make branch from a commit of your local <span class="command"><strong>nixos-version</strong></span>. That will help you to avoid additional local compilations. Because you will receive packages from binary cache. For example
</p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code>nixos-version --<span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>
0998212
<code class="prompt">$ </code>git checkout 0998212
<code class="prompt">$ </code>git checkout -b <span class="hljs-string"><span class="hljs-string">'fix/pkg-name-update'</span></span>
</pre><p>
         </p></li><li class="listitem"><p>
          Please avoid working directly on the <span class="command"><strong>master</strong></span> branch.
         </p></li></ul></div><p>
      </p></li><li class="listitem"><p>
       Make commits of logical units.
      </p></li><li class="listitem"><p>
       If you removed pkgs or made some major NixOS changes, write about it in the release notes for the next stable release. For example <span class="command"><strong>nixos/doc/manual/release-notes/rl-2003.xml</strong></span>.
      </p></li><li class="listitem"><p>
       Check for unnecessary whitespace with <span class="command"><strong>git diff --check</strong></span> before committing.
      </p></li><li class="listitem"><p>
       Format the commit in a following way:
      </p><pre class="programlisting hljs" xml:space="preserve">(pkg-name | nixos/&lt;module&gt;): (from -&gt; to | init at version | refactor | etc)
Additional information.
</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         Examples:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
            <span class="command"><strong>nginx: init at 2.0.1</strong></span>
           </p></li><li class="listitem"><p>
            <span class="command"><strong>firefox: 54.0.1 -&gt; 55.0</strong></span>
           </p></li><li class="listitem"><p>
            <span class="command"><strong>nixos/hydra: add bazBaz option</strong></span>
           </p></li><li class="listitem"><p>
            <span class="command"><strong>nixos/nginx: refactor config generation</strong></span>
           </p></li></ul></div><p>
        </p></li></ul></div></li><li class="listitem"><p>
       Test your changes. If you work with
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          nixpkgs:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
             update pkg -&gt;
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <span class="command"><strong>nix-env -i pkg-name -f &lt;path to your local nixpkgs folder&gt;</strong></span>
               </p></li></ul></div><p>
            </p></li><li class="listitem"><p>
             add pkg -&gt;
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Make sure it's in <span class="command"><strong>pkgs/top-level/all-packages.nix</strong></span>
               </p></li><li class="listitem"><p>
                <span class="command"><strong>nix-env -i pkg-name -f &lt;path to your local nixpkgs folder&gt;</strong></span>
               </p></li></ul></div><p>
            </p></li><li class="listitem"><p>
             <span class="emphasis"><em>If you don't want to install pkg in you profile</em></span>.
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <span class="command"><strong>nix-build -A pkg-attribute-name &lt;path to your local nixpkgs folder&gt;/default.nix</strong></span> and check results in the folder <span class="command"><strong>result</strong></span>. It will appear in the same directory where you did <span class="command"><strong>nix-build</strong></span>.
               </p></li></ul></div><p>
            </p></li><li class="listitem"><p>
             If you did <span class="command"><strong>nix-env -i pkg-name</strong></span> you can do <span class="command"><strong>nix-env -e pkg-name</strong></span> to uninstall it from your system.
            </p></li></ul></div><p>
         </p></li><li class="listitem"><p>
          NixOS and its modules:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
             You can add new module to your NixOS configuration file (usually it's <span class="command"><strong>/etc/nixos/configuration.nix</strong></span>). And do <span class="command"><strong>sudo nixos-rebuild test -I nixpkgs=&lt;path to your local nixpkgs folder&gt; --fast</strong></span>.
            </p></li></ul></div><p>
         </p></li></ul></div><p>
      </p></li><li class="listitem"><p>
       If you have commits <span class="command"><strong>pkg-name: oh, forgot to insert whitespace</strong></span>: squash commits in this case. Use <span class="command"><strong>git rebase -i</strong></span>.
      </p></li><li class="listitem"><p>
       <a class="link" href="https://git-scm.com/book/en/v2/Git-Branching-Rebasing" target="_top" shape="rect">Rebase</a> your branch against current <span class="command"><strong>master</strong></span>.
      </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h2 id="submitting-changes-submitting-changes" class="title" style="clear: both">19.2.&nbsp;Submitting changes<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-submitting-changes" aria-label="Anchor link for: submitting changes submitting changes" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Push your changes to your fork of nixpkgs.
      </p></li><li class="listitem"><p>
       Create the pull request
      </p></li><li class="listitem"><p>
       Follow <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/.github/CONTRIBUTING.md#submitting-changes" target="_top" shape="rect">the contribution guidelines</a>.
      </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h2 id="submitting-changes-submitting-security-fixes" class="title" style="clear: both">19.3.&nbsp;Submitting security fixes<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-submitting-security-fixes" aria-label="Anchor link for: submitting changes submitting security fixes" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Security fixes are submitted in the same way as other changes and thus the same guidelines apply.
    </p><p>
     If the security fix comes in the form of a patch and a CVE is available, then the name of the patch should be the CVE identifier, so e.g. <code class="literal">CVE-2019-13636.patch</code> in the case of a patch that is included in the Nixpkgs tree. If a patch is fetched the name needs to be set as well, e.g.:
    </p><pre class="programlisting hljs nix" xml:space="preserve">(fetchpatch {
  <span class="hljs-attr"><span class="hljs-attr">name</span></span> = <span class="hljs-string"><span class="hljs-string">"CVE-2019-11068.patch"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://gitlab.gnome.org/GNOME/libxslt/commit/e03553605b45c88f0b4b2980adfbbb8f6fca2fd6.patch"</span></span>;
  <span class="hljs-attr"><span class="hljs-attr">sha256</span></span> = <span class="hljs-string"><span class="hljs-string">"0pkpb4837km15zgg6h57bncp66d5lwrlvkr73h0lanywq7zrwhj8"</span></span>;
})
</pre><p>
     If a security fix applies to both master and a stable release then, similar to regular changes, they are preferably delivered via master first and cherry-picked to the release branch.
    </p><p>
     Critical security fixes may by-pass the staging branches and be delivered directly to release branches such as <code class="literal">master</code> and <code class="literal">release-*</code>.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="submitting-changes-pull-request-template" class="title" style="clear: both">19.4.&nbsp;Pull Request Template<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-pull-request-template" aria-label="Anchor link for: submitting changes pull request template" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     The pull request template helps determine what steps have been made for a contribution so far, and will help guide maintainers on the status of a change. The motivation section of the PR should include any extra details the title does not address and link any existing issues related to the pull request.
    </p><p>
     When a PR is created, it will be pre-populated with some checkboxes detailed below:
    </p><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-tested-with-sandbox" class="title">19.4.1.&nbsp;Tested using sandboxing<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-with-sandbox" aria-label="Anchor link for: submitting changes tested with sandbox" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      When sandbox builds are enabled, Nix will setup an isolated environment for each build process. It is used to remove further hidden dependencies set by the build environment to improve reproducibility. This includes access to the network during the build outside of <code class="function">fetch*</code> functions and files outside the Nix store. Depending on the operating system access to other resources are blocked as well (ex. inter process communication is isolated on Linux); see <a class="link" href="https://nixos.org/nix/manual/#conf-sandbox" target="_top" shape="rect">sandbox</a> in Nix manual for details.
     </p><p>
      Sandboxing is not enabled by default in Nix due to a small performance hit on each build. In pull requests for <a class="link" href="https://github.com/NixOS/nixpkgs/" target="_top" shape="rect">nixpkgs</a> people are asked to test builds with sandboxing enabled (see <code class="literal">Tested using sandboxing</code> in the pull request template) because in<a class="link" href="https://nixos.org/hydra/" target="_top" shape="rect">https://nixos.org/hydra/</a> sandboxing is also used.
     </p><p>
      Depending if you use NixOS or other platforms you can use one of the following methods to enable sandboxing <span class="bold"><strong>before</strong></span> building the package:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <span class="bold"><strong>Globally enable sandboxing on NixOS</strong></span>: add the following to <code class="filename">configuration.nix</code>
</p><pre class="screen hljs nix" xml:space="preserve">nix.<span class="hljs-attr"><span class="hljs-attr">useSandbox</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</pre><p>
        </p></li><li class="listitem"><p>
         <span class="bold"><strong>Globally enable sandboxing on non-NixOS platforms</strong></span>: add the following to: <code class="filename">/etc/nix/nix.conf</code>
</p><pre class="screen hljs nix" xml:space="preserve"><span class="hljs-attr"><span class="hljs-attr">sandbox</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span></pre><p>
        </p></li></ul></div><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-platform-diversity" class="title">19.4.2.&nbsp;Built on platform(s)<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-platform-diversity" aria-label="Anchor link for: submitting changes platform diversity" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Many Nix packages are designed to run on multiple platforms. As such, it's important to let the maintainer know which platforms your changes have been tested on. It's not always practical to test a change on all platforms, and is not required for a pull request to be merged. Only check the systems you tested the build on in this section.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-nixos-tests" class="title">19.4.3.&nbsp;Tested via one or more NixOS test(s) if existing and applicable for the change (look inside nixos/tests)<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-nixos-tests" aria-label="Anchor link for: submitting changes nixos tests" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      Packages with automated tests are much more likely to be merged in a timely fashion because it doesn't require as much manual testing by the maintainer to verify the functionality of the package. If there are existing tests for the package, they should be run to verify your changes do not break the tests. Tests only apply to packages with NixOS modules defined and can only be run on Linux. For more details on writing and running tests, see the <a class="link" href="https://nixos.org/nixos/manual/index.html#sec-nixos-tests" target="_top" shape="rect">section in the NixOS manual</a>.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-tested-compilation" class="title">19.4.4.&nbsp;Tested compilation of all pkgs that depend on this change using <span class="command"><strong>nixpkgs-review</strong></span><a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-compilation" aria-label="Anchor link for: submitting changes tested compilation" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      If you are updating a package's version, you can use nixpkgs-review to make sure all packages that depend on the updated package still compile correctly. The <span class="command"><strong>nixpkgs-review</strong></span> utility can look for and build all dependencies either based on uncommited changes with the <code class="literal">wip</code> option or specifying a github pull request number.
     </p><p>
      review changes from pull request number 12345:
</p><pre class="screen hljs" xml:space="preserve">nix run nixpkgs.nixpkgs-review -c nixpkgs-review pr 12345</pre><p>
     </p><p>
      review uncommitted changes:
</p><pre class="screen hljs" xml:space="preserve">nix run nixpkgs.nixpkgs-review -c nixpkgs-review wip</pre><p>
     </p><p>
      review changes from last commit:
</p><pre class="screen hljs" xml:space="preserve">nix run nixpkgs.nixpkgs-review -c nixpkgs-review rev HEAD</pre><p>
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-tested-execution" class="title">19.4.5.&nbsp;Tested execution of all binary files (usually in <code class="filename">./result/bin/</code>)<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-tested-execution" aria-label="Anchor link for: submitting changes tested execution" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      It's important to test any executables generated by a build when you change or create a package in nixpkgs. This can be done by looking in <code class="filename">./result/bin</code> and running any files in there, or at a minimum, the main executable for the package. For example, if you make a change to <span class="package">texlive</span>, you probably would only check the binaries associated with the change you made rather than testing all of them.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-contribution-standards" class="title">19.4.6.&nbsp;Meets Nixpkgs contribution standards<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-contribution-standards" aria-label="Anchor link for: submitting changes contribution standards" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The last checkbox is fits <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/.github/CONTRIBUTING.md" target="_top" shape="rect">CONTRIBUTING.md</a>. The contributing document has detailed information on standards the Nix community has for commit messages, reviews, licensing of contributions you make to the project, etc... Everyone should read and understand the standards the community has for contributing before submitting a pull request.
     </p></section></section><section class="section"><div class="titlepage"><div><div><h2 id="submitting-changes-hotfixing-pull-requests" class="title" style="clear: both">19.5.&nbsp;Hotfixing pull requests<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-hotfixing-pull-requests" aria-label="Anchor link for: submitting changes hotfixing pull requests" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Make the appropriate changes in you branch.
      </p></li><li class="listitem"><p>
       Don't create additional commits, do
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <span class="command"><strong>git rebase -i</strong></span>
         </p></li><li class="listitem"><p>
          <span class="command"><strong>git push --force</strong></span> to your branch.
         </p></li></ul></div><p>
      </p></li></ul></div></section><section class="section"><div class="titlepage"><div><div><h2 id="submitting-changes-commit-policy" class="title" style="clear: both">19.6.&nbsp;Commit policy<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-commit-policy" aria-label="Anchor link for: submitting changes commit policy" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Commits must be sufficiently tested before being merged, both for the master and staging branches.
      </p></li><li class="listitem"><p>
       Hydra builds for master and staging should not be used as testing platform, it's a build farm for changes that have been already tested.
      </p></li><li class="listitem"><p>
       When changing the bootloader installation process, extra care must be taken. Grub installations cannot be rolled back, hence changes may break people's installations forever. For any non-trivial change to the bootloader please file a PR asking for review, especially from @edolstra.
      </p></li></ul></div><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-master-branch" class="title">19.6.1.&nbsp;Master branch<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-master-branch" aria-label="Anchor link for: submitting changes master branch" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The <code class="literal">master</code> branch is the main development branch. It should only see non-breaking commits that do not cause mass rebuilds.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-staging-branch" class="title">19.6.2.&nbsp;Staging branch<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-staging-branch" aria-label="Anchor link for: submitting changes staging branch" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The <code class="literal">staging</code> branch is a development branch where mass-rebuilds go. It should only see non-breaking mass-rebuild commits. That means it is not to be used for testing, and changes must have been well tested already. If the branch is already in a broken state, please refrain from adding extra new breakages.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-staging-next-branch" class="title">19.6.3.&nbsp;Staging-next branch<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-staging-next-branch" aria-label="Anchor link for: submitting changes staging next branch" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      The <code class="literal">staging-next</code> branch is for stabilizing mass-rebuilds submitted to the <code class="literal">staging</code> branch prior to merging them into <code class="literal">master</code>. Mass-rebuilds should go via the <code class="literal">staging</code> branch. It should only see non-breaking commits that are fixing issues blocking it from being merged into the <code class="literal">master </code> branch.
     </p><p>
      If the branch is already in a broken state, please refrain from adding extra new breakages. Stabilize it for a few days and then merge into master.
     </p></section><section class="section"><div class="titlepage"><div><div><h3 id="submitting-changes-stable-release-branches" class="title">19.6.4.&nbsp;Stable release branches<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#submitting-changes-stable-release-branches" aria-label="Anchor link for: submitting changes stable release branches" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3></div></div></div><p>
      For cherry-picking a commit to a stable release branch (<span class="quote">“<span class="quote">backporting</span>”</span>), use <code class="literal">git cherry-pick -x &lt;original commit&gt;</code> so that the original commit id is included in the commit.
     </p><p>
      Add a reason for the backport by using <code class="literal">git cherry-pick -xe &lt;original commit&gt;</code> instead when it is not obvious from the original commit message. It is not needed when it’s a minor version update that includes security and bug fixes but don’t add new features or when the commit fixes an otherwise broken package.
     </p><p>
      Here is an example of a cherry-picked commit message with good reason description:
     </p><pre class="screen hljs nix" xml:space="preserve">zfs: Keep trying root <span class="hljs-built_in"><span class="hljs-built_in">import</span></span> until it works

Works around <span class="hljs-comment"><span class="hljs-comment">#11003.</span></span>

(cherry picked from commit <span class="hljs-number"><span class="hljs-number">98</span></span>b213a11041af39b39473906b595290e2a4e2f9)

Reason: several people cannot boot <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ZFS on NVMe
</pre><p>
      Other examples of reasons are:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Previously the build would fail due to, e.g., <code class="literal">getaddrinfo</code> not being defined
       </p></li><li class="listitem"><p>
        The previous download links were all broken
       </p></li><li class="listitem"><p>
        Crash when starting on some X11 systems
       </p></li></ul></div></section></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-reviewing-contributions" class="title">Chapter&nbsp;20.&nbsp;Reviewing contributions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-reviewing-contributions" aria-label="Anchor link for: chap reviewing contributions" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-package-updates" shape="rect">20.1. Package updates</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-new-packages" shape="rect">20.2. New packages</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-module-updates" shape="rect">20.3. Module updates</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-new-modules" shape="rect">20.4. New modules</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-other-submissions" shape="rect">20.5. Other submissions</a></span></dt><dt><span class="section"><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions--merging-pull-requests" shape="rect">20.6. Merging pull requests</a></span></dt></dl></div><div class="alert alert-warning"><strong>Warning:</strong> 
     The following section is a draft, and the policy for reviewing is still being discussed in issues such as <a class="link" href="https://github.com/NixOS/nixpkgs/issues/11166" target="_top" shape="rect">#11166 </a> and <a class="link" href="https://github.com/NixOS/nixpkgs/issues/20836" target="_top" shape="rect">#20836 </a>.
    </div><p>
    The Nixpkgs project receives a fairly high number of contributions via GitHub pull requests. Reviewing and approving these is an important task and a way to contribute to the project.
   </p><p>
    The high change rate of Nixpkgs makes any pull request that remains open for too long subject to conflicts that will require extra work from the submitter or the merger. Reviewing pull requests in a timely manner and being responsive to the comments is the key to avoid this issue. GitHub provides sort filters that can be used to see the <a class="link" href="https://github.com/NixOS/nixpkgs/pulls?q=is%3Apr+is%3Aopen+sort%3Aupdated-desc" target="_top" shape="rect">most recently</a> and the <a class="link" href="https://github.com/NixOS/nixpkgs/pulls?q=is%3Apr+is%3Aopen+sort%3Aupdated-asc" target="_top" shape="rect">least recently</a> updated pull requests. We highly encourage looking at <a class="link" href="https://github.com/NixOS/nixpkgs/pulls?q=is%3Apr+is%3Aopen+review%3Anone+status%3Asuccess+-label%3A%222.status%3A+work-in-progress%22+no%3Aproject+no%3Aassignee+no%3Amilestone" target="_top" shape="rect"> this list of ready to merge, unreviewed pull requests</a>.
   </p><p>
    When reviewing a pull request, please always be nice and polite. Controversial changes can lead to controversial opinions, but it is important to respect every community member and their work.
   </p><p>
    GitHub provides reactions as a simple and quick way to provide feedback to pull requests or any comments. The thumb-down reaction should be used with care and if possible accompanied with some explanation so the submitter has directions to improve their contribution.
   </p><p>
    pull request reviews should include a list of what has been reviewed in a comment, so other reviewers and mergers can know the state of the review.
   </p><p>
    All the review template samples provided in this section are generic and meant as examples. Their usage is optional and the reviewer is free to adapt them to their liking.
   </p><section class="section"><div class="titlepage"><div><div><h2 id="reviewing-contributions-package-updates" class="title" style="clear: both">20.1.&nbsp;Package updates<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-package-updates" aria-label="Anchor link for: reviewing contributions package updates" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     A package update is the most trivial and common type of pull request. These pull requests mainly consist of updating the version part of the package name and the source hash.
    </p><p>
     It can happen that non-trivial updates include patches or more complex changes.
    </p><p>
     Reviewing process:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Add labels to the pull request. (Requires commit rights)
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <code class="literal">8.has: package (update)</code> and any topic label that fit the updated package.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the package versioning fits the guidelines.
      </p></li><li class="listitem"><p>
       Ensure that the commit text fits the guidelines.
      </p></li><li class="listitem"><p>
       Ensure that the package maintainers are notified.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <a class="link" href="https://help.github.com/articles/about-codeowners/" target="_top" shape="rect">CODEOWNERS</a> will make GitHub notify users based on the submitted changes, but it can happen that it misses some of the package maintainers.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the meta field information is correct.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         License can change with version updates, so it should be checked to match the upstream license.
        </p></li><li class="listitem"><p>
         If the package has no maintainer, a maintainer must be set. This can be the update submitter or a community member that accepts to take maintainership of the package.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the code contains no typos.
      </p></li><li class="listitem"><p>
       Building the package locally.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         pull requests are often targeted to the master or staging branch, and building the pull request locally when it is submitted can trigger many source builds.
        </p><p>
         It is possible to rebase the changes on nixos-unstable or nixpkgs-unstable for easier review by running the following commands from a nixpkgs clone.
</p><pre class="screen hljs" xml:space="preserve"><code class="prompt">$ </code>git fetch origin nixos-unstable <a id="reviewing-rebase-2" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span>
<code class="prompt">$ </code>git fetch origin pull/PRNUMBER/head <a id="reviewing-rebase-3" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span>
<code class="prompt">$ </code>git rebase --onto nixos-unstable BASEBRANCH FETCH_HEAD <a id="reviewing-rebase-4" shape="rect"></a><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span>
</pre><p>
         </p><div class="calloutlist"><table class="table table-striped" border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-rebase-2" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/1.svg" alt="1" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
            Fetching the nixos-unstable branch.
           </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-rebase-3" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/2.svg" alt="2" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
            Fetching the pull request changes, <code class="varname">PRNUMBER</code> is the number at the end of the pull request title and <code class="varname">BASEBRANCH</code> the base branch of the pull request.
           </p></td></tr><tr><td width="5%" valign="top" align="left" rowspan="1" colspan="1"><p><a href="https://nixos.org/manual/nixpkgs/stable/#reviewing-rebase-4" shape="rect"><span><img src="./Nixpkgs-Manual-Version-20.09_files/3.svg" alt="3" border="0"></span></a> </p></td><td valign="top" align="left" rowspan="1" colspan="1"><p>
            Rebasing the pull request changes to the nixos-unstable branch.
           </p></td></tr></tbody></table></div><p>
        </p></li><li class="listitem"><p>
         The <a class="link" href="https://github.com/Mic92/nixpkgs-review" target="_top" shape="rect">nixpkgs-review</a> tool can be used to review a pull request content in a single command. <code class="varname">PRNUMBER</code> should be replaced by the number at the end of the pull request title. You can also provide the full github pull request url.
        </p><pre class="screen hljs nix" xml:space="preserve"><code class="prompt">$ </code>nix-shell -p nixpkgs-review --run <span class="hljs-string"><span class="hljs-string">"nixpkgs-review pr PRNUMBER"</span></span>
</pre></li></ul></div></li><li class="listitem"><p>
       Running every binary.
      </p></li></ul></div><div class="example"><a id="reviewing-contributions-sample-package-update" shape="rect"></a><p class="title"><strong>Example&nbsp;20.1.&nbsp;Sample template for a package update review</strong></p><div class="example-contents"><pre class="screen hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">##### Reviewed points</span></span>

- [ ] package name fits guidelines
- [ ] package version fits guidelines
- [ ] package build on ARCHITECTURE
- [ ] executables tested on ARCHITECTURE
- [ ] all depending packages build

<span class="hljs-comment"><span class="hljs-comment">##### Possible improvements</span></span>

<span class="hljs-comment"><span class="hljs-comment">##### Comments</span></span>

</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h2 id="reviewing-contributions-new-packages" class="title" style="clear: both">20.2.&nbsp;New packages<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-new-packages" aria-label="Anchor link for: reviewing contributions new packages" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     New packages are a common type of pull requests. These pull requests consists in adding a new nix-expression for a package.
    </p><p>
     Reviewing process:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Add labels to the pull request. (Requires commit rights)
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <code class="literal">8.has: package (new)</code> and any topic label that fit the new package.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the package versioning is fitting the guidelines.
      </p></li><li class="listitem"><p>
       Ensure that the commit name is fitting the guidelines.
      </p></li><li class="listitem"><p>
       Ensure that the meta field contains correct information.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         License must be checked to be fitting upstream license.
        </p></li><li class="listitem"><p>
         Platforms should be set or the package will not get binary substitutes.
        </p></li><li class="listitem"><p>
         A maintainer must be set. This can be the package submitter or a community member that accepts to take maintainership of the package.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the code contains no typos.
      </p></li><li class="listitem"><p>
       Ensure the package source.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         Mirrors urls should be used when available.
        </p></li><li class="listitem"><p>
         The most appropriate function should be used (e.g. packages from GitHub should use <code class="literal">fetchFromGitHub</code>).
        </p></li></ul></div></li><li class="listitem"><p>
       Building the package locally.
      </p></li><li class="listitem"><p>
       Running every binary.
      </p></li></ul></div><div class="example"><a id="reviewing-contributions-sample-new-package" shape="rect"></a><p class="title"><strong>Example&nbsp;20.2.&nbsp;Sample template for a new package review</strong></p><div class="example-contents"><pre class="screen hljs bash" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">##### Reviewed points</span></span>

- [ ] package path fits guidelines
- [ ] package name fits guidelines
- [ ] package version fits guidelines
- [ ] package build on ARCHITECTURE
- [ ] executables tested on ARCHITECTURE
- [ ] `meta.description` is <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> and fits guidelines
- [ ] `meta.license` fits upstream license
- [ ] `meta.platforms` is <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>
- [ ] `meta.maintainers` is <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>
- [ ] build time only dependencies are declared <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> `nativeBuildInputs`
- [ ] <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> is fetched using the appropriate <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>
- [ ] phases are respected
- [ ] patches that are remotely available are fetched with `fetchpatch`

<span class="hljs-comment"><span class="hljs-comment">##### Possible improvements</span></span>

<span class="hljs-comment"><span class="hljs-comment">##### Comments</span></span>

</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h2 id="reviewing-contributions-module-updates" class="title" style="clear: both">20.3.&nbsp;Module updates<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-module-updates" aria-label="Anchor link for: reviewing contributions module updates" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Module updates are submissions changing modules in some ways. These often contains changes to the options or introduce new options.
    </p><p>
     Reviewing process
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Add labels to the pull request. (Requires commit rights)
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <code class="literal">8.has: module (update)</code> and any topic label that fit the module.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the module maintainers are notified.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <a class="link" href="https://help.github.com/articles/about-codeowners/" target="_top" shape="rect">CODEOWNERS</a> will make GitHub notify users based on the submitted changes, but it can happen that it misses some of the package maintainers.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the module tests, if any, are succeeding.
      </p></li><li class="listitem"><p>
       Ensure that the introduced options are correct.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         Type should be appropriate (string related types differs in their merging capabilities, <code class="literal">optionSet</code> and <code class="literal">string</code> types are deprecated).
        </p></li><li class="listitem"><p>
         Description, default and example should be provided.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that option changes are backward compatible.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <code class="literal">mkRenamedOptionModule</code> and <code class="literal">mkAliasOptionModule</code> functions provide way to make option changes backward compatible.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that removed options are declared with <code class="literal">mkRemovedOptionModule</code>
      </p></li><li class="listitem"><p>
       Ensure that changes that are not backward compatible are mentioned in release notes.
      </p></li><li class="listitem"><p>
       Ensure that documentations affected by the change is updated.
      </p></li></ul></div><div class="example"><a id="reviewing-contributions-sample-module-update" shape="rect"></a><p class="title"><strong>Example&nbsp;20.3.&nbsp;Sample template for a module update review</strong></p><div class="example-contents"><pre class="screen hljs nix" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">##### Reviewed points</span></span>

- [ ] changes are backward compatible
- [ ] removed options are declared <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> `mkRemovedOptionModule`
- [ ] changes that are not backward compatible are documented <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> release notes
- [ ] module tests succeed on ARCHITECTURE
- [ ] options types are appropriate
- [ ] options description is set
- [ ] options example is provided
- [ ] documentation affected by the changes is updated

<span class="hljs-comment"><span class="hljs-comment">##### Possible improvements</span></span>

<span class="hljs-comment"><span class="hljs-comment">##### Comments</span></span>

</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h2 id="reviewing-contributions-new-modules" class="title" style="clear: both">20.4.&nbsp;New modules<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-new-modules" aria-label="Anchor link for: reviewing contributions new modules" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     New modules submissions introduce a new module to NixOS.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Add labels to the pull request. (Requires commit rights)
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <code class="literal">8.has: module (new)</code> and any topic label that fit the module.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the module tests, if any, are succeeding.
      </p></li><li class="listitem"><p>
       Ensure that the introduced options are correct.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         Type should be appropriate (string related types differs in their merging capabilities, <code class="literal">optionSet</code> and <code class="literal">string</code> types are deprecated).
        </p></li><li class="listitem"><p>
         Description, default and example should be provided.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that module <code class="literal">meta</code> field is present
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         Maintainers should be declared in <code class="literal">meta.maintainers</code>.
        </p></li><li class="listitem"><p>
         Module documentation should be declared with <code class="literal">meta.doc</code>.
        </p></li></ul></div></li><li class="listitem"><p>
       Ensure that the module respect other modules functionality.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         For example, enabling a module should not open firewall ports by default.
        </p></li></ul></div></li></ul></div><div class="example"><a id="reviewing-contributions-sample-new-module" shape="rect"></a><p class="title"><strong>Example&nbsp;20.4.&nbsp;Sample template for a new module review</strong></p><div class="example-contents"><pre class="screen hljs bash" xml:space="preserve"><span class="hljs-comment"><span class="hljs-comment">##### Reviewed points</span></span>

- [ ] module path fits the guidelines
- [ ] module tests succeed on ARCHITECTURE
- [ ] options have appropriate types
- [ ] options have default
- [ ] options have example
- [ ] options have descriptions
- [ ] No unneeded package is added to environment.systemPackages
- [ ] meta.maintainers is <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>
- [ ] module documentation is declared <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> meta.doc

<span class="hljs-comment"><span class="hljs-comment">##### Possible improvements</span></span>

<span class="hljs-comment"><span class="hljs-comment">##### Comments</span></span>

</pre></div></div><br class="example-break" clear="none"><br></section><section class="section"><div class="titlepage"><div><div><h2 id="reviewing-contributions-other-submissions" class="title" style="clear: both">20.5.&nbsp;Other submissions<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions-other-submissions" aria-label="Anchor link for: reviewing contributions other submissions" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     Other type of submissions requires different reviewing steps.
    </p><p>
     If you consider having enough knowledge and experience in a topic and would like to be a long-term reviewer for related submissions, please contact the current reviewers for that topic. They will give you information about the reviewing process. The main reviewers for a topic can be hard to find as there is no list, but checking past pull requests to see who reviewed or git-blaming the code to see who committed to that topic can give some hints.
    </p><p>
     Container system, boot system and library changes are some examples of the pull requests fitting this category.
    </p></section><section class="section"><div class="titlepage"><div><div><h2 id="reviewing-contributions--merging-pull-requests" class="title" style="clear: both">20.6.&nbsp;Merging pull requests<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#reviewing-contributions--merging-pull-requests" aria-label="Anchor link for: reviewing contributions  merging pull requests" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
     It is possible for community members that have enough knowledge and experience on a special topic to contribute by merging pull requests.
    </p><p>
     TODO: add the procedure to request merging rights.
    </p><p>
     In a case a contributor definitively leaves the Nix community, they should create an issue or post on <a class="link" href="https://discourse.nixos.org/" target="_top" shape="rect">Discourse</a> with references of packages and modules they maintain so the maintainership can be taken over by other contributors.
    </p></section></section><section class="chapter"><div class="titlepage"><div><div><h2 id="chap-contributing" class="title">Chapter&nbsp;21.&nbsp;Contributing to this documentation<a class="anchorjs-link " href="https://nixos.org/manual/nixpkgs/stable/#chap-contributing" aria-label="Anchor link for: chap contributing" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2></div></div></div><p>
    The DocBook sources of the Nixpkgs manual are in the <code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/tree/master/doc" target="_top" shape="rect">doc</a></code> subdirectory of the Nixpkgs repository.
   </p><p>
    You can quickly check your edits with <span class="command"><strong>make</strong></span>:
   </p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /path/to/nixpkgs/doc
<code class="prompt">$ </code>nix-shell
<code class="prompt">[nix-shell]$ </code>make
</pre><p>
    If you experience problems, run <span class="command"><strong>make debug</strong></span> to help understand the docbook errors.
   </p><p>
    After making modifications to the manual, it's important to build it before committing. You can do that as follows:
</p><pre class="screen hljs bash" xml:space="preserve"><code class="prompt">$ </code><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /path/to/nixpkgs/doc
<code class="prompt">$ </code>nix-shell
<code class="prompt">[nix-shell]$ </code>make clean
<code class="prompt">[nix-shell]$ </code>nix-build .
</pre><p>
    If the build succeeds, the manual will be in <code class="filename">./result/share/doc/nixpkgs/manual.html</code>.
   </p></section></div></div><ul xmlns="http://www.w3.org/1999/xhtml" class="hidden"></ul>
</section>
  </main>

  <footer>
    <div>
      <div class="upper">
        <section>
          <h4>The project</h4>
          <ul>
            <li><a href="https://status.nixos.org/">Channel Status</a></li>
            <li><a href="https://search.nixos.org/packages">Packages search</a></li>
            <li><a href="https://search.nixos.org/options">Options search</a></li>
            <li><a href="https://nixos.org/teams/security.html">Security</a></li>
          </ul>
        </section>
        <section>
          <h4>Get in Touch</h4>
          <ul>
            <li><a href="https://discourse.nixos.org/">Forum</a></li>
            <li><a href="https://webchat.freenode.net/#nixos">Chat</a></li>
            <li><a href="https://nixos.org/commercial-support.html">Commercial support</a></li>
          </ul>
        </section>
        <section>
          <h4>Contribute</h4>
          <ul>
            <li><a href="https://nixos.org/guides/contributing.html">Contributing Guide</a></li>
            <li><a href="https://nixos.org/donate.html">Donate</a></li>
          </ul>
        </section>
        <section>
          <h4>Stay up to date</h4>
          <ul>
            <li><a href="https://nixos.org/news.html">Announcements</a></li>
            <li><a href="https://weekly.nixos.org/">Newsletter</a></li>
          </ul>
        </section>
      </div>
      <hr>
      <div class="lower">
        <section class="footer-copyright">
          <h4>NixOS</h4>
          <div>
            <span>
              Copyright © 2021 NixOS
            </span>
            <a href="https://github.com/NixOS/nixos-homepage/blob/master/LICENSES/CC-BY-SA-4.0.txt">
              <abbr title="Creative Commons Attribution Share Alike 4.0 International">
                CC-BY-SA-4.0
              </abbr>
            </a>
          </div>
        </section>
        <section class="footer-social">
          <h4>Connect with us</h4>
          <ul>
            <li class="social-icon -twitter"><a href="https://twitter.com/nixos_org">Twitter</a></li>
            <li class="social-icon -youtube"><a href="https://www.youtube.com/channel/UC3vIimi9q4AT8EgxYp_dWIw">Youtube</a></li>
            <li class="social-icon -github"><a href="https://github.com/NixOS">GitHub</a></li>
          </ul>
        </section>
      </div>
    </div>
  </footer>
  <script src="./Nixpkgs-Manual-Version-20.09_files/nixos-site.js"></script>  <script src="./Nixpkgs-Manual-Version-20.09_files/anchor.min.js"></script>
  <script>
    anchors.add('main h1, main h2, main h3');
  </script>

  <script src="./Nixpkgs-Manual-Version-20.09_files/manual-version-switch.js"></script><div style="background: #333333;color: #FFFFFF;padding: 0.5em 1em;position: fixed;bottom: 0.5em;right: 0.5em;font-size: 0.8em;"><div style="text-align: right;cursor: pointer;"><span>v: stable</span> <strong aria-hidden="true">＋</strong><strong style="display: none;" aria-hidden="true">－</strong></div><dl style="width: 240px;margin: 0 0 1em 0;display: none;"><dt style="color: #999999;">Channels:</dt><dd style="display: inline-block;margin-left: 1em;"><a style="color: #FFFFFF;font-weight: bold;text-decoration: none;" href="https://nixos.org/manual/nixpkgs/unstable">unstable (21.05)</a></dd><dd style="display: inline-block;margin-left: 1em;"><a style="color: #FFFFFF;font-weight: bold;text-decoration: none;" href="https://nixos.org/manual/nixpkgs/stable">stable (20.09)</a></dd></dl></div>



</body></html>